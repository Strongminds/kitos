<div class="row">
    <div class="col-md-4">
        <!-- Organization tree -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <span class="glyphicon glyphicon-list"></span>
                <h7 class="panel-title">Organisation</h7>
                <span class="pull-right" data-ng-hide="true || chosenOrgUnit.hasWriteAccess">Låst</span>
                <span class="pull-right" data-ng-show="chosenOrgUnit.hasWriteAccess">
                    <a data-ng-click="editUnit(chosenOrgUnit)">Rediger</a>
                </span>
            </div>
            <div class="panel-body">
                <div data-ng-repeat="node in nodes">
                    <div data-ng-include="'partials/org/org-unit.html'"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="row">

            <!-- if no org unit is selected, this is shown -->
            <div class="col-md-12" data-ng-hide="chosenOrgUnit">
                <h3>Vælg en organisationsenhed</h3>
                <p>Her kan du få overblik over de organisationsenheder, som du er tilknyttet.</p>
                <p>
                    <strong>Start med at vælge en organisationsenhed i oversigten til venstre.</strong>
                </p>
            </div>

            <!-- if an org unit has been selected -->
            <div class="col-md-12" data-ng-show="chosenOrgUnit">
                <h3>{{ chosenOrgUnit.name }} 
                    <span class="text-muted">({{ chosenOrgUnit.organization.name }})</span>
                </h3>

                <!-- Organization Roles -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="glyphicon glyphicon-user"></i>
                        Organisationsroller

                        <a class="pull-right"
                            data-ng-show="chosenOrgUnit.hasWriteAccess"
                            data-ng-click="chosenOrgUnit.editRights = !chosenOrgUnit.editRights">
                            <span data-ng-if="!chosenOrgUnit.editRights">Rediger</span>
                            <span data-ng-if="chosenOrgUnit.editRights">Afslut rediger</span>
                        </a>
                    </div>
                    <table class="full-width table org-role-table">
                        <thead>
                            <tr>
                                <th>
                                    <button class="btn btn-link btn-header" data-ng-click="rightSortChange('orgUnitName')">Organisationsenhed</button></th>
                                <th>
                                    <button class="btn btn-link btn-header" data-ng-click="rightSortChange('roleName')">Organisationsrolle</button></th>
                                <th>
                                    <button class="btn btn-link btn-header" data-ng-click="rightSortChange('userName')">Navn</button></th>
                                <th>
                                    <button class="btn btn-link btn-header" data-ng-click="rightSortChange('userEmail')">Email</button></th>
                            </tr>
                        </thead>
                        <!-- for each right -->
                        <tbody data-ng-repeat="right in chosenOrgUnit.orgRights | filter : { show: true } | orderBy : rightSort : rightSortReverse">

                            <!-- show -->
                            <tr data-ng-hide="right.edit">
                                <td>{{ orgUnits[right.objectId].name }}</td>
                                <td>{{ orgRoles[right.roleId].name }}</td>
                                <td>{{ right.user.name }}</td>
                                <td class="relative-position">{{ right.user.email }}
                                    <div data-ng-show="chosenOrgUnit.hasWriteAccess && chosenOrgUnit.editRights" class="pull-right">
                                        <a data-ng-click="right.edit = true" class="btn btn-info btn-xs">
                                            <i class="glyphicon glyphicon-pencil"></i>
                                        </a>
                                        <a class="btn btn-danger btn-xs"
                                            data-confirmed-click="deleteRight(right)"
                                            data-confirm-click="Er du sikker på at du vil fjerne denne rolle fra denne person? Du sletter ikke personen.">
                                            <i class="glyphicon glyphicon-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>

                            <!-- edit -->
                            <tr data-ng-show="right.edit">
                                <td>
                                    <input type="text" disabled="disabled" class="form-control input-sm" value="{{ orgUnits[right.objectId].name }}" />
                                </td>
                                <td>
                                    <select data-ui-select2="" name="selectRole" data-ng-model="right.roleForSelect" class="form-control input-sm">
                                        <option data-ng-repeat="orgRole in orgRoles" value="{{orgRole.id}}">{{orgRole.name}} ({{orgRole.hasWriteAccess && "skriv" || "læs" }})
                                        </option>
                                    </select>
                                </td>
                                <td colspan="2" class="relative-position">
                                    <input data-select-user="foo" data-user-model="right.userForSelect" />
                                    <div class="pull-outside-table">
                                        <input type="submit" class="btn btn-success btn-sm" data-ng-click="updateRight(right)" value="Gem" />
                                    </div>
                                </td>
                            </tr>
                        </tbody>

                        <!-- add-new-right row -->
                        <tbody data-ng-show="chosenOrgUnit.hasWriteAccess">
                            <tr>
                                <td>
                                    <input type="text" disabled="disabled" class="form-control input-sm" value="{{ chosenOrgUnit.name }}" /></td>
                                <td>
                                    <select data-ui-select2="" name="selectRole" data-ng-model="newRole" data-placeholder="Vælg en organisationsrolle" class="form-control input-sm" data-ng-change="submitRight()">
                                        <option data-ng-repeat="orgRole in orgRoles" value="{{orgRole.id}}">{{orgRole.name}} ({{orgRole.hasWriteAccess && "skriv" || "læs" }})
                                        </option>
                                    </select>
                                </td>
                                <td colspan="2" class="form-group">
                                    <input data-select-user="foo" data-user-model="selectedUser" data-add-user="true" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="glyphicon glyphicon-tasks"></i>
                        Tilknyttede opgaver
                        <a class="pull-right" data-ng-show="chosenOrgUnit.hasWriteAccess" data-ng-click="changeTaskView()">
                            <span data-ng-if="!showAllTasks">Vis alle</span>
                            <span data-ng-if="showAllTasks">Vis valgte</span>
                        </a>
                    </div>
                    <div class="panel-body">
                        <div data-kle-filter="selectedTaskGroup"></div>
                    </div>
                    <table class="table table-condensed">
                        <thead>
                            <tr>
                                <th>Valgt</th>
                                <th class="col-md-2">KLE ID
                                    <button data-order-by="showAllTasks && 'taskKey' || 'taskRef.taskKey'" data-paging="pagination"></button>
                                </th>
                                <th class="col-md-9">KLE Navn
                                    <button data-order-by="showAllTasks && 'description' || 'taskRef.description'" data-paging="pagination"></button>
                                </th>
                                <th>Overblik</th>
                                <th>Delegeret</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-ng-repeat="task in taskRefUsageList">
                                <!-- selected -->
                                <td>
                                    <input type="checkbox" id="{{task.taskRef.id}}" data-ng-checked="task.usage" data-ng-click="task.toggleUsage()" data-ng-disabled="!chosenOrgUnit.hasWriteAccess" />
                                </td>
                                <td>
                                    <label for="{{task.taskRef.id}}">{{task.taskRef.taskKey}}</label>
                                </td>
                                <td>
                                    <label for="{{task.taskRef.id}}">{{task.taskRef.description}}</label>
                                </td>
                                <td>
                                    <button class="btn btn-link btn-star" data-ng-if="task.usage"
                                        data-ng-class="{'unstarred': !task.usage.starred}"
                                        data-ng-click="task.toggleStar()"
                                        data-ng-disabled="!chosenOrgUnit.hasWriteAccess"
                                        data-tooltip="Vis under overblik?">
                                        <i class="glyphicon glyphicon-star"></i>
                                    </button>
                                </td>
                                <td>
                                    <span class="text-success" data-ng-show="task.usage.hasDelegations">
                                        <i class="glyphicon glyphicon-ok" data-tooltip="{{ task.usage.delegatedTo | joinBy:', ' }}" data-tooltip-placement="right"></i>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="5" class="text-center">
                                    <span>
                                        <button class="btn btn-success btn-sm" data-ng-click="selectAllTasks()" data-ng-if="chosenOrgUnit.hasWriteAccess">
                                            Vælg alle
                                        </button>
                                        <button class="btn btn-danger btn-sm" data-confirmed-click="removeAllTasks()" data-confirm-click="Er du sikker?" data-ng-if="chosenOrgUnit.hasWriteAccess">
                                            Fjern alle
                                        </button>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="5" class="text-center">
                                    <span data-pagination-buttons="pagination"></span>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
