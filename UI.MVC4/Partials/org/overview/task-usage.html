<div class="row task-usage-root" data-ng-if="!usage.hasDelegations">

    <!-- org unit name -->
    <div class="col-md-3">
        <i class="glyphicon glyphicon-asterisk small invisible"></i>
        {{ usage.orgUnitName }}
    </div>

    <!-- task description -->
    <div class="col-md-1">{{ usage.taskRefTaskKey }}</div>
    <div class="col-md-4">{{ usage.taskRefDescription }}</div>

    <!-- statuses -->
    <div class="col-md-2">
        <div class="status-column" data-ng-if="user.currentConfig.showColumnTechnology">
            <span data-select-status2="" data-ng-model="usage.technologyStatus" data-can-write="usage.hasWriteAccess"
                   data-autosave="{{usage.updateUrl}}" data-field="technologyStatus"></span>
        </div>
        <div class="status-column" data-ng-if="user.currentConfig.showColumnUsage">
            <span data-select-status2="" data-ng-model="usage.usageStatus" data-can-write="usage.hasWriteAccess"
                   data-autosave="{{usage.updateUrl}}" data-field="usageStatus"></span>
        </div>
        <div class="status-column">
            <button class="btn btn-link btn-xs"
                data-tooltip-html-unsafe="<small>{{ usage.comment && 'Læs kommentar' || 'Tilføj kommentar' }}</small>"
                data-tooltip-trigger="mouseenter"
                data-tooltip-placement="right"
                data-ng-click="openComment(usage)"
                data-ng-if="usage.hasWriteAccess">
                <i class="glyphicon glyphicon-comment" data-ng-class="{'faded': !usage.comment}"></i>
            </button>
            <button class="btn btn-link btn-xs"
                data-tooltip-html-unsafe="<small>Læs kommentar</small>"
                data-tooltip-trigger="mouseenter"
                data-tooltip-placement="right"
                data-ng-click="openComment(usage)"
                data-ng-if="!usage.hasWriteAccess && usage.comment">
                <i class="glyphicon glyphicon-comment"></i>
            </button>
        </div>
    </div>

    <!-- extra info -->
    <div class="col-md-1 text-center">
        <span data-ng-if="usage.projects.length > 0" class="text-success">
            <i class="glyphicon glyphicon-ok" data-tooltip="{{usage.projects | joinBy:', ':'name'}}"></i>
        </span>
    </div>
    <div class="col-md-1 text-center">
        <span data-ng-if="usage.systems.length > 0" class="text-success">
            <i class="glyphicon glyphicon-ok" data-tooltip="{{usage.systems | joinBy:', ':'itSystemName'}}"></i>
        </span>
    </div>
</div>

<div data-ng-if="usage.hasDelegations">
    <div class="row task-usage-root">

        <!-- org unit name -->
        <div class="col-md-3">
            <a class="task-fold" data-ng-click="usage.isOpen = !usage.isOpen">
                <i class="glyphicon small"
                    data-ng-class="{'glyphicon-chevron-down': usage.isOpen, 'glyphicon-chevron-right': !usage.isOpen}"></i>
                    {{ usage.orgUnitName }}
            </a>
        </div>

        <!-- task description -->
        <div class="col-md-1">{{ usage.taskRefTaskKey }}</div>
        <div class="col-md-4">{{ usage.taskRefDescription }}</div>

        <!-- statuses -->
        <div class="col-md-2">
            <div class="status-column" data-show-status="usage.calculatedTechStatus" data-ng-if="user.currentConfig.showColumnTechnology"></div>
            <div class="status-column" data-show-status="usage.calculatedUsageStatus" data-ng-if="user.currentConfig.showColumnUsage"></div>

            <div class="status-column">
                <button class="btn btn-link btn-xs"
                    data-tooltip-html-unsafe="<small>{{ usage.comment && 'Læs kommentar' || 'Tilføj kommentar' }}</small>"
                    data-tooltip-trigger="mouseenter"
                    data-tooltip-placement="right"
                    data-ng-click="openComment(usage)"
                    data-ng-if="usage.hasWriteAccess">
                    <i class="glyphicon glyphicon-comment" data-ng-class="{'faded': !usage.comment}"></i>
                </button>
                <button class="btn btn-link btn-xs"
                    data-tooltip-html-unsafe="<small>Læs kommentar</small>"
                    data-tooltip-trigger="mouseenter"
                    data-tooltip-placement="right"
                    data-ng-click="openComment(usage)"
                    data-ng-if="!usage.hasWriteAccess && usage.comment">
                    <i class="glyphicon glyphicon-comment"></i>
                </button>
            </div>
        </div>


        <!-- extra info -->
        <div class="col-md-1 text-center">
            <span data-ng-if="usage.projects.length > 0" class="text-success">
                <i class="glyphicon glyphicon-ok" data-tooltip="{{usage.projects | joinBy:', ':'name'}}"></i>
            </span>
        </div>
        <div class="col-md-1 text-center">
            <span data-ng-if="usage.systemUsages.length > 0" class="text-success">
                <i class="glyphicon glyphicon-ok" data-tooltip="{{usage.systemUsages | joinBy:', ':'itSystemName'}}"></i>
            </span>
        </div>
    </div>

    <!-- delegations -->
    <div data-ng-show="usage.isOpen" class="task-usage task-usage-foldout">
        <div data-ng-repeat="usage in usage.children">
            <div data-ng-if="usage.hasDelegations">
                <div data-ng-include="'partials/org/overview/task-foldout-node.html'"></div>
            </div>
            <div data-ng-if="!usage.hasDelegations">
                <div data-ng-include="'partials/org/overview/task-foldout-leaf.html'"></div>
            </div>
        </div>
    </div>
</div>
