<div class="panel panel-default">
    <div class="panel-heading"><strong>IT systemet udstiller følgende snitflader:</strong></div>
    
    <table class="table table-striped table-condensed">
        <thead data-ng-if="exposedInterfaces.length > 0">
            <tr>
                <th>Ønske</th>
                <th>Aktiv</th>
                <th class="col-md-2">Snitflade</th>
                <th class="col-md-1">TSA</th>
                <th class="col-md-2">Kontrakt ID</th>
                <th class="col-md-1">Snitfladetype</th>
                <th class="col-md-1">Grænseflade</th>
                <th class="col-md-1">Metode</th>
                <th class="col-md-1">Anvendes af</th>
                <th class="col-md-offset-1"></th>
            </tr>
        </thead>
        <tbody class="small">
            <tr data-ng-repeat="system in exposedInterfaces">
                <!-- wished to be used -->
                <td>
                    <input type="checkbox"/>
                </td>

                <!-- active (depends on contract) -->
                <td>
                    <i class="glyphicon glyphicon-ok text-success"></i>
                </td>
                
                <!-- name of the system -->
                <td>{{system.name}}</td>
                
                <!-- tsa -->
                <td>
                    {{system.tsa.name}}
                </td>

                <!-- contract id -->
                <td>
                    <small class="text-muted">[Hentes fra kontrakt]</small>
                </td>
                
                <!-- inteface type -->
                <td>{{system.interfaceType.name}}</td>
                
                <!-- interface (grænseflade) -->
                <td>{{system.interface.name}}</td>
                
                <!-- method -->
                <td>{{system.method.name}}</td>
                
                <!-- number of usages -->
                <td>
                    {{system.canBeUsedByIds.length}}
                </td>

                <td>
                    <!-- data row table -->
                    <table class="table table-bordered table-condensed small table-fixed table-no-margin" data-ng-if="system.dataRows.length > 0">
                        <thead>
                            <tr class="info">
                                <th class="col-md-6">
                                    Data
                                </th>
                                <th class="col-md-6">
                                    Datatype
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-ng-repeat="dataRow in system.dataRows">
                                <td>
                                    {{dataRow.data}}
                                </td>
                                <td>
                                    {{dataRow.dataType.name}}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="text-center full-width text-muted" data-ng-if="system.dataRows.length == 0">
                        -
                    </div>
                </td>
            </tr>
            <tr data-ng-if="exposedInterfaces.length == 0">
               <td colspan="8" class="text-center">Systemet udstiller ingen snitflader</td> 
            </tr>
        </tbody>
    </table>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <strong>IT systemet kan anvende følgende snitflader:</strong>
        <a class="pull-right" data-ng-click="showAllInterfaces = !showAllInterfaces">
            <span data-ng-if="!showAllInterfaces">Vis alle
            </span>
            <span data-ng-if="showAllInterfaces">Vis kun aktuelle
            </span>
        </a>
    </div>
    
    <table class="table table-striped table-condensed">
        <thead data-ng-if="interfaces.length > 0">
            <tr>
                <th class="col-md-1">Snitflade</th>
                <th class="col-md-1">Snitfladetype</th>
                <th class="col-md-1">Udstillet af</th>
                <th class="col-md-1">Infrastruktur</th>
                <th class="col-md-1">Kategori</th>
                <th class="col-md-1">TSA</th>
                <th class="col-md-1">Kontrakt</th>
                <th class="col-md-5">Data</th>
            </tr>
        </thead>
        <tbody class="small">
            <tr data-ng-repeat="system in interfaces | filter:filterInterfaces | orderBy:'rank'" data-ng-class="{'strong': system.usage, 'faded': !system.usage && !system.canBeUsed } ">
                <!-- name + checkbox -->
                <td>
                    <label>
                        <input type="checkbox" data-ng-checked="system.usage" data-ng-click="toggleInterface(system)">
                        {{system.name}}
                    </label>
                </td>

                <!-- interface type -->
                <td>{{system.interfaceType.name}}</td>
                
                <!-- exposed by -->
                <td>{{system.exposedBy.name}}</td>
                <td>
                    <input type="hidden" data-ui-select2="itSystemsSelectOptions" data-ng-model="system.usage.infrastructure" 
                           class="form-control input-sm" data-ng-disabled="!system.usage" data-ng-change="updateInfrastructure(system.usage)">
                </td>
                
                <!-- interface category -->
                <td>
                    <select data-ui-select2="" data-ng-model="system.usage.interfaceCategoryId" class="form-control input-sm" data-ng-disabled="!system.usage" data-ng-change="updateCategory(system.usage)">
                        <option data-ng-repeat="category in interfaceCategories" value="{{category.id}}">{{category.name}}</option>
                    </select>
                </td>
                
                <!-- tsa -->
                <td>
                    {{system.tsa.name}}
                </td>
                
                <!-- contract -->
                <td>
                    <small class="text-muted">[Hentes fra kontrakt]</small>
                </td>
                
                <!-- interface data -->
                <td>
                    <table class="table table-bordered table-condensed small table-fixed table-no-margin" data-ng-if="system.dataRows.length > 0">
                        <thead>
                            <tr class="info">
                                <th class="col-md-1">
                                    Data
                                </th>
                                <th class="col-md-1">
                                    Datatype
                                </th>
                                <th class="col-md-2">
                                    Frekvens
                                </th>
                                <th class="col-md-2">
                                    Pris
                                </th>
                                <th class="col-md-2">
                                    Mængde
                                </th>
                                <th class="col-md-2">
                                    Økonomi
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-ng-if="system.showDataRows" data-ng-repeat="dataRow in system.dataRows">
                                <td>
                                    {{dataRow.data}}
                                </td>
                                <td>
                                    {{dataRow.dataType.name}}
                                </td>

                                <!-- frequency -->
                                <td>
                                    <select data-ng-model="dataRow.usage.frequencyId" 
                                            class="form-control input-sm" 
                                            data-ng-disabled="!system.usage"
                                            data-ng-options="freq.id as freq.name for freq in frequencies"
                                            data-ng-change="updateFrequency(dataRow.usage)">
                                    </select>
                                </td>

                                <!-- price -->
                                <td>
                                    <input type="text" data-ng-model="dataRow.usage.price" class="form-control input-sm" data-ng-disabled="!system.usage" data-ng-blur="updatePrice(dataRow.usage)" />
                                </td>

                                <!-- amount -->
                                <td>
                                    <input type="text" data-ng-model="dataRow.usage.amount" class="form-control input-sm" data-ng-disabled="!system.usage" data-ng-blur="updateAmount(dataRow.usage)" />
                                </td>

                                <!-- economy -->
                                <td>
                                    <input type="text" data-ng-model="dataRow.usage.economy" class="form-control input-sm" data-ng-disabled="!system.usage" data-ng-blur="updateEconomy(dataRow.usage)" />
                                </td>
                            </tr>
                            
                            <!-- fold out row -->
                            <tr data-ng-if="system.dataRows.length > 0 && !system.showDataRows">
                                <td colspan="6" class="text-center">
                                    <button class="full-width btn-link btn-xs" data-ng-click="system.showDataRows = true">
                                        <i class="glyphicon glyphicon-chevron-right small"></i>
                                        Fold ud
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="text-center full-width text-muted" data-ng-if="system.dataRows.length == 0">
                        -
                    </div>
                </td>
            </tr>
            <tr data-ng-if="interfaces.length == 0">
               <td colspan="8" class="text-center">Ingen snitflader tilgængelige!</td> 
            </tr>
        </tbody>
    </table>
</div>

