name: Deploy Kitos PubSub

on:
  push: #TODO remove before merging, required for testing in branch
    branches:
      - feature/KITOSUDV-5793-pubsub-github-workflow 
  workflow_dispatch:

jobs:
  deploy:
    runs-on: [self-hosted, staging-pubsub-server]

    steps:
        - name: Create root folder if not found
          run: mkdir -p /home/kitosadmintest/kitos_code/

        - name: Checkout code if not found
          uses: actions/checkout@v3
          with:
            path: /home/kitosadmintest/kitos_code/kitos

        - name: Build PubSub API
          run: |
            cd /home/kitosadmintest/kitos_code/kitos/PubSub.Application/Deployment
            sh build.sh
