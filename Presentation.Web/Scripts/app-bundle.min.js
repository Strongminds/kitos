function waitCursor(){jQuery("body").addClass("wait")}function normalCursor(){jQuery("body").removeClass("wait")}function NotifyProvider(){"use strict";var e=5e3,t=!0,n=!0;return this.globalTimeToLive=function(t){e=t},this.onlyUniqueMessages=function(e){n=e},this.$get=["$rootScope","$filter","$timeout","$sce",function(r,i,a,o){function s(e){r.$broadcast("notifyDeleteMessage",e)}function l(t){t.autoclose&&(t.timeout&&(a.cancel(t.timeout),delete t.timeout),t.timeout=a(function(){s(t)},e))}function c(e){h&&(e.text=h(e.text)),r.$broadcast("notifyNewMessage",e),l(e)}function d(e,n,r){void 0===r&&(r=t);var i={text:o.trustAsHtml(e),severity:n,autoclose:r,update:function(e,n,r){void 0===r&&(r=t),this.text=o.trustAsHtml(e),this.severity=n,this.autoclose=r,i.closed?c(i):l(i)},toWarnMessage:function(e,t){this.update(e,"warn",t)},toErrorMessage:function(e,t){this.update(e,"error",t)},toInfoMessage:function(e,t){this.update(e,"info",t)},toSuccessMessage:function(e,t){this.update(e,"success",t)},close:function(){s(this)}};return c(i),i}function u(e,t){return d(e,"warn",t)}function p(e,t){return d(e,"error",t)}function f(e,t){return d(e,"info",t)}function g(e,t){return d(e,"success",t)}function m(){return n}var h;try{h=i("translate")}catch(e){}return{addWarnMessage:u,addErrorMessage:p,addInfoMessage:f,addSuccessMessage:g,onlyUnique:m}}],this}var app=angular.module("app",["ui.router","ui.bootstrap","ui.select2","ngAnimate","notify","angularjs-dropdown-multiselect","ngSanitize","kendo.directives","angular-loading-bar","angular-confirm","ui.bootstrap.tpls","ngMessages","ui.tree","ui.tinymce","oidc-angular"]);app.constant("JSONfn",JSONfn).constant("moment",moment).constant("$",$).constant("_",_),app.config(["$urlRouterProvider",function(e){e.otherwise("/")}]),app.config(["$authProvider",function(e){e.configure({redirectUri:location.origin+"/#/?",scope:"openid email",basePath:location.origin.indexOf("test")>0?"https://os2sso-test.miracle.dk":"https://os2sso.miracle.dk",clientId:"kitos_client"})}]),app.config(["$httpProvider","$windowProvider","notifyProvider",function(e,t,n){e.interceptors.push("httpBusyInterceptor"),e.defaults.headers.get={"Cache-Control":"no-cache"},n.globalTimeToLive(5e3),n.onlyUniqueMessages(!1);var r=t.$get();e.interceptors.push(function(){return{request:function(e){return e.url=r.encodeURI(e.url),e}}})}]),app.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|.*):/)}]),app.run(["$rootScope","$http","$state","$uibModal","notify","userService","uiSelect2Config","navigationService","$timeout","$","needsWidthFixService",function(e,t,n,r,i,a,o,s,l,c,d){e.page={title:"Index",subnav:[]},c(window).resize(function(){e.positionSubnav()}),e.positionSubnav=function(){c(document).ready(function(){l(function(){if(e.subnavPositionCenter)c("#subnav").css("text-align","center"),c("#subnav").css("padding-left","0");else if(void 0===c("#navbar-top a.active").offset())l(function(){e.positionSubnav()},100);else{var t=c("#navbar-top a.active").width(),n=c("#navbar-top").offset().left-c("#navbar-top a.active").offset().left,r=c("#subnav ul").width(),i=c("#navbar-top").width();c("#subnav").css("text-align","left"),c("#subnav").css("padding-left",(-1*n-r/2+t/2)/i*100+"%")}e.subnavNotPositioned=!1},0)})},e.changingOrganization=!1,e.$state=n,a.reAuthorize(),o.dropdownAutoWidth=!0,e.logout=function(){a.logout().then(function(){e.changingOrganization=!1,n.go("index")})},e.changeOrganization=function(){e.changingOrganization=!0,a.changeOrganization().then(function(e){s.checkState(e.defaultUserStartPreference)?n.go(e.defaultUserStartPreference,null,{reload:!0}):n.go("index",null,{reload:!0})})},e.$on("$stateChangeStart",function(e,t,r,i,o){t.noAuth||a.auth(t.authRoles).then(function(e){},function(){e.preventDefault(),n.go("index",{to:t.name,toParams:r})})}),e.$on("$stateChangeSuccess",function(t,n,r,i,a){n.name.split(".")[0]!=i.name.split(".")[0]&&(e.subnavNotPositioned=!0)}),e.$on("$stateChangeError",function(e,t,r,i,a,o){n.go("index")}),d.fixWidthOnClick()}]),angular.module("notify",[]);var Kitos;!function(e){var t=function(){function e(){}return e.getFactoryFor=function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Object.create(e.prototype);return r.constructor.apply(r,t),r};return t.$inject=e.$inject,t},e}();e.DirectiveFactory=t}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){e[e.Local="Local"]="Local",e[e.Public="Public"]="Public"}(e.AccessModifier||(e.AccessModifier={}))}(e.Models||(e.Models={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){e[e.White=0]="White",e[e.Red=1]="Red",e[e.Yellow=2]="Yellow",e[e.Green=3]="Green"}(e.TrafficLight||(e.TrafficLight={}))}(e.Models||(e.Models={}))}(Kitos||(Kitos={})),function(e,t){"use strict";function n(){function e(e){return e.ConsultantBudget+e.EducationBudget+e.OtherBusinessExpensesBudget+e.IncreasedBusinessExpensesBudget}function t(e){return e.HardwareBudget+e.SoftwareBudget+e.OtherItExpensesBudget+e.IncreasedItExpensesBudget}function n(e){return e.SalaryBudget+e.OtherBusinessSavingsBudget}function r(e){return e.LicenseSavingsBudget+e.SystemMaintenanceSavingsBudget+e.OtherItSavingsBudget}function i(i){return e(i)+t(i)-n(i)-r(i)}return{getBusinessExpensesTotal:e,getItExpensesTotal:t,getBusinessSavingsTotal:n,getItSavingsTotal:r,getTotalBudget:i}}t.factory("economyCalc",n)}(angular,app);var Kitos;!function(e){!function(e){"use strict";function t(e,t,n,r,i){function a(a){function o(e){t(function(){var t=e.getOptions();d(t),c(t)})}function s(e,r){var a=e.element[0].id,o=l(),s=i.pick(o,"columnState"),c=i.merge({dataSource:{filter:r}},o),d=i.omit(c,"columnState"),u=0;i.forEach(s.columnState,function(r,o){var s=i.findIndex(e.columns,function(e){return e.hasOwnProperty("persistId")?e.persistId===o:(console.error("Unable to find persistId property in grid column with field="+e.field),!1)});if(-1!==s){var l=e.columns[s];r.index!==s&&r.index<e.columns.length&&e.reorderColumn(r.index,l),r.hidden!==l.hidden&&(r.hidden?e.hideColumn(l):e.showColumn(l)),l.hidden||u++,r.width!==l.width&&(l.width=r.width,t(function(){n("#"+a+" .k-grid-header").find("colgroup col").eq(u).width(r.width),n("#"+a+" .k-grid-content").find("colgroup col").eq(u).width(r.width)}))}}),e.setOptions(d),e.dataSource.pageSize(e.dataSource.options.pageSize)}function l(){var t,n=e.localStorage.getItem(a);n&&(t=r.parse(n,!0));var o,s=e.localStorage.getItem(v);s&&(o=r.parse(s,!0));var l,c=e.sessionStorage.getItem(a);c&&(l=r.parse(c,!0));return l?i.merge({},t,l):i.merge({},t,o)}function c(t){var n={};n.dataSource=i.pick(t.dataSource,["filter","sort","page"]),e.sessionStorage.setItem(a,r.stringify(n))}function d(t){if(t){var n={};n.dataSource=i.pick(t.dataSource,["pageSize"]),n.columnState={};for(var o=0;o<t.columns.length;o++){var s=t.columns[o];n.columnState[s.persistId]={index:o,width:s.width,hidden:s.hidden}}e.localStorage.setItem(a,r.stringify(n))}}function u(t){var n=t.getOptions(),a={};a.dataSource=i.pick(n.dataSource,["filter","sort"]),e.localStorage.setItem(v,r.stringify(a))}function p(e){g();var t=l(),n=i.omit(t,"columnState");e.setOptions(n)}function f(){return!!e.localStorage.getItem(v)}function g(){e.sessionStorage.removeItem(a)}function m(){e.localStorage.removeItem(a)}function h(){e.localStorage.removeItem(v)}if(!a)throw new Error("Missing parameter: storageKey");var v=a+"-profile";return{saveGridOptions:o,loadGridOptions:s,saveGridProfile:u,loadGridProfile:p,doesGridProfileExist:f,removeProfile:h,removeLocal:m,removeSession:g}}return{getService:a}}t.$inject=["$window","$timeout","$","JSONfn","_"],angular.module("app").factory("gridStateService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={})),function(e,t){t.factory("httpBusyInterceptor",["$q","$rootScope",function(e,t){function n(){i=!0,waitCursor(),t.$broadcast("httpBusy")}function r(){i&&(i=!1,normalCursor(),t.$broadcast("httpUnbusy"))}var i=!1;return{request:function(t){return e.when(t).then(function(t){if("GET"!==t.method&&t.handleBusy){if(i)return e.reject("BUSY");n()}return t})},response:function(t){return r(),t||e.when(t)},responseError:function(t){return r(),e.reject(t)}}}])}(angular,app),function(e,t){t.factory("httpBusyInterceptor",["$q","$rootScope",function(e,t){function n(){i=!0,waitCursor(),t.$broadcast("httpBusy")}function r(){i&&(i=!1,normalCursor(),t.$broadcast("httpUnbusy"))}var i=!1;return{request:function(t){return e.when(t).then(function(t){if("GET"!==t.method&&t.handleBusy){if(i)return e.reject("BUSY");n()}return t})},response:function(t){return r(),t||e.when(t)},responseError:function(t){return r(),e.reject(t)}}}])}(angular,app);var Kitos;!function(e){!function(e){"use strict";var t=function(){function e(e){var t=this;this.$http=e,this.GetItContractById=function(e){return t.$http.get("odata/ItContracts("+e+")")},this.GetAllItContracts=function(){return t.$http.get("odata/ItContracts")},this.GetItContractRoleById=function(e){return t.$http.get("odata/ItContractRoles("+e+")")},this.GetAllItContractRoles=function(){return t.$http.get("odata/ItContractRoles")},this.GetItContractRightsById=function(e){return t.$http.get("odata/ItContractRights?$filter=UserId eq ("+e+")")},this.GetContractDataById=function(e,n){return t.$http.get("odata/ItContractRights?$expand=role,object&$filter=UserId eq ("+e+") AND Object/OrganizationId eq ("+n+")")}}return e.$inject=["$http"],e}();e.ItContractsService=t,app.service("ItContractsService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){"use strict";var t=function(){function e(e){var t=this;this.$http=e,this.GetProjectById=function(e){return t.$http.get("odata/ItProjects("+e+")")},this.GetAllProjects=function(){return t.$http.get("odata/ItProjects")},this.GetProjectRoleById=function(e){return t.$http.get("odata/ItProjectRoles("+e+")")},this.GetAllProjectRoles=function(){return t.$http.get("odata/ItProjectRoles")},this.GetProjectRightsById=function(e){return t.$http.get("odata/ItProjectRights?$filter=UserId eq ("+e+")")},this.GetProjectDataById=function(e,n){return t.$http.get("odata/ItProjectRights?$expand=role,object&$filter=UserId eq ("+e+") AND Object/OrganizationId eq ("+n+")")}}return e.$inject=["$http"],e}();e.ItProjectService=t,app.service("ItProjectService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){"use strict";var t=function(){function e(e){var t=this;this.$http=e,this.GetSystemById=function(e){return t.$http.get("odata/ItSystems("+e+")")},this.GetAllSystems=function(){return t.$http.get("odata/ItSystems")},this.GetSystemRoleById=function(e){return t.$http.get("odata/ItSystemRoles("+e+")")},this.GetAllSystemRoles=function(){return t.$http.get("odata/ItSystemRoles")},this.GetSystemRightsById=function(e){return t.$http.get("odata/ItSystemRights?$filter=UserId eq ("+e+")")},this.GetSystemDataById=function(e){return t.$http.get("odata/ItSystemRights?$expand=role,object&$filter=UserId eq ("+e+")")},this.GetSystemDataByIdFiltered=function(e,n){return t.$http.get("odata/ItSystemRights?$expand=role($select=Name),object($select=Id;$expand=ItSystem($select=Id,Name))&$filter=Object/OrganizationId eq ("+n+") AND UserId eq ("+e+")&$select=Id")}}return e.$inject=["$http"],e}();e.ItSystemService=t,app.service("ItSystemService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){"use strict";var t=function(){function e(e,t){var n=this;this.$http=e,this.notify=t,this.baseUrl="/odata/ItSystemUsages",this.patchSystem=function(e,t){n.$http.patch(n.baseUrl+"("+e+")",t).then(function(){n.notify.addSuccessMessage("Feltet er opdateret!")},function(){return n.notify.addErrorMessage("Fejl! Feltet kunne ikke opdateres!")})}}return e.$inject=["$http","notify"],e}();e.itSystemUsageService=t,app.service("itSystemUsageService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){var t=function(){function e(){this.checkState=function(e){return["index","organization.overview","it-project.overview","it-system.overview","it-contract.overview","reports.overview"].indexOf(e)>-1}}return e}();e.NavigationService=t,app.service("navigationService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){var t=function(){function e(e){var t=this;this.$=e,this.fixWidthOnClick=function(){t.$("body").on("click",".k-item .k-state-default .k-link",function(){t.fixWidth()})},this.fixWidth=function(){t.$(".k-grid-content table").css("width","100%"),t.$(".k-grid-header-wrap table").css("width","100%")}}return e.$inject=["$"],e}();e.NeedsWidthFix=t,app.service("needsWidthFixService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){"use strict";var t=function(){function e(e){var t=this;this.$http=e,this.GetOrganizationUnitDataById=function(e,n){return t.$http.get("odata/OrganizationUnitRights?$expand=role,object&$filter=UserId eq ("+e+" )AND Object/OrganizationId eq ("+n+")")},this.GetOrganizationData=function(e,n){return t.$http.get("odata/OrganizationRights?$expand=Organization&$filter=UserId eq ("+e+") AND OrganizationId eq ("+n+")")},this.DeleteOrganizationAdminData=function(e,n,r){var i=e.OrganizationRights.filter(function(e){return e.Role===n}),a=i[0].Id;return t.$http.delete("/odata/"+r+"("+a+")")}}return e.$inject=["$http"],e}();e.OrganizationService=t,app.service("organizationService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){var t=function(){function e(e){var t=this;this.$http=e,this.baseUrl="/odata/ReportCategories",this.GetById=function(e){return t.$http.get(t.baseUrl+"("+e+")")},this.GetAll=function(){return t.$http.get(t.baseUrl)}}return e.$inject=["$http"],e}();e.ReportCategoriesService=t,app.service("reportCategoriesService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){var t=function(){function e(e){var t=this;this.$http=e,this.baseUrl="/odata/reports",this.GetById=function(e){return t.$http.get(t.baseUrl+"("+e+")")},this.GetAll=function(e){return t.$http.get(t.baseUrl+"?$expand=CategoryType")},this.GetEmptyReport=function(){return t.$http.get("/appReport/empty-report.json")},this.saveReport=function(e){t.$http.patch(t.baseUrl+"("+e.Id+")",e)},this.getReportCategories=function(){return t.$http.get("/odata/ReportCategoryTypes")}}return e.$inject=["$http"],e}();e.ReportService=t,app.service("reportService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={})),function(e,t){t.factory("taskService",["$http","$q","$rootScope","userService",function(e,t,n,r){function i(){function n(e){return function(){i.reject(e)}}var i=t.defer();return r.getUser().then(function(t){var r=o+"?roots=true&orgId="+t.currentOrganizationId+"&take=200";e.get(r).success(function(e){i.resolve(e.response)}).error(n("Couldn't load tasks"))},n("Couldn't acquire user!")),i.promise}function a(n){function i(e){return function(){a.reject(e)}}var a=t.defer();return r.getUser().then(function(t){var r=o+n+"?children=true&orgId="+t.currentOrganizationId;e.get(r).success(function(e){a.resolve(e.response)}).error(i("Couldn't load tasks"))},i("Couldn't acquire user!")),a.promise}var o="api/taskRef/";return{getRoots:i,getChildren:a}}])}(angular,app);var Kitos;!function(e){!function(e){var t=function(){function e(e,t){this.$http=e,this.notify=t}return e.prototype.uploadFile=function(e){var t=new FormData;t.append("kontraktIndgåelse",e);var n=this.notify.addSuccessMessage("Uploader fil...");this.$http.post("/api/uploadFile",t,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){n.toSuccessMessage("fil uploaded!")}).error(function(){n.toErrorMessage("Fejl! Fil kunne ikke uploades!")})},e.$inject=["$http","notify"],e}();e.UploadFileService=t,app.service("uploadFile",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){"use strict";var t=function(){function e(e){var t=this;this.$http=e,this.GetAllUsers=function(){return t.$http.get("odata/Users")},this.GetAllUsersFromOrganizationById=function(e){return t.$http.get("odata/Users?$filter=OrganizationRights/any(o:o/OrganizationId eq ("+e+"))")}}return e.$inject=["$http"],e}();e.UserGetService=t,app.service("UserGetService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){var n=function(){function t(t,n,r,i,a,o){var s=this;this.$http=t,this.$window=n,this.$q=r,this.$rootScope=i,this.$uibModal=a,this._=o,this._user=null,this._loadUserDeferred=null,this.saveUser=function(t,n){var r,i,a,o=n.organization,l=n.defaultOrgUnit,c=null==l?null:l.id,d=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.LocalAdmin&&t.organizationId==o.id}),u=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.OrganizationModuleAdmin&&t.organizationId==o.id}),p=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.ProjectModuleAdmin&&t.organizationId==o.id}),f=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.SystemModuleAdmin&&t.organizationId==o.id}),g=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.ContractModuleAdmin&&t.organizationId==o.id}),m=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.ReportModuleAdmin&&t.organizationId==o.id}),h=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.ReadOnly&&t.organizationId==o.id});return null==c?(r=o.root.id,i=o.root.name,a=!1):(r=c,i=l.name,a=!0),s._user={isAuth:!0,id:t.id,name:t.name,lastName:t.lastName,fullName:t.fullName,email:t.email,phoneNumber:t.phoneNumber,uuid:t.uuid,defaultUserStartPreference:t.defaultUserStartPreference||"index",isGlobalAdmin:t.isGlobalAdmin,isLocalAdmin:d,isOrgAdmin:u,isProjectAdmin:p,isSystemAdmin:f,isContractAdmin:g,isReportAdmin:m,isReadOnly:h,orgAndDefaultUnit:n,currentOrganizationUnitId:r,currentOrganizationUnitName:i,isUsingDefaultOrgUnit:a,defaultOrganizationUnitId:c,currentOrganization:o,currentOrganizationId:o.id,currentOrganizationName:o.name,currentConfig:o.config},s.$rootScope.user=s._user,s._user},this.patchUser=function(e){var t=s.$q.defer();return null==s._user?t.reject("Not authenticated."):s.$http({method:"PATCH",url:"api/user/"+s._user.id+"?organizationId="+s._user.currentOrganizationId,data:e}).success(function(e){var n=e.response;s.saveUser(n,s._user.orgAndDefaultUnit),s._loadUserDeferred=null,t.resolve(s._user)}).error(function(){t.reject("Couldn't patch the user!")}),t.promise},this.getUser=function(){return s.reAuthorize()},this.reAuthorize=function(){var e=s.$q.defer();return e.resolve(s.loadUser(null)),e.promise},this.getOrganizations=function(){return s.$http.get("api/authorize/GetOrganizations")},this.getOrganizationWithDefault=function(e){return s.$http.get("api/authorize/GetOrganization("+e+")").then(function(e){return e.data.response})},this.getCurrentUserIfAuthorized=function(){return s.$http.get("api/authorize")},this.authorizeUser=function(e){return s.$http.post("api/authorize",e)},this.saveUserInfo=function(e,t){s.saveUser(e,t),s.setDefaultOrganizationInBackend(t.organization.id)},this.auth=function(t){return s.getUser().then(function(n){if(t){if(!s._.some(t,function(t){return"GlobalAdmin"===t&&n.isGlobalAdmin||t===e.Models.OrganizationRole.LocalAdmin&&n.isLocalAdmin}))return s.$q.reject("User doesn't have the required permissions")}return!0})},this.getSavedOrgId=function(){var e=localStorage.getItem("currentOrgId");return null!=e&&JSON.parse(e)},this.setSavedOrgId=function(e){localStorage.setItem("currentOrgId",JSON.stringify(e))},this.clearSavedOrgId=function(){localStorage.setItem("currentOrgId",null)},this.setDefaultOrganizationInBackend=function(e){s.$http.post("api/user?updateDefaultOrganization=true&organizationId="+e,void 0)},this.login=function(e,t,n){var r=s.$q.defer();if(e&&t){var i={email:e,password:t,rememberMe:n};s.loadUser(i).then(function(e){r.resolve(e)},function(e){r.reject(e)})}else r.reject("Email or password cannot be empty");return r.promise},this.loginSSO=function(e){var t=s.$q.defer(),n={token:e};return t.resolve(s.loadUser(n)),t.promise},this.logout=function(){return s.clearSavedOrgId(),s._loadUserDeferred=null,s._user=null,s.$rootScope.user=null,s.$http.post("api/authorize?logout",void 0)},this.loadUser=function(e){if(!s._loadUserDeferred){s._loadUserDeferred=s.$q.defer();(e?s.authorizeUser(e):s.getCurrentUserIfAuthorized()).then(function(e){var t=e.data.response;s.$rootScope.userHasOrgChoices=s._.uniqBy(t.organizationRights,"organizationId").length>1,s.determineLoginProcedure().then(function(e){s.saveUserInfo(t,e),s._loadUserDeferred.resolve(s._user),s._loadUserDeferred=null},function(){s._loadUserDeferred.reject("No organization selected"),s._loadUserDeferred=null})},function(e){s._loadUserDeferred.reject(e.data),s._loadUserDeferred=null,s.clearSavedOrgId()})}return s._loadUserDeferred.promise},this.determineLoginProcedure=function(){var e=s.$q.defer();if(s.currentlyLoggedIn()){var t=s.getSavedOrgId();t&&e.resolve(s.getOrganizationWithDefault(t))}else e.resolve(s.chooseOrganization());return e.promise},this.selectAvailableOrganization=function(e){var t=e.$values[0];return s.setSavedOrgId(t.organization.id),t},this.lastChosenOrganization=function(e,t){var n=s._.find(e.$values,function(e){return e.organization.id==t});if(null!=n)return n;s.clearSavedOrgId()},this.chooseOrganization=function(){var e=s.$q.defer();return s.getOrganizations().then(function(t){var n=t.data.response;if(!s.$rootScope.userHasOrgChoices){var r=s.getOrganizationWithDefault(n[0].id);return e.resolve(r),e.promise}s.showOrganizationsModal(n).result.then(function(t){t.userCancelled&&e.resolve(!0),s.setSavedOrgId(t.id);var n=s.getOrganizationWithDefault(t.id);e.resolve(n)},function(){e.reject("Modal dismissed")})}),e.promise},this.showOrganizationsModal=function(e){return s.$uibModal.open({backdrop:"static",templateUrl:"app/components/home/choose-organization.html",controller:["$scope","$uibModalInstance","autofocus",function(t,n,r){r(),t.organizations=e,t.orgChooser={selectedId:null},t.ok=function(){var e=s._.find(t.organizations,function(e){return e.id===t.orgChooser.selectedId});n.close(e)}}]})},this.changeOrganization=function(){var e=s.getSavedOrgId();s.clearSavedOrgId();var t=null,n=s.$q.defer();return s.getCurrentUserIfAuthorized().then(function(r){t=r.data.response,s.chooseOrganization().then(function(e){s.saveUserInfo(t,e),n.resolve(s._user)},function(t){s.setSavedOrgId(e),n.reject("Could not select an organization.")})},function(e){n.reject("Could not retrieve organizational context.")}),n.promise},this.updateDefaultOrgUnit=function(e){var t={orgId:s._user.currentOrganizationId,orgUnitId:e};return s.$http.post("api/user?updateDefaultOrgUnit",t)}}return t.prototype.currentlyLoggedIn=function(){return this.getSavedOrgId()},t.$inject=["$http","$window","$q","$rootScope","$uibModal","_"],t}();t.UserService=n,app.service("userService",n)}(e.Services||(e.Services={}))}(Kitos||(Kitos={})),_.mixin({deep:function(e,t,n){var r,i=t.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split("."),a=0,o=i.length;if(arguments.length>2){for(r=e,o--;a<o;)t=i[a++],e=e[t]=_.isObject(e[t])?e[t]:{};e[i[a]]=n,n=r}else{for(;null!=(e=e[i[a++]])&&a<o;);n=a<o?void 0:e}return n}}),_.mixin({pluckDeep:function(e,t){return _.map(e,function(e){return _.deep(e,t)})}}),_.mixin({unpick:function(e){return e||(e={}),_.pick(e,_.difference(_.keys(e),_.flatten(Array.prototype.slice.call(arguments,1))))}}),_.mixin({resursivePluck:function e(t,n,r){r=void 0!==r?r:"children";var i=[];return i.push(t[n]),t.hasOwnProperty(r)&&_.each(t[r],function(t){i.pushArray(e(t,n,r))}),i}}),_.mixin({addHierarchyLevelOnNested:function e(t,n,r){n=void 0!==n?n:0,r=void 0!==r?r:"children",_.forEach(t,function(t){if(t.$level=n,t.hasOwnProperty(r)&&null!==t[r]){var i=t[r];_.isArray(i)||(i=[i]),_.forEach(i,function(t){e([t],n+1,r)})}})}}),_.mixin({addHierarchyLevelOnFlatAndSort:function(e,t,n){function r(e,o){var s=[];return i.filter(function(t){return t[n]===e}).forEach(function(e){e.$level=o,a.push(e),e.childIds=r(e[t],o+1),s.push(e[t]),s.pushArray(e.childIds)}),s}t=void 0!==t?t:"id",n=void 0!==n?n:"parentId";var i=_.clone(e),a=[];return r(null,0),a}}),_.mixin({toHierarchy:function(e,t,n,r){function i(e,a,o){o=void 0!==o?o:[],a=void 0!==a?a:{id:null};var s=_.filter(e,function(e){return e[n]===a[t]});return _.isEmpty(s)||(null==a[t]?o=s:a[r]=s,_.each(s,function(t){i(e,t)})),o}return t=void 0!==t?t:"id",n=void 0!==n?n:"parentId",r=void 0!==r?r:"children",i(e)}}),_.mixin({removeFiltersForField:function(e,t){function n(e){for(var r=e.length-1;r>=0;r--){var i=e[r];i.hasOwnProperty("field")?i.field==t&&e.splice(r,1):i.hasOwnProperty("filters")&&(n(i.filters),0===i.filters.length&&e.splice(r,1))}}var r=_.cloneDeep(e);return _.isEmpty(e)?{}:(n(r.filters),_.isEmpty(r.filters)?{}:r)}}),_.mixin({addFilter:function(e,t,n,r,i){function a(e){for(var n=0;n<e.length;n++){var r=e[n];if(!r.hasOwnProperty("field")){if(r.hasOwnProperty("filters"))return a(r.filters);throw Error("field or filters property missing, this doesn't look like a filter object!")}if(r.field==t)return e}return!1}var o=_.cloneDeep(e);if(_.isEmpty(o))o={logic:i,filters:[{field:t,operator:n,value:r}]};else{var s=a(o.filters);s?s.push({field:t,operator:n,value:r}):o.filters.push({logic:i,filters:[{field:t,operator:n,value:r}]})}return o}}),_.mixin({findKeyDeep:function e(t,n){var r,i,a,o;for(r in n)n.hasOwnProperty(r)&&(i=r,a=n[r]);for(r in t)if(r==i){if(t[r]==a)return t}else if(t[r]instanceof Object&&t.hasOwnProperty(r)&&(o=e(t[r],n)))return o;return!1}}),Array.prototype.pushArray=function(e){this.push.apply(this,e)},String.prototype.repeat=function(e){if(e<1)return"";for(var t="",n=this.valueOf();e>1;)1&e&&(t+=n),e>>=1,n+=n;return t+n},function(e,t){"use strict";t.directive("autofocus",["$timeout",function(e){return function(t,n,r){t.$on("autofocus",function(t){e(function(){n[0].focus()})})}}]),t.factory("autofocus",["$rootScope","$timeout",function(e,t){return function(){t(function(){e.$broadcast("autofocus")})}}])}(angular,app),function(e,t){"use strict";t.directive("autosave",["$http","$timeout","notify","userService","moment",function(e,t,n,r,i){return{restrict:"A",require:"ngModel",priority:0,link:function(a,o,s,l){function c(){var e=l.$modelValue;if(s.pluck&&(e=_.map(e,s.pluck)),e!==y&&l.$valid){var t={};t[s.field]=e,h(t)}}function d(){var e=l.$modelValue;if(s.pluck&&(e=_.map(e,s.pluck)),e!==y&&l.$valid){var t=i(e,"DD-MM-YYYY"),n={};t.isValid()?n[s.field]=t.format("YYYY-MM-DD"):n[s.field]=null,h(n)}}function u(){t(function(){if(s.globalOptionId)p();else{var e=l.$modelValue,t={};t[s.field]=e,h(t)}})}function p(){var t=parseInt(s.globalOptionId,10),r=l.$modelValue,i={};if(i[s.field]=t,r){var a=n.addInfoMessage("Gemmer...",!1);s.appendurl||(s.appendurl=""),e({method:"POST",url:s.autosave,data:i,ignoreLoadingBar:!0}).success(function(){a.toSuccessMessage("Feltet er opdateret."),y=l.$modelValue}).error(function(e,t){409===t?a.toErrorMessage("Fejl! Feltet kunne ikke ændres da værdien den allerede findes i KITOS!"):a.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}else{var a=n.addInfoMessage("Gemmer...",!1);s.appendurl||(s.appendurl=""),e({method:"DELETE",url:s.autosave+"("+t+")",ignoreLoadingBar:!0}).success(function(){a.toSuccessMessage("Feltet er opdateret."),y=l.$modelValue}).error(function(e,t){409===t?a.toErrorMessage("Fejl! Feltet kunne ikke ændres da værdien den allerede findes i KITOS!"):a.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}}function f(){t(function(){var e={};e[s.field]=l.$modelValue,h(e)},200)}function g(){t(function(){if(s.field){if(angular.isUndefined(v))return void n.addWarnMessage("Brugeren er endnu ikke indlæst. Vent venligst og prøv igen.",!0);var e,t=l.$viewValue;e=angular.isArray(t)?_.map(t,"id"):angular.isObject(t)?t.id:t;var r={};r[s.field]=e,h(r)}})}function m(t){var r,i=n.addInfoMessage("Gemmer...",!1);t.added?(r=t.added.id,e.post(s.autosave+"?organizationId="+v.currentOrganizationId+"&"+s.field+"="+r).success(function(){i.toSuccessMessage("Feltet er opdateret.")}).error(function(){i.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})):t.removed&&(r=t.removed.id,e.delete(s.autosave+"?organizationId="+v.currentOrganizationId+"&"+s.field+"="+r).success(function(){i.toSuccessMessage("Feltet er opdateret.")}).error(function(){i.toErrorMessage("Fejl! Feltet kunne ikke ændres!")}))}function h(t){var r=n.addInfoMessage("Gemmer...",!1);s.appendurl||(s.appendurl=""),e({method:"PATCH",url:s.autosave+"?organizationId="+v.currentOrganizationId+s.appendurl,data:t,ignoreLoadingBar:!0}).success(function(){r.toSuccessMessage("Feltet er opdateret."),y=l.$modelValue}).error(function(e,t){409===t?r.toErrorMessage("Fejl! Feltet kunne ikke ændres da værdien den allerede findes i KITOS!"):r.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}var v;r.getUser().then(function(e){v=e});var y;t(function(){y=l.$modelValue}),angular.isUndefined(s.uiSelect2)?angular.isUndefined(s.kendoDatePicker)?"checkbox"===s.type?o.bind("change",u):angular.isUndefined(s.autosaveTypeahead)?o.bind("blur",c):o.bind("blur",f):o.bind("blur",d):s.multiple?o.bind("change",m):o.bind("change",g)}}}])}(angular,app),function(e,t){"use strict";t.directive("confirmClick",[function(){return{link:function(e,t,n){var r=n.confirmClick||"Er du sikker?",i=n.confirmedClick;t.bind("click",function(t){window.confirm(r)&&e.$eval(i)})}}}])}(angular,app),function(e,t){"use strict";t.directive("datereader",["moment",function(e){return{scope:!0,template:"<span>{{dateStr}}</span>",require:"ngModel",link:function(t,n,r,i){function a(){angular.isUndefined(i.$modelValue)||null==i.$modelValue?t.dateStr="":t.dateStr=e(i.$modelValue).format("DD-MM-YY","da",!0)}t.date={},a(),i.$render=a}}}])}(angular,app),function(e,t){"use strict";t.directive("disabledOnBusy",[function(){return function(e,t,n){e.$on("httpBusy",function(e){t[0].disabled=!0}),e.$on("httpUnbusy",function(e){t[0].disabled=!1})}}])}(angular,app),function(e,t){"use strict";t.directive("hrefBlank",["$window",function(e){return{restrict:"A",scope:{url:"=hrefBlank"},link:function(t,n,r){n.bind("click",function(){e.open(t.url,"_blank")})}}}])}(angular,app),function(e,t){"use strict";t.filter("limitToDots",["limitToFilter",function(e){return function(t,n){var r=e(t,n);return t.length>n&&(r+="..."),r}}])}(angular,app),function(e,t){"use strict";t.directive("match",[function(){return{restrict:"A",scope:!0,require:"ngModel",link:function(e,t,n,r){var i=function(){return e.$eval(n.ngModel)==e.$eval(n.match)};e.$watch(i,function(e){r.$setValidity("unique",e)})}}}])}(angular,app),function(e,t){"use strict";t.directive("showErrors",["$timeout",function(e){var t;return t=function(t,n,r,i){var a,o,s,l,c,d;if(a=!1,c=!0,o=n[0].querySelector("[name]"),l=angular.element(o),!(s=l.attr("name")))throw"show-errors element has no child input elements with a 'name' attribute";return l.bind("blur",function(){return a=!0,d(i[s].$invalid)}),t.$watch(function(){return i[s]&&i[s].$invalid},function(e){if(a)return d(e)}),t.$on("show-errors-check-validity",function(){return d(i[s].$invalid)}),t.$on("show-errors-reset",function(){return e(function(){return n.removeClass("has-error"),n.removeClass("has-success"),a=!1},0,!1)}),d=function(e){if(n.toggleClass("has-error",e),c)return n.toggleClass("has-success",!e)}},{restrict:"A",require:"^form",compile:function(e,n){if(!e.hasClass("form-group"))throw"show-errors element does not have the 'form-group' class";return t}}}])}(angular,app),tinymce.addI18n("da",{Cut:"Klip","Heading 5":"Overskrift 5","Header 2":"Overskrift 2",
"Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.":"Din browser understøtter ikke direkte adgang til clipboard. Benyt Ctrl+X/C/ keybord shortcuts i stedet for.","Heading 4":"Overskrift 4",Div:"Div","Heading 2":"Overskrift 2",Paste:"Indsæt",Close:"Luk","Font Family":"Skrifttype",Pre:"Pre","Align right":"Højrejusteret","New document":"Nyt dokument",Blockquote:"Indrykning","Numbered list":"Nummerering","Heading 1":"Overskrift 1",Headings:"Overskrifter","Increase indent":"Forøg indrykning",Formats:"Formater",Headers:"Overskrifter","Select all":"Vælg alle","Header 3":"Overskrift 3",Blocks:"Blokke",Undo:"Fortryd",Strikethrough:"Gennemstreg","Bullet list":"Punkt tegn","Header 1":"Overskrift 1",Superscript:"Hævet","Clear formatting":"Nulstil formattering","Font Sizes":"Skriftstørrelse",Subscript:"Sænket","Header 6":"Overskrift 6",Redo:"Genopret",Paragraph:"Sætning",Ok:"Ok",Bold:"Fed",Code:"Code",Italic:"Kursiv","Align center":"Centreret","Header 5":"Overskrift 5","Heading 6":"Overskrift 6","Heading 3":"Overskrift 3","Decrease indent":"Formindsk indrykning","Header 4":"Overskrift 4","Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.":"Sæt ind er indstillet til at indsætte som ren tekst. Indhold bliver nu indsat uden formatering indtil du ændrer indstillingen.",Underline:"Understreg",Cancel:"Fortryd",Justify:"Justering",Inline:"Inline",Copy:"Kopier","Align left":"Venstrejusteret","Visual aids":"Visuel hjælp","Lower Greek":"Lower Græsk",Square:"Kvadrat",Default:"Standard","Lower Alpha":"Lower Alpha",Circle:"Cirkel",Disc:"Disk","Upper Alpha":"Upper Alpha","Upper Roman":"Upper Roman","Lower Roman":"Lower Roman",Name:"Navn",Anchor:"Anchor","You have unsaved changes are you sure you want to navigate away?":"Du har ikke gemte ændringer. Er du sikker på at du vil fortsætte?","Restore last draft":"Genopret sidste kladde","Special character":"Specielle tegn","Source code":"Kildekode",B:"B",R:"R",G:"G",Color:"Farve","Right to left":"Højre til venstre","Left to right":"Venstre til højre",Emoticons:"Emot-ikoner",Robots:"Robotter","Document properties":"Dokument egenskaber",Title:"Titel",Keywords:"Søgeord",Encoding:"Kodning",Description:"Beskrivelse",Author:"Forfatter",Fullscreen:"Fuldskærm","Horizontal line":"Vandret linie","Horizontal space":"Vandret afstand","Insert/edit image":"Indsæt/ret billede",General:"Generet",Advanced:"Avanceret",Source:"Kilde",Border:"Kant","Constrain proportions":"Behold propertioner","Vertical space":"Lodret afstand","Image description":"Billede beskrivelse",Style:"Stil",Dimensions:"Dimensioner","Insert image":"Indsæt billede","Zoom in":"Zoom ind",Contrast:"Kontrast",Back:"Tilbage",Gamma:"Gamma","Flip horizontally":"Flip horisontalt",Resize:"Skaler",Sharpen:"Gør skarpere","Zoom out":"Zoom ud","Image options":"Billede indstillinger",Apply:"Anvend",Brightness:"Lysstyrke","Rotate clockwise":"Drej med urets retning","Rotate counterclockwise":"Drej modsat urets retning","Edit image":"Rediger billede","Color levels":"Farve niveauer",Crop:"Beskær",Orientation:"Retning","Flip vertically":"Flip vertikalt",Invert:"Inverter","Insert date/time":"Indsæt dato/klokkeslet","Remove link":"Fjern link",Url:"Url","Text to display":"Vis tekst",Anchors:"Ankre","Insert link":"Indsæt link","New window":"Nyt vindue",None:"Ingen","The URL you entered seems to be an external link. Do you want to add the required http:// prefix?":"URLen som du angav ser ud til at være et eksternt link. Ønsker du at tilføje det krævede prefiks http:// ?",Target:"Target","The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?":"URLen som du angav ser ud til at være en email adresse. Ønsker du at tilføje det krævede prefiks  mailto: ?","Insert/edit link":"Indsæt/ret link","Insert/edit video":"Indsæt/ret video",Poster:"Poster","Alternative source":"Alternativ kilde","Paste your embed code below:":"Indsæt din embed kode herunder:","Insert video":"Indsæt video",Embed:"Integrer","Nonbreaking space":"Hårdt mellemrum","Page break":"Sideskift","Paste as text":"Indsæt som ren tekst",Preview:"Forhåndsvisning",Print:"Udskriv",Save:"Gem","Could not find the specified string.":"Kunne ikke finde søgetekst",Replace:"Erstat",Next:"Næste","Whole words":"Hele ord","Find and replace":"Find og erstat","Replace with":"Erstat med",Find:"Find","Replace all":"Erstat alt","Match case":"STORE og små bogstaver",Prev:"Forrige",Spellcheck:"Stavekontrol",Finish:"Færdig","Ignore all":"Ignorer alt",Ignore:"Ignorer","Add to Dictionary":"Tilføj til ordbog","Insert row before":"Indsæt række før",Rows:"Rækker",Height:"Højde","Paste row after":"Indsæt række efter",Alignment:"Tilpasning","Border color":"Kant farve","Column group":"Kolonne gruppe",Row:"Række","Insert column before":"Indsæt kolonne før","Split cell":"Split celle","Cell padding":"Celle padding","Cell spacing":"Celle afstand","Row type":"Række type","Insert table":"Indsæt tabel",Body:"Krop",Caption:"Tekst",Footer:"Sidefod","Delete row":"Slet række","Paste row before":"Indsæt række før",Scope:"Anvendelsesområde","Delete table":"Slet tabel","H Align":"H juster",Top:"Top","Header cell":"Sidehoved celle",Column:"Kolonne","Row group":"Række gruppe",Cell:"Celle",Middle:"Midt","Cell type":"Celle type","Copy row":"Kopier række","Row properties":"Række egenskaber","Table properties":"Tabel egenskaber",Bottom:"Bund","V Align":"V juster",Header:"Sidehoved",Right:"Højre","Insert column after":"Indsæt kolonne efter",Cols:"Kolonne","Insert row after":"Indsæt række efter",Width:"Bredde","Cell properties":"Celle egenskaber",Left:"Venstre","Cut row":"Klip række","Delete column":"Slet kolonne",Center:"Centrering","Merge cells":"Flet celler","Insert template":"Indsæt skabelon",Templates:"Skabeloner","Background color":"Baggrunds farve","Custom...":"Brugerdefineret...","Custom color":"Brugerdefineret farve","No color":"Ingen farve","Text color":"Tekst farve","Show blocks":"Vis klokke","Show invisible characters":"Vis usynlige tegn","Words: {0}":"Ord: {0}",Insert:"Indsæt",File:"Fil",Edit:"Rediger","Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help":"Rich Text område. Tryk ALT-F9 for menu. Tryk ALT-F10 for toolbar. Tryk ALT-0 for hjælp",Tools:"Værktøj",View:"Vis",Table:"Tabel",Format:"Format"}),function(e,t){t.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("edit-user",{url:"/user",templateUrl:"app/components/home/home-edit-user.view.html",controller:"home.EditUserCtrl",resolve:{user:["userService",function(e){return e.getUser()}],orgUnits:["userService","$http",function(e,t){return e.getUser().then(function(e){return t.get("api/organizationunit/?byUser&organizationId="+e.currentOrganizationId).then(function(e){return e.data.response})})}]}})}]),t.controller("home.EditUserCtrl",["$rootScope","$scope","notify","userService","user","orgUnits",function(e,t,n,r,i,a){function o(e){t.user={name:e.name,lastName:e.lastName,email:e.email,phoneNumber:e.phoneNumber,defaultUserStartPreference:e.defaultUserStartPreference,defaultOrganizationUnitId:e.defaultOrganizationUnitId,isUsingDefaultOrgUnit:e.isUsingDefaultOrgUnit,currentOrganizationName:e.currentOrganizationName,currentOrganizationUnitName:e.currentOrganizationUnitName}}e.page.title="Profil indstillinger",e.page.subnav=[],o(i),a.length>0?t.orgUnits=a:(t.orgUnits=[i.currentOrganization.root],t.fakeDefaultOrganizationUnitId=i.currentOrganization.root.id,t.noOrgUnits=!0),t.patch=function(e,t){var i={};i[e]=t,r.patchUser(i).then(function(e){o(e),n.addSuccessMessage("Feltet er opdateret!")},function(){n.addErrorMessage("Fejl! Kunne ikke opdatere feltet!")})},t.updateDefaultOrgUnit=function(){r.updateDefaultOrgUnit(t.user.defaultOrganizationUnitId).then(function(e){r.getUser().then(function(e){return e});n.addSuccessMessage("Feltet er opdateret!")},function(){n.addErrorMessage("Fejl! Kunne ikke opdatere feltet!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("forgot-password",{url:"/forgot-password",templateUrl:"app/components/home/home-forgot-password.view.html",controller:"home.ForgotPasswordCtrl",noAuth:!0})}]),t.controller("home.ForgotPasswordCtrl",["$rootScope","$scope","$http","notify",function(e,t,n,r){e.page.title="Glemt password",e.page.subnav=[],t.submit=function(){if(!t.requestForm.$invalid){var e=t.email,i={email:e},a=r.addInfoMessage("Sender email ...",!1);n.post("api/passwordresetrequest",i,{handleBusy:!0}).success(function(n){a.toSuccessMessage("En email er blevet sent til "+e),t.email=""}).error(function(e){a.toErrorMessage("Emailen kunne ikke sendes. Prøv igen eller kontakt en lokal administrator")})}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("reset-password",{url:"/reset-password/:requestId",templateUrl:"app/components/home/home-reset-password.view.html",controller:"home.ResetPasswordCtrl",noAuth:!0})}]),t.controller("home.ResetPasswordCtrl",["$rootScope","$scope","$http","$stateParams",function(e,t,n,r){e.page.title="Nyt password",e.page.subnav=[];var i=r.requestId;n.get("api/passwordresetrequest?requestId="+i).success(function(e){t.resetStatus="enterPassword",t.email=e.response.userEmail}).error(function(){t.resetStatus="missingRequest"}),t.submit=function(){if(!t.resetForm.$invalid){var e={requestId:i,newPassword:t.password};n.post("api/authorize?resetPassword",e).success(function(e){t.resetStatus="success",t.email=""}).error(function(e){t.requestFailure=!0})}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("index",{url:"/?to",templateUrl:"app/components/home/home.view.html",controller:"home.IndexCtrl",noAuth:!0,resolve:{texts:["$http",function(e){return e.get("api/text/").then(function(e){return e.data.response})}]}})}]),t.controller("home.IndexCtrl",["$rootScope","$scope","$http","$state","$stateParams","notify","userService","texts","navigationService","$sce","$auth","$location",function(e,t,n,r,i,a,o,s,l,c,d,u){e.page.title="Index",e.page.subnav=[],t.texts=[],t.texts.about=_.find(s,function(e){return 1==e.id}),t.texts.status=_.find(s,function(e){return 2==e.id}),t.texts.guide=_.find(s,function(e){return 3==e.id}),t.texts.support=_.find(s,function(e){return 4==e.id}),t.texts.join=_.find(s,function(e){return 5==e.id}),t.texts.about.value=c.trustAsHtml(t.texts.about.value),t.texts.status.value=c.trustAsHtml(t.texts.status.value),t.texts.guide.value=c.trustAsHtml(t.texts.guide.value),t.texts.support.value=c.trustAsHtml(t.texts.support.value),t.texts.join.value=c.trustAsHtml(t.texts.join.value),t.tinymceOptions={plugins:"link image code",skin:"lightgray",theme:"modern",convert_urls:!1},t.text={};var p=u.search().id_token;u.search("id_token",null),u.search("scope",null),u.search("session_state",null),p&&o.loginSSO(p).then(function(e){return t.loginResult(e)}),t.SSOLogin=function(){a.addInfoMessage("Should do redirect to OS2SSO..."),d.signIn()},t.submitLogin=function(){t.loginForm.$invalid||o.login(t.email,t.password,t.remember).then(function(e){a.addSuccessMessage("Du er nu logget ind!"),!0===e.isAuth&&(l.checkState(e.defaultUserStartPreference)?r.go(e.defaultUserStartPreference):r.go("index"))},function(e){"User is locked"===e.response?a.addErrorMessage("Brugeren er låst! Kontakt administrator."):void 0===e.response||a.addErrorMessage("Forkert brugernavn eller password!")})},t.save=function(e){var t=a.addInfoMessage("Gemmer...",!1),r={value:e.value};n({method:"PATCH",url:"api/text/"+e.id+"?organizationId=1",data:r,ignoreLoadingBar:!0}).success(function(){t.toSuccessMessage("Feltet er opdateret.")}).error(function(e,n){409===n?t.toErrorMessage("Fejl! Feltet kunne ikke ændres da værdien den allerede findes i KITOS!"):t.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}}])}(angular,app),function(e,t){t.controller("object.EditAdviceCtrl",["$","$scope","$http","$state","$stateParams","$timeout","notify","$uibModal","Roles","object","type","advicename","hasWriteAccess",function(e,t,n,r,i,a,o,s,l,c,d,u,p){function f(t){var n=e("#mainGrid").data("kendoGrid"),r=n.dataItem(n.select());e("#detailGrid").data("kendoGrid").dataSource.transport.options.read.url="/Odata/adviceSent?$filter=AdviceId eq "+r.Id,e("#detailGrid").data("kendoGrid").dataSource.read()}t.type=d,t.object=c,t.hasWriteAccess=p,t.advicename=u,t.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:"/Odata/advice?$filter=type eq '"+d+"' and RelationId eq "+c.id+"&$expand=Reciepients, Advicesent",dataType:"json"}},pageSize:10,serverPaging:!0,serverFiltering:!0},selectable:!0,change:f,columns:[{field:"Name",title:"Navn",attributes:{class:"might-overflow"}},{field:"SentDate",title:"Sidst sendt",template:function(e){return null!=e.SentDate?kendo.toString(new Date(e.SentDate),"d"):""},attributes:{class:"might-overflow"}},{field:"Id",hidden:!0},{field:"AlarmDate",title:"Start dato",template:function(e){return null!=e.AlarmDate?kendo.toString(new Date(e.AlarmDate),"d"):""},attributes:{class:"might-overflow"}},{field:"StopDate",title:"Slut dato",template:function(e){return null!=e.StopDate?kendo.toString(new Date(e.StopDate),"d"):""},attributes:{class:"might-overflow"}},{field:"Reciepients.Name",title:"Modtager",template:function(){return"<span data-ng-model=\"dataItem.Reciepients\" value=\"cc.Name\" ng-repeat=\"cc in dataItem.Reciepients | filter: { RecieverType: 'RECIEVER'}\"> {{cc.Name}}{{$last ? '' : ', '}}</span>"},attributes:{class:"might-overflow"}},{field:"Reciepients.Name",title:"CC",template:function(){return"<span data-ng-model=\"dataItem.Reciepients\" value=\"cc.Name\" ng-repeat=\"cc in dataItem.Reciepients | filter: { RecieverType: 'CC'}\"> {{cc.Name}}{{$last ? '' : ', '}}</span>"},attributes:{class:"might-overflow"}},{field:"Subject",title:"Emne"},{template:function(e){var t=moment().isAfter(moment(e.StopDate))||"Immediate"===e.Scheduling,n=0===e.AdviceSent.length;return p?'<button class="btn-link" ng-disabled="'+t+"\" data-ng-click=\"newAdvice('PATCH',"+e.Id+')"><i class="glyphicon glyphicon-pencil"></i></button>\n                                            <button class="btn-link" ng-disabled="'+!n+'" data-ng-click="deleteAdvice('+e.Id+')"><i class="glyphicon glyphicon-trash"></i></button>':"Ingen rettigheder"}}],toolbar:[{name:"opretRolle",text:"Opret rolle",template:'<button data-ng-disabled="!hasWriteAccess" class="btn btn-success btn-sm" data-ng-click="newAdvice(\'POST\')"><i class="glyphicon glyphicon-plus small" ></i>Ny</button>'}],pageable:{refresh:!0,pageSizes:[10,25,50,100,200],buttonCount:5}},t.detailGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:"/Odata/adviceSent?$filter=AdviceId eq 0",dataType:"json"}},pageSize:25},columns:[{field:"AdviceSentDate",title:"Afsendt",template:function(e){return null!=e.AdviceSentDate?kendo.toString(new Date(e.AdviceSentDate),"g"):""}}],scrollable:{virtual:!0}},t.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},t.deleteAdvice=function(t){n.delete("odata/advice("+t+")").then(function(){o.addSuccessMessage("Advisen er slettet!"),e("#mainGrid").data("kendoGrid").dataSource.read()},function(){return o.addErrorMessage("Fejl! Kunne ikke slette!")})};var g=!1;t.newAdvice=function(r,i){if(t.hasWriteAccess=p,t.action=r,!1===g){g=!0;s.open({windowClass:"modal fade in",templateUrl:"app/components/it-advice/it-advice-modal-view.html",controller:["$scope","$uibModalInstance","Roles","$window","type","action","object","currentUser",function(t,r,a,s,l,c,d,u){function p(e){var t=e.split("-");return t[2].length>4?new Date(t[0]+"/"+t[1]+"/"+t[2].substring(0,2)):new Date(t[2]+"/"+t[1]+"/"+t[0].substring(0,2))}function f(r,i,a){n({method:i,url:a,data:r,type:"application/json"}).success(function(){"POST"===i&&(o.addSuccessMessage("Advisen er oprettet!"),t.$close(!0),e("#mainGrid").data("kendoGrid").dataSource.read()),"PATCH"===i&&o.addSuccessMessage("Advisen er opdateret!")}).error(function(){"POST"===i&&o.addErrorMessage("Fejl! Kunne ikke oprette modalen!"),"PATCH"===i&&o.addErrorMessage("Fejl! Kunne ikke opdatere modalen!")})}function m(){var e={Name:"Straks afsendt",Subject:t.subject,Body:t.emailBody,RelationId:d.id,Type:l,Scheduling:"Immediate",Reciepients:[],AlarmDate:null,StopDate:null,JobId:t.hiddenForjob},n=t.externalTo,r=t.externalCC;if(void 0!=t.selectedRecievers)for(var i=0;i<t.selectedRecievers.length;i++)e.Reciepients.push({Name:t.selectedRecievers[i],RecpientType:"ROLE",RecieverType:"RECIEVER",adviceId:void 0});if(void 0!=t.selectedCC)for(var i=0;i<t.selectedCC.length;i++)e.Reciepients.push({Name:t.selectedCC[i],RecieverType:"CC",RecpientType:"ROLE"});if(void 0!=n)for(var i=0;i<n.split(",").length;i++)e.Reciepients.push({Name:n.split(",")[i],RecpientType:"USER",RecieverType:"RECIEVER"});if(void 0!=r)for(var i=0;i<r.split(",").length;i++)e.Reciepients.push({Name:r.split(",")[i],RecieverType:"CC",RecpientType:"USER"});return e}t.showRoleFields=!0,g=!0,a.data?t.recieverRoles=a.data.value:(t.showRoleFields=!1,t.collapsed=!1),"POST"===c&&(t.hideSend=!1,t.externalCC=u.email,t.emailBody="<a href='"+s.location.href.replace("advice","main")+"'>Link til "+l+"</a>"),"PATCH"===c&&(t.hideSend=!0,void 0!=i&&n({method:"GET",url:"Odata/advice?key="+i+"&$expand=Reciepients"}).then(function(e){t.name=e.data.Name,t.subject=e.data.Subject,t.emailBody=e.data.Body,t.repitionPattern=e.data.Scheduling,t.startDate=e.data.AlarmDate,t.stopDate=e.data.StopDate,t.selectedRecievers=[],t.hiddenForjob=e.data.JobId;var n=[];t.selectedCC=[];for(var r=0;r<e.data.Reciepients.length;r++)"ROLE"==e.data.Reciepients[r].RecpientType&&"RECIEVER"==e.data.Reciepients[r].RecieverType?t.selectedRecievers.push(e.data.Reciepients[r].Name):"ROLE"==e.data.Reciepients[r].RecpientType&&"CC"==e.data.Reciepients[r].RecieverType?t.selectedCC.push(e.data.Reciepients[r].Name):"USER"==e.data.Reciepients[r].RecpientType&&"RECIEVER"==e.data.Reciepients[r].RecieverType?t.externalTo=e.data.Reciepients[r].Name:"USER"==e.data.Reciepients[r].RecpientType&&"CC"==e.data.Reciepients[r].RecieverType&&n.push(e.data.Reciepients[r].Name);t.externalCC=n.join(", ")},function(e){})),t.save=function(){var r="",a=m();if(a.Name=t.name,a.Scheduling=t.repitionPattern,a.AlarmDate=p(t.startDate),a.StopDate=p(t.stopDate),a.StopDate.setHours(23,59,59,99),"POST"==c)r="Odata/advice",f(a,c,r);else if("PATCH"==c){r="Odata/advice("+i+")",n.delete("/api/AdviceUserRelation/DeleteByAdviceId?adviceId="+i);for(var s=0;s<a.Reciepients.length;s++)a.Reciepients[s].adviceId=i,n.post("/api/AdviceUserRelation",a.Reciepients[s]);a.Reciepients=void 0,n.patch(r,JSON.stringify(a)).then(function(){o.addSuccessMessage("Advisen er opdateret!"),e("#mainGrid").data("kendoGrid").dataSource.read(),t.$close(!0)},function(){})}},t.send=function(){f(m(),c,"Odata/advice")},t.checkErrStart=function(e,n){return t.errMessage="",t.startDateErrMessage="",t.curDate=new Date,moment(t.startDate,"dd-MM-yyyy").isValid()&&void 0!=t.startDate?t.startDate&&t.stopDate?p(t.startDate)>p(t.stopDate)?(t.errMessage="'Til Dato' skal være senere end eller samme som 'Fra dato'!",!1):(t.startDateErrMessage="",t.errMessage="",!0):(t.errMessage="Begge dato felter skal udfyldes!",!1):(t.startDateErrMessage="Fra Dato er ugyldig!",!1)},t.checkErrEnd=function(e,n){return t.errMessage="",t.stopDateErrMessage="",t.curDate=new Date,moment(t.stopDate,"dd-MM-yyyy").isValid()&&void 0!=t.stopDate?t.startDate&&t.stopDate?p(t.startDate)>p(t.stopDate)?(t.errMessage="'Til Dato' skal være senere end eller samme som 'Fra dato'!",!1):(t.stopDateErrMessage="",t.errMessage="",!0):(t.errMessage="Begge dato felter skal udfyldes!",!1):(t.stopDateErrMessage="Til Dato er ugyldig!",!1)},t.tinymceOptions={plugins:"link image code",skin:"lightgray",theme:"modern",toolbar:"bold italic | example | code | preview | link | searchreplace",convert_urls:!1},t.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},g=!1}],resolve:{Roles:["$http",function(e){return"itSystemUsage"==d?e.get("odata/LocalItSystemRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e}):"itContract"==d?e.get("odata/LocalItContractRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e}):"itProject"==d?e.get("odata/LocalItProjectRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e}):"itInterface"==d?[]:void 0}],type:[function(){return t.type}],action:[function(){return t.action}],object:[function(){return t.object}],currentUser:["userService",function(e){return e.getUser()}],advicename:[function(){return t.advicename}],hasWriteAccess:[function(){return t.hasWriteAccess}]}})}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin.contract",{url:"/contract",templateUrl:"app/components/global-admin/global-admin-contract.view.html",authRoles:["GlobalAdmin"]})}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l){var c=this;this.$uibModalInstance=e,this.$stateParams=t,this.$http=n,this.notify=r,this.reportService=i,this._=a,this.optionsUrl=o,this.optionId=s,this.optionType=l,this.initModal=function(e,t){if(0===e)c.pageTitle="Opret";else{c.pageTitle="Redigér";c.$http.get(t+"("+e+")").then(function(e){var t=e.data;c.name=t.Name,c.isObligatory=t.IsObligatory,c.hasWriteAccess=t.HasWriteAccess,c.description=t.Description})}},this.optionsUrl=this.$stateParams.optionsUrl,this.optionId=this.$stateParams.id,this.optionType=this.$stateParams.optionType,this.initModal(this.optionId,this.optionsUrl),this.buttonDisabled=!1}return e.prototype.createPayload=function(e){return"role"===e?{Name:this.name,IsObligatory:this.isObligatory,HasWriteAccess:this.hasWriteAccess,Description:this.description}:{Name:this.name,IsObligatory:this.isObligatory,Description:this.description}},e.prototype.ok=function(){var e=this;if(this.buttonDisabled=!0,0===this.optionId){var t=this.createPayload(this.optionType);this.$http.post(""+this.optionsUrl,t).then(function(t){e.$uibModalInstance.close(),e.notify.addSuccessMessage("Værdien blev oprettet.")}).catch(function(t){e.notify.addErrorMessage("Oprettelse mislykkedes.")})}else{var t=this.createPayload(this.optionType);this.$http.patch(this.optionsUrl+"("+this.optionId+")",t).then(function(t){e.$uibModalInstance.close(),e.notify.addSuccessMessage("Værdien blev redigeret.")}).catch(function(t){e.notify.addErrorMessage("Værdien blev ikke redigeret.")})}},e.prototype.cancel=function(){this.$uibModalInstance.close()},e.$inject=["$uibModalInstance","$stateParams","$http","notify","_"],e}();e.OptionsController=t,angular.module("app").config(["$stateProvider",function(e){e.state("global-admin.org.edit-org-roles",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-organisation-roles",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-option-edit-roles.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("global-admin.project.edit-project-roles",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-project-roles",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-option-edit-roles.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("global-admin.system.edit-system-roles",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-system-roles",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-option-edit-roles.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("global-admin.contract.edit-contract-roles",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-contract-roles",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-option-edit-roles.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("global-admin.project.edit-project-types",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-project-types",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-option-edit-types.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("global-admin.system.edit-system-types",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-system-types",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-option-edit-types.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("global-admin.contract.edit-contract-types",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-contract-types",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-option-edit-types.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("global-admin.report.edit-report-types",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-report-types",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-option-edit-types.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(e.Options||(e.Options={}))}(e.GlobalConfig||(e.GlobalConfig={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin.global-users",{url:"/global-admins",templateUrl:"app/components/global-admin/global-admin-global-admins.view.html",controller:"globalAdmin.globalAdminsCtrl",authRoles:["GlobalAdmin"]})}]),t.controller("globalAdmin.globalAdminsCtrl",["$rootScope","$scope","$http","notify",function(e,t,n,r){function i(e){var n={show:!0,user:e,userForSelect:{id:e.id,text:e.name,user:e}};t.globalAdmins.push(n)}function a(){if(t.newUser){var e=t.newUser,a=e.id;if(a){var o={userId:a},s=r.addInfoMessage("Arbejder ...",!1);n.post("api/globaladmin",o,{handleBusy:!0}).success(function(n){s.toSuccessMessage(e.text+" er blevet global administrator"),t.newUser=null,i(n.response)}).error(function(t){s.toErrorMessage("Kunne ikke gøre "+e.text+" til global administrator")})}}}e.page.title="Globale administratorer",t.globalAdmins=[],n.get("api/globaladmin").success(function(e){_.each(e.response,i)}),t.$watch("newUser",function(e,t){e!==t&&e&&a()}),t.deleteGlobalAdmin=function(e){var t=e.user.id,i=r.addInfoMessage("Arbejder ...",!1);n.delete("api/globaladmin?userId="+t).success(function(t){e.show=!1,i.toSuccessMessage(e.user.name+" er ikke længere global administrator")}).error(function(t){i.toErrorMessage("Kunne ikke fjerne "+e.user.name+" som global administrator")})},t.updateGlobalAdmin=function(e){if(e.userForSelect){var i=e.userForSelect,a=e.user.id,o=i.id;if(o){if(a==o)return void(e.edit=!1);var s=r.addInfoMessage("Arbejder ...",!1);n.delete("api/globaladmin?userId="+a,{handleBusy:!0}).success(function(r){var a={userId:o};n.post("api/globaladmin",a,{handleBusy:!0}).success(function(n){s.toSuccessMessage(i.text+" er blevet global administrator"),t.newUser=null;var r=n.response;e.user=r,e.userForSelect={id:r.id,text:r.text,user:r},e.edit=!1}).error(function(t){e.show=!1,s.toErrorMessage("Kunne ikke gøre "+i.text+" til global administrator")})}).error(function(t){e.userForSelect={id:e.user.id,text:e.user.name},s.toErrorMessage("Fejl!")})}}},t.adminSortBy="userName",t.adminSortReverse=!1,t.adminSort=function(e){switch(t.adminSortBy){case"userName":return e.user.name;case"userEmail":return e.user.email;default:return e.user.name}},t.adminSortChange=function(e){t.adminSortBy==e?t.adminSortReverse=!t.adminSortReverse:t.adminSortReverse=!1,t.adminSortBy=e}}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s){if(this.$uibModalInstance=e,this.$http=t,this.$q=n,this.notify=r,this.autofocus=i,this.user=a,this._=o,this.helpTexts=s,!a.currentOrganizationId)return void r.addErrorMessage("Fejl! Kunne ikke oprette hjælpetekst.",!0);i(),this.busy=!1}return e.prototype.cancel=function(){this.$uibModalInstance.close()},e.prototype.create=function(){var e=this,t=this.vm.key;if(_.find(this.helpTexts,function(e){return e.Key===t}))return void this.notify.addErrorMessage("Fejl! Der findes allerede en hjælpetekst med den angivne key.",!0);this.busy=!0;var n={Title:this.vm.title,Key:this.vm.key},r=this.notify.addInfoMessage("Opretter hjælpetekst",!1);this.$http.post("odata/HelpTexts",n,{handleBusy:!0}).then(function(t){r.toSuccessMessage(e.vm.title+" er oprettet i KITOS"),e.cancel()},function(){r.toErrorMessage("Fejl! Noget gik galt ved oprettelsen af "+e.vm.title+"!"),e.cancel()})},e.$inject=["$uibModalInstance","$http","$q","notify","autofocus","user","_","helpTexts"],e}();angular.module("app").config(["$stateProvider",function(e){e.state("global-admin.help-texts.create",{url:"/create",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/global-admin/global-admin-help-texts-create.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"ctrl",resolve:{user:["userService",function(e){return e.getUser()}],helpTexts:["$http",function(e){return e.get("/odata/HelpTexts").then(function(e){return e.data.value})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(e.HelpTexts||(e.HelpTexts={}))}(e.GlobalAdmin||(e.GlobalAdmin={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l){this.$rootScope=e,this.$scope=t,this.$http=n,this.notify=r,this.user=i,this.helpText=a,this.$uibModal=o,this._=s,this.$state=l,e.page.title="Hjælpetekter",this.tinymceOptions={plugins:"link image code",skin:"lightgray",theme:"modern",convert_urls:!1,height:"400px"}}return e.prototype.save=function(){var e={Title:this.helpText.Title,Description:this.helpText.Description},t=this.notify.addInfoMessage("Gemmer...",!1);this.$http({method:"PATCH",url:"odata/HelpTexts("+this.helpText.Id+")",data:e,ignoreLoadingBar:!0}).success(function(){t.toSuccessMessage("Feltet er gemt.")}).error(function(e,n){409===n?t.toErrorMessage("Fejl! Feltet kunne ikke ændres da værdien den allerede findes i KITOS!"):t.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})},e.prototype.delete=function(){if(confirm("Er du sikker på at du vil slette hjælpeteksten?")){var e=this.notify.addInfoMessage("Sletter...",!1),t=this;this.$http({method:"DELETE",url:"odata/HelpTexts("+this.helpText.Id+")"}).success(function(){e.toSuccessMessage("Hjælpeteksten er slettet."),t.$state.go("global-admin.help-texts")}).error(function(t,n){409===n?e.toErrorMessage("Fejl! Feltet kunne ikke ændres da værdien den allerede findes i KITOS!"):e.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}},e.$inject=["$rootScope","$scope","$http","notify","user","helpText","$uibModal","_","$state"],e}();e.HelpTextsEditController=t,angular.module("app").config(["$stateProvider",function(e){e.state("global-admin.help-texts-edit",{url:"/help-texts/edit/{id:[0-9]+}",templateUrl:"app/components/global-admin/global-admin-help-texts-edit.view.html",controller:t,controllerAs:"helpTextsEditCtrl",
authRoles:["GlobalAdmin"],resolve:{user:["userService",function(e){return e.getUser()}],helpText:["$http","$stateParams",function(e,t){return e.get("/odata/HelpTexts("+t.id+")").then(function(e){return e.data})}]}})}])}(e.HelpTexts||(e.HelpTexts={}))}(e.GlobalAdmin||(e.GlobalAdmin={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u){function p(e){e.element.kendoAutoComplete({noDataTemplate:""})}this.$rootScope=e,this.$scope=t,this.$http=n,this.$timeout=r,this.$window=i,this.$state=a,this.$=o,this._=s,this.notify=l,this.helpTexts=c,this.user=d,this.$modal=u,this.$rootScope.page.title="Hjælpetekster - Overblik",this.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:function(e){return"/odata/HelpTexts"},dataType:"json"}},sort:{field:"Title",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,filterable:{mode:"row",messages:{isTrue:"✔",isFalse:"✖"}},groupable:!1,columnMenu:{filterable:!1},toolbar:[{name:"opretHjælpeTekst",text:"Opret hjælpetekst",template:"<a ui-sref='global-admin.help-texts.create' class='btn btn-success pull-right'>#: text #</a>"}],columns:[{field:"Title",title:"Titel",width:150,persistId:"title",template:function(e){return'<a ui-sref="global-admin.help-texts-edit({id:'+e.Id+'})">'+e.Title+"</a>"},filterable:{cell:{template:p,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Key",title:"Key",width:150,persistId:"key",filterable:{cell:{template:p,dataSource:[],showOperators:!1,operator:"contains"}}}]}}return e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.$inject=["$rootScope","$scope","$http","$timeout","$window","$state","$","_","notify","helpTexts","user","$uibModal"],e}();e.HelpTextsController=t,angular.module("app").config(["$stateProvider",function(e){e.state("global-admin.help-texts",{url:"/help-texts",templateUrl:"app/components/global-admin/global-admin-help-texts.view.html",controller:t,controllerAs:"helpTextsCtrl",authRoles:["GlobalAdmin"],resolve:{user:["userService",function(e){return e.getUser()}],helpTexts:["$http",function(e){return e.get("/odata/HelpTexts").then(function(e){return e.data.value})}]}})}])}(e.HelpTexts||(e.HelpTexts={}))}(e.GlobalAdmin||(e.GlobalAdmin={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin.local-users",{url:"/local-admins",templateUrl:"app/components/global-admin/global-admin-local-admins.view.html",controller:"globalAdmin.localAdminsCtrl",authRoles:["GlobalAdmin"],resolve:{adminRights:["$http",function(e){return e.get("api/OrganizationRight/?roleName=LocalAdmin&roleWithName").then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser()}]}})}]),t.controller("globalAdmin.localAdminsCtrl",["$rootScope","$scope","$http","$state","notify","adminRights","user",function(e,t,n,r,i,a,o){function s(){if("object"==typeof t.newUser&&t.newOrg&&t.newUser){var e=t.newUser,r=e.id,a=t.newOrg.id,o=t.newOrg.text,s=Kitos.API.Models.OrganizationRole.LocalAdmin;if(r&&a&&s){var c={userId:r,role:s},d=i.addInfoMessage("Arbejder ...",!1);n.post("api/OrganizationRight/"+a+"?organizationId="+a,c,{handleBusy:!0}).success(function(t){d.toSuccessMessage(e.text+" er blevet lokal administrator for "+o),l()}).error(function(){d.toErrorMessage("Kunne ikke gøre "+e.text+" til lokal administrator for "+o)})}}}function l(){r.go(".",null,{reload:!0})}function c(e){var t="<div>"+e.text+"</div>";return e.cvr&&(t+='<div class="small">'+e.cvr+"</div>"),t}e.page.title="Lokal administratorer",t.adminRights=a,t.$watch("newUser",function(e,t){e!==t&&e&&s()}),t.$watch("newOrg",function(e,t){e!==t&&e&&s()}),t.deleteLocalAdmin=function(e){var t=e.organizationId,r=e.role,a=e.userId,s=i.addInfoMessage("Arbejder ...",!1);n.delete("api/OrganizationRight/"+t+"?rId="+r+"&uId="+a+"&organizationId="+o.currentOrganizationId).success(function(t){s.toSuccessMessage(e.userName+" er ikke længere lokal administrator"),l()}).error(function(t){s.toErrorMessage("Kunne ikke fjerne "+e.userName+" som lokal administrator")})},t.organizationSelectOptions=function(e,t,r){return{minimumInputLength:1,allowClear:!0,placeholder:" ",formatResult:t,ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(t){var i=r?"&"+r.join("&"):"",a=n.get(e+"?q="+t.data.query+i).then(t.success);return a.abort=function(){return null},a},results:function(e,t){var n=[];return _.each(e.data.response,function(e){n.push({id:e.id,text:e.name?e.name:"Unavngiven",cvr:e.cvr})}),{results:n}}}}}("api/organization",c,null)}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin.misc",{url:"/misc",templateUrl:"app/components/global-admin/global-admin-misc.view.html",controller:"globalAdminMisc",authRoles:["GlobalAdmin"],resolve:{globalConfigs:["$http",function(e){return e.get("/odata/GlobalConfigs").then(function(e){return e.data.value})}]}})}]),t.controller("globalAdminMisc",["$rootScope","$scope","$http","uploadFile","globalConfigs","_","notify",function(e,t,n,r,i,a,o){e.page.title="Andet",t.canGlobalAdminOnlyEditReports=a.find(i,function(e){return"CanGlobalAdminOnlyEditReports"===e.key}),t.uploadFile=function(){var e=t.myFile;r.uploadFile(e)},t.patchConfig=function(e){var t={};t.value=e.value,n.patch("/odata/GlobalConfigs("+e.Id+")",t).then(function(e){o.addSuccessMessage("Feltet er opdateret!")},function(){o.addErrorMessage("Fejl! Kunne ikke opdatere feltet!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin.org",{url:"/org",templateUrl:"app/components/global-admin/global-admin-org.view.html",authRoles:["GlobalAdmin"]})}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r){this.$rootScope=e,this.$scope=t,this.$http=n,this.notify=r,e.page.title="Ny organisation",this.title="Opret organisation",this.org={},this.org.accessModifier="1",this.org.typeId=1,this.buttonDisabled=!1}return e.prototype.dismiss=function(){this.$scope.$dismiss()},e.prototype.submit=function(){var e=this;this.buttonDisabled=!0;var t=this.org;this.$http.post("api/organization",t).success(function(t){e.notify.addSuccessMessage("Organisationen "+t.response.name+" er blevet oprettet!"),e.$scope.$close(!0)}).error(function(t){e.notify.addErrorMessage("Organisationen "+e.org.name+" kunne ikke oprettes!")})},e.$inject=["$rootScope","$scope","$http","notify"],e}();e.CreateOrganizationController=t,angular.module("app").config(["$stateProvider",function(e){e.state("global-admin.organizations.create",{url:"/create",authRoles:["GlobalAdmin"],onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({size:"lg",templateUrl:"app/components/global-admin/global-admin-organization-modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"ctrl"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(e.Organization||(e.Organization={}))}(e.GlobalAdmin||(e.GlobalAdmin={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a){this.$rootScope=e,this.$scope=t,this.$http=n,this.notify=r,this.org=i,this.user=a,e.page.title="Rediger organisation",t.title="Rediger organisation"}return e.prototype.dismiss=function(){this.$scope.$dismiss()},e.prototype.submit=function(){var e=this,t={name:this.org.name,accessModifier:this.org.accessModifier,cvr:this.org.cvr,typeId:this.org.typeId,foreignCvr:this.org.foreignCvr};this.$http({method:"PATCH",url:"api/organization/"+this.org.id+"?organizationId="+this.user.currentOrganizationId,data:t}).then(function(t){e.notify.addSuccessMessage("Ændringerne er blevet gemt!"),e.$scope.$close(!0)},function(t){e.notify.addErrorMessage("Ændringerne kunne ikke gemmes!")})},e.$inject=["$rootScope","$scope","$http","notify","org","user"],e}();e.EditOrganizationController=t,angular.module("app").config(["$stateProvider",function(e){e.state("global-admin.organizations.edit",{url:"/edit/:id",authRoles:["GlobalAdmin"],onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({size:"lg",templateUrl:"app/components/global-admin/global-admin-organization-modal.view.html",windowClass:"modal fade in",resolve:{org:["$http",function(e){return e.get("api/organization/"+n.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser()}]},controller:t,controllerAs:"ctrl"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(e.Organization||(e.Organization={}))}(e.GlobalAdmin||(e.GlobalAdmin={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c){function d(e){e.element.kendoAutoComplete({noDataTemplate:""})}var u=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.notify=r,this.user=i,this._=a,this.$=o,this.$state=s,this.$window=l,this.$timeout=c,this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(u.exportFlag){u.exportFlag=!1,u._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=u.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(u.mainGrid.element,!1)}else e.preventDefault(),u._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),u.$timeout(function(){u.exportFlag=!0,e.sender.saveAsExcel()})},this.onEdit=function(e){e.preventDefault();var t=u.mainGrid.dataItem(u.$(e.currentTarget).closest("tr")),n=t.Id;u.$state.go("global-admin.organizations.edit",{id:n})},this.onDelete=function(e){e.preventDefault();var t=u.mainGrid.dataItem(u.$(e.currentTarget).closest("tr"));u.$window.confirm("Er du sikker på at slette "+t.Name+"?")&&(u.mainGrid.dataSource.remove(t),u.mainGrid.dataSource.sync())},e.page.title="Organisationer",this.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:"/odata/Organizations?$expand=Type",dataType:"json"},destroy:{url:function(e){return"/odata/Organizations("+e.Id+")"},dataType:"json",contentType:"application/json"}},sort:{field:"Name",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{id:"Id"}}},toolbar:[{name:"opretOrganisation",text:"Opret Organisation",template:"<a ui-sref='global-admin.organizations.create' class='btn btn-success pull-right'>#: text #</a>"},{name:"excel",text:"Eksportér til Excel",className:"pull-right"}],excel:{fileName:"Organisationer.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},editable:!0,reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:!0,height:window.innerHeight-200,excelExport:this.exportToExcel,columns:[{field:"Name",title:"Navn",width:230,persistId:"name",hidden:!1,excelTemplate:function(e){return e.Name},filterable:{cell:{template:d,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Cvr",title:"CVR",width:230,persistId:"cvr",hidden:!1,excelTemplate:function(e){return e.Cvr},filterable:{cell:{template:d,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Type.Name",title:"Type",width:230,persistId:"type",hidden:!1,template:function(e){return e.Type.Name},excelTemplate:function(e){return e.Type.Name},filterable:{cell:{template:function(e){e.element.kendoDropDownList({dataSource:[{type:"Kommune",value:"Kommune"},{type:"Interessefællesskab",value:"Interessefællesskab"},{type:"Virksomhed",value:"Virksomhed"},{type:"Anden offentlig myndighed",value:"Anden offentlig myndighed"}],dataTextField:"type",dataValueField:"value",valuePrimitive:!0})},showOperators:!1}}},{field:"AccessModifier",title:"Synlighed",width:230,persistId:"synlighed",hidden:!1,template:'<display-access-modifier value="dataItem.AccessModifier"></display-access-modifier>',excelTemplate:function(e){return e.AccessModifier.toString()},filterable:{cell:{template:d,dataSource:[],showOperators:!1,operator:"contains"}}},{command:[{text:"Redigér",click:this.onEdit,imageClass:"k-edit",className:"k-custom-edit",iconClass:"k-icon"},{text:"Slet",click:this.onDelete,imageClass:"k-delete",className:"k-custom-delete",iconClass:"k-icon"}],title:" ",width:176,persistId:"command"}]}}return e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.$inject=["$rootScope","$scope","$http","notify","user","_","$","$state","$window","$timeout"],e}();e.OrganizationController=t,angular.module("app").config(["$stateProvider",function(e){e.state("global-admin.organizations",{url:"/organisations",templateUrl:"app/components/global-admin/global-admin-organizations.view.html",controller:t,controllerAs:"orgCtrl",authRoles:["GlobalAdmin"],resolve:{user:["userService",function(e){return e.getUser()}]}})}])}(e.Organization||(e.Organization={}))}(e.GlobalAdmin||(e.GlobalAdmin={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin.project",{url:"/project",templateUrl:"app/components/global-admin/global-admin-project.view.html",authRoles:["GlobalAdmin"]})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin.report",{url:"/report",templateUrl:"app/components/global-admin/global-admin-report.view.html",authRoles:["GlobalAdmin"]})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin",{url:"/global-admin",abstract:!0,controller:"globalAdminConfig",template:"<ui-view autoscroll='false' />"})}]),t.controller("globalAdminConfig",["$rootScope","$scope",function(e,t){var n=[{state:"global-admin.organizations",text:"Organisationer"},{state:"global-admin.global-users",text:"Globale administratorer"},{state:"global-admin.local-users",text:"Lokale administratorer"},{state:"global-admin.org",text:"Organisation"},{state:"global-admin.project",text:"IT Projekt"},{state:"global-admin.system",text:"IT System"},{state:"global-admin.contract",text:"IT Kontrakt"},{state:"global-admin.report",text:"Rapport"},{state:"global-admin.misc",text:"Andet"},{state:"global-admin.help-texts",text:"Hjælpetekster"}];e.page.title="Global admin",e.page.subnav=n,e.subnavPositionCenter=!0,t.$on("$viewContentLoaded",function(){e.positionSubnav()})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("global-admin.system",{url:"/system",templateUrl:"app/components/global-admin/global-admin-system.view.html",authRoles:["GlobalAdmin"]})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit",{url:"/edit/{id:[0-9]+}",templateUrl:"app/components/it-contract/it-contract-edit.view.html",controller:"contract.EditCtrl",controllerAs:"contractEditVm",resolve:{contract:["$http","$stateParams",function(e,t){return e.get("api/itcontract/"+t.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/itcontract/"+t.id+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}]}})}]),t.controller("contract.EditCtrl",["$scope","$rootScope","$http","$stateParams","notify","contract","user","hasWriteAccess",function(e,t,n,r,i,a,o,s){e.hasWriteAccess=s,e.allowClearOption={allowClear:!0},e.contract=a,e.hasWriteAccess||_.remove(t.page.subnav.buttons,function(e){return"Slet IT Kontrakt"===e.text})}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g,m,h){var v=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.$timeout=r,this.$window=i,this.$state=a,this.$=o,this._=s,this.moment=l,this.notify=c,this.user=d,this.gridStateService=u,this.itContractRoles=p,this.orgUnits=f,this.ecoStreamData=g,this.$modal=m,this.needsWidthFixService=h,this.storageKey="it-contract-overview-options",this.orgUnitStorageKey="it-contract-overview-orgunit",this.gridState=this.gridStateService.getService(this.storageKey),this.saveGridOptions=function(){v.gridState.saveGridOptions(v.mainGrid)},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(v.exportFlag){v.exportFlag=!1,v._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=v.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(v.mainGrid.element,!1),v.needsWidthFixService.fixWidth()}else e.preventDefault(),v._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),v.$timeout(function(){v.exportFlag=!0,e.sender.saveAsExcel()})},this.orgUnitDropDownList=function(e){function t(e){return"&nbsp;&nbsp;&nbsp;&nbsp;".repeat(e.$level)+e.Name}function n(){var e=this,t=i.$window.sessionStorage.getItem(i.orgUnitStorageKey);if(t){var n=i._.findIndex(e.dataItems(),function(e){return e.Id==t});n>0&&e.select(n)}}function r(){var e=this,t=i.mainGrid.dataSource,n=e.select(),r=i._.parseInt(e.value());n>0?i.$window.sessionStorage.setItem(i.orgUnitStorageKey,r.toString()):i.$window.sessionStorage.removeItem(i.orgUnitStorageKey),t.read()}var i=v;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:v.orgUnits,dataValueField:"Id",dataTextField:"Name",template:t,dataBound:n,change:r})},this.roleSelectorOptions=function(){return{autoBind:!1,dataSource:v.roleSelectorDataSource,dataTextField:"Name",dataValueField:"Id",optionLabel:"Vælg kontraktrolle...",change:function(e){v.mainGrid.hideColumn("ContractSigner"),v._.forEach(v.itContractRoles,function(e){return v.mainGrid.hideColumn("role"+e.Id)});var t=e.sender.value();v.mainGrid.showColumn(t),v.needsWidthFixService.fixWidth()}}},this.$rootScope.page.title="IT Kontrakt - Økonomi",this.$scope.$on("kendoWidgetCreated",function(e,t){t===v.mainGrid&&(v.loadGridOptions(),v.mainGrid.dataSource.read(),o(".k-grid-excel").click(function(){kendo.ui.progress(v.mainGrid.element,!0)}))}),this.activate()}return e.prototype.isValidUrl=function(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())},e.prototype.opretITKontrakt=function(){var e=this;this.$modal.open({windowClass:"modal fade in",templateUrl:"app/components/it-contract/it-contract-modal-create.view.html",controller:["$scope","$uibModalInstance",function(t,n){t.formData={},t.type="IT Kontrakt",t.checkAvailbleUrl="api/itProject/",t.saveAndProceed=function(){var r=e.user.currentOrganizationId,i=e.notify.addInfoMessage("Opretter kontrakt...",!1);e.$http.post("api/itcontract",{organizationId:r,name:t.formData.name}).success(function(t){i.toSuccessMessage("En ny kontrakt er oprettet!");var r=t.response;n.close(r.id),e.$state.go("it-contract.edit.main",{id:r.id})}).error(function(){i.toErrorMessage("Fejl! Kunne ikke oprette en ny kontrakt!")})},t.save=function(){var r=e.user.currentOrganizationId,i=e.notify.addInfoMessage("Opretter kontrakt...",!1);e.$http.post("api/itcontract",{organizationId:r,name:t.formData.name}).success(function(t){i.toSuccessMessage("En ny kontrakt er oprettet!");var r=t.response;n.close(r.id),e.$state.reload()}).error(function(){i.toErrorMessage("Fejl! Kunne ikke oprette en ny kontrakt!")})}}]})},e.prototype.fixRoleFilter=function(e,t,n){var r=new RegExp("(\\w+\\()"+t+"(.*?\\))","i");return e.replace(r,"Rights/any(c: $1concat(concat(c/User/Name, ' '), c/User/LastName)$2 and c/RoleId eq "+n+")")},e.prototype.fixSystemFilter=function(e,t){var n=new RegExp("(\\w+\\()"+t+"(.*?\\))","i");return e.replace(n,"AssociatedSystemUsages/any(c: $1c/ItSystemUsage/ItSystem/Name$2)")},e.prototype.loadGridOptions=function(){this.user.isReadOnly||this.mainGrid.options.toolbar.push({name:"excel",text:"Eksportér til Excel",className:"pull-right"}),this.gridState.loadGridOptions(this.mainGrid)},e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.prototype.saveGridProfile=function(){var e=this.$window.sessionStorage.getItem(this.orgUnitStorageKey);this.$window.localStorage.setItem(this.orgUnitStorageKey+"-profile",e),this.gridState.saveGridProfile(this.mainGrid),this.notify.addSuccessMessage("Filtre og sortering gemt")},e.prototype.loadGridProfile=function(){this.gridState.loadGridProfile(this.mainGrid);var e=this.$window.localStorage.getItem(this.orgUnitStorageKey+"-profile");this.$window.sessionStorage.setItem(this.orgUnitStorageKey,e),this.$(".k-filter-row[data-field='ResponsibleOrganizationUnit.Name']").find("input").data("kendoDropDownList").select(function(t){return t.Id==e}),this.mainGrid.dataSource.read(),this.notify.addSuccessMessage("Anvender gemte filtre og sortering")},e.prototype.clearGridProfile=function(){this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeSession(),this.notify.addSuccessMessage("Filtre og sortering slettet"),this.reload()},e.prototype.doesGridProfileExist=function(){return this.gridState.doesGridProfileExist()},e.prototype.clearOptions=function(){this.$window.localStorage.removeItem(this.orgUnitStorageKey+"-profile"),this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeLocal(),this.gridState.removeSession(),this.notify.addSuccessMessage("Sortering, filtering og kolonnevisning, -bredde og –rækkefølge nulstillet"),this.reload()},e.prototype.parseOptionEnum=function(e){switch(e){case"YES":return"Ja";case"NO":return"Nej";case"DONTKNOW":return"Ved ikke";default:return""}},e.prototype.activate=function(){function e(e){e.element.kendoAutoComplete({noDataTemplate:""})}var t=this,n=this._.cloneDeep(this.itContractRoles);this._.forEach(n,function(e){return e.Id="role"+e.Id}),n.push({Id:"ContractSigner",Name:"Kontraktunderskriver"}),this.roleSelectorDataSource=n,this.canCreate=!this.user.isReadOnly;var r={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:function(e){var n="?$expand=Reference,Parent,ResponsibleOrganizationUnit,PaymentModel,PaymentFreqency,Rights($expand=User,Role),Supplier,AssociatedSystemUsages($expand=ItSystemUsage($expand=ItSystem)),TerminationDeadline",r=t.$window.sessionStorage.getItem(t.orgUnitStorageKey);return null===r?"/odata/Organizations("+t.user.currentOrganizationId+")/ItContracts"+n:"/odata/Organizations("+t.user.currentOrganizationId+")/OrganizationUnits("+r+")/ItContracts"+n},dataType:"json"},parameterMap:function(e,n){var r=kendo.data.transports["odata-v4"].parameterMap(e,n);return r.$filter&&(t._.forEach(t.itContractRoles,function(e){return r.$filter=t.fixRoleFilter(r.$filter,"role"+e.Id,e.Id)}),r.$filter=t.fixSystemFilter(r.$filter,"AssociatedSystemUsages")),r}},sort:{field:"Name",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{fields:{OperationRemunerationBegun:{type:"date"},LastChanged:{type:"date"},Concluded:{type:"date"},ExpirationDate:{type:"date"},IrrevocableTo:{type:"date"},Terminated:{type:"date"},Acquisition:{type:"number"},Operation:{type:"number"},Other:{type:"number"},IsActive:{type:"boolean"}}},parse:function(e){return t._.forEach(e.value,function(e){var n=t._.filter(t.ecoStreamData,{ExternPaymentForId:e.Id});e.Acquisition=t._.sumBy(n,"Acquisition"),e.Operation=t._.sumBy(n,"Operation"),e.Other=t._.sumBy(n,"Other");var r=t._.first(t._.sortBy(n,["AuditDate"],["desc"]));r&&r.AuditDate&&(e.AuditDate=r.AuditDate);var i=t._.filter(n,{AuditStatus:"White"}).length,a=t._.filter(n,{AuditStatus:"Red"}).length,o=t._.filter(n,{AuditStatus:"Yellow"}).length,s=t._.filter(n,{AuditStatus:"Green"}).length;e.status={max:i+a+o+s,white:i,red:a,yellow:o,green:s},e.roles=[],t._.forEach(e.Rights,function(t){e.roles[t.RoleId]||(e.roles[t.RoleId]=[]),e.roles[t.RoleId].push([t.User.Name,t.User.LastName].join(" "))}),e.Parent||(e.Parent={Name:""}),e.ResponsibleOrganizationUnit||(e.ResponsibleOrganizationUnit={Name:""}),e.Supplier||(e.Supplier={Name:""}),e.Reference||(e.Reference={Title:"",ExternalReferenceId:""}),e.PaymentModel||(e.PaymentModel={Name:""}),e.PaymentFreqency||(e.PaymentFreqency={Name:""}),e.Reference||(e.Reference={Title:"",ExternalReferenceId:""})}),e}}},toolbar:[{name:"opretITKontrakt",text:"Opret IT Kontrakt",template:"<button ng-click='contractOverviewVm.opretITKontrakt()' class='btn btn-success pull-right' data-ng-disabled=\"!contractOverviewVm.canCreate\">#: text #</Button>"},{name:"clearFilter",text:"Nulstil",template:"<button type='button' class='k-button k-button-icontext' title='Nulstil sortering, filtering og kolonnevisning, -bredde og –rækkefølge' data-ng-click='contractOverviewVm.clearOptions()'>#: text #</button>"},{name:"saveFilter",text:"Gem filter",template:'<button type="button" class="k-button k-button-icontext" title="Gem filtre og sortering" data-ng-click="contractOverviewVm.saveGridProfile()">#: text #</button>'},{name:"useFilter",text:"Anvend filter",template:'<button type="button" class="k-button k-button-icontext" title="Anvend gemte filtre og sortering" data-ng-click="contractOverviewVm.loadGridProfile()" data-ng-disabled="!contractOverviewVm.doesGridProfileExist()">#: text #</button>'},{name:"deleteFilter",text:"Slet filter",template:"<button type='button' class='k-button k-button-icontext' title='Slet filtre og sortering' data-ng-click='contractOverviewVm.clearGridProfile()' data-ng-disabled='!contractOverviewVm.doesGridProfileExist()'>#: text #</button>"},{template:kendo.template(this.$("#role-selector").html())}],excel:{fileName:"IT Kontrakt Overblik.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:!0,height:window.innerHeight-200,dataBound:this.saveGridOptions,columnResize:this.saveGridOptions,columnHide:this.saveGridOptions,columnShow:this.saveGridOptions,columnReorder:this.saveGridOptions,excelExport:this.exportToExcel,columns:[{field:"IsActive",title:"Gyldig/Ikke gyldig",width:150,persistId:"isActive",template:function(e){return e.IsActive?'<span class="fa fa-file text-success" aria-hidden="true"></span>':'<span class="fa fa-file-o text-muted" aria-hidden="true"></span>'},excelTemplate:function(e){var n=!1;return e&&(n=t.isContractActive(e)),n.toString()},attributes:{class:"text-center"},sortable:!1,filterable:!1},{field:"ItContractId",title:"KontraktID",width:150,persistId:"contractid",excelTemplate:function(e){return e&&e.ItContractId||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Parent.Name",title:"Overordnet kontrakt",width:150,persistId:"parentname",template:function(e){return e.Parent?'<a data-ui-sref="it-contract.edit.main({id:'+e.Parent.Id+'})">'+e.Parent.Name+"</a>":""},excelTemplate:function(e){return e&&e.Parent&&e.Parent.Name||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Name",title:"IT Kontrakt",width:260,persistId:"name",template:function(e){return"<a data-ui-sref='it-contract.edit.main({id: "+e.Id+"})'>"+e.Name+"</a>"},excelTemplate:function(e){return e&&e.Name||""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ResponsibleOrganizationUnit.Name",title:"Ansv. organisationsenhed",width:245,persistId:"orgunit",template:function(e){return e.ResponsibleOrganizationUnit?e.ResponsibleOrganizationUnit.Name:""},filterable:{cell:{showOperators:!1,template:this.orgUnitDropDownList}}},{field:"AssociatedSystemUsages",title:"IT System",width:150,persistId:"itsys",template:function(e){var n="";return e.AssociatedSystemUsages.length>0&&(n=t._.first(e.AssociatedSystemUsages).ItSystemUsage.ItSystem.Disabled?t._.first(e.AssociatedSystemUsages).ItSystemUsage.ItSystem.Name+" (Slettes)":t._.first(e.AssociatedSystemUsages).ItSystemUsage.ItSystem.Name),e.AssociatedSystemUsages.length>1&&(n+=" ("+e.AssociatedSystemUsages.length+")"),n},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}},sortable:!1},{field:"Supplier.Name",title:"Leverandør",width:150,persistId:"suppliername",template:function(e){return e.Supplier?e.Supplier.Name:""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Reference.Title",title:"Reference",width:150,persistId:"ReferenceId",template:function(e){var t=e.Reference;return null!=t?t.URL?'<a target="_blank" style="float:left;" href="'+t.URL+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-center"},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Reference.ExternalReferenceId",title:"Mappe ref",width:150,persistId:"folderref",template:function(e){var t=e.Reference;return null!=t?t.ExternalReferenceId?'<a target="_blank" style="float:left;" href="'+t.ExternalReferenceId+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-center"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Acquisition",title:"Anskaffelse",width:90,persistId:"acquisition",excelTemplate:function(e){return e&&e.Acquisition.toString()||""},attributes:{class:"text-right"},format:"{0:n0}",sortable:!1,filterable:!1},{field:"Operation",title:"Drift/År",width:75,persistId:"operation",excelTemplate:function(e){return e&&e.Operation.toString()||""},attributes:{class:"text-right"},format:"{0:n0}",sortable:!1,filterable:!1},{field:"Other",title:"Andet",width:150,persistId:"other",excelTemplate:function(e){return e&&e.Other.toString()||""},attributes:{class:"text-right"},format:"{0:n0}",hidden:!0,sortable:!1,filterable:!1},{field:"ContainsDataHandlerAgreement",title:"Databehandleraftale",width:150,persistId:"ContainsDataHandlerAgreement",excelTemplate:function(e){return e&&e.ContainsDataHandlerAgreement||""},template:function(e){return t.parseOptionEnum(e.ContainsDataHandlerAgreement)},attributes:{class:"text-right"},hidden:!0,sortable:!1,filterable:{cell:{template:function(e){e.element.kendoDropDownList({dataSource:[{type:"Ja",value:"YES"},{type:"Nej",value:"NO"},{type:"Ved ikke",value:"DONTKNOW"}],dataTextField:"type",dataValueField:"value",valuePrimitive:!0})},showOperators:!1}}},{field:"OperationRemunerationBegun",title:"Driftsvederlag påbegyndt",format:"{0:dd-MM-yyyy}",width:150,persistId:"opremun",excelTemplate:function(e){return e&&e.OperationRemunerationBegun?t.moment(e.OperationRemunerationBegun).format("DD-MM-YYYY"):""},hidden:!0,filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"PaymentModel.Name",title:"Betalingsmodel",width:150,persistId:"paymodel",template:function(e){return e.PaymentModel?e.PaymentModel.Name:""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"PaymentFreqency.Name",title:"Betalingsfrekvens",width:150,persistId:"payfreq",template:function(e){return e.PaymentFreqency?e.PaymentFreqency.Name:""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"AuditDate",title:"Audit dato",width:90,persistId:"auditdate",template:function(e){return e.AuditDate?t.moment(e.AuditDate).format("DD-MM-YYYY"):""},sortable:!1,filterable:!1},{field:"AuditStatus",title:"Audit status",width:90,persistId:"auditstatus",template:function(e){if(e.status.max>0){return"<div data-show-status='"+JSON.stringify(e.status)+"'></div>"}return""},excelTemplate:function(e){
return e&&e.status&&"Hvid: "+e.status.white+", Rød: "+e.status.red+", Gul: "+e.status.yellow+", Grøn: "+e.status.green+", Max: "+e.status.max||""},sortable:!1,filterable:!1}]},i=this._.findIndex(r.columns,{persistId:"orgunit"})+1,a={field:"ContractSigner",title:"Kontraktunderskriver",persistId:"roleSigner",template:function(e){return e.ContractSigner?""+e.ContractSigner:""},width:130,hidden:!0,sortable:!0,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}};r.columns.splice(i,0,a),this._.forEachRight(this.itContractRoles,function(e){var n={field:"role"+e.Id,title:e.Name,persistId:"role"+e.Id,template:function(n){var r="";return void 0===n.roles[e.Id]?r:(r=t.concatRoles(n.roles[e.Id]),"<a data-ui-sref='it-contract.edit.roles({id: "+n.Id+"})'>"+r+"</a>")},excelTemplate:function(n){return n&&void 0!==n.roles[e.Id]?t.concatRoles(n.roles[e.Id]):""},width:200,hidden:!("Kontraktejer"===e.Name),sortable:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}};r.columns.splice(i,0,n)}),this.mainGridOptions=r},e.prototype.isContractActive=function(e){if(!e.Active){var t=this.moment().startOf("day"),n=e.Concluded?this.moment(e.Concluded).startOf("day"):t,r=e.ExpirationDate?this.moment(e.ExpirationDate).startOf("day"):this.moment("9999-12-30").startOf("day");if(e.Terminated){var i=this.moment(e.Terminated);return e.TerminationDeadline&&i.add(e.TerminationDeadline.Name,"months"),t>=n&&t<=i}return t>=n&&t<=r}return e.Active},e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.prototype.concatRoles=function(e){var t="";return e.length>0&&(t=e.slice(0,4).join(", ")),e.length>5&&(t+=", ..."),t},e.$inject=["$rootScope","$scope","$http","$timeout","$window","$state","$","_","moment","notify","user","gridStateService","itContractRoles","orgUnits","ecoStreamData","$uibModal","needsWidthFixService"],e}();e.OverviewController=t,angular.module("app").config(["$stateProvider",function(e){e.state("it-contract.overview",{url:"/overview",templateUrl:"app/components/it-contract/it-contract-overview.view.html",controller:t,controllerAs:"contractOverviewVm",resolve:{itContractRoles:["$http",function(e){return e.get("/odata/LocalItContractRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],user:["userService",function(e){return e.getUser()}],orgUnits:["$http","user","_",function(e,t,n){return e.get("/odata/Organizations("+t.currentOrganizationId+")/OrganizationUnits").then(function(e){return n.addHierarchyLevelOnFlatAndSort(e.data.value,"Id","ParentId")})}],ecoStreamData:["$http","user","notify",function(t,n,r){return t.get("/odata/ExternEconomyStreams(Organization="+n.currentOrganizationId+")").then(function(e){return e.data.value},function(){return e.transitionTo("home",{q:"updated search term"})})}]}})}])}(e.Overview||(e.Overview={}))}(e.ItContract||(e.ItContract={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g,m){var h=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.$timeout=r,this.$window=i,this.$state=a,this.$=o,this._=s,this.moment=l,this.notify=c,this.user=d,this.gridStateService=u,this.itContractRoles=p,this.orgUnits=f,this.$modal=g,this.needsWidthFixService=m,this.storageKey="it-contract-plan-options",this.orgUnitStorageKey="it-contract-plan-orgunit",this.gridState=this.gridStateService.getService(this.storageKey),this.saveGridOptions=function(){h.gridState.saveGridOptions(h.mainGrid)},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(h.exportFlag){h.exportFlag=!1,h._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=h.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(h.mainGrid.element,!1),h.needsWidthFixService.fixWidth()}else e.preventDefault(),h._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),h.$timeout(function(){h.exportFlag=!0,e.sender.saveAsExcel()})},this.orgUnitDropDownList=function(e){function t(e){return"&nbsp;&nbsp;&nbsp;&nbsp;".repeat(e.$level)+e.Name}function n(){var e=this,t=i.$window.sessionStorage.getItem(i.orgUnitStorageKey);if(t){var n=i._.findIndex(e.dataItems(),function(e){return e.Id==t});n>0&&e.select(n)}}function r(){var e=this,t=i.mainGrid.dataSource,n=e.select(),r=i._.parseInt(e.value());n>0?i.$window.sessionStorage.setItem(i.orgUnitStorageKey,r.toString()):i.$window.sessionStorage.removeItem(i.orgUnitStorageKey),t.read()}var i=h;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:h.orgUnits,dataValueField:"Id",dataTextField:"Name",template:t,dataBound:n,change:r})},this.roleSelectorOptions=function(){return{autoBind:!1,dataSource:h.roleSelectorDataSource,dataTextField:"Name",dataValueField:"Id",optionLabel:"Vælg kontraktrolle...",change:function(e){h.mainGrid.hideColumn("ContractSigner"),h._.forEach(h.itContractRoles,function(e){h.mainGrid.hideColumn("role"+e.Id)});var t=e.sender.value();h.mainGrid.showColumn(t),h.needsWidthFixService.fixWidth()}}},this.$rootScope.page.title="IT Kontrakt - Tid",t.$on("kendoWidgetCreated",function(e,t){t===h.mainGrid&&(h.loadGridOptions(),h.mainGrid.dataSource.read(),o(".k-grid-excel").click(function(){kendo.ui.progress(h.mainGrid.element,!0)}))}),this.activate()}return e.prototype.opretITKontrakt=function(){var e=this;this.$modal.open({windowClass:"modal fade in",templateUrl:"app/components/it-contract/it-contract-modal-create.view.html",controller:["$scope","$uibModalInstance",function(t,n){t.formData={},t.type="IT Kontrakt",t.checkAvailbleUrl="api/itProject/",t.saveAndProceed=function(){var r=e.user.currentOrganizationId,i=e.notify.addInfoMessage("Opretter kontrakt...",!1);e.$http.post("api/itcontract",{organizationId:r,name:t.formData.name}).success(function(t){i.toSuccessMessage("En ny kontrakt er oprettet!");var r=t.response;n.close(r.id),e.$state.go("it-contract.edit.main",{id:r.id})}).error(function(){i.toErrorMessage("Fejl! Kunne ikke oprette en ny kontrakt!")})},t.save=function(){var r=e.user.currentOrganizationId,i=e.notify.addInfoMessage("Opretter kontrakt...",!1);e.$http.post("api/itcontract",{organizationId:r,name:t.formData.name}).success(function(t){i.toSuccessMessage("En ny kontrakt er oprettet!");var r=t.response;n.close(r.id),e.$state.reload()}).error(function(){i.toErrorMessage("Fejl! Kunne ikke oprette en ny kontrakt!")})}}]})},e.prototype.fixRoleFilter=function(e,t,n){var r=new RegExp("(\\w+\\()"+t+"(.*?\\))","i");return e.replace(r,"Rights/any(c: $1concat(concat(c/User/Name, ' '), c/User/LastName)$2 and c/RoleId eq "+n+")")},e.prototype.fixProcurmentFilter=function(e){return e.replace(/ProcurementPlanYear/i,"cast($&, Edm.String)")},e.prototype.loadGridOptions=function(){this.user.isReadOnly||this.mainGrid.options.toolbar.push({name:"excel",text:"Eksportér til Excel",className:"pull-right"}),this.gridState.loadGridOptions(this.mainGrid)},e.prototype.saveGridProfile=function(){var e=this.$window.sessionStorage.getItem(this.orgUnitStorageKey);this.$window.localStorage.setItem(this.orgUnitStorageKey+"-profile",e),this.gridState.saveGridProfile(this.mainGrid),this.notify.addSuccessMessage("Filtre og sortering gemt")},e.prototype.loadGridProfile=function(){this.gridState.loadGridProfile(this.mainGrid);var e=this.$window.localStorage.getItem(this.orgUnitStorageKey+"-profile");this.$window.sessionStorage.setItem(this.orgUnitStorageKey,e),this.$(".k-filter-row [data-field='ResponsibleOrganizationUnit.Name']").find("input").data("kendoDropDownList").select(function(t){return t.Id==e}),this.mainGrid.dataSource.read(),this.notify.addSuccessMessage("Anvender gemte filtre og sortering")},e.prototype.clearGridProfile=function(){this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeSession(),this.notify.addSuccessMessage("Filtre og sortering slettet"),this.reload()},e.prototype.doesGridProfileExist=function(){return this.gridState.doesGridProfileExist()},e.prototype.clearOptions=function(){this.$window.localStorage.removeItem(this.orgUnitStorageKey+"-profile"),this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeLocal(),this.gridState.removeSession(),this.notify.addSuccessMessage("Sortering, filtering og kolonnevisning, -bredde og –rækkefølge nulstillet"),this.reload()},e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.prototype.activate=function(){function e(e){e.element.kendoAutoComplete({noDataTemplate:""})}var t=this,n=this._.cloneDeep(this.itContractRoles);this._.forEach(n,function(e){return e.Id="role"+e.Id}),n.push({Id:"ContractSigner",Name:"Kontraktunderskriver"}),this.roleSelectorDataSource=n,this.canCreate=!this.user.isReadOnly;var r={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:function(e){var n="?$expand=Parent,ResponsibleOrganizationUnit,Rights($expand=User,Role),Supplier,ContractTemplate,ContractType,PurchaseForm,OptionExtend,TerminationDeadline,ProcurementStrategy,AssociatedSystemUsages,AssociatedInterfaceUsages,AssociatedInterfaceExposures,Reference",r=t.$window.sessionStorage.getItem(t.orgUnitStorageKey);return null===r?"/odata/Organizations("+t.user.currentOrganizationId+")/ItContracts"+n:"/odata/Organizations("+t.user.currentOrganizationId+")/OrganizationUnits("+r+")/ItContracts"+n},dataType:"json"},parameterMap:function(e,n){var r=kendo.data.transports["odata-v4"].parameterMap(e,n);return r.$orderby&&("ProcurementPlanYear"===r.$orderby&&(r.$orderby="ProcurementPlanYear,ProcurementPlanHalf"),"ProcurementPlanYear desc"===r.$orderby&&(r.$orderby="ProcurementPlanYear desc,ProcurementPlanHalf desc")),r.$filter&&(t._.forEach(t.itContractRoles,function(e){r.$filter=t.fixRoleFilter(r.$filter,"role"+e.Id,e.Id)}),r.$filter=t.fixProcurmentFilter(r.$filter)),r}},sort:{field:"Name",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{fields:{OperationRemunerationBegun:{type:"date"},LastChanged:{type:"date"},Concluded:{type:"date"},ExpirationDate:{type:"date"},IrrevocableTo:{type:"date"},Terminated:{type:"date"},Duration:{type:"string"},IsActive:{type:"boolean"}}},parse:function(e){return t._.forEach(e.value,function(e){e.roles=[],t._.forEach(e.Rights,function(t){e.roles[t.RoleId]||(e.roles[t.RoleId]=[]),e.roles[t.RoleId].push([t.User.Name,t.User.LastName].join(" "))}),e.Parent||(e.Parent={Name:""}),e.ResponsibleOrganizationUnit||(e.ResponsibleOrganizationUnit={Name:""}),e.Supplier||(e.Supplier={Name:""}),e.ContractType||(e.ContractType={Name:""}),e.ContractTemplate||(e.ContractTemplate={Name:""}),e.PurchaseForm||(e.PurchaseForm={Name:""}),e.TerminationDeadline||(e.TerminationDeadline={Name:""}),e.Reference||(e.Reference={Title:"",ExternalReferenceId:""})}),e}}},toolbar:[{name:"opretITKontrakt",text:"Opret IT Kontrakt",template:"<button ng-click='contractOverviewPlanVm.opretITKontrakt()' class='btn btn-success pull-right' data-ng-disabled=\"!contractOverviewPlanVm.canCreate\">#: text #</button>"},{name:"clearFilter",text:"Nulstil",template:"<button type='button' class='k-button k-button-icontext' title='Nulstil sortering, filtering og kolonnevisning, -bredde og –rækkefølge' data-ng-click='contractOverviewPlanVm.clearOptions()'>#: text #</button>"},{name:"saveFilter",text:"Gem filter",template:'<button type="button" class="k-button k-button-icontext" title="Gem filtre og sortering" data-ng-click="contractOverviewPlanVm.saveGridProfile()">#: text #</button>'},{name:"useFilter",text:"Anvend filter",template:'<button type="button" class="k-button k-button-icontext" title="Anvend gemte filtre og sortering" data-ng-click="contractOverviewPlanVm.loadGridProfile()" data-ng-disabled="!contractOverviewPlanVm.doesGridProfileExist()">#: text #</button>'},{name:"deleteFilter",text:"Slet filter",template:"<button type='button' class='k-button k-button-icontext' title='Slet filtre og sortering' data-ng-click='contractOverviewPlanVm.clearGridProfile()' data-ng-disabled='!contractOverviewPlanVm.doesGridProfileExist()'>#: text #</button>"},{template:kendo.template(this.$("#role-selector").html())}],excel:{fileName:"IT Kontrakt tid.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:!0,height:window.innerHeight-200,detailTemplate:function(e){return'<uib-tabset active="0">\n                    <uib-tab index="0" heading="Systemer">\n                        <contract-details detail-model-type="ItSystem" detail-type="systemer" action="anvender" field-value="ItSystem.Name" data-odata-query="odata/ItSystemUsages?$select=ItSystem&$expand=ItSystem($select=name, disabled)&$filter=Contracts/any(x: x/ItContractId eq '+e.Id+')"></contract-details>\n                    </uib-tab>\n                    <uib-tab index="1" heading="Udstillede snitflader">\n                        <contract-details detail-model-type="ItInterface" detail-type="snitflader" action="udstiller" field-value="ItInterface.Name" data-odata-query="odata/ItInterfaceExhibits?$select=ItInterface&$expand=ItInterface($select=Name, Disabled)&$filter=ItInterfaceExhibitUsage/any(x: x/ItContractId eq '+e.Id+')"></contract-details>\n                    </uib-tab>\n                    <uib-tab index="2" heading="Anvendte snitflader">\n                        <contract-details detail-model-type="ItInterface" detail-type="snitflader" action="anvender" field-value="ItInterface.Name" data-odata-query="odata/ItContracts?$select=AssociatedInterfaceUsages&$expand=AssociatedInterfaceUsages($select=ItInterface;$expand=ItInterface($select=Name, Disabled))&$filter=AssociatedInterfaceUsages/any(x: x/ItContractId eq '+e.Id+')"></contract-details>\n                    </uib-tab>\n                </uib-tabset>'},dataBound:this.saveGridOptions,columnResize:this.saveGridOptions,columnHide:this.saveGridOptions,columnShow:this.saveGridOptions,columnReorder:this.saveGridOptions,excelExport:this.exportToExcel,columns:[{field:"IsActive",title:"Gyldig/Ikke gyldig",width:90,persistId:"isActive",template:function(e){return e.IsActive?'<span class="fa fa-file text-success" aria-hidden="true"></span>':'<span class="fa fa-file-o text-muted" aria-hidden="true"></span>'},excelTemplate:function(e){return t.isContractActive(e).toString()},attributes:{class:"text-center"},sortable:!1,filterable:!1},{field:"ItContractId",title:"KontraktID",width:150,persistId:"contractid",excelTemplate:function(e){return e&&e.ItContractId||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Parent.Name",title:"Overordnet kontrakt",width:150,persistId:"parentname",template:function(e){return e.Parent?'<a data-ui-sref="it-contract.edit.main({id:'+e.Parent.Id+'})">'+e.Parent.Name+"</a>":""},excelTemplate:function(e){return e&&e.Parent&&e.Parent.Name||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Name",title:"IT Kontrakt",width:265,persistId:"name",template:function(e){return"<a data-ui-sref='it-contract.edit.main({id: "+e.Id+"})'>"+e.Name+"</a>"},excelTemplate:function(e){return e&&e.Name||""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ResponsibleOrganizationUnit.Name",title:"Ansv. organisationsenhed",width:245,persistId:"orgunit",template:function(e){return e.ResponsibleOrganizationUnit?e.ResponsibleOrganizationUnit.Name:""},hidden:!0,filterable:{cell:{showOperators:!1,template:this.orgUnitDropDownList}}},{field:"Supplier.Name",title:"Leverandør",width:200,persistId:"suppliername",template:function(e){return e.Supplier?e.Supplier.Name:""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"AssociatedSystemUsages",title:"Antal systemer",width:50,persistId:"numOfItSystems",template:function(e){return e.AssociatedSystemUsages.length.toString()},attributes:{class:"text-center"},sortable:!1,filterable:!1},{field:"AssociatedInterfaceUsages",title:"Antal udstillede snitflader",width:50,persistId:"numOfItInterfacesExhibit",template:function(e){return e.AssociatedInterfaceExposures.length.toString()},attributes:{class:"text-center"},sortable:!1,filterable:!1},{field:"AssociatedInterfaceExposures",title:"Antal anvendte snitflader",width:50,persistId:"numOfItInterfacesUsages",template:function(e){return e.AssociatedInterfaceUsages.length.toString()},attributes:{class:"text-center"},sortable:!1,filterable:!1},{field:"Reference.Title",title:"Reference",width:150,persistId:"ReferenceId",template:function(e){var t=e.Reference;return null!=t?t.URL?'<a target="_blank" style="float:left;" href="'+t.URL+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-center"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Reference.ExternalReferenceId",title:"Mappe ref",width:150,persistId:"folderref",template:function(e){var t=e.Reference;return null!=t?t.ExternalReferenceId?'<a target="_blank" style="float:left;" href="'+t.ExternalReferenceId+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-center"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ContractType.Name",title:"Kontrakttype",width:120,persistId:"contracttype",template:"#: ContractType ? ContractType.Name : '' #",filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ContractTemplate.Name",title:"Kontraktskabelon",width:145,persistId:"contracttmpl",template:function(e){return e.ContractTemplate?e.ContractTemplate.Name:""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"PurchaseForm.Name",title:"Indkøbsform",width:115,persistId:"purchaseform",template:function(e){return e.PurchaseForm?e.PurchaseForm.Name:""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Concluded",title:"Gyldig fra",format:"{0:dd-MM-yyyy}",width:90,persistId:"concluded",excelTemplate:function(e){return e.Concluded?t.moment(e.Concluded).format("DD-MM-YYYY"):""},filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"Duration",title:"Varighed",width:115,persistId:"duration",template:function(e){if(e.DurationOngoing)return"Løbende";var t=e.DurationYears||0,n=e.DurationMonths||0;return 0===t&&0===n?"Ikke angivet":t>0&&n>0&&n<2?t+" år og "+n+" måned":t>0&&n>0?t+" år og "+n+" måneder":t<1&&n>0&&n>1?n+" måneder":t<1&&n<2?n+" måned":t>0&&n<1?t+" år":"Ikke angivet"},hidden:!0,sortable:!1,filterable:!1},{field:"ExpirationDate",title:"Gyldig til",format:"{0:dd-MM-yyyy}",width:90,persistId:"expirationDate",excelTemplate:function(e){return e.ExpirationDate?t.moment(e.ExpirationDate).format("DD-MM-YYYY"):""},filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"OptionExtend",title:"Option",width:150,persistId:"option",hidden:!0,template:function(e){var t="";return e.OptionExtend&&(t+=e.OptionExtend.Name),e.OptionExtend&&(t+=" ("+e.ExtendMultiplier+")"),t},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"TerminationDeadline.Name",title:"Opsigelse",width:100,persistId:"terminationDeadline",template:function(e){return e.TerminationDeadline?e.TerminationDeadline.Name+" md":""},hidden:!0,filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"IrrevocableTo",title:"Uopsigelig til",format:"{0:dd-MM-yyyy}",width:150,headerTemplate:'<div style="word-wrap: break-word;">Uopsigelig til</div>',persistId:"irrevocableTo",excelTemplate:function(e){return e.IrrevocableTo?t.moment(e.IrrevocableTo).format("DD-MM-YYYY"):""},hidden:!0,filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"Terminated",title:"Opsagt",format:"{0:dd-MM-yyyy}",width:150,persistId:"terminated",excelTemplate:function(e){return e.Terminated?t.moment(e.Terminated).format("DD-MM-YYYY"):""},hidden:!0,filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"ProcurementStrategy",title:"Udbudsstrategi",width:150,persistId:"procurementStrategy",hidden:!0,template:function(e){return e.ProcurementStrategy?e.ProcurementStrategy.Name:""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ProcurementPlanYear",title:"Udbuds plan",width:90,persistId:"procurementPlan",attributes:{class:"text-center"},template:function(e){return e.ProcurementPlanHalf&&e.ProcurementPlanYear?e.ProcurementPlanYear+" | "+e.ProcurementPlanHalf:""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}}]},i=this._.findIndex(r.columns,{persistId:"orgunit"})+1,a={field:"ContractSigner",title:"Kontraktunderskriver",persistId:"roleSigner",template:function(e){return e.ContractSigner?""+e.ContractSigner:""},width:130,hidden:!0,sortable:!0,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}};r.columns.splice(i,0,a),this._.forEachRight(this.itContractRoles,function(e){var n={field:"role"+e.Id,title:e.Name,persistId:"role"+e.Id,template:function(n){var r="";return void 0===n.roles[e.Id]?r:(r=t.concatRoles(n.roles[e.Id]),"<a data-ui-sref='it-contract.edit.roles({id: "+n.Id+"})'>"+r+"</a>")},excelTemplate:function(n){return void 0===n.roles[e.Id]?"":t.concatRoles(n.roles[e.Id])},width:130,hidden:!0,sortable:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}};r.columns.splice(i,0,n)}),this.mainGridOptions=r},e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.prototype.concatRoles=function(e){var t="";return e.length>0&&(t=e.slice(0,4).join(", ")),e.length>5&&(t+=", ..."),t},e.prototype.isContractActive=function(e){if(!e.Active){var t=this.moment().startOf("day"),n=e.Concluded?this.moment(e.Concluded).startOf("day"):t,r=e.ExpirationDate?this.moment(e.ExpirationDate).startOf("day"):this.moment("9999-12-30").startOf("day");if(e.Terminated){var i=this.moment(e.Terminated);return e.TerminationDeadline&&i.add(e.TerminationDeadline.Name,"months"),t>=n&&t<=i}return t>=n&&t<=r}return e.Active},e.$inject=["$rootScope","$scope","$http","$timeout","$window","$state","$","_","moment","notify","user","gridStateService","itContractRoles","orgUnits","$uibModal","needsWidthFixService"],e}();e.OverviewPlanController=t,angular.module("app").config(["$stateProvider",function(e){e.state("it-contract.plan",{url:"/plan",templateUrl:"app/components/it-contract/it-contract-plan.view.html",controller:t,controllerAs:"contractOverviewPlanVm",resolve:{user:["userService",function(e){return e.getUser()}],itContractRoles:["$http",function(e){return e.get("/odata/LocalItContractRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],orgUnits:["$http","user","_",function(e,t,n){return e.get("/odata/Organizations("+t.currentOrganizationId+")/OrganizationUnits").then(function(e){return n.addHierarchyLevelOnFlatAndSort(e.data.value,"Id","ParentId")})}]}})}])}(e.OverviewPlan||(e.OverviewPlan={}))}(e.ItContract||(e.ItContract={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract",{url:"/contract",abstract:!0,template:'<ui-view autoscroll="false" />',resolve:{user:["userService",function(e){return e.getUser()}]},controller:["$rootScope","$http","$state","$uibModal","notify","user","$scope",function(e,t,n,r,i,a,o){function s(){if(confirm("Er du sikker på du vil slette kontrakten?")){var e=n.params.id,r=i.addInfoMessage("Sletter IT Kontrakten...",!1);t.delete("api/itcontract/"+e+"?organizationId="+a.currentOrganizationId).success(function(e){r.toSuccessMessage("IT Kontrakten er slettet!"),n.go("it-contract.overview")}).error(function(){r.toErrorMessage("Fejl! Kunne ikke slette IT Kontrakten!")})}}e.page.title="IT Kontrakt",e.page.subnav=[{state:"it-contract.overview",text:"IT kontrakter: økonomi"},{state:"it-contract.plan",text:"IT kontrakter: tid"},{state:"it-contract.edit",text:"IT Kontrakt",showWhen:"it-contract.edit"}],e.page.subnav.buttons=[{func:s,text:"Slet IT Kontrakt",style:"btn-danger",icon:"glyphicon-minus",showWhen:"it-contract.edit"}],e.subnavPositionCenter=!1,o.$on("$viewContentLoaded",function(){e.positionSubnav()})}]})}])}(angular,app);var directiveModule=angular.module("angularjs-dropdown-multiselect",[]);directiveModule.directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse",function(e,t,n,r){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",translationTexts:"=",groupBy:"@"},template:function(e,t){var n=!!t.checkboxes,r=!!t.groupBy,i='<div class="multiselect-parent btn-group dropdown-multiselect">';i+='<button type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}<span class="caret"></span></button>',i+="<ul class=\"dropdown-menu dropdown-menu-form\" ng-style=\"{display: open ? 'block' : 'none'}\">",i+='<li ng-hide="!settings.showCheckAll || settings.selectionLimit > 0"><a data-ng-click="selectAll()"><span class="glyphicon glyphicon-ok"></span>  {{texts.checkAll}}</a>',i+='<li ng-show="settings.showUncheckAll"><a data-ng-click="deselectAll();"><span class="glyphicon glyphicon-remove"></span>   {{texts.uncheckAll}}</a></li>',i+='<li ng-hide="(!settings.showCheckAll || settings.selectionLimit > 0) && !settings.showUncheckAll" class="divider"></li>',i+='<li ng-show="settings.enableSearch"><input type="text" class="form-control" ng-model="searchFilter" placeholder="{{texts.searchPlaceholder}}" /></li>',i+='<li ng-show="settings.enableSearch" class="divider"></li>',r?(i+='<li ng-repeat-start="option in orderedItems | filter: searchFilter" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupTitle(getPropertyForObject(option, settings.groupBy)) }}</li>',i+='<li ng-repeat-end role="presentation">'):i+='<li role="presentation" ng-repeat="option in options | filter: searchFilter">',i+='<a role="menuitem" tabindex="-1" ng-click="setSelectedItem(getPropertyForObject(option,settings.idProp))">',i+=n?'<div class="checkbox"><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> {{getPropertyForObject(option, settings.displayProp)}}</label></div></a>':"<span data-ng-class=\"{'glyphicon glyphicon-ok': isChecked(getPropertyForObject(option,settings.idProp))}\"></span> {{getPropertyForObject(option, settings.displayProp)}}</a>",i+="</li>",i+='<li class="divider" ng-show="settings.selectionLimit > 1"></li>',i+='<li role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>',i+="</ul>",i+="</div>",e.html(i)},link:function(n,r,i){function a(e){var t={};return""===n.settings.externalIdProp?t[n.settings.idProp]=e:t[n.settings.externalIdProp]=e,t}function o(e){for(var t in e)delete e[t]}n.toggleDropdown=function(){n.open=!n.open},n.checkboxClick=function(e,t){n.setSelectedItem(t),e.stopImmediatePropagation()},n.searchFilter="",n.externalEvents={onItemSelect:angular.noop,onItemDeselect:angular.noop,onSelectAll:angular.noop,onDeselectAll:angular.noop,onInitDone:angular.noop,onMaxSelectionReached:angular.noop},n.settings={dynamicTitle:!0,closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,closeOnSelect:!1,buttonClasses:"btn btn-default",closeOnDeselect:!1,groupBy:i.groupBy||void 0,groupByTextProvider:null},n.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked"},angular.isDefined(n.settings.groupBy)&&n.$watch("options",function(t){angular.isDefined(t)&&(n.orderedItems=e("orderBy")(t,n.settings.groupBy))}),angular.extend(n.settings,n.extraSettings||[]),angular.extend(n.externalEvents,n.events||[]),angular.extend(n.texts,n.translationTexts),n.singleSelection=1===n.settings.selectionLimit,n.singleSelection&&angular.isArray(n.selectedModel)&&0===n.selectedModel.length&&o(n.selectedModel),n.settings.closeOnBlur&&t.on("click",function(e){for(var t=e.target.parentElement,r=!1;angular.isDefined(t)&&null!==t&&!r;)_.includes(t.classList,"multiselect-parent")&&!r&&(r=!0),t=t.parentElement;r||n.$apply(function(){n.open=!1})}),n.getGroupTitle=function(e){return null!==n.settings.groupByTextProvider?n.settings.groupByTextProvider(e):e},n.getButtonText=function(){if(n.settings.dynamicTitle){var e;return e=n.singleSelection?null!==n.selectedModel&&angular.isDefined(n.selectedModel[n.settings.idProp])?1:0:angular.isDefined(n.selectedModel)?n.selectedModel.length:0,0===e?n.texts.buttonDefaultText:e+" "+n.texts.dynamicButtonTextSuffix}return n.texts.buttonDefaultText},n.getPropertyForObject=function(e,t){return angular.isDefined(e)&&e.hasOwnProperty(t)?e[t]:""},n.selectAll=function(){n.deselectAll(!1),n.externalEvents.onSelectAll(),angular.forEach(n.options,function(e){n.setSelectedItem(e[n.settings.idProp],!0)})},n.deselectAll=function(e){e=e||!0,e&&n.externalEvents.onDeselectAll(),n.singleSelection?o(n.selectedModel):n.selectedModel.splice(0,n.selectedModel.length)},n.setSelectedItem=function(e,t){var r=a(e),i=null;if(i=""===n.settings.externalIdProp?_.find(n.options,r):r,n.singleSelection)return o(n.selectedModel),angular.extend(n.selectedModel,i),void n.externalEvents.onItemSelect(i);t=t||!1;var s=-1!==_.findIndex(n.selectedModel,r);!t&&s?(n.selectedModel.splice(_.findIndex(n.selectedModel,r),1),n.externalEvents.onItemDeselect(r)):!s&&(0===n.settings.selectionLimit||n.selectedModel.length<n.settings.selectionLimit)&&(n.selectedModel.push(i),n.externalEvents.onItemSelect(i))},n.isChecked=function(e){return n.singleSelection?null!==n.selectedModel&&angular.isDefined(n.selectedModel[n.settings.idProp])&&n.selectedModel[n.settings.idProp]===a(e)[n.settings.idProp]:-1!==_.findIndex(n.selectedModel,a(e))},n.externalEvents.onInitDone()}}}]);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s){this.$scope=e,this.$rootScope=t,this.$http=n,this._=r,this.project=i,this.projectTypes=a,this.user=o,this.hasWriteAccess=s,this.autosaveUrl="api/itproject/"+this.project.id,s||r.remove(t.page.subnav.buttons,function(e){return"Slet IT Projekt"===e.text})}return e.$inject=["$scope","$rootScope","$http","_","project","projectTypes","user","hasWriteAccess"],e}();angular.module("app").controller("project.EditCtrl",t).config(["$stateProvider",function(e){e.state("it-project.edit",{url:"/edit/{id:[0-9]+}",templateUrl:"app/components/it-project/it-project-edit.view.html",controller:t,controllerAs:"projectEditVm",resolve:{user:["userService",function(e){return e.getUser()}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/itproject/"+t.id+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}],project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}],projectTypes:["$http",function(e){
return e.get("odata/LocalItProjectTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}]}})}])}(e.Edit||(e.Edit={}))}(e.ItProject||(e.ItProject={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g,m){var h=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.$timeout=r,this.$window=i,this.$state=a,this.$=o,this._=s,this.moment=l,this.notify=c,this.projectRoles=d,this.user=u,this.gridStateService=p,this.orgUnits=f,this.economyCalc=g,this.needsWidthFixService=m,this.storageKey="it-project-overview-inactive-options",this.orgUnitStorageKey="it-project-overview-inactive-orgunit",this.gridState=this.gridStateService.getService(this.storageKey),this.saveGridOptions=function(){h.gridState.saveGridOptions(h.mainGrid)},this.economyTemplate=function(e){var t=0;return h._.forEach(e.EconomyYears,function(e){t+=h.economyCalc.getTotalBudget(e)}),-t},this.orgUnitDropDownList=function(e){function t(e){return"&nbsp;&nbsp;&nbsp;&nbsp;".repeat(e.$level)+e.Name}function n(){var e=this,t=i.$window.sessionStorage.getItem(i.orgUnitStorageKey);if(t){var n=i._.findIndex(e.dataItems(),function(e){return e.Id==t});n>0&&e.select(n)}}function r(){var e=this,t=i.mainGrid.dataSource,n=e.select(),r=i._.parseInt(e.value());n>0?i.$window.sessionStorage.setItem(i.orgUnitStorageKey,r.toString()):i.$window.sessionStorage.removeItem(i.orgUnitStorageKey),t.read()}var i=h;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:h.orgUnits,dataValueField:"Id",dataTextField:"Name",template:t,dataBound:n,change:r})},this.roleSelectorOptions=function(){return{autoBind:!1,dataSource:h.projectRoles,dataTextField:"Name",dataValueField:"Id",optionLabel:"Vælg projektrolle...",change:function(e){h._.forEach(h.projectRoles,function(e){h.mainGrid.hideColumn("role"+e.Id)});var t=e.sender.value(),n="role"+t;h.mainGrid.showColumn(n),h.needsWidthFixService.fixWidth()}}},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(h.exportFlag){h.exportFlag=!1,h._.forEach(t,function(t){var n=t;n.tempVisual&&(delete n.tempVisual,e.sender.hideColumn(n))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=h.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(h.mainGrid.element,!1),h.needsWidthFixService.fixWidth()}else e.preventDefault(),h._.forEach(t,function(t){var n=t;n.hidden&&(n.tempVisual=!0,e.sender.showColumn(n))}),h.$timeout(function(){h.exportFlag=!0,e.sender.saveAsExcel()})},this.$rootScope.page.title="IT Projekt - Overblik",this.$scope.$on("kendoWidgetCreated",function(e,t){t===h.mainGrid&&(h.loadGridOptions(),h.mainGrid.dataSource.read(),o(".k-grid-excel").click(function(){kendo.ui.progress(h.mainGrid.element,!0)}))}),this.activate()}return e.prototype.fixRoleFilter=function(e,t,n){var r=new RegExp("(\\w+\\()"+t+"(.*?\\))","i");return e.replace(r,"Rights/any(c: $1concat(concat(c/User/Name, ' '), c/User/LastName)$2 and c/RoleId eq "+n+")")},e.prototype.loadGridOptions=function(){this.user.isReadOnly||this.mainGrid.options.toolbar.push({name:"excel",text:"Eksportér til Excel",className:"pull-right"}),this.gridState.loadGridOptions(this.mainGrid)},e.prototype.saveGridProfile=function(){var e=this.$window.sessionStorage.getItem(this.orgUnitStorageKey);this.$window.localStorage.setItem(this.orgUnitStorageKey+"-profile",e),this.gridState.saveGridProfile(this.mainGrid),this.notify.addSuccessMessage("Filtre og sortering gemt")},e.prototype.loadGridProfile=function(){this.gridState.loadGridProfile(this.mainGrid);var e=this.$window.localStorage.getItem(this.orgUnitStorageKey+"-profile");this.$window.sessionStorage.setItem(this.orgUnitStorageKey,e),this.$(".k-filter-row [data-field='ResponsibleUsage.OrganizationUnit.Name']").find("input").data("kendoDropDownList").select(function(t){return t.Id==e}),this.mainGrid.dataSource.read(),this.notify.addSuccessMessage("Anvender gemte filtre og sortering")},e.prototype.clearGridProfile=function(){this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeSession(),this.notify.addSuccessMessage("Filtre og sortering slettet"),this.reload()},e.prototype.doesGridProfileExist=function(){return this.gridState.doesGridProfileExist()},e.prototype.clearOptions=function(){this.$window.localStorage.removeItem(this.orgUnitStorageKey+"-profile"),this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeLocal(),this.gridState.removeSession(),this.notify.addSuccessMessage("Sortering, filtering og kolonnevisning, -bredde og –rækkefølge nulstillet"),this.reload()},e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.prototype.activate=function(){function e(e){e.element.kendoAutoComplete({noDataTemplate:""})}var t=this,n={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:function(e){var n="?$expand=ItProjectStatuses,Parent,ItProjectType,Rights($expand=User,Role),ResponsibleUsage($expand=OrganizationUnit),GoalStatus,EconomyYears,ItProjectStatusUpdates($orderby=Created desc;$top=1)",r=t.$window.sessionStorage.getItem(t.orgUnitStorageKey);return null===r?"/odata/Organizations("+t.user.currentOrganizationId+")/ItProjects"+n:"/odata/Organizations("+t.user.currentOrganizationId+")/OrganizationUnits("+r+")/ItProjects"+n},dataType:"json"},parameterMap:function(e,n){var r=kendo.data.transports["odata-v4"].parameterMap(e,n);return r.$filter&&t._.forEach(t.projectRoles,function(e){r.$filter=t.fixRoleFilter(r.$filter,"role"+e.Id,e.Id)}),r}},filter:{field:"IsArchived",operator:"eq",value:!0},sort:{field:"Name",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{fields:{StatusDate:{type:"date"},LastChanged:{type:"date"},IsTransversal:{type:"boolean"},IsStrategy:{type:"boolean"},IsArchived:{type:"boolean"}}},parse:function(e){return t._.forEach(e.value,function(e){e.roles=[],t._.forEach(e.Rights,function(t){e.roles[t.RoleId]||(e.roles[t.RoleId]=[]),e.roles[t.RoleId].push([t.User.Name,t.User.LastName].join(" "))});var n="Phase"+e.CurrentPhase;e.CurrentPhaseObj=e[n],(t.user.isGlobalAdmin||t.user.isLocalAdmin||t._.find(e.Rights,{userId:t.user.id}))&&(e.hasWriteAccess=!0),e.Parent||(e.Parent={Name:""}),e.ResponsibleUsage||(e.ResponsibleUsage={OrganizationUnit:{Name:""}}),e.ItProjectType||(e.ItProjectType={Name:""}),e.GoalStatus||(e.GoalStatus={Status:""}),e.Reference||(e.Reference={Title:"",ExternalReferenceId:""})}),e}}},toolbar:[{name:"clearFilter",text:"Nulstil",template:"<button type='button' class='k-button k-button-icontext' title='Nulstil sortering, filtering og kolonnevisning, -bredde og –rækkefølge' data-ng-click='projectOverviewVm.clearOptions()'>#: text #</button>"},{name:"saveFilter",text:"Gem filter",template:'<button type="button" class="k-button k-button-icontext" title="Gem filtre og sortering" data-ng-click="projectOverviewVm.saveGridProfile()">#: text #</button>'},{name:"useFilter",text:"Anvend filter",template:'<button type="button" class="k-button k-button-icontext" title="Anvend gemte filtre og sortering" data-ng-click="projectOverviewVm.loadGridProfile()" data-ng-disabled="!projectOverviewVm.doesGridProfileExist()">#: text #</button>'},{name:"deleteFilter",text:"Slet filter",template:"<button type='button' class='k-button k-button-icontext' title='Slet filtre og sortering' data-ng-click='projectOverviewVm.clearGridProfile()' data-ng-disabled='!projectOverviewVm.doesGridProfileExist()'>#: text #</button>"},{template:kendo.template(this.$("#role-selector").html())}],excel:{fileName:"IT Project inaktive.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,filterable:{mode:"row",messages:{isTrue:"✔",isFalse:"✖"}},groupable:!1,columnMenu:!0,height:window.innerHeight-200,dataBound:this.saveGridOptions,columnResize:this.saveGridOptions,columnHide:this.saveGridOptions,columnShow:this.saveGridOptions,columnReorder:this.saveGridOptions,excelExport:this.exportToExcel,columns:[{field:"ItProjectId",title:"ProjektID",width:115,persistId:"projid",excelTemplate:function(e){return e&&e.ItProjectId?e.ItProjectId:""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Parent.Name",title:"Overordnet IT Projekt",width:150,persistId:"parentname",template:function(e){return e.Parent?'<a data-ui-sref="it-project.edit.main({id:'+e.Parent.Id+'})">'+e.Parent.Name+"</a>":""},excelTemplate:function(e){return e&&e.Parent&&e.Parent.Name||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Name",title:"IT Projekt",width:370,persistId:"projname",template:function(e){return'<a data-ui-sref="it-project.edit.main({id: '+e.Id+'})">'+e.Name+"</a>"},excelTemplate:function(e){return e&&e.Name?e.Name:""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ResponsibleUsage.OrganizationUnit.Name",title:"Ansv. organisationsenhed",width:245,persistId:"orgunit",template:function(e){return e.ResponsibleUsage&&e.ResponsibleUsage.OrganizationUnit.Name||""},filterable:{cell:{showOperators:!1,template:this.orgUnitDropDownList}}},{field:"Reference.Title",title:"Reference",width:150,persistId:"ReferenceId",template:function(e){var t=e.Reference;return null!=t?t.URL?'<a target="_blank" style="float:left;" href="'+t.URL+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-left"},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Reference.ExternalReferenceId",title:"Mappe ref",width:150,persistId:"folderref",template:function(e){var t=e.Reference;return null!=t?t.ExternalReferenceId?'<a target="_blank" style="float:left;" href="'+t.ExternalReferenceId+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-center"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ItProjectType.Name",title:"Projekttype",width:135,persistId:"projtype",template:function(e){return e.ItProjectType&&e.ItProjectType.Name||""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"CurrentPhaseObj",title:"Fase",width:100,persistId:"phasename",template:function(e){return e.CurrentPhaseObj?'<a data-ui-sref="it-project.edit.phases({id:'+e.Id+'})">'+e.CurrentPhaseObj.Name+"</a>":""},excelTemplate:function(e){return e&&e.CurrentPhaseObj&&e.CurrentPhaseObj.Name||""},sortable:!1,filterable:!1},{field:"CurrentPhaseObj.StartDate",title:"Fase: Startdato",format:"{0:dd-MM-yyyy}",width:85,persistId:"phasestartdate",template:function(e){return e.CurrentPhaseObj&&e.CurrentPhaseObj.StartDate?t.moment(e.CurrentPhaseObj.StartDate).format("DD-MM-YYYY"):""},excelTemplate:function(e){return e.CurrentPhaseObj&&e.CurrentPhaseObj.StartDate?t.moment(e.CurrentPhaseObj.StartDate).format("DD-MM-YYYY"):""},sortable:!1,filterable:!1},{field:"CurrentPhaseObj.EndDate",title:"Fase: Slutdato",format:"{0:dd-MM-yyyy}",width:85,persistId:"phaseenddate",hidden:!0,template:function(e){return e.CurrentPhaseObj&&e.CurrentPhaseObj.EndDate?t.moment(e.CurrentPhaseObj.EndDate).format("DD-MM-YYYY"):""},excelTemplate:function(e){return e.CurrentPhaseObj&&e.CurrentPhaseObj.EndDate?t.moment(e.CurrentPhaseObj.EndDate).format("DD-MM-YYYY"):""},sortable:!1,filterable:!1},{field:"ItProjectStatus",title:"Status: Samlet",width:100,persistId:"statusproj",template:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0],n=t.TimeStatus,r=t.QualityStatus,i=t.ResourcesStatus;return t.IsCombined?'<span data-square-traffic-light="'+t.CombinedStatus+'"></span>':"Red"===n||"Red"===r||"Red"===i?"<span data-square-traffic-light='Red'></span>":"Yellow"===n||"Yellow"===r||"Yellow"===i?"<span data-square-traffic-light='Yellow'></span>":"Green"===n||"Green"===r||"Green"===i?"<span data-square-traffic-light='Green'></span>":"<span data-square-traffic-light='White'></span>"}return""},excelTemplate:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0],n=t.TimeStatus,r=t.QualityStatus,i=t.ResourcesStatus;return t.IsCombined?'<span data-square-traffic-light="'+t.CombinedStatus+'"></span>':"Red"===n||"Red"===r||"Red"===i?"<span data-square-traffic-light='Red'></span>":"Yellow"===n||"Yellow"===r||"Yellow"===i?"<span data-square-traffic-light='Yellow'></span>":"Green"===n||"Green"===r||"Green"===i?"<span data-square-traffic-light='Green'></span>":"<span data-square-traffic-light='White'></span>"}return""},filterable:!1,sortable:!1},{field:"ItProjectTimeStatus",title:"Status: Tid",width:100,persistId:"statusproj",template:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.TimeStatus)+'"></span>'}return""},excelTemplate:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.TimeStatus)+'"></span>'}return""},filterable:!1,sortable:!1},{field:"ItProjectQualityStatus",title:"Status: Kvalitet",width:100,persistId:"statusproj",template:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.QualityStatus)+'"></span>'}return""},excelTemplate:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.QualityStatus)+'"></span>'}return""},filterable:!1,sortable:!1},{field:"ItProjectResourcesStatus",title:"Status: Ressourcer",width:100,persistId:"statusproj",template:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.ResourcesStatus)+'"></span>'}return""},excelTemplate:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.ResourcesStatus)+'"></span>'}return""},filterable:!1,sortable:!1},{field:"StatusDate",title:"Status projekt: Dato",format:"{0:dd-MM-yyyy}",width:130,persistId:"statusdateproj",excelTemplate:function(e){return e&&e.StatusDate?t.moment(e.StatusDate).format("DD-MM-YYYY"):""},hidden:!0,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Assignments",title:"Opgaver",width:150,persistId:"assignments",hidden:!0,template:function(e){return t._.filter(e.ItProjectStatuses,function(e){return t._.includes(e["@odata.type"],"Assignment")}).length.toString()},filterable:!1,sortable:!1},{field:"GoalStatus.Status",title:"Status Mål",width:150,persistId:"goalstatus",template:function(e){return'<span data-square-traffic-light="'+e.GoalStatus.Status+'"></span>'},excelTemplate:function(e){return e&&e.GoalStatus&&e.GoalStatus.Status.toString()||""},hidden:!0,filterable:{cell:{dataSource:[],showOperators:!1,operator:"eq"}},values:[{text:"Hvid",value:0},{text:"Rød",value:1},{text:"Gul",value:2},{text:"Grøn",value:3}]},{field:"IsTransversal",title:"Tværgående",width:150,persistId:"trans",hidden:!0,template:function(e){return e.IsTransversal?'<i class="text-success fa fa-check"></i>':'<i class="text-danger fa fa-times"></i>'},excelTemplate:function(e){return e&&e.IsTransversal.toString()||""}},{field:"IsStrategy",title:"Strategisk",width:150,persistId:"strat",hidden:!0,template:function(e){return e.IsStrategy?'<i class="text-success fa fa-check"></i>':'<i class="text-danger fa fa-times"></i>'},excelTemplate:function(e){return e&&e.IsStrategy.toString()||""}},{field:"EconomyYears",title:"Økonomi",width:150,persistId:"eco",hidden:!0,template:function(e){var n=0;return t._.forEach(e.EconomyYears,function(e){n+=t.economyCalc.getTotalBudget(e)}),(-n).toString()},filterable:!1,sortable:!1}]},r=this._.findIndex(n.columns,{persistId:"orgunit"})+1;this._.forEachRight(this.projectRoles,function(e){var i={field:"role"+e.Id,title:e.Name,persistId:"role"+e.Id,template:function(n){var r="";return void 0===n.roles[e.Id]?r:(r=t.concatRoles(n.roles[e.Id]),"<a data-ui-sref='it-system.usage.roles({id: "+n.Id+"})'>"+r+"</a>")},excelTemplate:function(n){return n&&void 0!==n.roles[e.Id]?t.concatRoles(n.roles[e.Id]):""},width:215,hidden:!("Projektleder"===e.Name),sortable:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}};n.columns.splice(r,0,i)}),this.mainGridOptions=n},e.prototype.concatRoles=function(e){var t="";return e.length>0&&(t=e.slice(0,4).join(", ")),e.length>5&&(t+=", ..."),t},e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.$inject=["$rootScope","$scope","$http","$timeout","$window","$state","$","_","moment","notify","projectRoles","user","gridStateService","orgUnits","economyCalc","needsWidthFixService"],e}();e.OverviewInactiveController=t,angular.module("app").config(["$stateProvider",function(e){e.state("it-project.overview-inactive",{url:"/overview-inactive",templateUrl:"app/components/it-project/it-project-overview.view.html",controller:t,controllerAs:"projectOverviewVm",resolve:{projectRoles:["$http",function(e){return e.get("odata/LocalItProjectRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],user:["userService",function(e){return e.getUser()}],orgUnits:["$http","user","_",function(e,t,n){return e.get("/odata/Organizations("+t.currentOrganizationId+")/OrganizationUnits").then(function(e){return n.addHierarchyLevelOnFlatAndSort(e.data.value,"Id","ParentId")})}]}})}])}(e.OverviewInactive||(e.OverviewInactive={}))}(e.ItProject||(e.ItProject={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g,m,h){var v=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.$timeout=r,this.$window=i,this.$state=a,this.$=o,this._=s,this.moment=l,this.notify=c,this.projectRoles=d,this.user=u,this.gridStateService=p,this.orgUnits=f,this.economyCalc=g,this.$modal=m,this.needsWidthFixService=h,this.storageKey="it-project-overview-options",this.orgUnitStorageKey="it-project-overview-orgunit",this.gridState=this.gridStateService.getService(this.storageKey),this.saveGridOptions=function(){v.gridState.saveGridOptions(v.mainGrid)},this.orgUnitDropDownList=function(e){function t(e){return"&nbsp;&nbsp;&nbsp;&nbsp;".repeat(e.$level)+e.Name}function n(){var e=this,t=i.$window.sessionStorage.getItem(i.orgUnitStorageKey);if(t){var n=i._.findIndex(e.dataItems(),function(e){return e.Id==t});n>0&&e.select(n)}}function r(){var e=this,t=i.mainGrid.dataSource,n=e.select(),r=i._.parseInt(e.value());n>0?i.$window.sessionStorage.setItem(i.orgUnitStorageKey,r.toString()):i.$window.sessionStorage.removeItem(i.orgUnitStorageKey),t.read()}var i=v;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:v.orgUnits,dataValueField:"Id",dataTextField:"Name",template:t,dataBound:n,change:r})},this.roleSelectorOptions=function(){return{autoBind:!1,dataSource:v.projectRoles,dataTextField:"Name",dataValueField:"Id",optionLabel:"Vælg projektrolle...",change:function(e){v._.forEach(v.projectRoles,function(e){v.mainGrid.hideColumn("role"+e.Id)});var t=e.sender.value(),n="role"+t;v.mainGrid.showColumn(n),v.needsWidthFixService.fixWidth()}}},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(v.exportFlag){v.exportFlag=!1,v._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=v.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(v.mainGrid.element,!1),v.needsWidthFixService.fixWidth()}else e.preventDefault(),v._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),v.$timeout(function(){v.exportFlag=!0,e.sender.saveAsExcel()})},this.$rootScope.page.title="IT Projekt - Overblik",this.$scope.$on("kendoWidgetCreated",function(e,t){t===v.mainGrid&&(v.loadGridOptions(),v.mainGrid.dataSource.read(),o(".k-grid-excel").click(function(){kendo.ui.progress(v.mainGrid.element,!0)}))}),this.activate()}return e.prototype.opretITProjekt=function(){var e=this;this.$modal.open({windowClass:"modal fade in",templateUrl:"app/components/it-project/it-project-modal-create.view.html",controller:["$scope","$uibModalInstance",function(t,n){t.formData={},t.type="IT Projekt",t.checkAvailbleUrl="api/itProject/",t.saveAndProceed=function(){var r=this,i=e.user.currentOrganizationUnitId,a={name:t.formData.name,responsibleOrgUnitId:i,organizationId:e.user.currentOrganizationId},o=e.notify.addInfoMessage("Opretter system...",!1);e.$http.post("api/itproject",a).success(function(t){o.toSuccessMessage("Et nyt projekt er oprettet!");var a=t.response.id;n.close(a),i&&e.$http.post("api/itproject/"+a+"?organizationunit="+i+"&organizationId="+r.user.currentOrganizationId,null),e.$state.go("it-project.edit.main",{id:a})}).error(function(){o.toErrorMessage("Fejl! Kunne ikke oprette nyt projekt!")})},t.save=function(){var r=this,i=e.user.currentOrganizationUnitId,a={name:t.formData.name,responsibleOrgUnitId:i,organizationId:e.user.currentOrganizationId},o=e.notify.addInfoMessage("Opretter projekt...",!1);e.$http.post("api/itproject",a).success(function(t){o.toSuccessMessage("Et nyt projekt er oprettet!");var a=t.response.id;n.close(a),i&&e.$http.post("api/itproject/"+a+"?organizationunit="+i+"&organizationId="+r.user.currentOrganizationId,null),e.$state.reload()}).error(function(){o.toErrorMessage("Fejl! Kunne ikke oprette nyt projekt!")})}}]})},e.prototype.fixRoleFilter=function(e,t,n){var r=new RegExp("(\\w+\\()"+t+"(,.*?\\))","i");return e.replace(r,"Rights/any(c: $1concat(concat(c/User/Name, ' '), c/User/LastName)$2 and c/RoleId eq "+n+")")},e.prototype.loadGridOptions=function(){this.user.isReadOnly||this.mainGrid.options.toolbar.push({name:"excel",text:"Eksportér til Excel",className:"pull-right"}),this.gridState.loadGridOptions(this.mainGrid)},e.prototype.saveGridProfile=function(){var e=this.$window.sessionStorage.getItem(this.orgUnitStorageKey);this.$window.localStorage.setItem(this.orgUnitStorageKey+"-profile",e),this.gridState.saveGridProfile(this.mainGrid),this.notify.addSuccessMessage("Filtre og sortering gemt")},e.prototype.loadGridProfile=function(){this.gridState.loadGridProfile(this.mainGrid);var e=this.$window.localStorage.getItem(this.orgUnitStorageKey+"-profile");this.$window.sessionStorage.setItem(this.orgUnitStorageKey,e),this.$(".k-filter-row [data-field='ResponsibleUsage.OrganizationUnit.Name']").find("input").data("kendoDropDownList").select(function(t){return t.Id==e}),this.mainGrid.dataSource.read(),this.notify.addSuccessMessage("Anvender gemte filtre og sortering")},e.prototype.clearGridProfile=function(){this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeSession(),this.notify.addSuccessMessage("Filtre og sortering slettet"),this.reload()},e.prototype.doesGridProfileExist=function(){return this.gridState.doesGridProfileExist()},e.prototype.clearOptions=function(){this.$window.localStorage.removeItem(this.orgUnitStorageKey+"-profile"),this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeLocal(),this.gridState.removeSession(),this.notify.addSuccessMessage("Sortering, filtering og kolonnevisning, -bredde og –rækkefølge nulstillet"),this.reload()},e.prototype.checkIfRoleIsAvailable=function(e){return!_.find(this.projectRoles,function(t){return t.Id===parseInt(e,10)})},e.prototype.toggleLock=function(e){e.hasWriteAccess&&(e.IsPriorityLocked=!e.IsPriorityLocked)},e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.prototype.isValidUrl=function(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())},e.prototype.activate=function(){function e(e){e.element.kendoAutoComplete({noDataTemplate:""})}var t=this;this.canCreate=!this.user.isReadOnly;var n={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:function(e){var n="?$expand=ItProjectStatuses,Reference,Parent,ItProjectType,Rights($expand=User,Role),ResponsibleUsage($expand=OrganizationUnit),GoalStatus,EconomyYears,ItProjectStatusUpdates($orderby=Created desc;$top=1)",r=t.$window.sessionStorage.getItem(t.orgUnitStorageKey);return null===r?"/odata/Organizations("+t.user.currentOrganizationId+")/ItProjects"+n:"/odata/Organizations("+t.user.currentOrganizationId+")/OrganizationUnits("+r+")/ItProjects"+n},dataType:"json"},parameterMap:function(e,n){var r=kendo.data.transports["odata-v4"].parameterMap(e,n);return r.$filter&&t._.forEach(t.projectRoles,function(e){r.$filter=t.fixRoleFilter(r.$filter,"role"+e.Id,e.Id)}),r}},filter:{field:"IsArchived",operator:"eq",value:!1},sort:{field:"Name",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{fields:{StatusDate:{type:"date"},LastChanged:{type:"date"},IsTransversal:{type:"boolean"},IsStrategy:{type:"boolean"},IsArchived:{type:"boolean"}}},parse:function(e){return t._.forEach(e.value,function(e){e.roles=[],t._.forEach(e.Rights,function(t){e.roles[t.RoleId]||(e.roles[t.RoleId]=[]),e.roles[t.RoleId].push([t.User.Name,t.User.LastName].join(" "))});var n="Phase"+e.CurrentPhase;e.CurrentPhaseObj=e[n],t.user.isGlobalAdmin||t.user.isLocalAdmin||t._.find(e.Rights,{userId:t.user.id})||t.user.id===e.ObjectOwnerId?e.hasWriteAccess=!0:e.hasWriteAccess=!1,e.Parent||(e.Parent={Name:""}),e.ResponsibleUsage||(e.ResponsibleUsage={OrganizationUnit:{Name:""}}),e.Reference||(e.Reference={Title:"",ExternalReferenceId:""}),e.ItProjectType||(e.ItProjectType={Name:""}),e.GoalStatus||(e.GoalStatus={Status:""})}),e}}},toolbar:[{name:"opretITProjekt",text:"Opret IT Projekt",template:"<button ng-click='projectOverviewVm.opretITProjekt()' class='btn btn-success pull-right' data-ng-disabled=\"!projectOverviewVm.canCreate\">#: text #</button>"},{name:"clearFilter",text:"Nulstil",template:"<button type='button' class='k-button k-button-icontext' title='Nulstil sortering, filtering og kolonnevisning, -bredde og –rækkefølge' data-ng-click='projectOverviewVm.clearOptions()'>#: text #</button>"},{name:"saveFilter",text:"Gem filter",template:'<button type="button" class="k-button k-button-icontext" title="Gem filtre og sortering" data-ng-click="projectOverviewVm.saveGridProfile()">#: text #</button>'},{name:"useFilter",text:"Anvend filter",template:'<button type="button" class="k-button k-button-icontext" title="Anvend gemte filtre og sortering" data-ng-click="projectOverviewVm.loadGridProfile()" data-ng-disabled="!projectOverviewVm.doesGridProfileExist()">#: text #</button>'},{name:"deleteFilter",text:"Slet filter",template:"<button type='button' class='k-button k-button-icontext' title='Slet filtre og sortering' data-ng-click='projectOverviewVm.clearGridProfile()' data-ng-disabled='!projectOverviewVm.doesGridProfileExist()'>#: text #</button>"},{template:kendo.template(this.$("#role-selector").html())}],excel:{fileName:"IT Project Overblik.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,filterable:{mode:"row",messages:{isTrue:"✔",isFalse:"✖"}},groupable:!1,columnMenu:!0,height:window.innerHeight-200,dataBound:this.saveGridOptions,columnResize:this.saveGridOptions,columnHide:this.saveGridOptions,columnShow:this.saveGridOptions,columnReorder:this.saveGridOptions,excelExport:this.exportToExcel,columns:[{field:"ItProjectId",title:"ProjektID",width:115,persistId:"projid",excelTemplate:function(e){return e&&e.ItProjectId||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Parent.Name",title:"Overordnet IT Projekt",width:150,persistId:"parentname",template:function(e){return e.Parent?'<a data-ui-sref="it-project.edit.main({id:'+e.Parent.Id+'})">'+e.Parent.Name+"</a>":""},excelTemplate:function(e){return e&&e.Parent&&e.Parent.Name||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Name",title:"IT Projekt",width:340,persistId:"projname",template:function(e){return'<a data-ui-sref="it-project.edit.main({id: '+e.Id+'})">'+e.Name+"</a>"},excelTemplate:function(e){return e&&e.Name||""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ResponsibleUsage.OrganizationUnit.Name",title:"Ansv. organisationsenhed",width:245,persistId:"orgunit",template:function(e){return e.ResponsibleUsage&&e.ResponsibleUsage.OrganizationUnit.Name||""},filterable:{cell:{showOperators:!1,template:this.orgUnitDropDownList}}},{field:"Reference.Title",title:"Reference",width:150,persistId:"ReferenceId",template:function(e){var t=e.Reference;return null!=t?t.URL?'<a target="_blank" style="float:left;" href="'+t.URL+'">'+t.Title+"</a>":t.Title:""},excelTemplate:function(e){return null==(e&&e.Reference)?"":e&&e.Reference.Title},attributes:{class:"text-left"},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Reference.ExternalReferenceId",title:"Mappe ref",width:150,persistId:"folder",template:function(e){var t=e.Reference;return null!=t?t.ExternalReferenceId?'<a target="_blank" style="float:left;" href="'+t.ExternalReferenceId+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-center"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ItProjectType.Name",title:"Projekttype",width:125,persistId:"projtype",template:function(e){return e.ItProjectType?e.ItProjectType.Name:""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"CurrentPhaseObj.Name",title:"Fase",width:100,persistId:"phasename",template:function(e){return e.CurrentPhaseObj?'<a data-ui-sref="it-project.edit.phases({id:'+e.Id+'})">'+e.CurrentPhaseObj.Name+"</a>":""},excelTemplate:function(e){return e&&e.CurrentPhaseObj&&e.CurrentPhaseObj.Name||""},sortable:!1,filterable:!1},{field:"CurrentPhaseObj.StartDate",title:"Fase: Startdato",format:"{0:dd-MM-yyyy}",width:85,persistId:"phasestartdate",hidden:!0,template:function(e){return e.CurrentPhaseObj&&e.CurrentPhaseObj.StartDate?t.moment(e.CurrentPhaseObj.StartDate).format("DD-MM-YYYY"):""},excelTemplate:function(e){return e&&e.CurrentPhaseObj&&e.CurrentPhaseObj.StartDate?t.moment(e.CurrentPhaseObj.StartDate).format("DD-MM-YYYY"):""},sortable:!1,filterable:!1},{field:"CurrentPhaseObj.EndDate",title:"Fase: Slutdato",format:"{0:dd-MM-yyyy}",width:85,persistId:"phaseenddate",template:function(e){return e.CurrentPhaseObj&&e.CurrentPhaseObj.EndDate?t.moment(e.CurrentPhaseObj.EndDate).format("DD-MM-YYYY"):""},excelTemplate:function(e){return e&&e.CurrentPhaseObj&&e.CurrentPhaseObj.EndDate?t.moment(e.CurrentPhaseObj.EndDate).format("DD-MM-YYYY"):""},sortable:!1,filterable:!1},{field:"ItProjectStatus",title:"Status: Samlet",width:100,persistId:"statusproj",template:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0],n=t.TimeStatus,r=t.QualityStatus,i=t.ResourcesStatus
;return t.IsCombined?'<span data-square-traffic-light="'+t.CombinedStatus+'"></span>':"Red"===n||"Red"===r||"Red"===i?"<span data-square-traffic-light='Red'></span>":"Yellow"===n||"Yellow"===r||"Yellow"===i?"<span data-square-traffic-light='Yellow'></span>":"Green"===n||"Green"===r||"Green"===i?"<span data-square-traffic-light='Green'></span>":"<span data-square-traffic-light='White'></span>"}return""},excelTemplate:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0],n=t.TimeStatus,r=t.QualityStatus,i=t.ResourcesStatus;return t.IsCombined?'<span data-square-traffic-light="'+t.CombinedStatus+'"></span>':"Red"===n||"Red"===r||"Red"===i?"<span data-square-traffic-light='Red'></span>":"Yellow"===n||"Yellow"===r||"Yellow"===i?"<span data-square-traffic-light='Yellow'></span>":"Green"===n||"Green"===r||"Green"===i?"<span data-square-traffic-light='Green'></span>":"<span data-square-traffic-light='White'></span>"}return""},filterable:!1,sortable:!1},{field:"ItProjectTimeStatus",title:"Status: Tid",width:100,persistId:"statusprojtime",template:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.TimeStatus)+'"></span>'}return""},excelTemplate:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.TimeStatus)+'"></span>'}return""},filterable:!1,sortable:!1},{field:"ItProjectQualityStatus",title:"Status: Kvalitet",width:100,persistId:"statusprojqual",template:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.QualityStatus)+'"></span>'}return""},excelTemplate:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.QualityStatus)+'"></span>'}return""},filterable:!1,sortable:!1},{field:"ItProjectResourcesStatus",title:"Status: Ressourcer",width:100,persistId:"statusprojress",template:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.ResourcesStatus)+'"></span>'}return""},excelTemplate:function(e){if(e.ItProjectStatusUpdates.length>0){var t=e.ItProjectStatusUpdates[0];return'<span data-square-traffic-light="'+(t.IsCombined?t.CombinedStatus:t.ResourcesStatus)+'"></span>'}return""},filterable:!1,sortable:!1},{field:"StatusDate",title:"Status projekt: Dato",format:"{0:dd-MM-yyyy}",width:130,persistId:"statusdateproj",excelTemplate:function(e){return e&&e.StatusDate?t.moment(e.StatusDate).format("DD-MM-YYYY"):""},hidden:!0,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Assignments",title:"Opgaver",width:150,persistId:"assignments",hidden:!0,template:function(e){return t._.filter(e.ItProjectStatuses,function(e){return t._.includes(e["@odata.type"],"Assignment")}).length.toString()},filterable:!1,sortable:!1},{field:"GoalStatus.Status",title:"Status Mål",width:150,persistId:"goalstatus",template:function(e){return'<span data-square-traffic-light="'+e.GoalStatus.Status+'"></span>'},excelTemplate:function(e){return e&&e.GoalStatus&&e.GoalStatus.Status.toString()||""},hidden:!0,filterable:{cell:{dataSource:[],showOperators:!1,operator:"eq"}},values:[{text:"Hvid",value:0},{text:"Rød",value:1},{text:"Gul",value:2},{text:"Grøn",value:3}]},{field:"IsTransversal",title:"Tværgående",width:150,persistId:"trans",hidden:!0,template:function(e){return e.IsTransversal?'<i class="text-success fa fa-check"></i>':'<i class="text-danger fa fa-times"></i>'},excelTemplate:function(e){return e&&e.IsTransversal.toString()||""}},{field:"IsStrategy",title:"Strategisk",width:150,persistId:"strat",hidden:!0,template:function(e){return e.IsStrategy?'<i class="text-success fa fa-check"></i>':'<i class="text-danger fa fa-times"></i>'},excelTemplate:function(e){return e&&e.IsStrategy.toString()||""}},{field:"EconomyYears",title:"Økonomi",width:150,persistId:"eco",hidden:!0,template:function(e){var n=0;return t._.forEach(e.EconomyYears,function(e){n+=t.economyCalc.getTotalBudget(e)}),(-n).toString()},filterable:!1,sortable:!1},{field:"Priority",title:"Prioritet: Projekt",width:120,persistId:"priority",template:function(){return'<select data-ng-model="dataItem.Priority" data-autosave="api/itproject/{{dataItem.Id}}" data-field="priority" data-ng-disabled="dataItem.IsPriorityLocked || !dataItem.hasWriteAccess">\n                                                    <option value="None">-- Vælg --</option>\n                                                    <option value="High">Høj</option>\n                                                    <option value="Mid">Mellem</option>\n                                                    <option value="Low">Lav</option>\n                                                </select>'},excelTemplate:function(e){return e&&e.Priority.toString()||""},filterable:{cell:{dataSource:[],showOperators:!1,operator:"eq"}},values:[{text:"Ingen",value:0},{text:"Lav",value:1},{text:"Mellem",value:2},{text:"Høj",value:3}]},{field:"PriorityPf",title:"Prioritet: Portefølje",width:150,persistId:"prioritypf",template:function(){return'<div class="btn-group btn-group-sm" data-toggle="buttons">\n                                                    <label class="btn btn-star" data-ng-class="{ \'unstarred\': !dataItem.IsPriorityLocked, \'disabled\': !dataItem.hasWriteAccess }" data-ng-click="projectOverviewVm.toggleLock(dataItem)">\n                                                        <input type="checkbox" data-ng-model="dataItem.IsPriorityLocked" data-autosave="api/itproject/{{dataItem.Id}}" data-field="IsPriorityLocked" data-ng-disabled="!dataItem.hasWriteAccess">\n                                                        <i class="glyphicon glyphicon-lock"></i>\n                                                    </label>\n                                                </div>\n                                                <select data-ng-model="dataItem.PriorityPf" data-autosave="api/itproject/{{dataItem.Id}}" data-field="priorityPf" data-ng-disabled="!dataItem.hasWriteAccess">\n                                                    <option value="None">-- Vælg --</option>\n                                                    <option value="High">Høj</option>\n                                                    <option value="Mid">Mellem</option>\n                                                    <option value="Low">Lav</option>\n                                                </select>'},excelTemplate:function(e){return e&&e.PriorityPf.toString()||""},hidden:!0,filterable:{cell:{dataSource:[],showOperators:!1,operator:"eq"}},values:[{text:"Ingen",value:0},{text:"Lav",value:1},{text:"Mellem",value:2},{text:"Høj",value:3}]},{field:"Rights.Role",title:""+this.user.fullName,width:150,persistId:"usersRoles",template:function(e){return'<span data-ng-model="dataItem.usersRoles" value="rights.Role.Name" ng-repeat="rights in dataItem.Rights"> {{rights.Role.Name}}<span data-ng-if="projectOverviewVm.checkIfRoleIsAvailable(rights.Role.Id)">(udgået)</span>{{$last ? \'\' : \', \'}}</span>'},attributes:{class:"might-overflow"},hidden:!0,sortable:!1,filterable:!1}]},r=this._.findIndex(n.columns,{persistId:"orgunit"})+1;this._.forEachRight(this.projectRoles,function(e){var i={field:"role"+e.Id,title:e.Name,persistId:"role"+e.Id,template:function(n){var r="";return void 0===n.roles[e.Id]?r:(r=t.concatRoles(n.roles[e.Id]),"<a data-ui-sref='it-project.edit.roles({id: "+n.Id+"})'>"+r+"</a>")},excelTemplate:function(n){return n&&void 0!==n.roles[e.Id]?t.concatRoles(n.roles[e.Id]):""},width:135,hidden:!("Projektleder"===e.Name),sortable:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}};n.columns.splice(r,0,i)}),this.mainGridOptions=n},e.prototype.concatRoles=function(e){var t="";return e.length>0&&(t=e.slice(0,4).join(", ")),e.length>5&&(t+=", ..."),t},e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.$inject=["$rootScope","$scope","$http","$timeout","$window","$state","$","_","moment","notify","projectRoles","user","gridStateService","orgUnits","economyCalc","$uibModal","needsWidthFixService"],e}();e.OverviewController=t,angular.module("app").config(["$stateProvider",function(e){e.state("it-project.overview",{url:"/overview",templateUrl:"app/components/it-project/it-project-overview.view.html",controller:t,controllerAs:"projectOverviewVm",resolve:{projectRoles:["$http",function(e){return e.get("odata/LocalItProjectRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],user:["userService",function(e){return e.getUser()}],orgUnits:["$http","user","_",function(e,t,n){return e.get("/odata/Organizations("+t.currentOrganizationId+")/OrganizationUnits").then(function(e){return n.addHierarchyLevelOnFlatAndSort(e.data.value,"Id","ParentId")})}]}})}])}(e.Overview||(e.Overview={}))}(e.ItProject||(e.ItProject={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project",{url:"/project",abstract:!0,template:'<ui-view autoscroll="false" />',resolve:{user:["userService",function(e){return e.getUser()}]},controller:["$rootScope","$http","$state","notify","user","$scope","$timeout",function(e,t,n,r,i,a,o){function s(){if(confirm("Er du sikker på du vil slette projektet?")){var e=n.params.id,a=r.addInfoMessage("Sletter IT Projektet...",!1);t.delete("api/itproject/"+e+"?organizationId="+i.currentOrganizationId).success(function(e){a.toSuccessMessage("IT Projektet er slettet!"),n.go("it-project.overview")}).error(function(){a.toErrorMessage("Fejl! Kunne ikke slette IT Projektet!")})}}e.page.title="IT Projekt",e.page.subnav=[{state:"it-project.overview",text:"IT projekter"},{state:"it-project.overview-inactive",text:"Inaktive IT projekter"},{state:"it-project.edit",text:"IT Projekt",showWhen:"it-project.edit"}],e.page.subnav.buttons=[{func:s,text:"Slet IT Projekt",style:"btn-danger",showWhen:"it-project.edit"}],e.subnavPositionCenter=!1,a.$on("$viewContentLoaded",function(){e.positionSubnav()})}]})}])}(angular,app),function(e,t){"use strict";t.directive("simpleComment",[function(){return{scope:!0,require:"ngModel",template:'<button class="btn btn-link btn-sm" data-ng-disabled="disabled" data-popover="{{comment}}"><i class="glyphicon glyphicon-comment small" data-ng-class="ngClassObj"></i></button>',link:function(e,t,n,r){function i(t){e.disabled=t,e.ngClassObj={faded:t}}i(!0),r.$render=function(){i(!r.$viewValue),e.comment=r.$viewValue}}}}])}(angular,app),function(e,t){"use strict";t.directive("squareTrafficLight",[function(){return{template:'<uib-progressbar class="status-bar" data-value="value" data-type="{{type}}"></uib-progressbar>',scope:{status:"@squareTrafficLight"},link:function(e){switch(e.status.toLowerCase()){case"red":case 1:e.type="danger",e.value=100;break;case"yellow":case 2:e.type="warning",e.value=100;break;case"green":case 3:e.type="success",e.value=100;break;default:e.value=0}}}}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p,f){function g(e){e.element.kendoAutoComplete({noDataTemplate:""})}var m=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.$timeout=r,this.$state=i,this.$sce=a,this.$=o,this._=s,this.moment=l,this.notify=c,this.user=d,this.gridStateService=u,this.$uibModal=p,this.needsWidthFixService=f,this.storageKey="it-system-catalog-options",this.gridState=this.gridStateService.getService(this.storageKey),this.saveGridOptions=function(){m.gridState.saveGridOptions(m.mainGrid)},this.saveGridProfile=function(){m.gridState.saveGridProfile(m.mainGrid),m.notify.addSuccessMessage("Filtre og sortering gemt")},this.doesGridProfileExist=function(){return m.gridState.doesGridProfileExist()},this.showUsageDetails=function(e,t){m.usageGrid.dataSource.filter({field:"ItSystemId",operator:"eq",value:e}),m.modal.setOptions({title:"Anvendelse af "+t}),m.modal.center().open()},this.usageDetailsGrid={dataSource:{type:"odata-v4",transport:{read:{url:"/odata/ItSystemUsages?$expand=Organization",dataType:"json"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0},autoBind:!1,columns:[{field:"Organization.Name",title:"Organisation"}],dataBound:this.detailsBound},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(m.exportFlag){m.exportFlag=!1,m._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=m.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(m.mainGrid.element,!1),m.needsWidthFixService.fixWidth()}else e.preventDefault(),m._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),m.$timeout(function(){m.exportFlag=!0,e.sender.saveAsExcel()})},this.accessModFilter=function(e){function t(){var e=this,t=i.filter();switch(r._.findKeyDeep(t,{field:"AccessModifier"}).value){case"Kitos.AccessModifier0":e.select(1);break;case"Kitos.AccessModifier1":e.select(2);break;default:e.select(0)}}function n(){var e=this,t=r.mainGrid.dataSource,n=e.value(),i=t.filter(),a=r._.removeFiltersForField(i,"AccessModifier");n&&(a=r._.addFilter(a,"AccessModifier","eq",n,"and")),t.filter(a)}var r=m,i=e.dataSource;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:[{value:"Kitos.AccessModifier0",text:"Lokal"},{value:"Kitos.AccessModifier1",text:"Offentlig"}],dataTextField:"text",dataValueField:"value",optionLabel:"Vælg filter...",dataBound:t,change:n})},e.page.title="IT System - Katalog",t.$on("kendoWidgetCreated",function(e,t){if(t===m.mainGrid){m.loadGridOptions(),m.mainGrid.dataSource.read();var n=o(".k-filter-row [data-field='AccessModifier']"),r=n.find("input").data("kendoDropDownList");n.find("button").on("click",function(){r.select(0)}),o(".k-grid-excel").click(function(){kendo.ui.progress(m.mainGrid.element,!0)})}});var h;h=d.isGlobalAdmin?"/odata/ItSystems":"/odata/Organizations("+d.currentOrganizationId+")/ItSystems";var v=h+"?$expand=AppTypeOption,BusinessType,AssociatedDataWorkers,BelongsTo,TaskRefs,Parent,Organization,ObjectOwner,Usages($expand=Organization),LastChangedByUser,Reference";this.canCreate=!this.user.isReadOnly,this.mainGridOptions={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:v,dataType:"json"},parameterMap:function(e,t){var n=kendo.data.transports["odata-v4"].parameterMap(e,t);return n.$filter&&(n.$filter=n.$filter.replace(/('Kitos\.AccessModifier([0-9])')/,"Kitos.AccessModifier'$2'"),n.$filter=n.$filter.replace(/(\w+\()(TaskKey.*\))/,"TaskRefs/any(c: $1c/$2)"),n.$filter=n.$filter.replace(/(\w+\()TaskName(.*\))/,"TaskRefs/any(c: $1c/Description$2)"),n.$filter=n.$filter.replace(/contains\(Uuid,/,"contains(CAST(Uuid, 'Edm.String'),")),n}},sort:{field:"Name",dir:"asc"},schema:{model:{fields:{LastChanged:{type:"date"},Disabled:{type:"boolean"}}},parse:function(e){return m._.forEach(e.value,function(e){e.Reference||(e.Reference={Title:"",ExternalReferenceId:""}),e.Parent||(e.Parent={Name:""}),e.BusinessType||(e.BusinessType={Name:""}),e.AppTypeOption||(e.AppTypeOption={Name:""}),e.BelongsTo||(e.BelongsTo={Name:""}),e.Usages||(e.Usages=[]),e.Organization||(e.Organization={Name:""})}),e}},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0},toolbar:[{name:"createITSystem",text:"Opret IT System",template:"<button ng-click='systemCatalogVm.createITSystem()' class='btn btn-success pull-right' data-ng-disabled=\"!systemCatalogVm.canCreate\">#: text #</button>"},{name:"clearFilter",text:"Nulstil",template:"<button type='button' class='k-button k-button-icontext' title='Nulstil sortering, filtering og kolonnevisning, -bredde og –rækkefølge' data-ng-click='systemCatalogVm.clearOptions()'>#: text #</button>"},{name:"saveFilter",text:"Gem filter",template:'<button type="button" class="k-button k-button-icontext" title="Gem filtre og sortering" data-ng-click="systemCatalogVm.saveGridProfile()">#: text #</button>'},{name:"useFilter",text:"Anvend filter",template:'<button type="button" class="k-button k-button-icontext" title="Anvend gemte filtre og sortering" data-ng-click="systemCatalogVm.loadGridProfile()" data-ng-disabled="!systemCatalogVm.doesGridProfileExist()">#: text #</button>'},{name:"deleteFilter",text:"Slet filter",template:"<button type='button' class='k-button k-button-icontext' title='Slet filtre og sortering' data-ng-click='systemCatalogVm.clearGridProfile()' data-ng-disabled='!systemCatalogVm.doesGridProfileExist()'>#: text #</button>"}],excel:{fileName:"IT System Katalog.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:!0,height:window.innerHeight-200,dataBound:this.saveGridOptions,columnResize:this.saveGridOptions,columnHide:this.saveGridOptions,columnShow:this.saveGridOptions,columnReorder:this.saveGridOptions,excelExport:this.exportToExcel,columns:[{field:"Usages",title:"Anvendes",width:40,persistId:"command",template:function(e){return m._.find(e.Usages,function(e){return e.OrganizationId==m.user.currentOrganizationId})?'<div class="text-center"><button type="button" class="btn btn-link" data-ng-click="systemCatalogVm.removeUsage('+e.Id+')"><span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span></button></div>':e.Disabled?'<div class="text-center"><button type="button" class="btn btn-link" disabled><span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span></button></div>':'<div class="text-center"><button type="button" class="btn btn-link " data-ng-click="systemCatalogVm.enableUsage(dataItem)"><span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span></button></div>'},excelTemplate:function(e){return!!e&&m._.find(e.Usages,function(e){return e.OrganizationId==m.user.currentOrganizationId})?"Anvendt":"Ikke anvendt"},filterable:!1,sortable:!1},{field:"Parent.Name",title:"Overordnet IT System",width:150,persistId:"parentname",template:function(e){return e.Parent?e.Parent.Name:""},hidden:!0,filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"PreviousName",title:"Tidligere Systemnavn",width:285,persistId:"previousname",template:function(e){return null!=e.PreviousName?e.PreviousName:""},filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Name",title:"It System",width:285,persistId:"name",template:function(e){return e.Disabled?"<a data-ui-sref='it-system.edit.main({id: "+e.Id+"})'>"+e.Name+" (Slettes) </a>":"<a data-ui-sref='it-system.edit.main({id: "+e.Id+"})'>"+e.Name+"</a>"},excelTemplate:function(e){return e&&e.Name?e.Disabled?e.Name+" (Slettes)":e.Name:""},filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Disabled",title:"Slettes",width:120,persistId:"Disabled",template:function(e){return e.Disabled?"Ja":"Nej"},hidden:!1,filterable:{cell:{template:function(e){e.element.kendoDropDownList({dataSource:[{type:"Ja",value:!0},{type:"Nej",value:!1}],dataTextField:"type",dataValueField:"value",valuePrimitive:!0})},showOperators:!1}}},{field:"AccessModifier",title:"Synlighed",width:120,persistId:"accessmod",template:'<display-access-modifier value="dataItem.AccessModifier"></display-access-modifier>',excelTemplate:function(e){return e&&e.AccessModifier.toString()||""},hidden:!0,filterable:{cell:{showOperators:!1,template:this.accessModFilter}}},{field:"BusinessType.Name",title:"Forretningstype",width:150,persistId:"busitype",template:function(e){return e.BusinessType?e.BusinessType.Name:""},attributes:{class:"might-overflow"},filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"AppTypeOption.Name",title:"Applikationstype",width:150,persistId:"apptype",template:function(e){return e.AppTypeOption?e.AppTypeOption.Name:""},hidden:!0,filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"BelongsTo.Name",title:"Rettighedshaver",width:210,persistId:"belongsto",template:function(e){return e.BelongsTo?e.BelongsTo.Name:""},filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"TaskKey",title:"KLE ID",width:150,persistId:"taskkey",template:function(e){return e.TaskRefs.length>0?m._.map(e.TaskRefs,"TaskKey").join(", "):""},attributes:{class:"might-overflow"},hidden:!0,filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"startswith"}},sortable:!1},{field:"TaskName",title:"KLE Navn",width:155,persistId:"taskname",template:function(e){return e.TaskRefs.length>0?m._.map(e.TaskRefs,"Description").join(", "):""},attributes:{class:"might-overflow"},filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"startswith"}},sortable:!1},{field:"Usages.length",title:"IT System: Anvendes af",width:95,persistId:"usages",template:function(e){return'<a class="col-xs-7 text-center" data-ng-click="systemCatalogVm.showUsageDetails('+e.Id+",'"+m.$sce.getTrustedHtml(e.Name)+"')\">"+e.Usages.length+"</a>"},excelTemplate:function(e){return e&&e.Usages&&e.Usages.length.toString()||""},filterable:!1,sortable:!1},{field:"Organization.Name",title:"Oprettet af: Organisation",width:150,persistId:"orgname",template:function(e){return e.Organization?e.Organization.Name:""},hidden:!0,filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ObjectOwner.Name",title:"Oprettet af: Bruger",width:150,persistId:"ownername",template:function(e){return e.ObjectOwner.Name+" "+e.ObjectOwner.LastName},hidden:!0,filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LastChangedByUser.Name",title:"Sidst redigeret: Bruger",width:150,persistId:"lastchangedname",template:function(e){return e.LastChangedByUser.Name+" "+e.LastChangedByUser.LastName},hidden:!0,filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LastChanged",title:"Sidst redigeret: Dato",format:"{0:dd-MM-yyyy}",width:130,persistId:"lastchangeddate",template:function(e){return e&&e.LastChanged&&"01-01-0001"!==m.moment(e.LastChanged).format("DD-MM-YYYY")?m.moment(e.LastChanged).format("DD-MM-YYYY"):""},excelTemplate:function(e){return e&&e.LastChanged&&"01-01-0001"!==m.moment(e.LastChanged).format("DD-MM-YYYY")?m.moment(e.LastChanged).format("DD-MM-YYYY"):""},attributes:{class:"text-center"},filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"Reference.Title",title:"Reference",width:150,persistId:"ReferenceId",template:function(e){var t=e.Reference;return null!=t?t.URL?'<a target="_blank" style="float:left;" href="'+t.URL+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-left"},filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Reference.ExternalReferenceId",title:"Mappe ref",width:150,persistId:"folderref",template:function(e){var t=e.Reference;return null!=t?t.ExternalReferenceId?'<a target="_blank" style="float:left;" href="'+t.ExternalReferenceId+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-center"},hidden:!0,filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Uuid",title:"UUID",width:150,persistId:"uuid",excelTemplate:function(e){return e.Uuid},hidden:!0,filterable:{cell:{template:g,dataSource:[],showOperators:!1,operator:"contains"}}}]}}return e.prototype.createITSystem=function(){var e=this;this.$uibModal.open({windowClass:"modal fade in",templateUrl:"app/components/it-system/it-system-modal-create.view.html",controller:["$scope","$uibModalInstance",function(t,n){t.formData={},t.type="IT System",t.checkAvailableUrl="api/itSystem/",t.saveAndProceed=function(){var r={name:t.formData.name,belongsToId:e.user.currentOrganizationId,organizationId:e.user.currentOrganizationId,taskRefIds:[]},i=e.notify.addInfoMessage("Opretter system...",!1);e.$http.post("api/itsystem",r).success(function(t){i.toSuccessMessage("Et nyt system er oprettet!");var r=t.response.id;n.close(r),r&&e.$state.go("it-system.edit.main",{id:r})}).error(function(){i.toErrorMessage("Fejl! Kunne ikke oprette et nyt system!")})},t.save=function(){var r={name:t.formData.name,belongsToId:e.user.currentOrganizationId,organizationId:e.user.currentOrganizationId,taskRefIds:[]},i=e.notify.addInfoMessage("Opretter system...",!1);e.$http.post("api/itsystem",r).success(function(t){i.toSuccessMessage("Et nyt system er oprettet!");var r=t.response.id;n.close(r),r&&e.$state.reload()}).error(function(){i.toErrorMessage("Fejl! Kunne ikke oprette et nyt system!")})}}]})},e.prototype.detailsBound=function(e){var t=e.sender;if(0==t.dataSource.total()){var n=t.columns.length;this.$(e.sender.wrapper).find("tbody").append('<tr class="kendo-data-row"><td colspan="'+n+'" class="no-data text-muted">System anvendens ikke</td></tr>')}},e.prototype.loadGridOptions=function(){this.user.isReadOnly||this.mainGrid.options.toolbar.push({name:"excel",text:"Eksportér til Excel",className:"pull-right"}),this.gridState.loadGridOptions(this.mainGrid)},e.prototype.loadGridProfile=function(){this.gridState.loadGridProfile(this.mainGrid),this.mainGrid.dataSource.read(),this.notify.addSuccessMessage("Anvender gemte filtre og sortering")},e.prototype.clearGridProfile=function(){this.gridState.removeProfile(),this.gridState.removeSession(),this.notify.addSuccessMessage("Filtre og sortering slettet"),this.reload()},e.prototype.clearOptions=function(){this.gridState.removeProfile(),this.gridState.removeLocal(),this.gridState.removeSession(),this.notify.addSuccessMessage("Sortering, filtering og kolonnevisning, -bredde og –rækkefølge nulstillet"),this.reload()},e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.prototype.isValidUrl=function(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())},e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.prototype.enableUsage=function(e){var t=this;this.addUsage(e).then(function(){return t.mainGrid.dataSource.fetch()})},e.prototype.removeUsage=function(e){var t=this;confirm("Er du sikker på at du vil fjerne den lokale anvendelse af systemet? Dette sletter ikke systemet, men vil slette alle lokale detaljer vedrørende anvendelsen.")&&this.deleteUsage(e).then(function(){return t.mainGrid.dataSource.fetch()})},e.prototype.addUsage=function(e){var t=this;return this.$http.post("api/itSystemUsage",{itSystemId:e.Id,organizationId:this.user.currentOrganizationId,dataLevel:e.DataLevel,containsLegalInfo:e.ContainsLegalInfo,AssociatedDataWorkers:e.AssociatedDataWorkers}).success(function(){return t.notify.addSuccessMessage("Systemet er taget i anvendelse")}).error(function(){return t.notify.addErrorMessage("Systemet kunne ikke tages i anvendelse!")})},e.prototype.deleteUsage=function(e){var t=this,n="api/itSystemUsage?itSystemId="+e+"&organizationId="+this.user.currentOrganizationId;return this.$http.delete(n).success(function(){return t.notify.addSuccessMessage("Anvendelse af systemet er fjernet")}).error(function(){return t.notify.addErrorMessage("Anvendelse af systemet kunne ikke fjernes!")})},e.$inject=["$rootScope","$scope","$http","$timeout","$state","$sce","$","_","moment","notify","user","gridStateService","$uibModal","needsWidthFixService"],e}();e.CatalogController=t,angular.module("app").config(["$stateProvider",function(e){e.state("it-system.catalog",{url:"/catalog",templateUrl:"app/components/it-system/it-system-catalog.view.html",controller:t,controllerAs:"systemCatalogVm",resolve:{user:["userService",function(e){return e.getUser()}]}})}])}(e.Catalog||(e.Catalog={}))}(e.ItSystem||(e.ItSystem={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g){var m=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.$timeout=r,this.$window=i,this.$state=a,this.$=o,this._=s,this.moment=l,this.notify=c,this.systemRoles=d,this.user=u,this.gridStateService=p,this.orgUnits=f,this.needsWidthFixService=g,this.storageKey="it-system-overview-options",this.orgUnitStorageKey="it-system-overview-orgunit",this.gridState=this.gridStateService.getService(this.storageKey),this.saveGridOptions=function(){m.gridState.saveGridOptions(m.mainGrid)},this.orgUnitDropDownList=function(e){function t(e){return"&nbsp;&nbsp;&nbsp;&nbsp;".repeat(e.$level)+e.Name}function n(){var e=this,t=i.$window.sessionStorage.getItem(i.orgUnitStorageKey);if(t){var n=i._.findIndex(e.dataItems(),function(e){return e.Id==t});n>0&&e.select(n)}}function r(){var e=this,t=i.mainGrid.dataSource,n=e.select(),r=i._.parseInt(e.value());n>0?i.$window.sessionStorage.setItem(i.orgUnitStorageKey,r.toString()):i.$window.sessionStorage.removeItem(i.orgUnitStorageKey),t.read()}var i=m;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:m.orgUnits,dataValueField:"Id",dataTextField:"Name",template:t,dataBound:n,change:r})},this.contractFilterDropDownList=function(e){function t(){var e=this,t=i.filter(),n=r._.findKeyDeep(t,{field:"MainContract"});"neq"==n.operator?e.select(1):"eq"==n.operator&&e.select(2)}function n(){var e=this,t=r.mainGrid.dataSource,n=e.value(),i="MainContract",a=t.filter(),o=r._.removeFiltersForField(a,i);"Har kontrakt"===n?o=r._.addFilter(o,i,"ne",null,"and"):"Ingen kontrakt"===n&&(o=r._.addFilter(o,i,"eq",null,"and")),t.filter(o)}var r=m,i=e.dataSource;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:["Har kontrakt","Ingen kontrakt"],optionLabel:"Vælg filter...",dataBound:t,change:n})},this.roleSelectorOptions=function(){return{autoBind:!1,dataSource:m.systemRoles,dataTextField:"Name",dataValueField:"Id",optionLabel:"Vælg systemrolle...",change:function(e){m._.forEach(m.systemRoles,function(e){m.mainGrid.hideColumn("role"+e.Id)});var t=e.sender.value(),n="role"+t;m.mainGrid.showColumn(n),m.needsWidthFixService.fixWidth()}}},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(m.exportFlag){m.exportFlag=!1,m._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=m.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(m.mainGrid.element,!1),m.needsWidthFixService.fixWidth()}else e.preventDefault(),m._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),m.$timeout(function(){m.exportFlag=!0,e.sender.saveAsExcel()})},e.page.title="IT System - Overblik",t.$on("kendoWidgetCreated",function(e,t){t===m.mainGrid&&(m.loadGridOptions(),m.mainGrid.dataSource.read(),o(".k-grid-excel").click(function(){kendo.ui.progress(m.mainGrid.element,!0)}))}),this.activate()}return e.prototype.fixRoleFilter=function(e,t,n){var r=new RegExp("(\\w+\\()"+t+"(.*?\\))","i");return e.replace(r,"Rights/any(c: $1concat(concat(c/User/Name, ' '), c/User/LastName)$2 and c/RoleId eq "+n+")")},e.prototype.fixKleIdFilter=function(e,t){var n=new RegExp("(\\w+\\()"+t+"(.*?\\))","i");return e.replace(n,"ItSystem/TaskRefs/any(c: $1c/TaskKey$2)")},e.prototype.fixKleDescFilter=function(e,t){var n=new RegExp("(\\w+\\()"+t+"(.*?\\))","i");return e.replace(n,"ItSystem/TaskRefs/any(c: $1c/Description$2)")},
e.prototype.loadGridOptions=function(){this.user.isReadOnly||this.mainGrid.options.toolbar.push({name:"excel",text:"Eksportér til Excel",className:"pull-right"}),this.gridState.loadGridOptions(this.mainGrid)},e.prototype.saveGridProfile=function(){var e=this.$window.sessionStorage.getItem(this.orgUnitStorageKey);this.$window.localStorage.setItem(this.orgUnitStorageKey+"-profile",e),this.gridState.saveGridProfile(this.mainGrid),this.notify.addSuccessMessage("Filtre og sortering gemt")},e.prototype.loadGridProfile=function(){this.gridState.loadGridProfile(this.mainGrid);var e=this.$window.localStorage.getItem(this.orgUnitStorageKey+"-profile");this.$window.sessionStorage.setItem(this.orgUnitStorageKey,e),this.$(".k-filter-row [data-field='ResponsibleUsage.OrganizationUnit.Name']").find("input").data("kendoDropDownList").select(function(t){return t.Id==e}),this.mainGrid.dataSource.read(),this.notify.addSuccessMessage("Anvender gemte filtre og sortering")},e.prototype.clearGridProfile=function(){this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeSession(),this.notify.addSuccessMessage("Filtre og sortering slettet"),this.reload()},e.prototype.doesGridProfileExist=function(){return this.gridState.doesGridProfileExist()},e.prototype.clearOptions=function(){this.$window.localStorage.removeItem(this.orgUnitStorageKey+"-profile"),this.$window.sessionStorage.removeItem(this.orgUnitStorageKey),this.gridState.removeProfile(),this.gridState.removeLocal(),this.gridState.removeSession(),this.notify.addSuccessMessage("Sortering, filtering og kolonnevisning, -bredde og –rækkefølge nulstillet"),this.reload()},e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.prototype.isValidUrl=function(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())},e.prototype.activate=function(){function e(e){e.element.kendoAutoComplete({noDataTemplate:""})}var t=this,n={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:function(e){var n="?$expand=ItSystem($expand=AppTypeOption,BusinessType,Parent,TaskRefs),ArchivePeriods,Reference,Organization,ResponsibleUsage($expand=OrganizationUnit),MainContract($expand=ItContract($expand=Supplier)),Contracts($expand=ItContract($expand=ContractType,AssociatedAgreementElementTypes($expand=AgreementElementType))),Rights($expand=User,Role),ArchiveType,SensitiveDataType,ObjectOwner,LastChangedByUser,ItProjects($select=Name)",r=t.$window.sessionStorage.getItem(t.orgUnitStorageKey);return null===r?"/odata/Organizations("+t.user.currentOrganizationId+")/ItSystemUsages"+n:"/odata/Organizations("+t.user.currentOrganizationId+")/OrganizationUnits("+r+")/ItSystemUsages"+n},dataType:"json"},parameterMap:function(e,n){var r=kendo.data.transports["odata-v4"].parameterMap(e,n);if(r.$filter){var i=t.systemRoles.sort(function(e,t){return e.Id>t.Id?-1:e.Id<t.Id?1:0});t._.forEach(i,function(e){r.$filter=t.fixRoleFilter(r.$filter,"role"+e.Id,e.Id)}),r.$filter=t.fixKleIdFilter(r.$filter,"ItSystem/TaskRefs/TaskKey"),r.$filter=t.fixKleDescFilter(r.$filter,"ItSystem/TaskRefs/Description"),r.$filter=r.$filter.replace(/contains\(ItSystem\/Uuid,/,"contains(CAST(ItSystem/Uuid, 'Edm.String'),"),r.$filter=r.$filter.replace("ItSystem/TaskRefs/any(c: startswith(c/TaskKey,'\"\"'))","ItSystem/TaskRefs/any(c: contains(c/TaskKey,'')) eq false"),r.$filter=r.$filter.replace("ItSystem/TaskRefs/any(c: startswith(c/TaskKey,'alt'))","ItSystem/TaskRefs/any(c: contains(c/TaskKey,'')) eq true")}return r}},sort:{field:"SystemName",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{fields:{LastChanged:{type:"date"},Concluded:{type:"date"},ArchiveDuty:{type:"number"},Registertype:{type:"boolean"},EndDate:{from:"ArchivePeriods.EndDate",type:"date"},SystemName:{from:"ItSystem.Name",type:"string"},IsActive:{type:"boolean"}}},parse:function(e){return t._.forEach(e.value,function(e){e.roles=[],t._.forEach(e.Rights,function(t){e.roles[t.RoleId]||(e.roles[t.RoleId]=[]),e.roles[t.RoleId].push([t.User.Name,t.User.LastName].join(" "))}),e.ItSystem.Parent||(e.ItSystem.Parent={Name:""}),e.ResponsibleUsage||(e.ResponsibleUsage={OrganizationUnit:{Name:""}}),e.ItSystem.BusinessType||(e.ItSystem.BusinessType={Name:""}),e.ItSystem.AppTypeOption||(e.ItSystem.AppTypeOption={Name:""}),e.ItSystem.TaskRefs||(e.ItSystem.TaskRefs={TaskKey:"",Description:""}),e.SensitiveDataType||(e.SensitiveDataType={Name:""}),e.MainContract||(e.MainContract={ItContract:{Supplier:{Name:""}}}),e.Reference||(e.Reference={Title:"",ExternalReferenceId:""}),e.MainContract.ItContract.Supplier||(e.MainContract.ItContract.Supplier={Name:""})}),e}}},toolbar:[{name:"clearFilter",text:"Nulstil",template:"<button type='button' class='k-button k-button-icontext' title='Nulstil sortering, filtering og kolonnevisning, -bredde og –rækkefølge' data-ng-click='systemOverviewVm.clearOptions()'>#: text #</button>"},{name:"saveFilter",text:"Gem filter",template:'<button type="button" class="k-button k-button-icontext" title="Gem filtre og sortering" data-ng-click="systemOverviewVm.saveGridProfile()">#: text #</button>'},{name:"useFilter",text:"Anvend filter",template:'<button type="button" class="k-button k-button-icontext" title="Anvend gemte filtre og sortering" data-ng-click="systemOverviewVm.loadGridProfile()" data-ng-disabled="!systemOverviewVm.doesGridProfileExist()">#: text #</button>'},{name:"deleteFilter",text:"Slet filter",template:"<button type='button' class='k-button k-button-icontext' title='Slet filtre og sortering' data-ng-click='systemOverviewVm.clearGridProfile()' data-ng-disabled='!systemOverviewVm.doesGridProfileExist()'>#: text #</button>"},{template:kendo.template(this.$("#role-selector").html())}],excel:{fileName:"IT System Overblik.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:!0,height:window.innerHeight-200,dataBound:this.saveGridOptions,columnResize:this.saveGridOptions,columnHide:this.saveGridOptions,columnShow:this.saveGridOptions,columnReorder:this.saveGridOptions,excelExport:this.exportToExcel,columns:[{field:"IsActive",title:"Gyldig/Ikke gyldig",width:90,persistId:"isActive",template:function(e){return e.IsActive?'<span class="fa fa-file text-success" aria-hidden="true"></span>':'<span class="fa fa-file-o text-muted" aria-hidden="true"></span>'},excelTemplate:function(e){return t.isContractActive(e).toString()},attributes:{class:"text-center"},sortable:!1,filterable:!1},{field:"LocalSystemId",title:"Lokal system ID",width:150,persistId:"localid",excelTemplate:function(e){return e&&e.LocalSystemId||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"},ignoreCase:!0}},{field:"ItSystem.Uuid",title:"UUID",width:150,persistId:"uuid",excelTemplate:function(e){return e.ItSystem.Uuid},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ItSystem.Parent.Name",title:"Overordnet IT System",width:150,persistId:"parentsysname",template:function(e){return e.ItSystem.Parent?e.ItSystem.Parent.Name:""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"SystemName",title:"IT System",width:320,persistId:"sysname",template:function(e){return e.ItSystem.Disabled?"<a data-ui-sref='it-system.usage.main({id: "+e.Id+"})'>"+e.ItSystem.Name+" (Slettes) </a>":"<a data-ui-sref='it-system.usage.main({id: "+e.Id+"})'>"+e.ItSystem.Name+"</a>"},excelTemplate:function(e){return e&&e.ItSystem&&e.ItSystem.Name?e.ItSystem.Disabled?e.ItSystem.Name+" (Slettes)":e.ItSystem.Name:""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Version",title:"Version",width:150,persistId:"version",excelTemplate:function(e){return e&&e.Version||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LocalCallName",title:"Lokal kaldenavn",width:150,persistId:"localname",excelTemplate:function(e){return e&&e.LocalCallName||""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ResponsibleUsage.OrganizationUnit.Name",title:"Ansv. organisationsenhed",width:190,persistId:"orgunit",template:function(e){return e.ResponsibleUsage?e.ResponsibleUsage.OrganizationUnit.Name:""},filterable:{cell:{showOperators:!1,template:this.orgUnitDropDownList}}},{field:"ItSystem.BusinessType.Name",title:"Forretningstype",width:150,persistId:"busitype",template:function(e){return e.ItSystem.BusinessType?e.ItSystem.BusinessType.Name:""},attributes:{class:"might-overflow"},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ItSystem.AppTypeOption.Name",title:"Applikationstype",width:150,persistId:"apptype",template:function(e){return e.ItSystem.AppTypeOption?e.ItSystem.AppTypeOption.Name:""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ItSystem.TaskRefs.TaskKey",title:"KLE ID",width:150,persistId:"taskkey",template:function(e){return e.ItSystem.TaskRefs.length>0?t._.map(e.ItSystem.TaskRefs,"TaskKey").join(", "):""},attributes:{class:"might-overflow"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"startswith"}},sortable:!1},{field:"ItSystem.TaskRefs.Description",title:"KLE navn",width:150,persistId:"klename",template:function(e){return e.ItSystem.TaskRefs.length>0?t._.map(e.ItSystem.TaskRefs,"Description").join(", "):""},attributes:{class:"might-overflow"},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}},sortable:!1},{field:"Reference.Title",title:"Reference",width:150,persistId:"ReferenceId",template:function(e){var t=e.Reference;return null!=t?t.URL?'<a target="_blank" style="float:left;" href="'+t.URL+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-left"},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Reference.ExternalReferenceId",title:"Mappe ref",width:150,persistId:"folderref",template:function(e){var t=e.Reference;return null!=t?t.ExternalReferenceId?'<a target="_blank" style="float:left;" href="'+t.ExternalReferenceId+'">'+t.Title+"</a>":t.Title:""},attributes:{class:"text-center"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"DataLevel",title:"Datatype",width:150,persistId:"dataLevel",template:function(e){switch(e.DataLevel){case"PERSONALDATA":return"Persondata";case"PERSONALDATANDSENSITIVEDATA":return"Persondata og følsomme persondata";default:return"Ingen persondata"}},attributes:{class:"might-overflow"},hidden:!0,filterable:{cell:{template:function(e){e.element.kendoDropDownList({dataSource:[{type:"Ingen persondata",value:"NONE"},{type:"Persondata",value:"PERSONALDATA"},{type:"Persondata og følsomme persondata",value:"PERSONALDATANDSENSITIVEDATA"}],dataTextField:"type",dataValueField:"value",valuePrimitive:!0})},showOperators:!1}}},{field:"MainContract",title:"Kontrakt",width:120,persistId:"contract",template:function(e){return e.MainContract&&e.MainContract.ItContract&&e.MainContract.ItContract.Name?t.isContractActive(e.MainContract.ItContract)?'<a data-ui-sref="it-system.usage.contracts({id: '+e.Id+'})"><span class="fa fa-file text-success" aria-hidden="true"></span></a>':'<a data-ui-sref="it-system.usage.contracts({id: '+e.Id+'})"><span class="fa fa-file-o text-muted" aria-hidden="true"></span></a>':""},excelTemplate:function(e){return e&&e.MainContract&&e.MainContract.ItContract?t.isContractActive(e.MainContract.ItContract).toString():""},attributes:{class:"text-center"},sortable:!1,filterable:{cell:{showOperators:!1,template:this.contractFilterDropDownList}}},{field:"MainContract.ItContract.Supplier.Name",title:"Leverandør",width:175,persistId:"supplier",template:function(e){return e.MainContract&&e.MainContract.ItContract&&e.MainContract.ItContract.Supplier&&e.MainContract.ItContract.Supplier.Name||""},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ItProjects",title:"IT Projekt",width:150,persistId:"sysusage",template:function(e){return e.ItProjects.length>0?t._.first(e.ItProjects).Name:""},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ObjectOwner.Name",title:"Taget i anvendelse af",width:150,persistId:"ownername",template:function(e){return e.ObjectOwner.Name+" "+e.ObjectOwner.LastName},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LastChangedByUser.Name",title:"Sidst redigeret: Bruger",width:150,persistId:"lastchangedname",template:function(e){return e.LastChangedByUser.Name+" "+e.LastChangedByUser.LastName},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LastChanged",title:"Sidste redigeret: Dato",format:"{0:dd-MM-yyyy}",width:150,persistId:"changed",excelTemplate:function(e){return e&&e.LastChanged?t.moment(e.LastChanged).format("DD-MM-YYYY"):""},hidden:!0,filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"Concluded",title:"Ibrugtagningsdato",format:"{0:dd-MM-yyyy}",width:150,persistId:"concludedSystemFrom",hidden:!1,filterable:{operators:{date:{eq:"Lig med",gte:"Fra og med",lte:"Til og med"}}}},{field:"ArchiveDuty",title:"Arkiveringspligt",width:160,persistId:"ArchiveDuty",template:function(e){switch(e.ArchiveDuty){case 1:return"B";case 2:return"K";case 3:return"Ved ikke";default:return""}},excelTemplate:function(e){switch(e.ArchiveDuty){case 1:return"B";case 2:return"K";case 3:return"Ved ikke";default:return""}},hidden:!1,filterable:{cell:{template:function(e){e.element.kendoDropDownList({dataSource:[{type:"B",value:1},{type:"K",value:2},{type:"Ved ikke",value:3}],dataTextField:"type",dataValueField:"value",valuePrimitive:!0})},showOperators:!1}}},{field:"Registertype",title:"Er dokumentbærende",width:160,persistId:"Registertype",template:function(e){return e.Registertype?"Ja":"Nej"},hidden:!1,filterable:{cell:{template:function(e){e.element.kendoDropDownList({dataSource:[{type:"Ja",value:!0},{type:"Nej",value:!1}],dataTextField:"type",dataValueField:"value",valuePrimitive:!0})},showOperators:!1}}},{field:"EndDate",title:"Journalperiode slutdato",format:"{0:dd-MM-yyyy}",width:180,persistId:"ArchivePeriodsEndDate",template:function(e){if(!e||!e.ArchivePeriods)return"";var n;return _.each(e.ArchivePeriods,function(e){moment().isBetween(moment(e.StartDate).startOf("day"),moment(e.EndDate).endOf("day"),null,"[]")&&(!n||n.StartDate>e.StartDate)&&(n=e)}),n?t.moment(n.EndDate).format("DD-MM-YYYY"):""},hidden:!0,filterable:!1,sortable:!1},{field:"RiskSupervisionDocumentationUrlName",title:"Risikovurdering",width:150,persistId:"riskSupervisionDocumentationUrlName",template:function(e){return null!=e.RiskSupervisionDocumentationUrl&&null!=e.RiskSupervisionDocumentationUrlName?'<a href="'+e.RiskSupervisionDocumentationUrl+'">'+e.RiskSupervisionDocumentationUrlName+"</a>":null!=e.RiskSupervisionDocumentationUrl&&null==e.RiskSupervisionDocumentationUrlName?'<a href="'+e.RiskSupervisionDocumentationUrl+'">'+e.RiskSupervisionDocumentationUrl+"</a>":null!=e.RiskSupervisionDocumentationUrlName?e.RiskSupervisionDocumentationUrlName:""},attributes:{class:"text-left"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LinkToDirectoryUrlName",title:"Fortegnelse",width:150,persistId:"LinkToDirectoryUrlName",template:function(e){return null!=e.LinkToDirectoryUrl&&null!=e.LinkToDirectoryUrlName?'<a href="'+e.LinkToDirectoryUrl+'">'+e.LinkToDirectoryUrlName+"</a>":null!=e.LinkToDirectoryUrl&&null==e.LinkToDirectoryUrlName?'<a href="'+e.LinkToDirectoryUrl+'">'+e.LinkToDirectoryUrl+"</a>":null!=e.LinkToDirectoryUrlName?e.LinkToDirectoryUrlName:""},attributes:{class:"text-left"},hidden:!0,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ItContractDataHandler",title:"Databehandleraftale",width:150,persistId:"ItContractDataHandler",template:function(e){return null!=e.Contracts&&(e.Contracts.some(function(e){return null!==e.ItContract.ContractType&&"Databehandleraftale"===e.ItContract.ContractType.Name})||e.Contracts.some(function(e){return null!==e.ItContract.AssociatedAgreementElementTypes&&e.ItContract.AssociatedAgreementElementTypes.some(function(e){return"Databehandleraftale"===e.AgreementElementType.Name})}))?"Ja":"Nej"},attributes:{class:"text-left"},hidden:!0,filterable:!1,sortable:!1}]},r=this._.findIndex(n.columns,{persistId:"orgunit"})+1;this._.forEachRight(this.systemRoles,function(i){var a={field:"role"+i.Id,title:i.Name,persistId:"role"+i.Id,template:function(e){var n="";return void 0===e.roles[i.Id]?n:(n=t.concatRoles(e.roles[i.Id]),"<a data-ui-sref='it-system.usage.roles({id: "+e.Id+"})'>"+n+"</a>")},excelTemplate:function(e){return e&&void 0!==e.roles[i.Id]?t.concatRoles(e.roles[i.Id]):""},width:145,hidden:!("Systemejer"===i.Name),sortable:!1,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}};n.columns.splice(r,0,a)}),this.mainGridOptions=n},e.prototype.concatRoles=function(e){var t="";return e.length>0&&(t=e.slice(0,4).join(", ")),e.length>5&&(t+=", ..."),t},e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.prototype.isContractActive=function(e){if(!e.Active){var t=moment(),n=e.Concluded?moment(e.Concluded,"YYYY-MM-DD").startOf("day"):moment().startOf("day"),r=e.ExpirationDate?moment(e.ExpirationDate,"YYYY-MM-DD").endOf("day"):this.moment("9999-12-30","YYYY-MM-DD").endOf("day");if(e.Terminated){var i=moment(e.Terminated,"YYYY-MM-DD").endOf("day");return e.TerminationDeadline&&i.add(e.TerminationDeadline.Name,"months"),t.isBetween(n,i,null,"[]")}return t.isBetween(n,r,null,"[]")}return e.Active},e.$inject=["$rootScope","$scope","$http","$timeout","$window","$state","$","_","moment","notify","systemRoles","user","gridStateService","orgUnits","needsWidthFixService"],e}();e.OverviewController=t,angular.module("app").config(["$stateProvider",function(e){e.state("it-system.overview",{url:"/overview",templateUrl:"app/components/it-system/it-system-overview.view.html",controller:t,controllerAs:"systemOverviewVm",resolve:{systemRoles:["$http",function(e){return e.get("odata/LocalItSystemRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],user:["userService",function(e){return e.getUser()}],orgUnits:["$http","user","_",function(e,t,n){return e.get("/odata/Organizations("+t.currentOrganizationId+")/OrganizationUnits").then(function(e){return n.addHierarchyLevelOnFlatAndSort(e.data.value,"Id","ParentId")})}]}})}])}(e.Overview||(e.Overview={}))}(e.ItSystem||(e.ItSystem={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system",{url:"/system",abstract:!0,template:'<ui-view autoscroll="false" />',resolve:{user:["userService",function(e){return e.getUser()}]},controller:["$rootScope","$http","$state","$uibModal","notify","user","$scope","$timeout",function(e,t,n,r,i,a,o,s){function l(){if(confirm("Er du sikker på at du vil fjerne den lokale anvendelse af systemet? Dette sletter ikke systemet, men vil slette alle lokale detaljer vedrørende anvendelsen.")){var e=n.params.id,r=i.addInfoMessage("Sletter IT System anvendelsen...",!1);t.delete("api/itSystemUsage/"+e+"?organizationId="+a.currentOrganizationId).success(function(e){r.toSuccessMessage("IT System anvendelsen er slettet!"),n.go("it-system.overview")}).error(function(e,t){401===t?r.toErrorMessage("Fejl! Du har ikke tilladelse!"):r.toErrorMessage("Fejl! Kunne ikke slette IT System anvendelsen!")})}}function c(){if(confirm("Er du sikker på du vil slette snitfladen?")){var e=n.params.id,r=i.addInfoMessage("Sletter Snitflade...",!1);t.delete("api/itinterface/"+e+"?organizationId="+a.currentOrganizationId).success(function(e){r.toSuccessMessage("Snitflade er slettet!"),n.go("it-system.interfaceCatalog")}).error(function(e,t){409==t?r.toErrorMessage("Fejl! Kan ikke slette snitflade, den er tilknyttet et IT System, som er i lokal anvendelse!"):401===t?r.toErrorMessage("Fejl! Du har ikke tilladelse!"):r.toErrorMessage("Fejl! Kunne ikke slette Snitfladen!")})}}e.page.title="IT System",e.page.subnav=[{state:"it-system.overview",text:"IT Systemer"},{state:"it-system.catalog",text:"IT System katalog"},{state:"it-system.interfaceCatalog",text:"Snitflade katalog"},{state:"it-system.edit",text:"IT System",showWhen:"it-system.edit"},{state:"it-system.usage",text:"IT System anvendelse",showWhen:"it-system.usage"},{state:"it-system.interface-edit",text:"Snitflade",showWhen:"it-system.interface-edit"}],e.page.subnav.buttons=[{func:l,text:"Fjern anvendelse",style:"btn-danger",showWhen:"it-system.usage"},{func:c,text:"Slet Snitflade",style:"btn-danger",showWhen:"it-system.interface-edit"}],e.subnavPositionCenter=!1,o.$on("$viewContentLoaded",function(){e.positionSubnav()})}]})}])}(angular,app),function(e,t){"use strict";t.directive("unique",["$http","userService",function(e,t){return{require:"ngModel",link:function(n,r,i,a){var o;t.getUser().then(function(e){o=e});var s=_.debounce(function(t){e.get(i.unique+"?checkname="+t+"&orgId="+o.currentOrganizationId).success(function(){a.$setValidity("available",!0),a.$setValidity("lookup",!0)}).error(function(e,t){409==t?a.$setValidity("available",!1):a.$setValidity("lookup",!1)})},500);a.$parsers.unshift(function(e){return s(e),e})}}}])}(angular,app),function(e,t){"use strict";t.directive("uniqueItInterfaceIdName",["$http","userService","$q",function(e,t,n){return{require:"ngModel",link:function(r,i,a,o){var s;t.getUser().then(function(t){s=t,o.$asyncValidators.uniqueConstraint=function(t){var i=n.defer(),a=r.createForm.name.$viewValue,o=r.createForm.itInterfaceId.$viewValue;return e.get("/api/itinterface?checkitinterfaceid="+o+"&checkname="+a+"&orgId="+s.currentOrganizationId).success(function(e){r.uniqueConstraintError=!1,i.resolve()}).error(function(e){r.uniqueConstraintError=!0,i.reject()}),i.promise}})}}}])}(angular,app),function(e,t){"use strict";t.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,n,r){var i=e(r.fileModel),a=i.assign;n.bind("change",function(){t.$apply(function(){a(t,n[0].files[0])})})}}}])}(angular,app);var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function e(e,t,n,r,i,a,o){var s=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.notify=r,this.userService=i,this.currentUser=a,this.org=o,e.page.title="Ny organisation",this.title="Opret organisation",this.org={},this.org.AccessModifier="1",this.org.TypeId=2,this.org.Cvr=null,this.userService.getUser().then(function(e){s.currentUser=e}).catch(function(e){s.notify.addErrorMessage("Brugeren blev ikke fundet!")})}return e.prototype.dismiss=function(){this.$scope.$dismiss()},e.prototype.submit=function(){var e=this,t={Id:this.currentUser.currentOrganizationId,ObjectOwnerId:this.currentUser.id,Name:this.org.Name,TypeId:this.org.TypeId,AccessModifier:this.org.AccessModifier,Cvr:this.org.Cvr};this.$http.post("odata/Organizations",t).success(function(t){2===e.org.TypeId?e.notify.addSuccessMessage("Organisationen "+t.Name+" er blevet oprettet med "+e.currentUser.fullName+" som lokal admin."):e.notify.addSuccessMessage("Organisationen "+t.Name+" er blevet oprettet!"),e.$scope.$close(!0)}).error(function(t){e.notify.addErrorMessage("Organisationen "+e.org.Name+" kunne ikke oprettes!")})},e.$inject=["$rootScope","$scope","$http","notify","userService"],e}();t.CreateOrganizationController=n,angular.module("app").config(["$stateProvider",function(t){t.state("local-config.org.create",{url:"/create",authRoles:[e.Models.OrganizationRole.LocalAdmin],onEnter:["$state","$stateParams","$uibModal",function(e,t,r){r.open({size:"lg",templateUrl:"app/components/local-config/local-admin-organization-modal.view.html",windowClass:"modal fade in",controller:n,controllerAs:"ctrl"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(t.Organization||(t.Organization={}))}(e.LocalAdmin||(e.LocalAdmin={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function e(e,t,n,r,i,a){this.$rootScope=e,this.$scope=t,this.$http=n,this.notify=r,this.org=i,this.user=a,e.page.title="Rediger organisation",t.title="Rediger organisation"}return e.prototype.dismiss=function(){this.$scope.$dismiss()},e.prototype.submit=function(){var e=this,t={name:this.org.name,accessModifier:this.org.accessModifier,cvr:this.org.cvr,typeId:this.org.typeId};this.$http({method:"PATCH",url:"api/organization/"+this.org.id+"?organizationId="+this.user.currentOrganizationId,data:t}).then(function(t){e.notify.addSuccessMessage("Ændringerne er blevet gemt!"),e.$scope.$close(!0)},function(t){e.notify.addErrorMessage("Ændringerne kunne ikke gemmes!")})},e.$inject=["$rootScope","$scope","$http","notify","org","user"],e}();t.EditOrganizationController=n,angular.module("app").config(["$stateProvider",function(t){t.state("local-config.org.edit",{url:"/edit/:id",authRoles:[e.Models.OrganizationRole.LocalAdmin],onEnter:["$state","$stateParams","$uibModal",function(e,t,r){r.open({size:"lg",templateUrl:"app/components/local-config/local-admin-organization-modal.view.html",windowClass:"modal fade in",resolve:{org:["$http",function(e){return e.get("api/organization/"+t.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser()}]},controller:n,controllerAs:"ctrl"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(t.Organization||(t.Organization={}))}(e.LocalAdmin||(e.LocalAdmin={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("local-config.contract",{url:"/contract",templateUrl:"app/components/local-config/local-config-contract.view.html",authRoles:[Kitos.Models.OrganizationRole.LocalAdmin]})}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r){switch(this.$scope=e,this.$http=t,this.notify=n,this.organization=r,r.typeId){case 1:this.typeName="Kommune";break;case 2:this.typeName="Interessefællesskab";break;case 3:this.typeName="Virksomhed";break;case 4:this.typeName="Anden offentlig myndighed"}this.orgAutosaveUrl="api/organization/"+r.id}return e.$inject=["$scope","$http","notify","organization"],e}();e.CurrentOrganizationController=t,angular.module("app").config(["$stateProvider",function(e){e.state("local-config.current-org",{url:"/current-org",templateUrl:"app/components/local-config/local-config-current-org.view.html",controller:t,controllerAs:"currentOrgCtrl",resolve:{organization:["$http","userService",function(e,t){return t.getUser().then(function(t){return e.get("api/organization/"+t.currentOrganizationId).then(function(e){return e.data.response})})}]}})}])}(e.Organization||(e.Organization={}))}(e.LocalAdmin||(e.LocalAdmin={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l){var c=this;this.$uibModalInstance=e,this.$stateParams=t,this.$http=n,this.notify=r,this.reportService=i,this._=a,this.optionsUrl=o,this.optionId=s,this.optionType=l,this.initModal=function(e,t){c.pageTitle="Redigér",c.$http.get(t+"("+e+")").then(function(e){var t=e.data;c.optionName=t.Name,c.description=t.Description})},this.optionsUrl=this.$stateParams.optionsUrl,this.optionId=this.$stateParams.id,this.optionType=this.$stateParams.optionType,this.initModal(this.optionId,this.optionsUrl)}return e.prototype.ok=function(){var e=this,t={Description:this.description};this.$http.patch(this.optionsUrl+"("+this.optionId+")",t).then(function(t){e.$uibModalInstance.close(),e.notify.addSuccessMessage("Værdien blev redigeret.")}).catch(function(t){e.notify.addErrorMessage("Værdien blev ikke redigeret.")})},e.prototype.cancel=function(){this.$uibModalInstance.close()},e.prototype.resetDescription=function(){this.$http.patch(this.optionsUrl+"("+this.optionId+")",{Description:null}),this.$uibModalInstance.close()},e.$inject=["$uibModalInstance","$stateParams","$http","notify","_"],e}();e.LocalOptionsController=t,angular.module("app").config(["$stateProvider",function(e){e.state("local-config.current-org.edit-current-org-roles",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-organisation-roles",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/local-config/local-config-option-edit.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("local-config.project.edit-project-roles",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-project-roles",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/local-config/local-config-option-edit.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("local-config.system.edit-system-roles",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-system-roles",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/local-config/local-config-option-edit.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("local-config.contract.edit-contract-roles",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-contract-roles",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/local-config/local-config-option-edit.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("local-config.project.edit-project-types",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-project-types",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/local-config/local-config-option-edit.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("local-config.system.edit-system-types",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-system-types",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/local-config/local-config-option-edit.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]}).state("local-config.contract.edit-contract-types",{url:"/{:optionsUrl}/{id:int}/{:optionType}/edit-contract-types",onEnter:["$state","$stateParams","$uibModal",function(e,n,r){r.open({templateUrl:"app/components/local-config/local-config-option-edit.modal.view.html",windowClass:"modal fade in",controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(e.LocalOptions||(e.LocalOptions={}))}(e.LocalAdmin||(e.LocalAdmin={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function e(e,t,n,r,i){function a(e){e.element.kendoAutoComplete({noDataTemplate:""})}var o=this;this.$scope=e,this.$http=t,this.notify=n,this.$timeout=r,this._=i,this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(o.exportFlag){o.exportFlag=!1,o._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,
e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],s=0;s<i.cells.length;s++)if(""!==t[s].field){var l=i.cells[s],c=o.getTemplateMethod(t[s]);l.value=c(a)}kendo.ui.progress(o.mainGrid.element,!1)}else e.preventDefault(),o._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),o.$timeout(function(){o.exportFlag=!0,e.sender.saveAsExcel()})},this.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:"/odata/Organizations?$expand=Type",dataType:"json"}},sort:{field:"Name",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0},toolbar:[{name:"opretOrganisation",text:"Opret Organisation",template:"<a ui-sref='local-config.org.create' class='btn btn-success pull-right'>#: text #</a>"},{name:"excel",text:"Eksportér til Excel",className:"pull-right"}],excel:{fileName:"Organisationer.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},editable:!0,reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:!0,height:window.innerHeight-200,excelExport:this.exportToExcel,columns:[{field:"Name",title:"Navn",width:230,persistId:"name",hidden:!1,excelTemplate:function(e){return e.Name},filterable:{cell:{template:a,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Cvr",title:"CVR",width:230,persistId:"cvr",hidden:!1,excelTemplate:function(e){return e.Cvr},filterable:{cell:{template:a,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Type.Name",title:"Type",width:230,persistId:"type",hidden:!1,template:function(e){return e.Type.Name},excelTemplate:function(e){return e.Type.Name},filterable:{cell:{template:function(e){e.element.kendoDropDownList({dataSource:[{type:"Kommune",value:"Kommune"},{type:"Interessefællesskab",value:"Interessefællesskab"},{type:"Virksomhed",value:"Virksomhed"},{type:"Anden offentlig myndighed",value:"Anden offentlig myndighed"}],dataTextField:"type",dataValueField:"value",valuePrimitive:!0})},showOperators:!1}}},{field:"AccessModifier",title:"Synlighed",width:230,persistId:"synlighed",hidden:!1,template:'<display-access-modifier value="dataItem.AccessModifier"></display-access-modifier>',excelTemplate:function(e){return e.AccessModifier.toString()},filterable:{cell:{template:function(e){e.element.kendoDropDownList({dataSource:[{type:"Lokal",value:"Local"},{type:"Offentlig",value:"Public"}],dataTextField:"type",dataValueField:"value",valuePrimitive:!0})},showOperators:!1}}}]}}return e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.$inject=["$scope","$http","notify","$timeout","_"],e}();t.OrganizationController=n,angular.module("app").config(["$stateProvider",function(t){t.state("local-config.org",{url:"/org",templateUrl:"app/components/local-config/local-config-org.view.html",controller:n,controllerAs:"orgCtrl",authRoles:[e.Models.OrganizationRole.LocalAdmin],resolve:{user:["userService",function(e){return e.getUser()}]}})}])}(t.Organization||(t.Organization={}))}(e.LocalAdmin||(e.LocalAdmin={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("local-config.project",{url:"/project",templateUrl:"app/components/local-config/local-config-project.view.html",authRoles:[Kitos.Models.OrganizationRole.LocalAdmin]})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("local-config",{url:"/local-config",abstract:!0,template:'<ui-view autoscroll="false" />',resolve:{user:["$http","userService",function(e,t){return t.getUser().then(function(e){return e})}],config:["user",function(e){return e.currentConfig}]},controller:["$rootScope","$scope","config","user",function(e,t,n,r){e.page.title="Konfiguration",e.page.subnav=[{state:"local-config.current-org",text:r.currentOrganizationName},{state:"local-config.org",text:"Organisation"},{state:"local-config.project",text:"IT Projekt"},{state:"local-config.system",text:"IT System"},{state:"local-config.contract",text:"IT Kontrakt"},{state:"local-config.import.organization",text:"Masse Opret"}],t.config=n,t.config.autosaveUrl="odata/Configs("+n.id+")",e.subnavPositionCenter=!0,t.$on("$viewContentLoaded",function(){e.positionSubnav()})}]})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("local-config.system",{url:"/system",templateUrl:"app/components/local-config/local-config-system.view.html",authRoles:[Kitos.Models.OrganizationRole.LocalAdmin]})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("organization",{url:"/organization",abstract:!0,template:'<ui-view autoscroll="false" />',resolve:{user:["userService",function(e){return e.getUser()}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/Organization/"+n.currentOrganizationId+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}]},controller:["$rootScope","$scope","$uibModal","$state","user","hasWriteAccess","$timeout",function(e,t,n,r,i,a,o){function s(){1==a&&r.go("organization.user.create")}e.page.title="Organisation";var l=[];i.currentConfig.showTabOverview&&l.push({state:"organization.overview",text:"Overblik"}),l.push({state:"organization.structure",text:"Organisation"}),l.push({state:"organization.user",text:"Brugere"}),l.push({state:"organization.gdpr",text:"Stamdata"}),e.page.subnav=l,e.page.subnav.buttons=[{func:s,text:"Opret Bruger",style:"btn-success",disabled:!a,icon:"glyphicon-plus",showWhen:"organization.user"}],e.subnavPositionCenter=!1,t.$on("$viewContentLoaded",function(){e.positionSubnav()})}]})}])}(angular,app),function(e,t){"use strict";t.directive("uniqueEmailContactperson",["$http","userService","_",function(e,t,n){return{require:"ngModel",link:function(r,i,a,o){var s;t.getUser().then(function(e){s=e});var l=n.debounce(function(n){e.get("/odata/Users/IsEmailAvailable(email='"+n+"')").then(function(e){e.data.value?(t.get,r._emailExists=!1,o.$setValidity("available",!0),o.$setValidity("lookup",!0)):r._emailExists=!0},function(){o.$setValidity("lookup",!1)})},500);o.$parsers.unshift(function(e){return l(e),e})}}}])}(angular,app),function(e,t){"use strict";t.directive("uniqueEmail",["$http","userService","_",function(e,t,n){return{require:"ngModel",link:function(r,i,a,o){var s;t.getUser().then(function(e){s=e});var l=n.debounce(function(t){e.get("/odata/Users/IsEmailAvailable(email='"+t+"')").then(function(e){e.data.value?(r.emailExists=!1,o.$setValidity("available",!0),o.$setValidity("lookup",!0)):r.emailExists=!0},function(){o.$setValidity("lookup",!1)})},500);o.$parsers.unshift(function(e){return l(e),e})}}}])}(angular,app),function(e,t){"use strict";t.directive("uniqueOrgUser",["$http","userService","_",function(e,t,n){return{require:"ngModel",link:function(r,i,a,o){var s;t.getUser().then(function(e){s=e});var l=n.debounce(function(t){e.get("/odata/Organizations("+s.currentOrganizationId+")/Rights?$filter=User/Email eq '"+t+"'&$select=Role").then(function(e){n.isEmpty(e.data.value)?(o.$setValidity("lookup",!0),r.userExists=!1):(o.$setValidity("lookup",!0),r.userExists=!0)},function(){o.$setValidity("lookup",!1)})},500);o.$parsers.unshift(function(e){return l(e),e})}}}])}(angular,app);var Kitos;!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d){var u=this;this.$uibModalInstance=e,this.$stateParams=t,this.$http=n,this.$scope=r,this.$state=i,this.$window=a,this.notify=o,this.reportService=s,this._=l,this.user=c,this.globalConfigs=d,this.init=function(e){u.reportId=e,0===e?(u.title="Opret rapport",u.accessModifier="Local"):u.title="Redigér rapport",u.reportService.getReportCategories().then(function(t){u.categories=t.data.value,e>0&&u.reportService.GetById(e).then(function(e){var t=e.data;u.name=t.Name,u.description=t.Description,u.categoryTypeId=t.CategoryTypeId,u.accessModifier=t.AccessModifier,0==u.categoryTypeId?u.selectedCategory=u.categories[0]:u.selectedCategory=u._.find(u.categories,function(e){if(e.Id===t.CategoryTypeId)return e})})})},("true"===l.find(d,function(e){return"CanGlobalAdminOnlyEditReports"===e.key}).value?c.isGlobalAdmin:c.isGlobalAdmin||c.isLocalAdmin||c.isReportAdmin)||(i.go("^"),a.location.reload()),this.init(t.id)}return e.prototype.ok=function(){var e=this;if(this.selectedCategory&&(this.categoryTypeId=this.selectedCategory.Id),0===this.reportId){var t={Id:0,Name:this.name,Description:this.description,CategoryTypeId:this.categoryTypeId,AccessModifier:this.accessModifier};this.$http.post("/odata/reports",t).then(function(t){e.$uibModalInstance.close()})}else{var t={Name:this.name,Description:this.description,CategoryTypeId:this.categoryTypeId,AccessModifier:this.accessModifier};this.$http.patch("/odata/reports("+this.reportId+")",t).then(function(t){e.$uibModalInstance.close()})}},e.prototype.cancel=function(){this.$uibModalInstance.close()},e.$inject=["$uibModalInstance","$stateParams","$http","$scope","$state","$window","notify","reportService","_","user","globalConfigs"],e}();e.EditReportController=t,angular.module("app").config(["$stateProvider",function(e){e.state("reports.overview.report-edit",{url:"/{id:int}/edit",onEnter:["$state","$stateParams","$uibModal","$rootScope",function(e,n,r,i){r.open({templateUrl:"app/components/reports/report-edit.modal.view.html",windowClass:"modal fade in",resolve:{user:["userService",function(e){return e.getUser()}],globalConfigs:["$http",function(e){return e.get("odata/GlobalConfigs").then(function(e){return e.data.value})}]},controller:t,controllerAs:"vm"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(e.Reports||(e.Reports={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g,m,h){var v=this;this.$rootScope=e,this.$scope=t,this.$http=n,this.$timeout=r,this.$window=i,this.$state=a,this.$=o,this._=s,this.moment=l,this.notify=c,this.user=d,this.reports=u,this.$confirm=p,this.globalConfigs=f,this.gridStateService=g,this.reportCategoryTypes=m,this.needsWidthFixService=h,this.storageKey="report-overview-options",this.gridState=this.gridStateService.getService(this.storageKey),this.onEdit=function(e){e.preventDefault();var t=v.mainGrid.dataItem(v.$(e.currentTarget).closest("tr")),n=t.Id;v.$state.go("reports.overview.report-edit",{id:n})},this.onCreate=function(){v.$state.go("reports.overview.report-edit",{id:0})},this.onDelete=function(e){e.preventDefault(),v.$confirm({text:"Ønsker du at slette rapporten?",title:"Slet rapport",ok:"Ja",cancel:"Nej"}).then(function(){var t=v.mainGrid.dataItem(v.$(e.currentTarget).closest("tr"));v.mainGrid.dataSource.remove(t),v.mainGrid.dataSource.sync()})},this.getAccessModifier=function(){return[{Id:0,Name:"Lokal"},{Id:1,Name:"Offentlig"}]},this.saveGridOptions=function(){v.gridState.saveGridOptions(v.mainGrid)},this.saveGridProfile=function(){v.gridState.saveGridProfile(v.mainGrid),v.notify.addSuccessMessage("Filtre og sortering gemt")},this.doesGridProfileExist=function(){return v.gridState.doesGridProfileExist()},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(v.exportFlag){v.exportFlag=!1,v._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=v.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(v.mainGrid.element,!1),v.needsWidthFixService.fixWidth()}else e.preventDefault(),v._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),v.$timeout(function(){v.exportFlag=!0,e.sender.saveAsExcel()})},this.accessModFilter=function(e){function t(){var e=this,t=i.filter();switch(r._.findKeyDeep(t,{field:"AccessModifier"}).value){case"Kitos.AccessModifier0":e.select(1);break;case"Kitos.AccessModifier1":e.select(2);break;default:e.select(0)}}function n(){var e=this,t=r.mainGrid.dataSource,n=e.value(),i=t.filter(),a=r._.removeFiltersForField(i,"AccessModifier");n&&(a=r._.addFilter(a,"AccessModifier","eq",n,"and")),t.filter(a)}var r=v,i=e.dataSource;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:[{value:"Kitos.AccessModifier0",text:"Lokal"},{value:"Kitos.AccessModifier1",text:"Offentlig"}],dataTextField:"text",dataValueField:"value",optionLabel:"Vælg filter...",dataBound:t,change:n})},this.$rootScope.page.title="Rapport Oversigt";var y=s.find(this.globalConfigs,function(e){return"CanGlobalAdminOnlyEditReports"===e.key});this.canCreate="true"===y.value?d.isGlobalAdmin:d.isGlobalAdmin||d.isLocalAdmin||d.isReportAdmin,!d.isGlobalAdmin&&d.isReadOnly&&(this.canCreate=!1),this.categoryTypeValues=[];var I=this;this._.each(this.reportCategoryTypes,function(e){I.categoryTypeValues.push({text:e.Name,value:e.Id})}),t.$on("kendoWidgetCreated",function(e,t){v.loadGridOptions(),v.mainGrid.dataSource.read();var n=o(".k-filter-row [data-field='AccessModifier']"),r=n.find("input").data("kendoDropDownList");n.find("button").on("click",function(){r.select(0)}),o(".k-grid-excel").click(function(){kendo.ui.progress(v.mainGrid.element,!0)})}),this.setupGrid()}return e.prototype.setupGrid=function(){function e(e){e.element.kendoAutoComplete({noDataTemplate:""})}var t=this,n="odata/reports",r={type:"odata-v4",transport:{read:{url:function(){return n+"?$expand=CategoryType,Organization,LastChangedByUser($select=Id,Name,LastName)"},dataType:"json"},update:{url:function(e){return n+"("+e.Id+")"},beforeSend:function(e){e.setRequestHeader("Prefer","return=representation")},type:"PATCH",dataType:"json"},destroy:{url:function(e){return n+"("+e.Id+")"},type:"DELETE",dataType:"json"},create:{url:n,type:"POST",dataType:"json"},parameterMap:function(e,t){var n=kendo.data.transports["odata-v4"].parameterMap(e,t);if(n){if(n.$filter&&(n.$filter=n.$filter.replace(/('Kitos\.AccessModifier([0-9])')/,"Kitos.AccessModifier'$2'")),"read"==t&&(n.$count=!0),"update"===t){var r=e,i={Name:r.Name,Description:r.Description,CategoryTypeId:r.CategoryTypeId,AccessModifier:r.AccessModifier};return JSON.stringify(i)}if("create"===t){var r=e,i={Id:0,Name:r.Name,Description:r.Description,CategoryTypeId:r.CategoryTypeId,AccessModifier:r.AccessModifier};return JSON.stringify(i)}}return n}},sort:{field:"Name",dir:"asc"},batch:!1,sync:!1,columnMenu:!0,serverPaging:!0,serverSorting:!0,serverFiltering:!0,groupable:!1,pageSize:20,schema:{model:{id:"Id",fields:{Id:{editable:!1,nullable:!0},Name:{editable:!0,validation:{required:!0}},Description:{editable:!0,validation:{required:!0}},AccessModifier:{type:"string"},CategoryTypeId:{type:"number"}}}}};this.mainGridOptions={autoBind:!1,dataBinding:function(e){for(var n=t.user.currentOrganizationId,r=0;r<e.items.length;r++)e.items[r].canEdit=t.user.isGlobalAdmin||t.canCreate&&e.items[r].OrganizationId==n},dataSource:r,editable:!0,toolbar:[{name:"createReport",template:'<button type="button" class="btn btn-success pull-right" title="Opret rapport" data-ng-click="vm.onCreate()" data-ng-disabled="!vm.canCreate">Opret rapport</button>'},{name:"clearFilter",text:"Nulstil",template:"<button type='button' class='k-button k-button-icontext' title='Nulstil sortering, filtering og kolonnevisning, -bredde og –rækkefølge' data-ng-click='vm.clearOptions()'>#: text #</button>"},{name:"saveFilter",text:"Gem filter",template:'<button type="button" class="k-button k-button-icontext" title="Gem filtre og sortering" data-ng-click="vm.saveGridProfile()">#: text #</button>'},{name:"useFilter",text:"Anvend filter",template:'<button type="button" class="k-button k-button-icontext" title="Anvend gemte filtre og sortering" data-ng-click="vm.loadGridProfile()" data-ng-disabled="!vm.doesGridProfileExist()">#: text #</button>'},{name:"deleteFilter",text:"Slet filter",template:"<button type='button' class='k-button k-button-icontext' title='Slet filtre og sortering' data-ng-click='vm.clearGridProfile()' data-ng-disabled='!vm.doesGridProfileExist()'>#: text #</button>"}],excel:{fileName:"Rapport Overblik.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,groupable:!1,filterable:{mode:"row"},columnMenu:!0,height:window.innerHeight-200,dataBound:this.saveGridOptions,columnResize:this.saveGridOptions,columnHide:this.saveGridOptions,columnShow:this.saveGridOptions,columnReorder:this.saveGridOptions,excelExport:this.exportToExcel,columns:[{field:"Name",persistId:"name",title:"Navn",width:150,template:function(e){return e.Id?"<a href='appReport/?id="+e.Id+"' target='_blank'>"+e.Name+"</a>":""},excelTemplate:function(e){return e.Name},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Description",persistId:"desc",title:"Beskrivelse",width:"250px",excelTemplate:function(e){return e.Description},filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"CategoryTypeId",persistId:"catTypeId",title:"Kategori",width:"180px",menu:!1,filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"eq"}},values:this.categoryTypeValues},{field:"AccessModifier",persistId:"accessModifier",title:"Synlighed",width:"150px",template:'<display-access-modifier value="dataItem.AccessModifier"></display-access-modifier>',filterable:{cell:{showOperators:!1,template:this.accessModFilter}}},{field:"Organization.Name",persistId:"org",title:"Organisation",width:"60px",filterable:{cell:{template:e,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LastChanged",persistId:"lastChanged",title:"Sidst ændret",width:"60px",type:"date",filterable:!1,template:function(e){return kendo.toString(kendo.parseDate(e.LastChanged),"d")}},{field:"LastChangedByUser.Name",persistId:"lastChangedByUser",title:"Sidst ændret af",width:"150px",filterable:!1,template:function(e){return e.LastChangedByUser.Name+" "+e.LastChangedByUser.LastName}},{title:"Handlinger",persistId:"actions",width:70,filterable:!1,template:function(e){return"<button type='button' class='btn btn-link' title='Redigér rapport' data-ng-click='vm.onEdit($event)' data-ng-disabled='!"+e.canEdit+"'><i class='fa fa-pencil' aria-hidden='true'></i></button><button type='button' class='btn btn-link' title='Slet rapport' data-ng-click='vm.onDelete($event)' data-ng-disabled='!"+e.canEdit+"'><i class='fa fa-minus' aria-hidden='true'></i></button>"}}]}},e.prototype.loadGridOptions=function(){this.user.isReadOnly||this.mainGrid.options.toolbar.push({name:"excel",text:"Eksportér til Excel",className:"pull-right"}),this.gridState.loadGridOptions(this.mainGrid)},e.prototype.loadGridProfile=function(){this.gridState.loadGridProfile(this.mainGrid),this.mainGrid.dataSource.read(),this.notify.addSuccessMessage("Anvender gemte filtre og sortering")},e.prototype.clearGridProfile=function(){this.gridState.removeProfile(),this.gridState.removeSession(),this.notify.addSuccessMessage("Filtre og sortering slettet"),this.reload()},e.prototype.clearOptions=function(){this.gridState.removeProfile(),this.gridState.removeLocal(),this.gridState.removeSession(),this.notify.addSuccessMessage("Sortering, filtering og kolonnevisning, -bredde og –rækkefølge nulstillet"),this.reload()},e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.$inject=["$rootScope","$scope","$http","$timeout","$window","$state","$","_","moment","notify","user","reports","$confirm","globalConfig","gridStateService","reportCategoryTypes","needsWidthFixService"],e}();e.ReportsOverviewController=t,angular.module("app").config(["$stateProvider",function(e){e.state("reports.overview",{url:"/overblik",templateUrl:"app/components/reports/reports-overview.html",controller:t,controllerAs:"vm",resolve:{user:["userService",function(e){return e.getUser()}],reports:["reportService",function(e){return e.GetAll().then(function(e){return e.data.value})}],globalConfig:["$http",function(e){return e.get("/odata/GlobalConfigs").then(function(e){return e.data.value})}],reportCategoryTypes:["reportService",function(e){return e.getReportCategories().then(function(e){return e.data.value})}]}})}])}(e.Overview||(e.Overview={}))}(e.Reports||(e.Reports={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("reports",{url:"/rapporter",abstract:!0,template:'<ui-view autoscroll="false" />',resolve:{user:["userService",function(e){return e.getUser()}]},controller:["$rootScope","$state","user","$scope",function(e,t,n,r){e.page.title="Rapporter";var i=[];i.push({state:"reports.overview",text:"Overblik"}),e.page.subnav=i,e.subnavPositionCenter=!1,r.$on("$viewContentLoaded",function(){e.positionSubnav()})}]})}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){!function(e){e[e.User=0]="User",e[e.LocalAdmin=1]="LocalAdmin",e[e.OrganizationModuleAdmin=2]="OrganizationModuleAdmin",e[e.ProjectModuleAdmin=3]="ProjectModuleAdmin",e[e.SystemModuleAdmin=4]="SystemModuleAdmin",e[e.ContractModuleAdmin=5]="ContractModuleAdmin",e[e.ReportModuleAdmin=6]="ReportModuleAdmin",e[e.ReadOnly=7]="ReadOnly"}(e.OrganizationRole||(e.OrganizationRole={}))}(e.Models||(e.Models={}))}(e.API||(e.API={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){!function(e){e[e.None=0]="None",e[e.Low=1]="Low",e[e.Mid=2]="Mid",e[e.High=3]="High"}(e.ItProjectPriority||(e.ItProjectPriority={}))}(e.ItProject||(e.ItProject={}))}(e.Models||(e.Models={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){e[e.User="User"]="User",e[e.LocalAdmin="LocalAdmin"]="LocalAdmin",e[e.OrganizationModuleAdmin="OrganizationModuleAdmin"]="OrganizationModuleAdmin",e[e.ProjectModuleAdmin="ProjectModuleAdmin"]="ProjectModuleAdmin",e[e.SystemModuleAdmin="SystemModuleAdmin"]="SystemModuleAdmin",e[e.ContractModuleAdmin="ContractModuleAdmin"]="ContractModuleAdmin",e[e.ReportModuleAdmin="ReportModuleAdmin"]="ReportModuleAdmin",e[e.ReadOnly="ReadOnly"]="ReadOnly"}(e.OrganizationRole||(e.OrganizationRole={}))}(e.Models||(e.Models={}))}(Kitos||(Kitos={})),function(e,t){"use strict";t.directive("displayAccessModifier",[function(){return{template:"{{ friendlyName }}",scope:{value:"="},controller:["$scope",function(e){switch(e.value){case Kitos.Models.AccessModifier.Local:e.friendlyName="Lokal";break;case Kitos.Models.AccessModifier.Public:e.friendlyName="Offentlig";break;default:e.friendlyName="Ukendt"}}]}}])}(angular,app),function(e,t){"use strict";t.filter("joinBy",function(){return function(e,t,n){if(t=void 0!==t?t:", ",e=void 0!==e?e:[],n){return _.pluckDeep(e,n).join(t)}return e.join(t)}})}(angular,app),function(e,t){"use strict";t.directive("helpText",[function(){return{templateUrl:"app/shared/helpText/helpText.view.html",scope:{key:"@",defaultTitle:"@",noButtonLayout:"@"},controller:["$scope","$http","$uibModal","$sce",function(e,t,n,r){var i=e;e.showHelpTextModal=function(){n.open({windowClass:"modal fade in",templateUrl:"app/shared/helpText/helpTextModal.view.html",controller:["$scope","$uibModalInstance","notify",function(e,n,a){t.get("odata/HelpTexts?$filter=Key eq '"+i.key+"'").success(function(t){t.value.length?(e.title=t.value[0].Title,e.description=r.trustAsHtml(t.value[0].Description)):(e.title=i.defaultTitle,e.description="Ingen hjælpetekst defineret.")})}]})}}]}}])}(angular,app),function(e,t){t.directive("globalAdvis",[function(){return{templateUrl:"app/shared/globalAdvis/it-advice-global.view.html",scope:{stateName:"@",user:"="},controller:["$scope","$http","$uibModal","$state","$window",function(e,t,n,r,i){e.$watch("stateName",function(t,n){"it-project.overview"===e.stateName||"it-system.overview"===e.stateName||"it-contract.overview"===e.stateName||"it-contract.plan"===e.stateName?e.disableAdvisLink=!1:e.disableAdvisLink=!0});var a=e;e.showAdviceModal=function(){n.open({windowClass:"modal fade in",templateUrl:"app/shared/globalAdvis/it-advice-global.modal.view.html",size:"lg",controller:["$scope","$uibModalInstance","notify",function(e,t,n){var r=moment().format("YYYY-MM-DD"),o="",s="";"it-project.overview"===a.stateName&&(e.title="IT advis - IT Projekter",s="Type eq 'itProject'",o=i.location.href.replace("overview","edit")),"it-contract.overview"!==a.stateName&&"it-contract.plan"!==a.stateName||(e.title="IT advis - IT Kontrakter",s="Type eq 'itContract'",o=i.location.href.replace("overview","edit")),"it-system.overview"===a.stateName&&(e.title="IT advis - IT Systemer",s="Type eq 'itSystemUsage'",o=i.location.href.replace("overview","usage")),e.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:"/Odata/Organizations("+e.user.currentOrganizationId+")/Advice?$filter="+s+" AND StopDate gt "+r+"&$expand=Reciepients, Advicesent",dataType:"json"}},pageSize:10,serverPaging:!0,serverFiltering:!0},selectable:!0,columns:[{field:"Name",title:"Navn",template:function(e){return'<a ng-click="$dismiss()" href="'+o+"/"+e.RelationId+'/advice">'+e.Name+"</a>"},attributes:{class:"might-overflow"}},{field:"SentDate",title:"Sidst sendt",template:function(e){return null!=e.SentDate?kendo.toString(new Date(e.SentDate),"d"):""},attributes:{class:"might-overflow"}},{field:"Id",hidden:!0},{field:"AlarmDate",title:"Start dato",template:function(e){return null!=e.AlarmDate?kendo.toString(new Date(e.AlarmDate),"d"):""},attributes:{class:"might-overflow"}},{field:"StopDate",title:"Slut dato",template:function(e){return null!=e.StopDate?kendo.toString(new Date(e.StopDate),"d"):""},attributes:{class:"might-overflow"}},{field:"Reciepients.Name",title:"Modtager",template:function(){return"<span data-ng-model=\"dataItem.Reciepients\" value=\"cc.Name\" ng-repeat=\"cc in dataItem.Reciepients | filter: { RecieverType: 'RECIEVER'}\"> {{cc.Name}}{{$last ? '' : ', '}}</span>"},attributes:{class:"might-overflow"}},{field:"Reciepients.Name",title:"CC",template:function(){return"<span data-ng-model=\"dataItem.Reciepients\" value=\"cc.Name\" ng-repeat=\"cc in dataItem.Reciepients | filter: { RecieverType: 'CC'}\"> {{cc.Name}}{{$last ? '' : ', '}}</span>"},attributes:{class:"might-overflow"}},{field:"Subject",title:"Emne"}],pageable:{refresh:!0,pageSizes:[10,25,50,100,200],buttonCount:5}}}]})}}]}}])}(angular,app),function(e,t){"use strict";t.directive("kleFilter",["taskService",function(e){return{scope:{selectedGroup:"=kleFilter",hasWriteAccess:"="},templateUrl:"app/shared/kleFilter/kleFilter.view.html",link:function(t,n,r){e.getRoots().then(function(e){t.maingroups=e}),t.maingroupChanged=function(){t.taskList=[],t.selectedSubgroup=null,t.groupChanged(),t.selectedMaingroup&&e.getChildren(t.selectedMaingroup).then(function(e){t.groups=e})},t.groupChanged=function(){t.selectedSubgroup?t.selectedGroup=t.selectedSubgroup:t.selectedMaingroup?t.selectedGroup=t.selectedMaingroup:t.selectedGroup=""}}}}])}(angular,app),angular.module("notify").directive("notify",["$rootScope",function(e){"use strict";return{restrict:"A",template:'<div class="notify">\t<div class="notify-item alert" ng-repeat="message in messages" ng-class="computeClasses(message)">\t\t<button type="button" class="close" ng-click="deleteMessage(message)">&times;</button>       <div ng-bind-html="message.text"></div>\t</div></div>',replace:!1,scope:!0,controller:["$scope","$sce","$timeout","notify",function(t,n,r,i){function a(e){e.closed=!1,t.messages.push(e)}var o=i.onlyUnique();t.messages=[],e.$on("notifyNewMessage",function(e,n){var r;o?(angular.forEach(t.messages,function(e){n.text===e.text&&n.severity===e.severity&&(r=!0)}),r||a(n)):a(n)}),e.$on("notifyDeleteMessage",function(e,n){t.deleteMessage(n)}),t.deleteMessage=function(e){var n=t.messages.indexOf(e);n>-1&&(e.closed=!0,t.messages.splice(n,1))},t.computeClasses=function(e){return{"alert-success":"success"===e.severity,"alert-error":"error"===e.severity,"alert-danger":"error"===e.severity,"alert-info":"info"===e.severity,"alert-warning":"warn"===e.severity}}}]}}]),angular.module("notify").provider("notify",NotifyProvider),function(e,t){"use strict";t.directive("optionList",["$http",function(e){return{scope:{optionsUrl:"@",title:"@"},templateUrl:"app/shared/optionList/optionList.view.html",link:function(t,n,r){t.list=[],e.get(t.optionsUrl+"?nonsuggestions").success(function(e){_.each(e.response,function(e){t.list.push({id:e.id,name:e.name,note:e.note})})})}}}])}(angular,app),function(e,t){"use strict";t.directive("orderBy",[function(){return{scope:{orderBy:"=orderBy",pagination:"=paging"},replace:!0,templateUrl:"app/shared/orderBy/orderBy.view.html",link:function(e,t,n){e.order=function(){e.pagination.skip=0,e.pagination.orderBy==e.orderBy?e.pagination.descending=!e.pagination.descending:(e.pagination.orderBy=e.orderBy,e.pagination.descending=!1)}}}}])}(angular,app),function(e,t){"use strict";t.directive("paginationButtons",[function(){return{scope:{pagination:"=paginationButtons",totalCount:"=paginationTotalCount"},templateUrl:"app/shared/paginationButtons/paginationButtons.view.html",link:function(e,t,n){e.less=function(){e.pagination.skip-=e.pagination.take,e.pagination.skip<0&&(e.pagination.skip=0)},e.more=function(){e.pagination.skip+=e.pagination.take}}}}])}(angular,app),function(e,t){"use strict";t.directive("searchBox",["$timeout",function(e){return{scope:{pagination:"=paging"},replace:!0,templateUrl:"app/shared/searchBox/searchBox.view.html",link:function(t,n,r){function i(){t.pagination.skip=0,t.pagination.search=t.search,a=null}var a=null;t.update=function(){a&&e.cancel(a),a=e(i,200)}}}}])}(angular,app),function(e,t){"use strict";t.directive("selectAccessModifier",[function(){return{priority:1,replace:!0,templateUrl:"app/shared/selectAccessModifier/selectAccessModifier.view.html",controller:["$scope","userService",function(e,t){t.getUser().then(function(t){e.isGlobalAdmin=t.isGlobalAdmin})}]}}])}(angular,app),function(e,t){"use strict";t.directive("selectMultipleOption",[function(){return{templateUrl:"app/shared/selectMultipleOption/selectMultipleOption.view.html",scope:{id:"@",placeholder:"@",options:"&",selectedIds:"=ngModel",selectedTexts:"&",autoSaveUrl:"@",field:"@",disabled:"&ngDisabled"},link:function(e,t,n,r){var i=[];_.forEach(e.selectedIds,function(t,n){!_.some(e.options(),{Id:t})&&i.push({Id:t,Name:e.selectedTexts()[n]})}),e.deletedOptions=i}}}])}(angular,app),function(e,t){"use strict";t.directive("selectMultipleRecievers",[function(){return{templateUrl:"app/shared/selectMultipleUsers/selectMultipleRecievers.view.html",scope:{id:"@",placeholder:"@",roles:"&",users:"&",selectedIds:"=ngModel",selectedTexts:"&",field:"@",disabled:"&ngDisabled"}}}])}(angular,app),function(e,t){"use strict";t.directive("selectOption",[function(){return{templateUrl:"app/shared/selectOption/selectOption.view.html",scope:{id:"@",label:"@",placeholder:"@",options:"=",selectedId:"=ngModel",selectedText:"@",autoSaveUrl:"@",appendurl:"@",field:"@",disabled:"&ngDisabled",required:"@"},link:function(e,t,n,r){var i=_.find(e.options,function(t){return t.Id==e.selectedId});e.options&&null!=e.selectedId&&!i&&e.options.splice(0,0,{Id:e.selectedId,Name:e.selectedText+" (Slettes)"}),e.savedId=e.selectedId,e.optionDescription=null,e.$watch("selectedId",function(t){var n=_.find(e.options,function(t){return t.Id===parseInt(e.selectedId,10)});e.optionDescription=n?n.Description:null})}}}])}(angular,app),function(e,t){"use strict";t.directive("selectOrgUnit",["$http","$timeout","$sce","userService",function(e,t,n,r){return{scope:{extraOptions:"=?",allowClear:"@?",ngDisabled:"=?"},require:"ngModel",priority:0,templateUrl:"app/shared/selectOrgUnit/selectOrgUnit.view.html",link:function(i,a,o,s){i.isLoading=!0,
a.bind("change",function(){t(function(){""===i.select.selected?s.$setViewValue(null):s.$setViewValue(i.select.selected),a.triggerHandler("blur")})}),s.$render=function(){i.select.selected=s.$viewValue};var l=[],c={allowClear:!!i.allowClear,escapeMarkup:function(e){return e},formatSelection:function(e){var t;return t=e.id?_.find(l,{id:parseInt(e.id)}):_.find(l,{id:parseInt(e)}),t?t.selectedText:null}};i.extraOptions&&_.each(i.extraOptions,function(e){var t={id:e.id,text:e.text,selectedText:e.text};l.push(t)}),r.getUser().then(function(t){e.get("api/organizationUnit?organization="+t.currentOrganizationId).success(function(e){function t(e,r){var i={id:e.id,text:n.trustAsHtml(r+e.name),selectedText:e.name};l.push(i),_.each(e.children,function(e){return t(e,r+"    ")})}t(e.response,""),i.select.isReady=!0})}),i.select={settings:c,options:l,isReady:!1,selected:null}}}}])}(angular,app),function(e,t){"use strict";t.directive("selectStatus2",["$timeout",function(e){return{scope:{canWrite:"="},require:"ngModel",templateUrl:"app/shared/selectStatus2/selectStatus2.view.html",link:function(t,n,r,i){t.setModel=function(r){t.model!=r&&(t.model=r,e(function(){i.$setViewValue(t.model),n.triggerHandler("blur")}))},i.$render=function(){t.model=i.$viewValue}}}}])}(angular,app),function(e,t){"use strict";t.directive("selectUser",function(){function e(e){var t="<div>"+e.text+"</div>";return e.user&&(t+="<div class='small'>"+e.user.Email,e.user.defaultOrganizationUnitName&&(t+=", "+e.user.defaultOrganizationUnitName),t+="</div>"),t}function t(e){return e.text}return{scope:{inputName:"@?name",userModel:"=",addUser:"@?",allowClear:"@?",onSelect:"&?",ngDisabled:"=?",orgId:"@?"},replace:!0,templateUrl:"app/shared/selectUser/selectUser.view.html",controller:["$scope","$http","$timeout",function(n,r,i){function a(e){var t=e.split(" ",3),i=0,a="?$filter=";void 0===n.orgId&&(a+="OrganizationRights/any()");for(var o=0,s=t;o<s.length;o++){var l=s[o];void 0===n.orgId?l&&(a+=" and contains(concat(concat(concat(concat(tolower(Name), ' '), tolower(LastName)), ' '), tolower(Email)), tolower('"+l+"'))"):l&&(0!=i&&(a+=" and "),a+="contains(concat(concat(concat(concat(tolower(Name), ' '), tolower(LastName)), ' '), tolower(Email)), tolower('"+l+"'))"),i++}return void 0===n.orgId?r.get("/odata/Users"+a,{ignoreLoadingBar:!0}):r.get("/odata/Organizations("+n.orgId+")/Users"+a,{ignoreLoadingBar:!0})}n.onChange=function(){"object"==typeof n.userModel&&i(n.onSelect)},n.selectUserOptions={escapeMarkup:function(e){return e},formatResult:e,formatSelection:t,allowClear:!!n.allowClear,minimumInputLength:1,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(e){var t=a(e.data.query).then(e.success);return t.abort=function(){return null},t},results:function(e,t){var n=[];return _.each(e.data.value,function(e){n.push({id:e.Id,text:e.Name+" "+e.LastName,user:e})}),{results:n}}}}}]}})}(angular,app),function(e,t){"use strict";t.directive("showStatus",["$timeout",function(e){return{scope:{status:"=showStatus"},replace:!1,templateUrl:"app/shared/showStatus/showStatus.view.html",link:function(t,n,r){function i(){e(function(){if(!t.status)return void i();t.ready=!0})}t.ready=!1,i(),t.$watch("status",function(e,t){e!==t&&i()})}}}])}(angular,app),function(e,t){"use strict";t.directive("typeahead",["$timeout","_","$filter",function(e,t,n){return{restrict:"AEC",scope:{items:"=",placeholder:"@",displayValue:"@",fieldValue:"@",model:"=ngModel",stringModel:"=",autosaveUrl:"@",field:"@",userHasWriteAccess:"="},templateUrl:"app/shared/typeahead/typeahead.view.html",link:function(t,r,i){t.model&&(t.searchInput=t.model),t.handleSelection=function(e){t.model=e.Name+" "+e.LastName,t.searchInput=e.Name+" "+e.LastName,t.current=0,t.showItems=!1},t.current=0,t.isCurrent=function(e){return t.current===e},t.setCurrent=function(e){t.items[e]&&(t.current=e)},t.onFocus=function(){t.showItems=!0},t.onBlur=function(){(angular.isUndefined(t.model)||t.model.length)&&(t.model=t.searchInput,e(function(){t.showItems=!1},200))},t.onKeypress=function(e){if(38===e.which)t.setCurrent(t.current-1);else if(40===e.which)t.setCurrent(t.current+1);else if(13===e.which){var i=n("filter")(t.items,t.searchInput);i.length&&t.handleSelection(i[t.current]),r.find(".typeahead-input").blur()}}}}}])}(angular,app),function(e,t){"use strict";t.directive("selectUserOrgUnit",["$http","$timeout","$sce","userService",function(e,t,n,r){return{scope:{extraOptions:"=?",allowClear:"@?",ngDisabled:"=?"},require:"ngModel",priority:0,templateUrl:"app/components/home/selectUserOrgUnit/selectUserOrgUnit.view.html",link:function(i,a,o,s){a.bind("change",function(){t(function(){s.$setViewValue(i.select.selected),a.triggerHandler("blur")})}),s.$render=function(){i.select.selected=s.$viewValue};var l=[],c={allowClear:!!i.allowClear,escapeMarkup:function(e){return e},formatSelection:function(e){var t;return t=e.id?_.find(l,{id:parseInt(e.id)}):_.find(l,{id:parseInt(e)}),t?t.selectedText:null}};i.extraOptions&&_.each(i.extraOptions,function(e){var t={id:e.id,text:e.text,selectedText:e.text};l.push(t)}),r.getUser().then(function(t){e.get("api/organizationUnit?organization="+t.currentOrganizationId,{cache:!0}).success(function(e){function t(e,r){var i={id:e.id,text:n.trustAsHtml(r+e.name),selectedText:e.name};l.push(i),_.each(e.children,function(e){return t(e,r+"    ")})}t(e.response,""),i.select.isReady=!0})}),i.select={settings:c,options:l,isReady:!1,selected:r.getUser().defaultOrganizationUnitId}}}}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";function t(){return{scope:{editState:"@state",dirId:"@",optionType:"@"},controller:n,controllerAs:"ctrl",bindToController:{title:"@",optionsUrl:"@"},template:'<h2>{{ ctrl.title }}</h2><div id="{{ctrl.dirId}}" data-kendo-grid="{{ ctrl.mainGrid }}" data-k-options="{{ ctrl.mainGridOptions }}"></div>'}}var n=function(){function e(e,t,n,r,i,a,o){function s(e){e.element.kendoAutoComplete({noDataTemplate:""})}var l=this;this.$http=e,this.$timeout=t,this._=n,this.$=r,this.$state=i,this.notify=a,this.$scope=o,this.createOption=function(){l.$scope.$state.go(l.editState,{id:0,optionsUrl:l.optionsUrl,optionType:l.optionType})},this.editOption=function(e){e.preventDefault();var t=l.$("#"+l.dirId).data("kendoGrid"),n=t.dataItem(l.$(e.currentTarget).closest("tr"));l.optionId=n.get("id"),l.$scope.$state.go(l.editState,{id:l.optionId,optionsUrl:l.optionsUrl,optionType:l.optionType})},this.disableEnableOption=function(e,t){e.preventDefault();var n=l,r=l.$("#"+l.dirId).data("kendoGrid"),i=r.dataItem(l.$(e.currentTarget).closest("tr")),a=i.get("Id"),o={IsEnabled:t},s=l.notify.addInfoMessage("Gemmer...",!1);l.$http.patch(l.optionsUrl+"("+a+")",o).success(function(){s.toSuccessMessage("Feltet er opdateret."),n.$("#"+n.dirId).data("kendoGrid").dataSource.read()}).error(function(e,t){409===t?s.toErrorMessage("Fejl! Feltet kunne ikke ændres da værdien den allerede findes i KITOS!"):s.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})},this.pushUp=function(e){e.preventDefault();var t=l.$("#"+l.dirId).data("kendoGrid"),n=t.dataItem(l.$(e.currentTarget).closest("tr")),r=n.get("Priority");l.optionId=n.get("Id");var i={Priority:r+1};l.$http.patch(l.optionsUrl+"("+l.optionId+")",i).then(function(e){l.$("#"+l.dirId).data("kendoGrid").dataSource.read()})},this.pushDown=function(e){e.preventDefault();var t=l.$("#"+l.dirId).data("kendoGrid"),n=t.dataItem(l.$(e.currentTarget).closest("tr")),r=n.get("Priority");l.optionId=n.get("Id");var i={Priority:r-1};l.$http.patch(l.optionsUrl+"("+l.optionId+")",i).then(function(e){l.$("#"+l.dirId).data("kendoGrid").dataSource.read()})},this.$scope.$state=i,this.editState=o.editState,this.dirId=o.dirId,this.optionType=o.optionType,this.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:""+this.optionsUrl,dataType:"json"}},sort:{field:"priority",dir:"desc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{id:"Id",fields:{IsObligatory:{type:"boolean"},Name:{type:"string"},Description:{type:"string"}}}}},toolbar:[{name:"opretType",text:"Opret type",template:"<a ng-click='ctrl.createOption()' class='btn btn-success pull-right'>#: text #</a>"}],pageable:{refresh:!0,pageSizes:[10,25,50,100,200],buttonCount:5},sortable:{mode:"single"},editable:!0,reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:{filterable:!1}},"reportCategoryTypeId"===this.dirId?this.mainGridOptions.columns=[{field:"Name",title:"Navn",width:230,persistId:"name",template:function(e){return e.Name},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Description",title:"Beskrivelse",width:230,persistId:"description",template:function(e){return e.Description},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{name:"editOption",text:"Redigér",template:"<button type='button' class='btn btn-link' title='Redigér type' ng-click='ctrl.editOption($event)'><i class='fa fa-pencil' aria-hidden='true'></i></button> <button type='button' class='btn btn-link' title='Gør type utilgængelig' ng-click='ctrl.disableEnableOption($event, false)' ng-if='dataItem.IsEnabled'><i class='fa fa-times' aria-hidden='true'></i></button>",title:" ",width:176}]:this.mainGridOptions.columns=[{field:"IsEnabled",title:"Tilgængelig",width:112,persistId:"isEnabled",attributes:{class:"text-center"},template:'# if(IsEnabled) { # <span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span> # } else { # <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> # } #',hidden:!1,filterable:!1,sortable:!1},{field:"IsObligatory",title:"Obligatorisk",width:112,persistId:"IsObligatory",attributes:{class:"text-center"},template:'# if(IsObligatory) { # <span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span> # } else { # <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> # } #',hidden:!1,filterable:!1,sortable:!1},{title:"Prioritet",template:"<button class='btn btn-link' data-ng-click='ctrl.pushUp($event)'\"><i class='fa fa-arrow-up' aria-hidden='true'></i></button><button class='btn btn-link' data-ng-click='ctrl.pushDown($event)'\"><i class='fa fa-arrow-down' aria-hidden='true'></i></button>",width:100,attributes:{class:"text-center"},persistId:"command"},{field:"Name",title:"Navn",width:230,persistId:"name",template:function(e){return e.Name},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Description",title:"Beskrivelse",width:230,persistId:"description",template:function(e){return e.Description},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{name:"editOption",text:"Redigér",template:"<button type='button' class='btn btn-link' title='Redigér type' ng-click='ctrl.editOption($event)'><i class='fa fa-pencil' aria-hidden='true'></i></button> <button type='button' class='btn btn-link' title='Gør type utilgængelig' ng-click='ctrl.disableEnableOption($event, false)' ng-if='dataItem.IsEnabled'><i class='fa fa-times' aria-hidden='true'></i></button> <button type='button' class='btn btn-link' title='Gør type tilgængelig' ng-click='ctrl.disableEnableOption($event, true)' ng-if='!dataItem.IsEnabled'><i class='fa fa-check' aria-hidden='true'></i></button>",title:" ",width:176}]}return e.$inject=["$http","$timeout","_","$","$state","notify","$scope"],e}();angular.module("app").directive("globalOptionList",t)}(e.Directives||(e.Directives={}))}(e.GlobalConfig||(e.GlobalConfig={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";function t(){return{scope:{editState:"@state",dirId:"@",optionType:"@"},controller:n,controllerAs:"ctrl",bindToController:{title:"@",optionsUrl:"@"},template:'<h2>{{ ctrl.title }}</h2><div id="{{ctrl.dirId}}" data-kendo-grid="{{ ctrl.mainGrid }}" data-k-options="{{ ctrl.mainGridOptions }}"></div>'}}var n=function(){function e(e,t,n,r,i,a,o){function s(e){e.element.kendoAutoComplete({noDataTemplate:""})}var l=this;this.$http=e,this.$timeout=t,this._=n,this.$=r,this.$state=i,this.notify=a,this.$scope=o,this.createOption=function(){l.$scope.$state.go(l.editState,{id:0,optionsUrl:l.optionsUrl,optionType:l.optionType})},this.editOption=function(e){e.preventDefault();var t=l.$("#"+l.dirId).data("kendoGrid"),n=t.dataItem(l.$(e.currentTarget).closest("tr"));l.optionId=n.get("id"),l.$scope.$state.go(l.editState,{id:l.optionId,optionsUrl:l.optionsUrl,optionType:l.optionType})},this.disableEnableOption=function(e,t){e.preventDefault();var n=l,r=l.$("#"+l.dirId).data("kendoGrid"),i=r.dataItem(l.$(e.currentTarget).closest("tr")),a=i.get("Id"),o={IsEnabled:t},s=l.notify.addInfoMessage("Gemmer...",!1);l.$http.patch(l.optionsUrl+"("+a+")",o).success(function(){s.toSuccessMessage("Feltet er opdateret."),n.$("#"+n.dirId).data("kendoGrid").dataSource.read()}).error(function(e,t){409===t?s.toErrorMessage("Fejl! Feltet kunne ikke ændres da værdien den allerede findes i KITOS!"):s.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})},this.pushUp=function(e){e.preventDefault();var t=l.$("#"+l.dirId).data("kendoGrid"),n=t.dataItem(l.$(e.currentTarget).closest("tr")),r=n.get("Priority");l.optionId=n.get("Id");var i={Priority:r+1};l.$http.patch(l.optionsUrl+"("+l.optionId+")",i).then(function(e){l.$("#"+l.dirId).data("kendoGrid").dataSource.read()})},this.pushDown=function(e){e.preventDefault();var t=l.$("#"+l.dirId).data("kendoGrid"),n=t.dataItem(l.$(e.currentTarget).closest("tr")),r=n.get("Priority");l.optionId=n.get("Id");var i={Priority:r-1};l.$http.patch(l.optionsUrl+"("+l.optionId+")",i).then(function(e){l.$("#"+l.dirId).data("kendoGrid").dataSource.read()})},this.$scope.$state=i,this.editState=o.editState,this.dirId=o.dirId,this.optionType=o.optionType,this.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:""+this.optionsUrl,dataType:"json"}},sort:{field:"priority",dir:"desc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{id:"Id",fields:{IsObligatory:{type:"boolean"},Name:{type:"string"},HasWriteAccess:{type:"boolean"},Description:{type:"string"}}}}},toolbar:[{name:"opretRolle",text:"Opret rolle",template:"<a ng-click='ctrl.createOption()' class='btn btn-success pull-right'>#: text #</a>"}],pageable:{refresh:!0,pageSizes:[10,25,50,100,200],buttonCount:5},sortable:{mode:"single"},editable:!0,reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:{filterable:!1},columns:[{field:"IsEnabled",title:"Tilgængelig",width:112,persistId:"isEnabled",attributes:{class:"text-center"},template:'# if(IsEnabled) { # <span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span> # } else { # <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> # } #',hidden:!1,filterable:!1,sortable:!1},{field:"IsObligatory",title:"Obligatorisk",width:112,persistId:"IsObligatory",attributes:{class:"text-center"},template:'# if(IsObligatory) { # <span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span> # } else { # <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> # } #',hidden:!1,filterable:!1,sortable:!1},{title:"Prioritet",template:"<button class='btn btn-link' data-ng-click='ctrl.pushUp($event)'\"><i class='fa fa-arrow-up' aria-hidden='true'></i></button><button class='btn btn-link' data-ng-click='ctrl.pushDown($event)'\"><i class='fa fa-arrow-down' aria-hidden='true'></i></button>",width:100,attributes:{class:"text-center"},persistId:"command"},{field:"Name",title:"Navn",width:230,persistId:"name",template:function(e){return e.Name},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"HasWriteAccess",title:"Skriv",width:112,persistId:"hasWriteAccess",attributes:{class:"text-center"},template:'# if(HasWriteAccess) { # <span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span> # } else { # <span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span> # } #',hidden:!1,filterable:!1,sortable:!1},{field:"Description",title:"Beskrivelse",width:230,persistId:"description",template:function(e){return e.Description},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{name:"editOption",text:"Redigér",template:"<button type='button' class='btn btn-link' title='Redigér rolle' ng-click='ctrl.editOption($event)'><i class='fa fa-pencil' aria-hidden='true'></i></button> <button type='button' class='btn btn-link' title='Gør rolle utilgængelig' ng-click='ctrl.disableEnableOption($event, false)' ng-if='dataItem.IsEnabled'><i class='fa fa-times' aria-hidden='true'></i></button> <button type='button' class='btn btn-link' title='Gør rolle tilgængelig' ng-click='ctrl.disableEnableOption($event, true)' ng-if='!dataItem.IsEnabled'><i class='fa fa-check' aria-hidden='true'></i></button>",title:" ",width:176}]}}return e.$inject=["$http","$timeout","_","$","$state","notify","$scope"],e}();angular.module("app").directive("globalOptionRoleList",t)}(e.Directives||(e.Directives={}))}(e.GlobalConfig||(e.GlobalConfig={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function e(){this.templateUrl="app/components/it-contract/it-contract-details/it-contract-details.view.html",this.scope={detailType:"@",action:"@",fieldValue:"@",odataQuery:"@",detailModelType:"@"}}return e.prototype.link=function(e,t,n){e.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:function(){return""+e.odataQuery},dataType:"json"}},sort:{field:"Id",dir:"asc"}},noRecords:!0,messages:{noRecords:"Kontrakten "+e.action+" ingen "+e.detailType+"."},columns:[{persistId:"fieldValue",field:""+e.fieldValue,title:"Kontrakten "+e.action+" følgende "+e.detailType,width:150,template:function(t){return angular.isUndefined(t.AssociatedInterfaceUsages)?t[e.detailModelType].Disabled?t[e.detailModelType].Name+" (Slettes)":t[e.detailModelType].Name:'<table data-ng-repeat="item in dataItem.AssociatedInterfaceUsages">\n                                            <td>{{item.ItInterface.Name}} <span data-ng-if="item.ItInterface.Disabled"> (Slettes) </span></td>\n                                        </table>'},hidden:!1}]}},e.directiveName="contractDetails",e}();angular.module("app").directive(n.directiveName,e.DirectiveFactory.getFactoryFor(n))}(t.Details||(t.Details={}))}(e.Contract||(e.Contract={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.advice-generic",{url:"/advice",templateUrl:"app/components/it-advice/it-advice.view.html",controller:"object.EditAdviceCtrl",controllerAs:"Vm",resolve:{Roles:["$http",function(e){return e.get("odata/LocalItContractRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],advices:["$http","$stateParams",function(e,t){return e.get("api/itcontract/"+t.id).then(function(e){return e.data.response.advices})}],object:["contract",function(e){return e}],type:[function(){return"itContract"}],advicename:["$http","$stateParams",function(e,t){return e.get("api/itcontract/"+t.id).then(function(e){return e.data.response})}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/itcontract/"+t.id+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}]}})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.deadlines",{url:"/deadlines",templateUrl:"app/components/it-contract/tabs/it-contract-tab-deadlines.view.html",controller:"contract.DeadlinesCtrl",resolve:{optionExtensions:["$http",function(e){return e.get("odata/LocalOptionExtendTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],terminationDeadlines:["$http",function(e){return e.get("odata/LocalTerminationDeadlineTypes").then(function(e){return e.data.value})}],paymentMilestones:["$http","$stateParams",function(e,t){return e.get("api/paymentMilestone/"+t.id+"?contract=true").then(function(e){return e.data.response})}],handoverTrialTypes:["$http",function(e){return e.get("odata/LocalHandoverTrialTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],handoverTrials:["$http","$stateParams",function(e,t){return e.get("api/handoverTrial/"+t.id+"?byContract=true").then(function(e){return e.data.response})}]}})}]),t.controller("contract.DeadlinesCtrl",["$scope","$http","$timeout","$state","$stateParams","notify","optionExtensions","terminationDeadlines","paymentMilestones","handoverTrialTypes","handoverTrials","user","moment","$q",function(e,t,n,r,i,a,o,s,l,c,d,u,p,f){function g(n){var r=f.defer(),i=a.addInfoMessage("Gemmer...",!1);return t.patch("odata/itcontracts("+e.contract.id+")",n).success(function(){i.toSuccessMessage("Varigheden blev gemt."),r.resolve()}).error(function(){i.toErrorMessage("Varigheden blev ikke gemt."),r.reject()}),r.promise}function m(){var t=parseInt(e.durationYears),n=parseInt(e.durationMonths);(0===t||t<0)&&(e.durationYears=""),(0===n||n<0||n>11)&&(e.durationMonths="")}function h(e,n){var r=a.addInfoMessage("Gemmer...",!1);t({method:"PATCH",url:n,data:e}).success(function(){r.toSuccessMessage("Feltet er opdateret.")}).error(function(){r.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}function v(){return r.transitionTo(r.current,i,{reload:!0}).then(function(){return e.hideContent=!0,n(function(){return e.hideContent=!1},1)})}e.autosaveUrl="api/itcontract/"+e.contract.id,e.optionExtensions=o,e.terminationDeadlines=s,e.paymentMilestones=l,e.handoverTrialTypes=c,e.handoverTrials=d,e.durationYears=e.contract.durationYears,e.durationMonths=e.contract.durationMonths,e.durationOngoing=e.contract.durationOngoing,e.saveDurationYears=function(){if(""!==e.durationYears){var t=parseInt(e.durationYears);if(t>-1){g({DurationYears:t||0}).then(function(){e.contract.durationYears=e.durationYears},function(){e.durationYears=e.contract.durationYears})}else{a.addInfoMessage("Gemmer...",!1).toErrorMessage("Antallet af år er ikke gyldig.")}m()}},e.saveDurationMonths=function(){if(""!==e.durationMonths){var t=parseInt(e.durationMonths);if(t>-1&&t<12){g({DurationMonths:t||0}).then(function(){e.contract.durationMonths=e.durationMonths},function(){e.durationMonths=e.contract.durationMonths})}else{a.addInfoMessage("Gemmer...",!1).toErrorMessage("Antallet af måneder er ikke gyldig.")}m()}},e.saveOngoingStatus=function(){var n={DurationYears:0,DurationMonths:0,DurationOngoing:e.durationOngoing},r=a.addInfoMessage("Gemmer...",!1);t.patch("odata/itcontracts("+e.contract.id+")",n).success(function(){r.toSuccessMessage("Varigheden blev gemt."),e.durationYears="",e.durationMonths="",e.contract.durationOngoing=e.durationOngoing,e.contract.durationYears=e.durationYears,e.contract.durationMonths=e.durationMonths}).error(function(){r.toErrorMessage("Varigheden blev ikke gemt.")})},e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},e.saveMilestone=function(n){n.itContractId=e.contract.id;var r=p(n.approved,"DD-MM-YYYY"),i=p(n.expected,"DD-MM-YYYY"),o=r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099,s=i.isValid()||isNaN(i.valueOf())||i.year()<1e3||i.year()>2099;o?n.approved=r.format("YYYY-MM-DD"):(a.addInfoMessage("Den indtastede forventet dato er ugyldig. Tom værdi indsættes"),n.approved=null),s?n.expected=i.format("YYYY-MM-DD"):(a.addInfoMessage("Den indtastede godkendt dato er ugyldig. Tom værdi indsættes"),n.expected=null);var l=a.addInfoMessage("Gemmer...",!1);t.post("api/paymentMilestone",n).success(function(t){l.toSuccessMessage("Gemt");var n=t.response;e.paymentMilestones.push(n),delete e.paymentMilestone,e.milestoneForm.$setPristine()}).error(function(){l.toErrorMessage("Fejl! Kunne ikke gemmes!")})},e.deleteMilestone=function(e){var n=a.addInfoMessage("Sletter...",!1);t.delete("api/paymentMilestone/"+e+"?organizationId="+u.currentOrganizationId).success(function(){n.toSuccessMessage("Slettet"),v()}).error(function(){n.toErrorMessage("Fejl! Kunne ikke slette!")})},e.saveTrial=function(n){n.itContractId=e.contract.id;var r=p(n.approved,"DD-MM-YYYY"),i=p(n.expected,"DD-MM-YYYY"),o=r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099,s=i.isValid()||isNaN(i.valueOf())||i.year()<1e3||i.year()>2099;o?n.approved=r.format("YYYY-MM-DD"):(a.addInfoMessage("Den indtastede forventet dato er ugyldig. Tom værdi indsættes"),n.approved=null),s?n.expected=i.format("YYYY-MM-DD"):(a.addInfoMessage("Den indtastede godkent dato er ugyldig. Tom værdi indsættes"),n.expected=null);var l=a.addInfoMessage("Gemmer...",!1);t.post("api/handoverTrial",n).success(function(t){l.toSuccessMessage("Gemt");var n=t.response;e.handoverTrials.push(n),delete e.handoverTrial,e.trialForm.$setPristine()}).error(function(){l.toErrorMessage("Fejl! Kunne ikke gemmes!")})},e.deleteTrial=function(e){var n=a.addInfoMessage("Sletter...",!1);t.delete("api/handoverTrial/"+e+"?organizationId="+u.currentOrganizationId).success(function(){n.toSuccessMessage("Slettet"),v()}).error(function(){n.toErrorMessage("Fejl! Kunne ikke slette!")})},e.patchDate=function(t,n){var r=p(n,"DD-MM-YYYY");if(!r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099)a.addErrorMessage("Den indtastede dato er ugyldig.");else{var i=r.format("YYYY-MM-DD"),o={};o[t]=i,h(o,e.autosaveUrl+"?organizationId="+u.currentOrganizationId)}},e.patchDateProcurement=function(e,t,n,r){var i=p(t,"DD-MM-YYYY");if(!i.isValid()||isNaN(i.valueOf())||i.year()<1e3||i.year()>2099)a.addErrorMessage("Den indtastede dato er ugyldig.");else{var o=i.format("YYYY-MM-DD"),s={};s[e]=o,h(s,r+n+"?organizationId="+u.currentOrganizationId)}},m()}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.economy",{url:"/economy",templateUrl:"app/components/it-contract/tabs/it-contract-tab-economy.view.html",controller:"contract.EditEconomyCtrl",resolve:{orgUnits:["$http","userService",function(e,t){return t.getUser().then(function(t){return e.get("api/organizationunit/?organizationid="+t.currentOrganizationId).then(function(e){return e.data.response})})}],externalEconomyStreams:["$http","contract","$state",function(e,t){return e.get("api/EconomyStream/?externPaymentForContractWithId="+t.id).then(function(e){return e.data.response},function(e){return e})}],internalEconomyStreams:["$http","contract","$state",function(e,t){return e.get("api/EconomyStream/?internPaymentForContractWithId="+t.id).then(function(e){return e.data.response},function(e){return e})}]}})}]),t.controller("contract.EditEconomyCtrl",["$scope","$http","$timeout","$state","$stateParams","notify","contract","orgUnits","user","externalEconomyStreams","internalEconomyStreams","_",function(e,t,n,r,i,a,o,s,l,c,d,u){function p(n){var r={accessModifier:""+e.visibility};return t.patch("api/EconomyStream/?id="+n.id+"&organizationId="+l.currentOrganizationId,r)}function f(e,n){function r(){if(e.ean=" - ",e.organizationUnitId){var t=u.find(s,{id:parseInt(e.organizationUnitId)});t&&t.ean&&(e.ean=t.ean)}}e.show=!0,e.updateUrl=v+"/"+e.id,e.delete=function(){var n=a.addInfoMessage("Sletter række...");t.delete(this.updateUrl+"?organizationId="+l.currentOrganizationId).success(function(){e.show=!1,n.toSuccessMessage("Rækken er slettet!")}).error(function(){n.toErrorMessage("Fejl! Kunne ikke slette rækken!")}).finally(h)},e.updateEan=r,r(),n.push(e)}function g(e,n){var r={};r[e]=o.id,r[n]=l.currentOrganizationId;var i=a.addInfoMessage("Tilføjer ny række...");t.post("api/EconomyStream/?contractId="+o.id,r).success(function(e){i.toSuccessMessage("Rækken er tilføjet!")}).error(function(){i.toErrorMessage("Fejl! Kunne ikke tilføje række")}).finally(h)}function m(e,n){var r=a.addInfoMessage("Gemmer...",!1);t({method:"PATCH",url:n,data:e}).success(function(){r.toSuccessMessage("Feltet er opdateret.")}).error(function(){r.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}function h(){return r.transitionTo(r.current,i,{reload:!0}).then(function(){return e.hideContent=!0,n(function(){return e.hideContent=!1},1)})}if(e.hasWriteAccess=l.currentOrganizationId===o.organizationId&&(l.id===o.objectOwnerId||l.isGlobalAdmin||l.isLocalAdmin||l.isContractAdmin),401===c.status&&401===d.status)a.addInfoMessage("Du har ikke lov til at se disse informationer. Kontakt venligst din lokale administrator eller kontrakt administrator.");else{var v="api/economyStream";e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]};var y=[];u.each(c,function(e){y.push(e)}),u.each(d,function(e){y.push(e)}),y.length>0?e.visibility=y[0].accessModifier:e.visibility=0;var I=[];e.externEconomyStreams=I,u.each(c,function(e){f(e,I)});var b=[];e.internEconomyStreams=b,u.each(d,function(e){f(e,b)}),e.changeVisibility=function(){e.hasWriteAccess?(0!==c.length&&u.each(c,function(e){p(e).then(function(){a.addSuccessMessage("Synligheden for ekstern betaling blev opdateret")},function(e){403===e.status?a.addInfoMessage("Du har ikke lov til at foretage denne handling."):a.addErrorMessage("Synligheden for ekstern betaling blev ikke opdateret")})}),0!==d&&u.each(d,function(e){p(e).then(function(){a.addSuccessMessage("Synligheden for intern betaling blev opdateret")},function(e){403===e.status?a.addInfoMessage("Du har ikke lov til at foretage denne handling."):a.addErrorMessage("Synligheden for intern betaling blev ikke opdateret")})})):a.addInfoMessage("Du har ikke lov til at foretage denne handling.")},e.newExtern=function(){g("ExternPaymentForId","OrganizationId")},e.newIntern=function(){g("InternPaymentForId","OrganizationId")},e.patchDate=function(e,t,n){var r=moment(t,"DD-MM-YYYY");if(!r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099)a.addErrorMessage("Den indtastede dato er ugyldig.");else{var i=r.format("YYYY-MM-DD"),o={};o[e]=i,m(o,"api/EconomyStream/?id="+n+"&organizationId="+l.currentOrganizationId)}}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.hierarchy",{url:"/hierarchy",templateUrl:"app/components/it-contract/tabs/it-contract-tab-hierarchy.view.html",controller:"contract.EditHierarchyCtrl",resolve:{hierarchyFlat:["$http","$stateParams",function(e,t){return e.get("api/itcontract/"+t.id+"?hierarchy").then(function(e){return e.data.response})}]}})}]),t.controller("contract.EditHierarchyCtrl",["$scope","_","$state","$timeout","hierarchyFlat","$stateParams","notify","contract","hasWriteAccess","$http","user",function(e,t,n,r,i,a,o,s,l,c,d){function u(e){return"<div>"+e.text+"</div>"}function p(){return n.transitionTo(n.current,a,{reload:!0}).then(function(){return e.hideContent=!0,r(function(){return e.hideContent=!1},1)})}e.hierarchy=t.toHierarchy(i,"id","parentId","children"),e.autoSaveUrl="api/itcontract/"+a.id,e.contract=s,e.hasWriteAccess=l,e.itContractsSelectOptions=function(e,n,r,i){return{minimumInputLength:1,allowClear:!0,placeholder:" ",formatResult:r,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(t){var n=i?"&"+i.join("&"):"",r=c.get(e+"?q="+t.data.query+n).then(t.success);return r.abort=function(){return null},r},results:function(e,r){var i=[];return t.each(e.data.response,function(e){n&&e.id==s.id||i.push({id:e.id,text:e.name?e.name:"Unavngiven",cvr:e.cvr})}),i=t.orderBy(i,function(e){return e.text},"asc"),{results:i}}}}}("api/itcontract",!0,u,["orgId="+d.currentOrganizationId]),s.parentId&&(e.contract.parent={id:s.parentId,text:s.parentName}),e.updateHierarchy=function(t,n){var r;r=null==n?null:n.id;var i={};i[t]=r,c.patch(e.autoSaveUrl+"?organizationId="+d.currentOrganizationId,i).then(function(){o.addSuccessMessage("Feltet er opdateret!"),p()},function(){return o.addErrorMessage("Fejl! Feltet kunne ikke opdateres!")})}}])
}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.main",{url:"/main",templateUrl:"app/components/it-contract/tabs/it-contract-tab-main.view.html",controller:"contract.EditMainCtrl",resolve:{contractTypes:["$http",function(e){return e.get("odata/LocalItContractTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],contractTemplates:["$http",function(e){return e.get("odata/LocalItContractTemplateTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],purchaseForms:["$http",function(e){return e.get("odata/LocalPurchaseFormTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],procurementStrategies:["$http",function(e){return e.get("odata/LocalProcurementStrategyTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],orgUnits:["$http","contract",function(e,t){return e.get("api/organizationunit/?organizationid="+t.organizationId).then(function(e){return e.data.response})}],kitosUsers:["$http","user","_",function(e,t,n){return e.get("odata/organizationRights?$filter=OrganizationId eq "+t.currentOrganizationId+"&$expand=User($select=Name,LastName,Email,Id)&$select=User").then(function(e){var t=n.uniqBy(e.data.value,"User.Id"),r=[];return n.forEach(t,function(e){r.push({Name:e.User.Name,LastName:e.User.LastName,Email:e.User.Email,Id:e.User.Id})}),r=n.orderBy(r,function(e){return e.Name},"asc")})}]}})}]),t.controller("contract.EditMainCtrl",["$scope","$http","_","$stateParams","$uibModal","notify","contract","contractTypes","contractTemplates","purchaseForms","procurementStrategies","orgUnits","hasWriteAccess","user","autofocus","$timeout","kitosUsers",function(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g,m,h){function v(e,n){var r=a.addInfoMessage("Gemmer...",!1);t({method:"PATCH",url:n,data:e}).success(function(){r.toSuccessMessage("Feltet er opdateret.")}).error(function(){r.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}function y(e){return"<div>"+e.text+"</div>"}function I(e){var t="<div>"+e.text+"</div>";return e.cvr&&(t+='<div class="small">'+e.cvr+"</div>"),t}function b(e,r,i,a){return{minimumInputLength:1,allowClear:!0,placeholder:" ",formatResult:i,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(n){var r=a?"&"+a.join("&"):"",i=t.get(e+"?q="+n.data.query+r).then(n.success);return i.abort=function(){return null},i},results:function(e,t){var i=[];return n.each(e.data.response,function(e){r&&e.id==o.id||i.push({id:e.id,text:e.name?e.name:"Unavngiven",cvr:e.cvr})}),{results:i}}}}}function S(){var t=moment(),n=moment(e.contract.concluded,"DD-MM-YYYY").startOf("day"),r=moment(e.contract.expirationDate,"DD-MM-YYYY").endOf("day");e.contract.active||t.isBetween(n,r,null,"[]")||t.isSameOrAfter(n)&&!r.isValid()||t.isSameOrBefore(r)&&!n.isValid()||!n.isValid()&&!r.isValid()?e.contract.isActive=!0:e.contract.isActive=!1}e.autoSaveUrl="api/itcontract/"+r.id,e.autosaveUrl2="api/itcontract/"+o.id,e.contract=o,e.hasWriteAccess=p,e.hasViewAccess=f.currentOrganizationId==o.organizationId,e.kitosUsers=h,g(),e.contractTypes=s,e.contractTemplates=l,e.purchaseForms=c,e.procurementStrategies=d,e.orgUnits=u;var k=new Date;e.dataHandlerLink="",null!=e.contract.dataHandler?(e.dataHandlerLink="#/contract/edit/"+e.contract.dataHandlerId+"/main",e.contract.dataHandlerAgreementUrlName?e.dataHandlerLinkName=e.contract.dataHandlerAgreementUrlName:e.dataHandlerLinkName=e.contract.dataHandler.name):""!=e.contract.dataHandlerAgreementUrl&&(e.dataHandlerLink=e.contract.dataHandlerAgreementUrl,e.contract.dataHandlerAgreementUrlName?e.dataHandlerLinkName=e.contract.dataHandlerAgreementUrlName:e.dataHandlerLinkName="Databehandleraftale"),o.active?e.displayActive=!1:o.concluded<k&&k<o.expirationDate?e.displayActive=!0:e.displayActive=!1,e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},e.procurementPlans=[];for(var $=moment(),O=0;O<20;O++){var w=$.quarter()<=2?1:2,M=$.year(),U={id:O,half:w,year:M};e.procurementPlans.push(U),$.add(6,"months")}var R=n.find(e.procurementPlans,function(e){return e.half==o.procurementPlanHalf&&e.year==o.procurementPlanYear});if(R)e.contract.procurementPlan=R.id;else if(null!=o.procurementPlanHalf){var x={id:e.procurementPlans.length,half:o.procurementPlanHalf,year:o.procurementPlanYear};e.procurementPlans.unshift(x),e.contract.procurementPlan=x.id}e.patchDate=function(t,n){var r=moment(moment(n,"DD-MM-YYYY",!0).format());if(!r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099)a.addErrorMessage("Den indtastede dato er ugyldig.");else{var i=r.format("YYYY-MM-DD"),o={};o[t]=i,v(o,e.autosaveUrl2+"?organizationId="+f.currentOrganizationId)}},e.saveProcurement=function(){var t;if(""===e.contract.procurementPlan)o=e.contract,t={procurementPlanHalf:null,procurementPlanYear:null};else{var n=e.contract.procurementPlan,r=e.procurementPlans[n];t={procurementPlanHalf:r.half,procurementPlanYear:r.year}}e.contract.procurementPlanHalf=t.procurementPlanHalf,e.contract.procurementPlanYear=t.procurementPlanYear,v(t,e.autoSaveUrl+"?organizationId="+f.currentOrganizationId)},e.procurementPlanOption={allowClear:!0,initSelection:function(e,t){t({id:1,text:"Text"})}},o.parentId&&(e.contract.parent={id:o.parentId,text:o.parentName}),e.itContractsSelectOptions=b("api/itcontract",!0,y,["orgId="+f.currentOrganizationId]),o.supplierId&&(e.contract.supplier={id:o.supplierId,text:o.supplierName}),e.suppliersSelectOptions=b("api/organization",!1,I,["public=true","orgId="+f.currentOrganizationId]),e.editLink=function(){i.open({templateUrl:"app/components/it-contract/tabs/it-contract-gdpr-editlink-modal.view.html",controller:["$scope","$state","$uibModalInstance","contracts","contract",function(e,n,r,i,o){e.contracts=i,e.contract=o,0==e.contract.dataHandlerId&&(e.contract.dataHandlerId=""),e.ok=function(){var i=a.addInfoMessage("Gemmer...",!1),s={Id:o.id,DataHandlerId:e.contract.dataHandlerId,DataHandlerAgreementUrl:e.contract.dataHandlerAgreementUrl,DataHandlerAgreementUrlName:e.contract.dataHandlerAgreementUrlName};t({method:"PATCH",url:"api/itcontract/"+o.id+"?organizationId="+f.currentOrganizationId,data:s}).success(function(){i.toSuccessMessage("Feltet er opdateret."),n.reload()}).error(function(){i.toErrorMessage("Fejl! Feltet kunne ikke ændres!")}),r.close()},e.cancel=function(){r.dismiss("cancel")}}],resolve:{contracts:["$http",function(e){return e.get("odata/ItContracts?$filter=Active eq true").then(function(e){return e.data.value})}],contract:[function(){return e.contract}]}})},e.override=function(){S()},e.checkContractValidity=function(t,n){console.log(n);var r=e.contract.expirationDate,i=e.contract.concluded,o=moment(i,["DD-MM-YYYY","YYYY-MM-DD"]).startOf("day"),s=moment(r,["DD-MM-YYYY","YYYY-MM-DD"]).endOf("day"),l=moment(n,["DD-MM-YYYY","YYYY-MM-DDTHH:mm:ssZ"],!0),c={};if(""===n)c[t]=null,v(c,e.autosaveUrl2+"?organizationId="+f.currentOrganizationId),S();else if(null==n);else if(!l.isValid()||isNaN(l.valueOf())||l.year()<1e3||l.year()>2099)a.addErrorMessage("Den indtastede dato er ugyldig.");else if(o>=s)a.addErrorMessage("Den indtastede slutdato er før startdatoen.");else{var d=l.format("YYYY-MM-DD");c[t]=d,v(c,e.autosaveUrl2+"?organizationId="+f.currentOrganizationId),S()}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.paymentmodel",{url:"/paymentmodel",templateUrl:"app/components/it-contract/tabs/it-contract-tab-paymentmodel.view.html",controller:"contract.PaymentmodelCtrl",resolve:{paymentFrequencies:["$http",function(e){return e.get("odata/LocalPaymentFrequencyTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],paymentModels:["$http",function(e){return e.get("odata/LocalPaymentModelTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],priceRegulations:["$http",function(e){return e.get("odata/LocalPriceRegulationTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}]}})}]),t.controller("contract.PaymentmodelCtrl",["$scope","$http","notify","user","contract","paymentFrequencies","paymentModels","priceRegulations",function(e,t,n,r,i,a,o,s){function l(e,r){var i=n.addInfoMessage("Gemmer...",!1);t({method:"PATCH",url:r,data:e}).success(function(){i.toSuccessMessage("Feltet er opdateret.")}).error(function(){i.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}e.contract=i,e.autosaveUrl="api/itcontract/"+i.id,e.paymentFrequencies=a,e.paymentModels=o,e.priceRegulations=s,e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},e.patchDate=function(t,i){var a=moment(i,"DD-MM-YYYY");if(!a.isValid()||isNaN(a.valueOf())||a.year()<1e3||a.year()>2099)n.addErrorMessage("Den indtastede dato er ugyldig.");else{var o=a.format("YYYY-MM-DD"),s={};s[t]=o,l(s,e.autosaveUrl+"?organizationId="+r.currentOrganizationId)}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.references.create",{url:"createReference/:id",onEnter:["$state","$stateParams","$uibModal","user",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"contract.referenceCreateModalCtrl",resolve:{contract:["$http","$stateParams",function(e,t){return e.get("api/itcontract/"+t.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("contract.referenceCreateModalCtrl",["$scope","$http","contract","notify","user",function(e,t,n,r,i){e.dismiss=function(){e.$dismiss()},e.save=function(){var i=new Date,a={ItContract_Id:n.id,Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display,Created:i},o=r.addInfoMessage("Gemmer række",!1);t.post("api/Reference",a).success(function(t){o.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){o.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.references.edit",{url:"/editReference/:refId/:orgId",onEnter:["$state","$stateParams","$uibModal","$http",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"contract.referenceEditModalCtrl",resolve:{reference:["$http",function(e){return e.get("api/Reference/"+t.refId).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("contract.referenceEditModalCtrl",["$scope","$http","reference","$stateParams","notify",function(e,t,n,r,i){e.reference=n,e.dismiss=function(){e.$dismiss()},e.save=function(){var n={Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display},a=i.addInfoMessage("Gemmer række",!1);t.patch("api/Reference/"+r.refId+"?organizationId="+r.orgId,n).success(function(t){a.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){a.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.references",{url:"/reference/",templateUrl:"app/components/it-reference/it-reference.view.html",controller:"contract.EditReference"})}]),t.controller("contract.EditReference",["$scope","$http","$timeout","$state","$stateParams","contract","$confirm","notify","hasWriteAccess",function(e,t,n,r,i,a,o,s,l){function c(){r.go(".",null,{reload:!0})}e.autoSaveUrl="api/itcontract/"+i.id,e.contract=a,e.hasWriteAccess=l,e.reference=a,e.referenceName=a.name,e.objectId=a.id,e.objectReference="it-contract.edit.references.create",e.references=a.externalReferences,e.deleteReference=function(e){var n=s.addInfoMessage("Sletter...");t.delete("api/Reference/"+e+"?organizationId="+a.organizationId).success(function(){n.toSuccessMessage("Slettet!")}).error(function(){n.toErrorMessage("Fejl! Kunne ikke slette!")}),c()},e.setChosenReference=function(e){var n=e===a.referenceId?null:e,r={referenceId:n},i=s.addInfoMessage("Opdaterer felt...",!1);t.patch("api/itContract/"+a.id+"?organizationId="+a.organizationId,r).success(function(e){i.toSuccessMessage("Feltet er opdateret!"),c()}).error(function(){i.toErrorMessage("Fejl! Prøv igen.")})},e.edit=function(e){r.go(".edit",{refId:e,orgId:a.organizationId})},e.isValidUrl=function(e){if(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())}return!1},e.mainGridOptions={dataSource:{data:a.externalReferences,pageSize:10},sortable:!0,pageable:{refresh:!1,pageSizes:!0,buttonCount:5},columns:[{field:"title",title:"Dokumenttitel test",template:function(e){return e.url?'<a target="_blank" href="'+e.url+'">'+e.title+"</a>":e.title},width:240},{field:"externalReferenceId",title:"Evt. dokumentID/Sagsnr./anden referenceContact"},{field:"created",title:"Oprettet",template:"#= kendo.toString(kendo.parseDate(created, 'yyyy-MM-dd'), 'dd. MMMM yyyy') #"},{field:"objectOwner.fullName",title:"Oprettet af",width:150},{title:"Rediger",template:function(t){var n="<button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' title='Redigér reference' data-ng-click=\"edit("+t.id+")\"><i class='fa fa-pencil'  aria-hidden='true'></i></button>";return t.id!=a.referenceId&&(n+=" <button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' data-confirm-click=\"Er du sikker på at du vil slette?\" class='btn btn-link' title='Slet reference' data-confirmed-click='deleteReference("+t.id+")'><i class='fa fa-trash-o' aria-hidden='true'></i></button>"),t.url&&(n=t.id===a.referenceId?n+'<button data-uib-tooltip="Vises i overblik" data-ng-disabled=\''+!e.hasWriteAccess+"' tooltip-placement='right' class='btn btn-link' data-ng-click='setChosenReference("+t.id+")'><img class='referenceIcon chosen' src=\"/Content/img/VisIOverblik.svg\"/></button>":n+'<button data-uib-tooltip="Vis objekt i overblik" data-ng-disabled=\''+!e.hasWriteAccess+"' tooltip-placement='right' class='btn btn-link' data-ng-click='setChosenReference("+t.id+")'><img class='referenceIcon' src=\"/Content/img/VisIOverblik.svg\"></img></button>"),n}}],toolbar:[{name:"addReference",text:"Tilføj reference",template:function(){return l?'<a id="addReference" class="btn btn-success btn-sm" href="\\#/contract/edit/'+a.id+"/reference/createReference/"+a.id+'">Tilføj reference</a>':""}}]}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.roles",{url:"/roles",templateUrl:"app/components/it-contract/tabs/it-contract-tab-roles.view.html",controller:"contract.EditRolesCtrl",resolve:{itContractRights:["$http","$stateParams",function(e,t){return e.get("api/itcontractright/"+t.id).then(function(e){return e.data.response})}],itContractRoles:["$http",function(e){return e.get("odata/ItContractRoles").then(function(e){return e.data.value})}],localItContractRoles:["$http",function(e){return e.get("odata/LocalItContractRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}})}]),t.controller("contract.EditRolesCtrl",["$scope","$http","notify","contract","itContractRights","itContractRoles","localItContractRoles","user",function(e,t,n,r,i,a,o,s){var l=r.id;e.orgId=s.currentOrganizationId,e.contract=r,e.activeItContractRoles=o,e.newRole=a.length>0?1:0,e.rights=[],_.each(i,function(t){t.role=_.find(a,{Id:t.roleId}),t.show=!0;var n=_.find(e.activeItContractRoles,{Id:t.roleId});!angular.isUndefined(n)&&n.Description&&(t.role.Description=n.Description),t.userForSelect={id:t.user.id,text:t.user.fullName},t.roleForSelect=t.roleId,e.rights.push(t)}),e.$watch("selectedUser",function(){e.submitRight()}),e.submitRight=function(){if(e.selectedUser&&e.newRole){var r=parseInt(e.newRole),i=e.selectedUser.id;if(r&&i){var a={roleId:r,userId:i};t.post("api/itcontractright/"+l+"?organizationId="+s.currentOrganizationId,a).success(function(t){n.addSuccessMessage(t.response.user.fullName+" er knyttet i rollen"),e.rights.push({objectId:t.response.objectId,roleId:t.response.roleId,userId:t.response.userId,user:t.response.user,userForSelect:{id:t.response.userId,text:t.response.user.fullName},roleForSelect:t.response.roleId,role:_.find(o,{Id:t.response.roleId}),show:!0}),e.newRole=1,e.selectedUser=""}).error(function(e){n.addErrorMessage("Fejl!")})}}},e.deleteRight=function(e){var r=e.roleId,i=e.userId;t.delete("api/itcontractright/"+l+"?rId="+r+"&uId="+i+"&organizationId="+s.currentOrganizationId).success(function(t){e.show=!1,n.addSuccessMessage("Rollen er slettet!")}).error(function(e){n.addErrorMessage("Kunne ikke slette rollen!")})},e.updateRight=function(r){if(r.roleForSelect&&r.userForSelect){if(!e.checkIfRoleIsAvailable(r.roleForSelect))return void(r.edit=!1);var i=r.roleId,a=r.userId,c=r.roleForSelect,d=r.userForSelect.id;i==c&&a==d&&(r.edit=!1),t.delete("api/itcontractright/"+l+"?rId="+i+"&uId="+a+"&organizationId="+s.currentOrganizationId).success(function(e){var i={roleId:c,userId:d};t.post("api/itcontractright/"+l+"?organizationId="+s.currentOrganizationId,i).success(function(e){r.roleId=e.response.roleId,r.user=e.response.user,r.userId=e.response.userId,r.role=_.find(o,{Id:r.roleId}),r.edit=!1,n.addSuccessMessage(r.user.fullName+" er knyttet i rollen")}).error(function(e){r.show=!1,n.addErrorMessage("Fejl!")})}).error(function(e){r.userForSelect={id:r.user.id,text:r.user.fullName},r.roleForSelect=r.roleId,n.addErrorMessage("Fejl!")})}},e.rightSortBy="roleName",e.rightSortReverse=!1,e.rightSort=function(t){switch(e.rightSortBy){case"roleName":return t.role.Priority;case"userName":return t.user.name;case"userEmail":return t.user.email;default:return t.role.Priority}},e.rightSortChange=function(t){e.rightSortBy==t?e.rightSortReverse=!e.rightSortReverse:e.rightSortReverse=!1,e.rightSortBy=t},e.checkIfRoleIsAvailable=function(t){return _.find(e.activeItContractRoles,function(e){return e.Id===parseInt(t,10)})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-contract.edit.systems",{url:"/systems",templateUrl:"app/components/it-contract/tabs/it-contract-tab-systems.view.html",controller:"contract.EditSystemsCtrl",resolve:{user:["userService",function(e){return e.getUser()}],exhibitedInterfaces:["$http","contract",function(e,t){return e.get("api/ItInterfaceExhibitUsage/?contractId="+t.id).then(function(e){return e.data.response})}],usedInterfaces:["$http","contract",function(e,t){return e.get("api/ItInterfaceUsage/?contractId="+t.id).then(function(e){return e.data.response})}],interfaces:["$http",function(e){return e.get("odata/ItInterfaces").then(function(e){return e.data.value})}],agreementElements:["$http",function(e){return e.get("odata/LocalAgreementElementTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}]}})}]),t.controller("contract.EditSystemsCtrl",["$scope","$http","$state","$stateParams","notify","user","contract","exhibitedInterfaces","usedInterfaces","agreementElements","_","$filter",function(e,t,n,r,i,a,o,s,l,c,d,u){function p(){n.go(".",null,{reload:!0})}function f(n){function r(e){return t.delete("api/itcontract/"+o.id+"?systemUsageId="+e.id+"&organizationId="+a.currentOrganizationId)}function s(e){return t.post("api/itcontract/"+o.id+"?systemUsageId="+e.selectedSystem.id+"&organizationId="+a.currentOrganizationId)}d.each(n,function(e){e.show=!0,e.delete=function(){r(e).success(function(){i.addSuccessMessage("Rækken er slettet."),d.remove(o.associatedSystemUsages,{id:e.id}),e.show=!1}).error(function(){i.addErrorMessage("Kunne ikke slette rækken")})}}),e.associatedSystemUsages=n,e.newAssociatedSystemUsage={save:function(){s(e.newAssociatedSystemUsage).success(function(e){i.addSuccessMessage("Rækken er tilføjet."),o.associatedSystemUsages=e.response,f(e.response)}).error(function(e){i.addErrorMessage("Fejl! Kunne ikke tilføje rækken!")})}}}e.autoSaveUrl="api/itcontract/"+r.id,e.exhibitedInterfaces=s,e.usedInterfaces=l,e.contract=o,e.agreementElements=c,e.selectedAgreementElementIds=d.map(o.agreementElements,"id"),e.selectedAgreementElementNames=d.map(o.agreementElements,"name"),e.deleteExhibit=function(e,n){t({method:"PATCH",url:"api/itInterfaceExhibitUsage/?usageId="+n+"&exhibitId="+e,data:{itContractId:null}}).success(function(){i.addSuccessMessage("Snitfladerelationen er slettet."),p()}).error(function(){i.addSuccessMessage("Fejl! Snitfladerelationen kunne ikke slettes.")})},e.deleteUsed=function(e,n,r){t({method:"PATCH",url:"api/ItInterfaceUsage/?usageId="+e+"&sysId="+n+"&interfaceId="+r+"&organizationId="+a.currentOrganizationId,data:{itContractId:null}}).success(function(){i.addSuccessMessage("Snitfladerelationen er slettet."),p()}).error(function(){i.addSuccessMessage("Fejl! Snitfladerelationen kunne ikke slettes.")})},f(o.associatedSystemUsages),e.newAssociatedInterfaceSave=function(){var n="";"exhibit"==e.newAssociatedInterfaceRelation&&(n="api/itInterfaceExhibitUsage?usageId="+e.newAssociatedInterfaceSelectedSystemUsage.id+"&exhibitId="+e.newAssociatedInterfaceSelectedInterfaceUsage.id),"using"==e.newAssociatedInterfaceRelation&&(n="api/ItInterfaceUsage?usageId="+e.newAssociatedInterfaceSelectedSystemUsage.id+"&sysId="+e.newAssociatedInterfaceSelectedInterfaceUsage.id.sysId+"&interfaceId="+e.newAssociatedInterfaceSelectedInterfaceUsage.id.intfId+"&organizationId="+a.currentOrganizationId),t({method:"PATCH",url:n,data:{itContractId:o.id}}).success(function(){p()})},e.itInterfaceUsagesSelectOptions={minimumInputLength:1,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(n){var r="";"exhibit"==e.newAssociatedInterfaceRelation&&(r="api/exhibit?sysId="+e.newAssociatedInterfaceSelectedSystemUsage.itSystemId+"&orgId="+a.currentOrganizationId+"&q="+n.data.query),"using"==e.newAssociatedInterfaceRelation&&(r="odata/ItInterfaces?$filter=contains(Name, '"+n.data.query+"')");var i=t.get(r).then(n.success);return i.abort=function(){return null},i},results:function(t,n){var r=[];return"exhibit"==e.newAssociatedInterfaceRelation?d.each(t.data.response,function(e){e.itInterfaceDisabled||r.push({id:e.id,text:u("limitToDots")(e.itInterfaceName,30)})}):d.each(t.data.value,function(t){t.Disabled||r.push({id:{intfId:t.Id,sysId:e.newAssociatedInterfaceSelectedSystemUsage.itSystemId},text:u("limitToDots")(t.Name,30)})}),{results:r}}}},e.itSystemUsagesSelectOptions={minimumInputLength:1,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(e){var n=t.get("api/itSystemUsage?organizationId="+a.currentOrganizationId+"&q="+e.data.query).then(e.success);return n.abort=function(){return null},n},results:function(e,t){var n=[];return d.each(e.data.response,function(e){e.itSystem.disabled||n.push({id:e.id,text:u("limitToDots")(e.itSystem.name,30),itSystemId:e.itSystem.id})}),{results:n}}}}}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p){function f(e){e.element.kendoAutoComplete({noDataTemplate:""})}var g=this;this.$rootScope=e,this.$scope=t,this.$timeout=n,this.$state=r,this.$=i,this._=a,this.moment=o,this.notify=s,this.user=l,this.gridStateService=c,this.$modal=d,this.$http=u,this.needsWidthFixService=p,this.storageKey="it-interface-catalog-options",this.gridState=this.gridStateService.getService(this.storageKey),this.saveGridOptions=function(){g.gridState.saveGridOptions(g.mainGrid)},this.accessModFilter=function(e){function t(){var e=this,t=i.filter();switch(r._.findKeyDeep(t,{field:"AccessModifier"}).value){case"Kitos.AccessModifier0":e.select(1);break;case"Kitos.AccessModifier1":e.select(2);break;case"Kitos.AccessModifier2":e.select(3);break;default:e.select(0)}}function n(){var e=this,t=r.mainGrid.dataSource,n=e.value(),i=t.filter(),a=r._.removeFiltersForField(i,"AccessModifier");n&&(a=r._.addFilter(a,"AccessModifier","eq",n,"and")),t.filter(a)}var r=g,i=e.dataSource;e.element.removeAttr("data-bind"),e.element.kendoDropDownList({dataSource:[{value:"Kitos.AccessModifier0",text:"Lokal"},{value:"Kitos.AccessModifier1",text:"Offentlig"}],dataTextField:"text",dataValueField:"value",optionLabel:"Vælg filter...",dataBound:t,change:n})},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(g.exportFlag){g.exportFlag=!1,g._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=g.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(g.mainGrid.element,!1),g.needsWidthFixService.fixWidth()}else e.preventDefault(),g._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),g.$timeout(function(){g.exportFlag=!0,e.sender.saveAsExcel()})},e.page.title="Snitflade - Katalog",t.$on("kendoWidgetCreated",function(e,t){if(t===g.mainGrid){g.loadGridOptions(),g.mainGrid.dataSource.read();var n=g.$(".k-filter-row [data-field='AccessModifier']"),r=n.find("input").data("kendoDropDownList");n.find("button").on("click",function(){r.select(0)}),i(".k-grid-excel").click(function(){kendo.ui.progress(g.mainGrid.element,!0)})}});var m;m=l.isGlobalAdmin?"/odata/ItInterfaces":"/odata/Organizations("+l.currentOrganizationId+")/ItInterfaces";var h=m+"?$expand=Interface,InterfaceType,ObjectOwner,BelongsTo,Organization,Tsa,ExhibitedBy($expand=ItSystem),Method,LastChangedByUser,DataRows($expand=DataType),InterfaceLocalUsages";this.canCreate=!this.user.isReadOnly,this.mainGridOptions={autoBind:!1,dataSource:{type:"odata-v4",transport:{read:{url:h,dataType:"json"},parameterMap:function(e,t){var n=kendo.data.transports["odata-v4"].parameterMap(e,t);return n.$filter&&(n.$filter=n.$filter.replace(/('Kitos\.AccessModifier([0-9])')/,"Kitos.AccessModifier'$2'"),n.$filter=n.$filter.replace(/contains\(Uuid,/,"contains(CAST(Uuid, 'Edm.String'),"),l.isGlobalAdmin||(n.$filter=n.$filter+"and Disabled eq false")),n}},sort:{field:"Name",dir:"asc"},schema:{model:{fields:{LastChanged:{type:"date"}}},parse:function(e){return g._.forEach(e.value,function(e){e.InterfaceType||(e.InterfaceType={Name:""}),e.BelongsTo||(e.BelongsTo={Name:""}),e.ExhibitedBy||(e.ExhibitedBy={ItSystem:{Name:""}}),e.Tsa||(e.Tsa={Name:""}),e.Interface||(e.Interface={Name:""}),e.Method||(e.Method={Name:""}),e.Organization||(e.Organization={Name:""})}),e}},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0},toolbar:[{name:"createSnitflade",text:"Opret Snitflade",template:"<button ng-click='interfaceCatalogVm.createSnitflade()' class='btn btn-success pull-right' data-ng-disabled=\"!interfaceCatalogVm.canCreate\">#: text #</button>"},{name:"clearFilter",text:"Nulstil",template:"<button type='button' class='k-button k-button-icontext' title='Nulstil sortering, filtering og kolonnevisning, -bredde og –rækkefølge' data-ng-click='interfaceCatalogVm.clearOptions()'>#: text #</button>"},{name:"saveFilter",text:"Gem filter",template:'<button type="button" class="k-button k-button-icontext" title="Gem filtre og sortering" data-ng-click="interfaceCatalogVm.saveGridProfile()">#: text #</button>'},{name:"useFilter",text:"Anvend filter",template:'<button type="button" class="k-button k-button-icontext" title="Anvend gemte filtre og sortering" data-ng-click="interfaceCatalogVm.loadGridProfile()" data-ng-disabled="!interfaceCatalogVm.doesGridProfileExist()">#: text #</button>'},{name:"deleteFilter",text:"Slet filter",template:"<button type='button' class='k-button k-button-icontext' title='Slet filtre og sortering' data-ng-click='interfaceCatalogVm.clearGridProfile()' data-ng-disabled='!interfaceCatalogVm.doesGridProfileExist()'>#: text #</button>"}],excel:{fileName:"Snitflade Katalog.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:!0,height:window.innerHeight-200,dataBound:this.saveGridOptions,columnResize:this.saveGridOptions,columnHide:this.saveGridOptions,columnShow:this.saveGridOptions,columnReorder:this.saveGridOptions,excelExport:this.exportToExcel,columns:[{field:"ItInterfaceId",title:"Snitflade ID",width:120,persistId:"infid",excelTemplate:function(e){return e&&e.ItInterfaceId||""},filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Name",title:"Snitflade",width:285,persistId:"name",template:function(e){return e.Disabled?"<a data-ui-sref='it-system.interface-edit.main({id: "+e.Id+"})'>"+e.Name+" (Slettes)</a>":"<a data-ui-sref='it-system.interface-edit.main({id: "+e.Id+"})'>"+e.Name+"</a>"},excelTemplate:function(e){return e&&e.Name?e.Disabled?e.Name+" (Slettes)":e.Name:""},filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Version",title:"Version",width:150,persistId:"version",excelTemplate:function(e){return e&&e.Version||""},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"AccessModifier",title:"Synlighed",width:120,persistId:"accessmod",template:'<display-access-modifier value="dataItem.AccessModifier"></display-access-modifier>',excelTemplate:function(e){return e&&e.AccessModifier.toString()||""},filterable:{cell:{showOperators:!1,template:this.accessModFilter}}},{field:"InterfaceType.Name",title:"Snitfladetype",width:150,persistId:"inftype",template:function(e){return e.InterfaceType?e.InterfaceType.Name:""},filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"BelongsTo.Name",title:"Rettighedshaver",width:150,persistId:"belongs",template:function(e){return e.BelongsTo?e.BelongsTo.Name:""},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Url",title:"Link til beskrivelse",width:125,persistId:"link",template:function(e){return e.Url?'<a href="'+e.Url+'" title="Link til yderligere..." target="_blank"><i class="fa fa-link"></i></a>':""},excelTemplate:function(e){return e&&e.Url||""},attributes:{class:"text-center"},filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ExhibitedBy.ItSystem.Name",title:"Udstillet af",width:230,persistId:"exhibit",template:function(e){return e.ExhibitedBy&&e.ExhibitedBy.ItSystem.Name?e.ExhibitedBy.ItSystem.Disabled?e.ExhibitedBy.ItSystem.Name+" (Slettes)":e.ExhibitedBy.ItSystem.Name:""},filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Tsa.Name",title:"TSA",width:90,persistId:"tsa",template:function(e){return e.Tsa?e.Tsa.Name:""},filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Interface.Name",title:"Grænseflade",width:150,persistId:"infname",template:function(e){return e.Interface?e.Interface.Name:""},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Method.Name",title:"Metode",width:150,persistId:"method",template:function(e){return e.Method?e.Method.Name:""},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"DataType",title:"Datatype",width:150,persistId:"datatypes",
template:function(e){var t="";return e.DataRows.length>0&&(t=g._.map(e.DataRows.slice(0,4),"DataType.Name").join(", ")),e.DataRows.length>5&&(t+=", ..."),t},excelTemplate:function(e){var t="";return e&&e.DataRows.length>0&&(t=g._.map(e.DataRows,"DataType.Name").join(", ")),t},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Organization.Name",title:"Oprettet af: Organisation",width:150,persistId:"orgname",excelTemplate:function(e){return e&&e.Organization&&e.Organization.Name||""},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"ObjectOwner.Name",title:"Oprettet af: Bruger",width:150,persistId:"ownername",template:function(e){return e.ObjectOwner.Name+" "+e.ObjectOwner.LastName},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LastChangedByUser.Name",title:"Sidst redigeret: Bruger",width:150,persistId:"lastchangedname",template:function(e){return e.LastChangedByUser&&e.LastChangedByUser.Name+" "+e.LastChangedByUser.LastName||""},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LastChanged",title:"Sidst redigeret: Dato",format:"{0:dd-MM-yyyy}",width:130,persistId:"lastchangeddate",excelTemplate:function(e){return e&&e.LastChanged?g.moment(e.LastChanged).format("DD-MM-YYYY"):""},attributes:{class:"text-center"},filterable:{cell:{showOperators:!1,operator:"gte"}}},{field:"Uuid",title:"UUID",width:150,persistId:"uuid",excelTemplate:function(e){return e.Uuid},hidden:!0,filterable:{cell:{template:f,dataSource:[],showOperators:!1,operator:"contains"}}}]}}return e.prototype.createSnitflade=function(){var e=this;this.$modal.open({windowClass:"modal fade in",templateUrl:"app/components/it-system/it-interface/it-interface-modal-create.view.html",controller:["$scope","$uibModalInstance",function(t,n){t.formData={itInterfaceId:""},t.type="IT Snitflade",t.checkAvailbleUrl="api/itInterface/",t.validateName=function(){t.createForm.name.$validate()},t.validateItInterfaceId=function(){t.createForm.itInterfaceId.$validate()},t.uniqueConstraintError=!1,t.submit=function(){var r={name:t.formData.name,itInterfaceId:t.formData.itInterfaceId,belongsToId:e.user.currentOrganizationId,organizationId:e.user.currentOrganizationId},i=e.notify.addInfoMessage("Opretter snitflade...",!1);e.$http.post("api/itinterface",r).success(function(e){i.toSuccessMessage("En ny snitflade er oprettet!");var t=e.response.id;n.close(t)}).error(function(){i.toErrorMessage("Fejl! Kunne ikke oprette snitflade!")})}}]}).result.then(function(t){e.$state.go("it-system.interface-edit.main",{id:t})})},e.prototype.loadGridOptions=function(){this.user.isReadOnly||this.mainGrid.options.toolbar.push({name:"excel",text:"Eksportér til Excel",className:"pull-right"}),this.gridState.loadGridOptions(this.mainGrid)},e.prototype.saveGridProfile=function(){this.gridState.saveGridProfile(this.mainGrid),this.notify.addSuccessMessage("Filtre og sortering gemt")},e.prototype.loadGridProfile=function(){this.gridState.loadGridProfile(this.mainGrid),this.mainGrid.dataSource.read(),this.notify.addSuccessMessage("Anvender gemte filtre og sortering")},e.prototype.clearGridProfile=function(){this.gridState.removeProfile(),this.gridState.removeSession(),this.notify.addSuccessMessage("Filtre og sortering slettet"),this.reload()},e.prototype.doesGridProfileExist=function(){return this.gridState.doesGridProfileExist()},e.prototype.clearOptions=function(){this.gridState.removeProfile(),this.gridState.removeLocal(),this.gridState.removeSession(),this.notify.addSuccessMessage("Sortering, filtering og kolonnevisning, -bredde og –rækkefølge nulstillet"),this.reload()},e.prototype.reload=function(){this.$state.go(".",null,{reload:!0})},e.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},e.$inject=["$rootScope","$scope","$timeout","$state","$","_","moment","notify","user","gridStateService","$uibModal","$http","needsWidthFixService"],e}();e.CatalogController=t,angular.module("app").config(["$stateProvider",function(e){e.state("it-system.interfaceCatalog",{url:"/interface-catalog",templateUrl:"app/components/it-system/it-interface/it-interface-catalog.view.html",controller:t,controllerAs:"interfaceCatalogVm",resolve:{user:["userService",function(e){return e.getUser()}]}})}])}(e.Catalog||(e.Catalog={}))}(e.ItInterface||(e.ItInterface={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.interface-edit.advice",{url:"/advice",templateUrl:"app/components/it-advice/it-advice.view.html",controller:"object.EditAdviceCtrl",controllerAs:"Vm",resolve:{Roles:["$http",function(e){return e.get("odata/LocalItSystemRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],advices:["$http","$stateParams",function(e,t){return e.get("api/itInterface/1").then(function(e){return e.data.response.advices})}],object:["$http","$stateParams",function(e,t){var n=t.id;return e.get("api/itInterface/"+n).then(function(e){return e.data.response})}],type:[function(){return"itInterface"}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/itInterface/"+t.id+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}],advicename:["$http","$stateParams",function(e,t){var n=t.id;return e.get("api/itInterface/"+n).then(function(e){return e.data.response})}]}})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.interface-edit.interface-details",{url:"/interface-details",templateUrl:"app/components/it-system/it-interface/it-interface-edit-tab-details.view.html",controller:"system.SystemInterfaceDetailsCtrl",resolve:{tsas:["$http",function(e){return e.get("odata/LocalTsaTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],interfaces:["$http",function(e){return e.get("odata/LocalInterfaceTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],interfaceTypes:["$http",function(e){return e.get("odata/LocalItInterfaceTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],methods:["$http",function(e){return e.get("odata/LocalMethodTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],dataTypes:["$http",function(e){return e.get("odata/LocalDataTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],dataRows:["$http","itInterface",function(e,t){return e.get("api/datarow/?interfaceid="+t.id).then(function(e){return e.data.response})}]}})}]),t.controller("system.SystemInterfaceDetailsCtrl",["$scope","$http","$timeout","$state","notify","user","tsas","interfaces","interfaceTypes","methods","dataTypes","itInterface","dataRows","hasWriteAccess",function(e,t,n,r,i,a,o,s,l,c,d,u,p,f){function g(n){n.show=!0,n.updateUrl="api/dataRow/"+n.id,n.delete=function(){var e=i.addInfoMessage("Fjerner rækken...",!1);t.delete(n.updateUrl+"?organizationId="+a.currentOrganizationId).success(function(t){n.show=!1,e.toSuccessMessage("Rækken er fjernet!")}).error(function(){e.toErrorMessage("Fejl! Kunne ikke fjerne rækken!")})},e.dataRows.push(n)}function m(){r.go(".",null,{reload:!0})}e.hasWriteAccess=f,e.tsas=o,e.interfaces=s,e.interfaceTypes=l,e.methods=c,e.dataTypes=d;var h=u.exhibitedByItSystemDisabled?" (Slettes)":"";e.exposedByObj=u.exhibitedByItSystemId?{id:u.exhibitedByItSystemId,text:u.exhibitedByItSystemName+h}:null,u.updateUrl="api/itInterface/"+u.id,e.system=u,e.select2AllowClearOpt={allowClear:!0},e.dataRows=[],_.each(p,g),e.newDataRow=function(){var e={itInterfaceId:u.id},n=i.addInfoMessage("Tilføjer række...",!1);t.post("api/dataRow",e).success(function(e){g(e.response),n.toSuccessMessage("Rækken er tilføjet!")}).error(function(){n.toErrorMessage("Fejl! Kunne ikke tilføje rækken!")})},e.itSystemsSelectOptions=function(e,n){return{allowClear:!0,minimumInputLength:1,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(r){var i=n?"&"+n.join("&"):"",a=t.get(e+"q="+r.data.query+i).then(r.success);return a.abort=function(){return null},a},results:function(e,t){var n=[];return _.each(e.data.response,function(e){e.disabled||n.push({id:e.id,text:e.name})}),{results:n}}}}}("api/itsystem?",["organizationId="+a.currentOrganizationId]),e.save=function(){if("object"==typeof e.exposedByObj){if(u.isUsed&&!e.exposedByObj&&!confirm("Der er IT Systemer, som er i Lokal anvendelse som har denne snitfladerelation tilknyttet. Er du sikker på at du vil fjerne relationen?"))return void(e.exposedByObj={id:u.exhibitedByItSystemId,text:u.exhibitedByItSystemName});var n=i.addInfoMessage("Gemmer...",!1);if(e.exposedByObj)if(u.exhibitedByItSystemId){var r={itSystemId:e.exposedByObj.id},o="api/exhibit/"+u.id+"?organizationId="+a.currentOrganizationId;t({method:"PATCH",url:o,data:r}).success(function(){n.toSuccessMessage("Feltet er opdateret."),m()}).error(function(){n.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}else{var s={id:u.id,itSystemId:e.exposedByObj.id};t.post("api/exhibit",s).success(function(){n.toSuccessMessage("Feltet er opdateret."),m()}).error(function(){n.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}else t.delete("api/exhibit/"+u.id+"?organizationId="+a.currentOrganizationId).success(function(){n.toSuccessMessage("Feltet er opdateret."),m()}).error(function(){n.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.interface-edit.main",{url:"/main",templateUrl:"app/components/it-system/it-interface/it-interface-edit-tab-main.view.html",controller:"system.SystemInterfaceMainCtrl"})}]),t.controller("system.SystemInterfaceMainCtrl",["$rootScope","$scope","$http","$state","notify","itInterface","autofocus","user","hasWriteAccess",function(e,t,n,r,i,a,o,s,l){e.page.title="Snitflade - Rediger",o(),t.hasWriteAccess=l,a.belongsTo=a.belongsToId?{id:a.belongsToId,text:a.belongsToName}:null,a.updateUrl="api/itInterface/"+a.id,t.interface=a,t.select2AllowClearOpt={allowClear:!0},t.organizationSelectOptions=function(e,t,r){return{minimumInputLength:1,initSelection:function(e,t){},allowClear:t,ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(t){var i=r?"&"+r.join("&"):"",a=n.get(e+"?q="+t.data.query+i).then(t.success);return a.abort=function(){return null},a},results:function(e,t){var n=[];return _.each(e.data.response,function(e){n.push({id:e.id,text:e.name})}),{results:n}}}}}("api/organization",!0,["orgId="+s.currentOrganizationId])}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.interface-edit",{url:"/edit/{id:[0-9]+}/interface",templateUrl:"app/components/it-system/it-interface/it-interface-edit.view.html",controller:"system.interfaceEditCtrl",resolve:{user:["userService",function(e){return e.getUser()}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){var r=t.id;return e.get("api/itInterface/"+r+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}],itInterface:["$http","$stateParams",function(e,t){var n=t.id;return e.get("api/itInterface/"+n).then(function(e){return e.data.response})}]}})}]),t.controller("system.interfaceEditCtrl",["$rootScope","$scope","$http","$state","notify","itInterface","hasWriteAccess","autofocus","user","$stateParams","_",function(e,t,n,r,i,a,o,s,l,c,d){function u(){if(confirm("Er du sikker på du vil deaktivere snitfladen?")){var e={};e.Disabled=!0;var t=i.addInfoMessage("Deaktiverer snitflade...",!1);n.patch("odata/ItInterfaces("+a.id+")",e).success(function(e){t.toSuccessMessage("Snitflade er deaktiveret!"),r.reload()}).error(function(e,n){t.toErrorMessage("Fejl! Kunne ikke deaktivere snitflade!")})}}function p(){if(confirm("Er du sikker på du vil aktivere snitflade?")){var e={};e.Disabled=!1;var t=i.addInfoMessage("Aktiverer snitflade...",!1);n.patch("odata/ItInterfaces("+a.id+")",e).success(function(e){t.toSuccessMessage("Snitflade er aktiveret!"),r.reload()}).error(function(e,n){t.toErrorMessage("Fejl! Kunne ikke aktivere snitflade!")})}}e.page.title="Snitflade - Rediger",s(),t.stateId=c.id,a.belongsTo=a.belongsToId?{id:a.belongsToId,text:a.belongsToName}:null,a.updateUrl="api/itInterface/"+a.id,t.interface=a,t.hasWriteAccess=o,t.select2AllowClearOpt={allowClear:!0},t.hasWriteAccess?l.isGlobalAdmin&&(d.remove(e.page.subnav.buttons,function(e){return"Deaktivér snitflade"===e.text}),d.remove(e.page.subnav.buttons,function(e){return"Aktivér snitflade"===e.text}),1===a.accessModifier&&(a.disabled?e.page.subnav.buttons.push({func:p,text:"Aktivér snitflade",style:"btn-success",showWhen:"it-system.interface-edit"}):e.page.subnav.buttons.push({func:u,text:"Deaktivér snitflade",style:"btn-danger",showWhen:"it-system.interface-edit"}))):d.remove(e.page.subnav.buttons,function(e){return"Slet Snitflade"===e.text})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.interface-edit.references.create",{url:"createReference/:id",onEnter:["$state","$stateParams","$uibModal","user",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"contract.referenceCreateModalCtrl",resolve:{contract:["$http","$stateParams",function(e,t){return e.get("api/itcontract/"+t.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("contract.referenceCreateModalCtrl",["$scope","$http","contract","notify","user",function(e,t,n,r,i){e.dismiss=function(){e.$dismiss()},e.save=function(){var i=new Date,a={ItContract_Id:n.id,Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display,Created:i},o=r.addInfoMessage("Gemmer række",!1);t.post("api/Reference",a).success(function(t){o.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){o.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.interface-edit.references.edit",{url:"/editReference/:refId/:orgId",onEnter:["$state","$stateParams","$uibModal","$http",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"interface.referenceEditModalCtrl",resolve:{reference:["$http",function(e){return e.get("api/Reference/"+t.refId).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("interface.referenceEditModalCtrl",["$scope","$http","reference","$stateParams","notify",function(e,t,n,r,i){e.reference=n,e.dismiss=function(){e.$dismiss()},e.save=function(){var n={Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display},a=i.addInfoMessage("Gemmer række",!1);t.patch("api/Reference/"+r.refId+"?organizationId="+r.orgId,n).success(function(t){a.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){a.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.interface-edit.references",{url:"/reference/",templateUrl:"app/components/it-reference/it-reference.view.html",controller:"interface.EditReference"})}]),t.controller("interface.EditReference",["$scope","$http","$timeout","$state","$stateParams","itInterface","$confirm","notify","hasWriteAccess",function(e,t,n,r,i,a,o,s,l){function c(){r.go(".",null,{reload:!0})}e.autoSaveUrl="api/itcontract/"+i.id,e.contract=a,e.hasWriteAccess=l,e.reference=a,e.objectId=a.id,e.objectReference="it-interface.edit.references.create",e.references=a.externalReferences,e.deleteReference=function(e){var n=s.addInfoMessage("Sletter...");t.delete("api/Reference/"+e+"?organizationId="+a.organizationId).success(function(){n.toSuccessMessage("Slettet!")}).error(function(){n.toErrorMessage("Fejl! Kunne ikke slette!")}),c()},e.setChosenReference=function(e){var n=e===a.referenceId?null:e,r={referenceId:n},i=s.addInfoMessage("Opdaterer felt...",!1);t.patch("api/itContract/"+a.id+"?organizationId="+a.organizationId,r).success(function(e){i.toSuccessMessage("Feltet er opdateret!"),c()}).error(function(){i.toErrorMessage("Fejl! Prøv igen.")})},e.edit=function(e){r.go(".edit",{refId:e,orgId:a.organizationId})},e.isValidUrl=function(e){if(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())}return!1},e.mainGridOptions={dataSource:{data:a.externalReferences,pageSize:10},sortable:!0,pageable:{refresh:!1,pageSizes:!0,buttonCount:5},columns:[{field:"title",title:"Dokumenttitel",template:function(t){return e.isValidUrl(t.url)?'<a target="_blank" href="'+t.url+'" target="_blank" >'+t.title+"</a>":t.title},width:240},{field:"externalReferenceId",title:"Evt. dokumentID/Sagsnr./anden referenceContact"},{field:"created",title:"Oprettet",template:"#= kendo.toString(kendo.parseDate(created, 'yyyy-MM-dd'), 'dd. MMMM yyyy') #"},{field:"objectOwner.fullName",title:"Oprettet af",width:150},{title:"Rediger",template:function(t){var n="<button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' title='Redigér reference' data-ng-click=\"edit("+t.id+")\"><i class='fa fa-pencil' aria-hidden='true'></i></button>";return t.id!=a.referenceId&&(n+=" <button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' data-confirm-click=\"Er du sikker på at du vil slette?\" class='btn btn-link' title='Slet reference' data-confirmed-click='deleteReference("+t.id+")'><i class='fa fa-trash-o' aria-hidden='true'></i></button>"),e.isValidUrl(t.url)&&(n=t.id===a.referenceId?n+'<button data-uib-tooltip="Vises i overblik" data-ng-disabled=\''+!e.hasWriteAccess+"' tooltip-placement='right' class='btn btn-link' data-ng-click='setChosenReference("+t.id+")'><img class='referenceIcon chosen' src=\"/Content/img/VisIOverblik.svg\"/></button>":n+'<button data-uib-tooltip="Vis objekt i overblik" data-ng-disabled=\''+!e.hasWriteAccess+"' tooltip-placement='right' class='btn btn-link' data-ng-click='setChosenReference("+t.id+")'><img class='referenceIcon' src=\"/Content/img/VisIOverblik.svg\"></img></button>"),n}}],toolbar:[{name:"addReference",text:"Tilføj reference",template:function(){return l?'<a id="addReference" class="btn btn-success btn-sm" href="\\#/contract/edit/'+a.id+"/reference/createReference/"+a.id+'">Tilføj reference</a>':""}}]}}])}(angular,app),function(e,t){t.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("it-system.edit",{url:"/edit/{id:[0-9]+}",templateUrl:"app/components/it-system/edit/it-system-edit.view.html",controller:"system.EditCtrl",resolve:{itSystem:["$http","$stateParams",function(e,t){return e.get("api/itsystem/"+t.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser()}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/itsystem/"+t.id+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}]}})}]),t.controller("system.EditCtrl",["$rootScope","$scope","itSystem","user","hasWriteAccess","$state","notify","$http","_",function(e,t,n,r,i,a,o,s,l){function c(){if(confirm("Er du sikker på du vil deaktivere systemet?")){var e={};e.Disabled=!0;var t=o.addInfoMessage("Deaktiverer IT System...",!1);s.patch("odata/ItSystems("+n.id+")",e).success(function(e){t.toSuccessMessage("IT System er deaktiveret!"),a.reload()}).error(function(e,n){t.toErrorMessage("Fejl! Kunne ikke deaktivere IT System!")})}}function d(){if(confirm("Er du sikker på du vil aktivere systemet?")){var e={};e.Disabled=!1;var t=o.addInfoMessage("Aktiverer IT System...",!1);s.patch("odata/ItSystems("+n.id+")",e).success(function(e){t.toSuccessMessage("IT System er aktiveret!"),a.reload()}).error(function(e,n){t.toErrorMessage("Fejl! Kunne ikke aktivere IT System!")})}}function u(){if(confirm("Er du sikker på du vil slette systemet?")){var e=a.params.id,t=o.addInfoMessage("Sletter IT System...",!1);s.delete("api/itsystem/"+e+"?organizationId="+r.currentOrganizationId).success(function(e){t.toSuccessMessage("IT System  er slettet!"),a.go("it-system.catalog")}).error(function(e,n){409===n?t.toErrorMessage("Fejl! IT Systemet er i lokal anvendelse!"):401===n?t.toErrorMessage("Fejl! Du har ikke tilladelse!"):t.toErrorMessage("Fejl! Kunne ikke slette IT System!")})}}t.hasWriteAccess=i,r.isGlobalAdmin?e.page.subnav.buttons.some(function(e){return"Slet IT System"===e.text})||e.page.subnav.buttons.push({func:u,text:"Slet IT System",style:"btn-danger",showWhen:"it-system.edit"}):i&&r.currentOrganizationId===n.organizationId&&0===n.accessModifier||t.hasWriteAccess&&r.id===n.objectOwnerId&&0===n.accessModifier?e.page.subnav.buttons.some(function(e){return"Slet IT System"===e.text})||e.page.subnav.buttons.push({func:u,text:"Slet IT System",style:"btn-danger",showWhen:"it-system.edit"}):l.remove(e.page.subnav.buttons,function(e){return"Slet IT System"===e.text}),(1===n.accessModifier||r.isGlobalAdmin||r.isLocalAdmin)&&(l.remove(e.page.subnav.buttons,function(e){return"Deaktivér IT System"===e.text}),l.remove(e.page.subnav.buttons,function(e){return"Aktivér IT System"===e.text}),(1===n.accessModifier||r.isGlobalAdmin||r.isLocalAdmin)&&(n.disabled?e.page.subnav.buttons.push({func:d,text:"Aktivér IT System",style:"btn-success",showWhen:"it-system.edit"}):e.page.subnav.buttons.push({func:c,text:"Deaktivér IT System",style:"btn-danger",showWhen:"it-system.edit"})))}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.advice-generic",{url:"/advice",templateUrl:"app/components/it-advice/it-advice.view.html",controller:"object.EditAdviceCtrl",controllerAs:"Vm",resolve:{Roles:["$http",function(e){return e.get("odata/LocalItProjectRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],advices:["$http","$stateParams",function(e,t){return e.get("api/itProject/"+t.id).then(function(e){return e.data.response.advices})}],object:["project",function(e){return e}],type:[function(){return"itProject"}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/itProject/"+t.id+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}],advicename:["$http","$stateParams",function(e,t){return e.get("api/itProject/"+t.id).then(function(e){return e.data.response})}]}})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.communication",{url:"/communication",templateUrl:"app/components/it-project/tabs/it-project-tab-communication.view.html",controller:"project.EditCommunicationCtrl",resolve:{comms:["$http","$stateParams",function(e,t){return e.get("api/communication/"+t.id+"?project=true").then(function(e){return e.data.response})}],usersWithRoles:["$http","$stateParams",function(e,t){return e.get("api/itprojectright/"+t.id).then(function(t){var n=t.data.response;return e.get("odata/ItProjectRoles?%24format=json&%24top=100&%24orderby=priority+desc&%24count=true").then(function(e){var t=e.data.value,r={};return _.each(n,function(e){var n=r[e.userId]||e.user,i=_.find(t,{Id:e.roleId}),a=n.roleNames||[];a.push(i.Name),n.roleNames=a,r[e.userId]=n}),r})})}]}})}]),t.controller("project.EditCommunicationCtrl",["$scope","$http","notify","$timeout","$state","$stateParams","comms","usersWithRoles","user",function(e,t,n,r,i,a,o,s,l){function c(){return i.transitionTo(i.current,a,{reload:!0}).then(function(){return e.hideContent=!0,r(function(){return e.hideContent=!1},1)})}e.comms=o,e.usersWithRoles=_.values(s),e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},e.comm={itProjectId:a.id},e.save=function(){if(e.$broadcast("show-errors-check-validity"),!e.commForm.$invalid){var n=moment(e.comm.dueDate,"DD-MM-YYYY");n.isValid()?e.comm.dueDate=n.format("YYYY-MM-DD"):e.comm.dueDate=null,t.post("api/communication",e.comm).finally(c)}},e.delete=function(e){t.delete("api/communication/"+e+"?organizationId="+l.currentOrganizationId).finally(c)},e.checkDate=function(t){var r=moment(t,"DD-MM-YYYY");e.DateFailed=!1,(!r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099)&&(n.addErrorMessage("Den indtastede dato er ugyldig."),e.DateFailed=!0)}}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){var t=function(){function e(e){this.project=e}return e.$inject=["project"],e}();angular.module("app").config(["$stateProvider",function(e){e.state("it-project.edit.description",{url:"/description",templateUrl:"app/components/it-project/tabs/it-project-tab-description.view.html",controller:t,controllerAs:"projectDescriptionVm"})}])}(e.Edit||(e.Edit={}))}(e.ItProject||(e.ItProject={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.economy",{url:"/economy",templateUrl:"app/components/it-project/tabs/it-project-tab-economy.view.html",controller:"project.EditEconomyCtrl",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}]}})}]),t.controller("project.EditEconomyCtrl",["$rootScope","$scope","project",function(e,t,n){function r(e){return{label:e,titlerow:!0}}function i(e,t){return{label:e,columns:_.map(n.economyYears,function(){return{budget:0,rea:0}}),total:{budget:0,rea:0},readonly:!0,classes:t}}function a(e,t,r,i){var a=e+"Budget",o=e+"Rea",s=_.map(n.economyYears,function(e){return{updateUrl:"api/economyYear/"+e.id,budget:e[a],rea:e[o]}}),l={budgetName:a,reaName:o,label:t,columns:s,total:{budget:0,rea:0},update:null};l.update=function(){return i(l)},r.push(l),l.update()}function o(e,t){return a(e,t,g,function(e){d(e),u(g,m),u([m,v],y),p(O,y,w)})}function s(e,t){return a(e,t,h,function(e){d(e),u(h,v),u([m,v],y),p(O,y,w)})}function l(e,t){return a(e,t,b,function(e){d(e),u(b,S),u([S,$],O),p(O,y,w)})}function c(e,t){return a(e,t,k,function(e){d(e),u(k,$),u([S,$],O),p(O,y,w)})}function d(e){var t=_.reduce(e.columns,function(e,t){return{budget:e.budget+parseInt(t.budget),rea:e.rea+parseInt(t.rea)}},{budget:0,rea:0});e.total=t}function u(e,t){_.each(t.columns,function(t,n){var r=_.reduce(e,function(e,t){return{budget:e.budget+parseInt(t.columns[n].budget),rea:e.rea+parseInt(t.columns[n].rea)}},{budget:0,rea:0});t.budget=r.budget,t.rea=r.rea}),t.total=_.reduce(e,function(e,t){return{budget:e.budget+t.total.budget,rea:e.rea+t.total.rea}},{budget:0,rea:0})}function p(e,t,n){_.each(n.columns,function(n,r){n.budget=e.columns[r].budget-t.columns[r].budget,n.rea=e.columns[r].rea-t.columns[r].rea}),n.total={budget:e.total.budget-t.total.budget,rea:e.total.rea-t.total.rea}}t.columns=_.range(6);var f=r("OMKOSTNINGER"),g=[],m=i("Forretningsmæssige omkostninger","sub-sum"),h=[],v=i("IT omkostninger","sub-sum"),y=i("OMKOSTNINGER TOTAL","sum"),I=r("BESPARELSER"),b=[],S=i("Forretningsmæssige besparelser","sub-sum"),k=[],$=i("IT besparelser","sub-sum"),O=i("BESPARELSER TOTAL","sum"),w=i("Finansieringsbehov / besparelse","super-sum");o("consultant","Konsulentbistand"),o("education","Uddannelse (medarbejdere/borgere mv.)"),o("otherBusinessExpenses","Andre forretningsmæssige omkostninger"),o("increasedBusinessExpenses","Øgede forretningsmæssige omkostninger"),s("hardware","Hardware"),s("software","Software"),s("otherItExpenses","Andre IT omkostninger"),s("increasedItExpenses","Øgede IT omkostninger"),l("salary","Lønbesparelser"),l("otherBusinessSavings","Andre forretningsmæssige besparelser"),c("licenseSavings","Besparelser på licenser"),c("systemMaintenanceSavings","Besparelser på systemvedligehold"),c("otherItSavings","Andre IT driftsbesparelser"),t.rows=[].concat([f],g,[m],h,[v],[y],[I],b,[S],k,[$],[O],[w])}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.handover",{url:"/handover",templateUrl:"app/components/it-project/tabs/it-project-tab-handover.view.html",controller:"project.EditHandoverCtrl",resolve:{handover:["$http","$stateParams",function(e,t){var n=t.id;return e.get("api/handover/"+n).then(function(e){return e.data.response})}],usersWithRoles:["$http","$stateParams",function(e,t){return e.get("api/itprojectright/"+t.id).then(function(t){var n=t.data.response;return e.get("odata/ItProjectRoles?%24format=json&%24top=100&%24orderby=priority+desc&%24count=true").then(function(e){var t=e.data.value,r={};return _.each(n,function(e){var n=r[e.userId]||e.user,i=_.find(t,{Id:e.roleId}),a=n.roleNames||[];a.push(i.Name),n.roleNames=a,r[e.userId]=n}),r})})}]}})}]),t.controller("project.EditHandoverCtrl",["$scope","$http","$stateParams","dateFilter","handover","usersWithRoles",function(e,t,n,r,i,a){e.handover=i,e.usersWithRoles=a,e.autosaveUrl="api/handover/"+n.id,e.participants=_.map(i.participants,function(e){return e.id.toString()}),e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},e.select2Options={dropdownAutoWidth:!0},e.$watch("participants",function(n,r){if(n.length>r.length){var i=_.difference(n,r);t.post(e.autosaveUrl+"?participantId="+i)}else if(n.length<r.length){var a=_.difference(r,n);t.delete(e.autosaveUrl+"?participantId="+a)}})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.hierarchy",{url:"/hierarchy",templateUrl:"app/components/it-project/tabs/it-project-tab-hierarchy.view.html",controller:"project.EditHierarchyCtrl",resolve:{hierarchyFlat:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id+"?hierarchy").then(function(e){return e.data.response})}]}})}]),t.controller("project.EditHierarchyCtrl",["$scope","_","hierarchyFlat","project",function(e,t,n,r){e.hierarchy=t.toHierarchy(n,"id","parentId","children"),e.project=r}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.itsys",{url:"/itsys",templateUrl:"app/components/it-project/tabs/it-project-tab-itsys.view.html",controller:"project.EditItsysCtrl",resolve:{user:["userService",function(e){return e.getUser()}],usages:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id+"?usages=true").then(function(e){return e.data.response})}]}})}]),t.controller("project.EditItsysCtrl",["$scope","$http","$timeout","$state","$stateParams","user","notify","usages",function(e,t,n,r,i,a,o,s){function l(){r.go(".",null,{reload:!0})}var c=i.id;e.systemUsages=s,e.save=function(){t.post("api/itproject/"+c+"?usageId="+e.selectedSystemUsage.id+"&organizationId="+a.currentOrganizationId).success(function(){o.addSuccessMessage("Systemet er tilknyttet."),l()}).error(function(){o.addErrorMessage("Fejl! Kunne ikke tilknytte systemet!")})},e.delete=function(e){t.delete("api/itproject/"+c+"?usageId="+e+"&organizationId="+a.currentOrganizationId).success(function(){o.addSuccessMessage("Systemets tilknyttning er fjernet."),l()}).error(function(){o.addErrorMessage("Fejl! Kunne ikke fjerne systemets tilknyttning!")})},e.itSystemUsagesSelectOptions={minimumInputLength:1,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(e){
var n=t.get("api/itSystemUsage?organizationId="+a.currentOrganizationId+"&q="+e.data.query).then(e.success);return n.abort=function(){return null},n},results:function(e,t){var n=[];return _.each(e.data.response,function(e){e.itSystem.disabled||n.push({id:e.id,text:e.itSystem.name,usage:e})}),{results:n}}}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.kle",{url:"/kle",templateUrl:"app/components/it-project/tabs/it-project-tab-kle.view.html",controller:"project.EditKleCtrl",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}]}})}]),t.controller("project.EditKleCtrl",["$scope","$http","$state","$stateParams","notify","user",function(e,t,n,r,i,a){function o(){var n=u+"?tasks=true";n+="&onlySelected="+!e.showAllTasks,n+="&taskGroup="+e.selectedTaskGroup,n+="&skip="+e.pagination.skip+"&take="+e.pagination.take,e.pagination.orderBy&&(n+="&orderBy="+e.pagination.orderBy,e.pagination.descending&&(n+="&descending="+e.pagination.descending)),t.get(n).success(function(t,n,r){e.tasklist=t.response;var i=JSON.parse(r("X-Pagination"));e.totalCount=i.TotalCount}).error(function(){i.addErrorMessage("Kunne ikke hente opgaver!")})}function s(e){return t.post(u+"?taskId="+e.taskRef.id+"&organizationId="+a.currentOrganizationId,{ignoreLoadingBar:!0}).then(function(t){e.isSelected=!0})}function l(e){return t.delete(u+"?taskId="+e.taskRef.id+"&organizationId="+a.currentOrganizationId,{ignoreLoadingBar:!0}).then(function(t){e.isSelected=!1})}function c(){n.go(".",null,{reload:!0})}var d=r.id,u="api/itProject/"+d;e.pagination={skip:0,take:50},e.showAllTasks=!0,e.$watch("selectedTaskGroup",function(t,n){e.pagination.skip=0,o()}),e.$watchCollection("pagination",o),e.changeTaskView=function(){e.showAllTasks=!e.showAllTasks,e.pagination.skip=0,o()},e.save=function(e){var t=i.addInfoMessage("Opdaterer ...",!1);e.isSelected?l(e).then(function(){t.toSuccessMessage("Feltet er opdateret!")},function(){t.toErrorMessage("Fejl!")}):s(e).then(function(){t.toSuccessMessage("Feltet er opdateret!")},function(){t.toErrorMessage("Fejl!")})},e.selectAllTasks=function(){_.each(e.tasklist,function(e){e.isSelected||s(e)})},e.removeAllTasks=function(){_.each(e.tasklist,function(e){e.isSelected&&l(e)})},e.selectTaskGroup=function(){var n=u+"?taskId="+e.selectedTaskGroup+"&organizationId="+a.currentOrganizationId,r=i.addInfoMessage("Opretter tilknytning...",!1);t.post(n).then(function(){r.toSuccessMessage("Tilknytningen er oprettet"),c()},function(){r.toErrorMessage("Fejl! Kunne ikke oprette tilknytningen!")})},e.removeTaskGroup=function(){var n=u+"?taskId="+e.selectedTaskGroup+"&organizationId="+a.currentOrganizationId,r=i.addInfoMessage("Fjerner tilknytning...",!1);t.delete(n).then(function(){r.toSuccessMessage("Tilknytningen er fjernet"),c()},function(){r.toErrorMessage("Fejl! Kunne ikke fjerne tilknytningen!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.main",{url:"/main",templateUrl:"app/components/it-project/tabs/it-project-tab-main.view.html",controller:"project.EditMainCtrl"})}]),t.controller("project.EditMainCtrl",["$scope","$http","notify","_","project","projectTypes","user","hasWriteAccess","moment","autofocus",function(e,t,n,r,i,a,o,s,l,c){e.projectTypes=a,e.autosaveUrl="api/itproject/"+i.id,e.moment=l,e.hasWriteAccess=s,e.project=i,e.global=o.isGlobalAdmin,e.project.parentId&&(e.project.parent={id:e.project.parentId,text:e.project.parentName}),e.selectLazyLoading=function(n,i,a){return{minimumInputLength:1,allowClear:!0,placeholder:" ",initSelection:function(){},ajax:{data:function(e){return{query:e}},quietMillis:500,transport:function(e){var r=a?"&"+a.join("&"):"";return t.get(n+"?q="+e.data.query+r).then(e.success)},results:function(t){var n=[];return r.each(t.data.response,function(t){i&&t.id==e.project.id||n.push({id:t.id,text:t.name?t.name:"Unavngiven",cvr:t.cvr})}),{results:n}}}}},e.parentSelectOptions=e.selectLazyLoading("api/itproject",!0,["overview=true","orgId="+o.currentOrganizationId])}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.org",{url:"/org",templateUrl:"app/components/it-project/tabs/it-project-tab-org.view.html",controller:"project.EditOrgCtrl",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}],isTransversal:["project",function(e){return e.isTransversal}],selectedOrgUnits:["$http","$stateParams",function(e,t){var n=t.id;return e.get("api/itProjectOrgUnitUsage/"+n).then(function(e){return e.data.response})}],responsibleOrgUnitId:["$http","$stateParams",function(e,t){var n=t.id;return e.get("api/itProjectOrgUnitUsage/"+n+"?responsible=true").then(function(e){return e.data.response?e.data.response.id:null})}],orgUnitsTree:["$http","project",function(e,t){return e.get("api/organizationunit/?organization="+t.organizationId).then(function(e){return[e.data.response]})}]}})}]),t.controller("project.EditOrgCtrl",["$scope","$http","$stateParams","notify","isTransversal","orgUnitsTree","selectedOrgUnits","responsibleOrgUnitId","user",function(e,t,n,r,i,a,o,s,l){function c(e,t){if(e.id==t)return e;if(null!=e.children){for(var n=null,r=0;null==n&&r<e.children.length;r++)n=c(e.children[r],t);return n}return null}e.orgUnitsTree=a,e.isTransversal=i,e.selectedOrgUnits=o,e.responsibleOrgUnitId=s;var d=n.id;e.patchUrl="api/itproject/"+d,e.saveResponsible=function(){var n=e.responsibleOrgUnitId,i=r.addInfoMessage("Gemmer... ");e.responsibleOrgUnitId?t.post("api/itProjectOrgUnitUsage/?projectId="+d+"&orgUnitId="+n+"&responsible").success(function(){i.toSuccessMessage("Gemt!")}).error(function(){i.toErrorMessage("Fejl! Kunne ikke gemmes!")}):t.delete("api/itProjectOrgUnitUsage/?projectId="+d+"&responsible").success(function(){i.toSuccessMessage("Gemt!")}).error(function(){i.toErrorMessage("Fejl! Kunne ikke gemmes!")})},e.save=function(n){var i=r.addInfoMessage("Gemmer... ");n.selected?t.post("api/itproject/"+d+"?organizationunit="+n.id+"&organizationId="+l.currentOrganizationId).success(function(){i.toSuccessMessage("Gemt!"),e.selectedOrgUnits.push(n)}).error(function(){i.toErrorMessage("Fejl! Kunne ikke gemmes!")}):t.delete("api/itproject/"+d+"?organizationunit="+n.id+"&organizationId="+l.currentOrganizationId).success(function(){i.toSuccessMessage("Gemt!");var t;_.filter(e.selectedOrgUnits,function(e,r){var i=e.id==n.id;return i&&(t=r),i})&&e.selectedOrgUnits.splice(t,1),n.id==e.responsibleOrgUnitId&&(e.responsibleOrgUnitId="")}).error(function(){i.toErrorMessage("Fejl! Kunne ikke gemmes!")})};var u=_.map(o,"id");_.each(u,function(e){var t=c(a[0],e);t&&(t.selected=!0)})}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i){this.$scope=e,this.$http=t,this.notify=n,this.project=r,this.user=i,this.project.updateUrl="api/itproject/"+this.project.id+"?organizationId="+this.user.currentOrganizationId,this.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},this.project.phases=[this.project.phase1,this.project.phase2,this.project.phase3,this.project.phase4,this.project.phase5]}return e.prototype.updatePhaseName=function(e,t){var n=this,r={};r.Name=e.name,this.$http.post(this.project.updateUrl+"&phaseNum="+t,r).then(function(){return n.notify.addSuccessMessage("Feltet er opdateret")},function(){return n.notify.addErrorMessage("Fejl!")})},e.prototype.updateSelectedPhase=function(e){var t=this;this.patch(this.project.updateUrl,"currentPhase",e).then(function(n){t.notify.addSuccessMessage("Feltet er opdateret"),t.project.currentPhase=e},function(){return t.notify.addErrorMessage("Fejl!")})},e.prototype.updatePhaseDate=function(e,t){var n,r=this,i=moment(e.startDate,"DD-MM-YYYY");if(!i.isValid())return void this.notify.addErrorMessage("Den indtastede dato er ugyldig.");n=i.format("YYYY-MM-DD");var a={};a.StartDate=n,this.$http.post(this.project.updateUrl+"&phaseNum="+t,a).then(function(){if(t>1){var e=t-1,i={};i.EndDate=n,r.$http.post(r.project.updateUrl+"&phaseNum="+e,i).then(function(){return r.notify.addSuccessMessage("Feltet er opdateret")},function(){return r.notify.addErrorMessage("Fejl!")})}},function(){return r.notify.addErrorMessage("Fejl!")})},e.prototype.patch=function(e,t,n){var r={};return r[t]=n,this.$http({method:"PATCH",url:e,data:r})},e.$inject=["$scope","$http","notify","project","user"],e}();angular.module("app").config(["$stateProvider",function(e){e.state("it-project.edit.phases",{url:"/phases",templateUrl:"app/components/it-project/tabs/it-project-tab-phases.view.html",controller:t,controllerAs:"projectPhasesVm"})}])}(e.Edit||(e.Edit={}))}(e.ItProject||(e.ItProject={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.references.create",{url:"/createReference/:id",onEnter:["$state","$stateParams","$uibModal","project","user",function(e,t,n,r,i){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"project.referenceCreateModalCtrl",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("project.referenceCreateModalCtrl",["$scope","$http","project","notify","user",function(e,t,n,r,i){e.dismiss=function(){e.$dismiss()},e.save=function(){var i=new Date,a={ItProject_Id:n.id,Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display,Created:i},o=r.addInfoMessage("Gemmer række",!1);t.post("api/Reference",a).success(function(t){o.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){o.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.references.edit",{url:"/editReference/:refId/:orgId",onEnter:["$state","$stateParams","$uibModal","$http",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"project.referenceEditModalCtrl",resolve:{reference:["$http",function(e){return e.get("api/Reference/"+t.refId).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("project.referenceEditModalCtrl",["$scope","$http","reference","$stateParams","notify",function(e,t,n,r,i){e.reference=n,e.dismiss=function(){e.$dismiss()},e.save=function(){var n={Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display},a=i.addInfoMessage("Gemmer række",!1);t.patch("api/Reference/"+r.refId+"?organizationId="+r.orgId,n).success(function(t){a.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){a.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.references",{url:"/reference",templateUrl:"app/components/it-reference/it-reference.view.html",controller:"project.EditReference",controllerAs:"Vm"})}]),t.controller("project.EditReference",["$scope","$http","$timeout","$state","$stateParams","project","$confirm","notify","$","hasWriteAccess",function(e,t,n,r,i,a,o,s,l,c){function d(){r.go(".",null,{reload:!0})}e.hasWriteAccess=c,e.reference=a,e.deleteReference=function(e){var n=s.addInfoMessage("Sletter...");t.delete("api/Reference/"+e+"?organizationId="+a.organizationId).success(function(){n.toSuccessMessage("Slettet!")}).error(function(){n.toErrorMessage("Fejl! Kunne ikke slette!")}),d()},e.referenceName=a.name,e.setChosenReference=function(e){var n=e===a.referenceId?null:e,r={referenceId:n},i=s.addInfoMessage("Opdaterer felt...",!1);t.patch("api/itProject/"+a.id+"?organizationId="+a.organizationId,r).success(function(e){i.toSuccessMessage("Feltet er opdateret!"),d()}).error(function(){i.toErrorMessage("Fejl! Prøv igen.")})},e.isValidUrl=function(e){if(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())}return!1},e.edit=function(e){r.go(".edit",{refId:e,orgId:a.organizationId})},e.mainGridOptions={dataSource:{data:a.externalReferences,pageSize:10},sortable:!0,pageable:{refresh:!1,pageSizes:!0,buttonCount:5},columns:[{field:"title",title:"Dokumenttitel",template:function(e){return e.url?'<a target="_blank" href="'+e.url+'">'+e.title+"</a>":e.title},width:240},{field:"externalReferenceId",title:"Evt. dokumentID/Sagsnr./anden referenceContact"},{field:"created",title:"Oprettet",template:"#= kendo.toString(kendo.parseDate(created, 'yyyy-MM-dd'), 'dd. MMMM yyyy') #"},{field:"objectOwner.fullName",title:"Oprettet af",width:150},{title:"Rediger",template:function(t){var n="<button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' title='Redigér reference' data-ng-click=\"edit("+t.id+")\"><i class='fa fa-pencil' aria-hidden='true'></i></button>";return t.id!=a.referenceId&&(n+=" <button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' data-confirm-click=\"Er du sikker på at du vil slette?\" class='btn btn-link' title='Slet reference' data-confirmed-click='deleteReference("+t.id+")'><i class='fa fa-trash-o'  aria-hidden='true'></i></button>"),t.url&&(n=t.id===a.referenceId?n+"<button data-ng-disabled='"+!e.hasWriteAccess+"' data-uib-tooltip=\"Vises i overblik\" tooltip-placement='right' class='btn btn-link' data-ng-click='setChosenReference("+t.id+")'><img class='referenceIcon chosen' src=\"/Content/img/VisIOverblik.svg\"/></button>":n+"<button data-ng-disabled='"+!e.hasWriteAccess+"' data-uib-tooltip=\"Vis objekt i overblik\"  tooltip-placement='right' class='btn btn-link' data-ng-click='setChosenReference("+t.id+")'><img class='referenceIcon' src=\"/Content/img/VisIOverblik.svg\"></img></button>"),n}}],toolbar:[{name:"addReference",text:"Tilføj reference",template:function(){return c?'<a id="addReference" class="btn btn-success btn-sm" href="\\#/project/edit/'+a.id+"/reference/createReference/"+a.id+"\"'>Tilføj reference</a>":""}}]}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.risk",{url:"/risk",templateUrl:"app/components/it-project/tabs/it-project-tab-risk.view.html",controller:"project.EditRiskCtrl",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}],risks:["$http","project",function(e,t){return e.get("api/risk/?getByProject=true&projectId="+t.id).then(function(e){return e.data.response})}],usersWithRoles:["$http","$stateParams",function(e,t){return e.get("api/itprojectright/"+t.id).then(function(t){var n=t.data.response;return e.get("odata/ItProjectRoles?%24format=json&%24top=100&%24orderby=priority+desc&%24count=true").then(function(e){var t=e.data.value,r={};return _.each(n,function(e){var n=r[e.userId]||e.user,i=_.find(t,{Id:e.roleId}),a=n.roleNames||[];a.push(i.Name),n.roleNames=a,r[e.userId]=n}),r})})}]}})}]),t.controller("project.EditRiskCtrl",["$scope","$http","$stateParams","notify","risks","usersWithRoles","user",function(e,t,n,r,i,a,o){function s(t){t.show=!0,t.updateUrl="api/risk/"+t.id,e.risks.push(t)}function l(){e.newRisk={consequence:1,probability:1}}var c=n.id;e.risks=[],e.usersWithRoles=_.values(a),_.each(i,s),e.product=function(e){return e.product=e.consequence*e.probability,e.product},e.delete=function(e){t.delete(e.updateUrl+"?organizationId="+o.currentOrganizationId).success(function(t){e.show=!1,r.addSuccessMessage("Rækken er slettet")}).error(function(){r.addErrorMessage("Fejl! Kunne ikke slette!")})},e.averageProduct=function(){return 0==e.risks.length?0:_.reduce(e.risks,function(e,t){return e+t.product},0)/e.risks.length},l(),e.saveNewRisk=function(){if(e.$broadcast("show-errors-check-validity"),!e.riskForm.$invalid){var n=e.newRisk;if(n.name&&n.action&&n.responsibleUserId){var i={itProjectId:c,name:n.name,action:n.action,probability:n.probability,consequence:n.consequence,responsibleUserId:n.responsibleUserId},a=r.addInfoMessage("Gemmer række",!1);t.post("api/risk",i).success(function(e){s(e.response),l(),a.toSuccessMessage("Rækken er gemt")}).error(function(){a.toErrorMessage("Fejl! Prøv igen")})}}}}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){var t=function(){function e(e,t,n,r,i,a,o,s,l,c){var d=this;this.$http=n,this._=r,this.notify=i,this.itProjectRoles=s,this.localItProjectRoles=l,this.user=c,this.projectId=a.id,this.orgId=this.user.currentOrganizationId,this.activeItProjectRoles=l,this.newRole="1",this.rights=[],r.each(o,function(e){e.role=r.find(d.itProjectRoles,{Id:e.roleId}),e.show=!0;var t=r.find(d.activeItProjectRoles,{Id:e.roleId});!angular.isUndefined(t)&&t.Description&&(e.role.Description=t.Description),e.userForSelect={id:e.user.id,text:e.user.fullName},e.roleForSelect=e.roleId,d.rights.push(e)}),t.$watch(function(){return d.selectedUser},function(){return d.submitRight()}),this.rightSortBy="roleName",this.rightSortReverse=!1}return e.prototype.rightSortChange=function(e){this.rightSortBy===e?this.rightSortReverse=!this.rightSortReverse:this.rightSortReverse=!1,this.rightSortBy=e},e.prototype.rightSort=function(e){switch(this.rightSortBy){case"roleName":return e.role.Priority;case"userName":return e.user.fullName;case"userEmail":return e.user.email;default:return e.role.Priority}},e.prototype.updateRight=function(e){var t=this;if(e.roleForSelect&&e.userForSelect){if(!this.checkIfRoleIsAvailable(e.roleForSelect))return void(e.edit=!1);var n=e.roleId,r=e.userId,i=e.roleForSelect,a=e.userForSelect.id;n===i&&r===a&&(e.edit=!1),this.$http.delete("api/itprojectright/"+this.projectId+"?rId="+n+"&uId="+r+"&organizationId="+this.user.currentOrganizationId).then(function(n){var r={roleId:i,userId:a};t.$http.post("api/itprojectright/"+t.projectId+"?organizationId="+t.user.currentOrganizationId,r).then(function(n){e.roleId=n.data.response.roleId,e.user=n.data.response.user,e.userId=n.data.response.userId,e.role=_.find(t.localItProjectRoles,{Id:e.roleId}),e.edit=!1,t.notify.addSuccessMessage(e.user.fullName+" er knyttet i rollen")},function(n){e.show=!1,t.notify.addErrorMessage("Fejl!")})},function(n){e.userForSelect={id:e.user.id,text:e.user.fullName},e.roleForSelect=e.roleId,t.notify.addErrorMessage("Fejl!")})}},e.prototype.deleteRight=function(e){var t=this,n=e.roleId,r=e.userId;this.$http.delete("api/itprojectright/"+this.projectId+"?rId="+n+"&uId="+r+"&organizationId="+this.user.currentOrganizationId).then(function(n){e.show=!1,t.notify.addSuccessMessage("Rollen er slettet!")},function(e){t.notify.addErrorMessage("Kunne ikke slette rollen!")})},e.prototype.submitRight=function(){var e=this;if(this.selectedUser&&this.newRole){var t=this.projectId,n=parseInt(this.newRole,10),r=this.selectedUser.id;if(t&&n&&r){var i={roleId:n,userId:r};this.$http.post("api/itprojectright/"+t+"?organizationId="+this.user.currentOrganizationId,i).then(function(t){e.notify.addSuccessMessage(t.data.response.user.fullName+" er knyttet i rollen"),e.rights.push({objectId:t.data.response.objectId,roleId:t.data.response.roleId,userId:t.data.response.userId,user:t.data.response.user,userForSelect:{id:t.data.response.userId,text:t.data.response.user.fullName},roleForSelect:t.data.response.roleId,role:e._.find(e.localItProjectRoles,{Id:t.data.response.roleId}),show:!0}),e.newRole="1",e.selectedUser=""},function(t){return e.notify.addErrorMessage("Fejl!")})}}},e.prototype.checkIfRoleIsAvailable=function(e){return _.find(this.activeItProjectRoles,function(t){return t.Id===parseInt(e,10)})},e.$inject=["$rootScope","$scope","$http","_","notify","project","itProjectRights","itProjectRoles","localItProjectRoles","user"],e}();angular.module("app").config(["$stateProvider",function(e){e.state("it-project.edit.roles",{url:"/roles",templateUrl:"app/components/it-project/tabs/it-project-tab-roles.view.html",controller:t,controllerAs:"projectRolesVm",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}],itProjectRights:["$http","$stateParams",function(e,t){return e.get("api/itprojectright/"+t.id).then(function(e){return e.data.response})}],itProjectRoles:["$http",function(e){return e.get("odata/ItProjectRoles").then(function(e){return e.data.value})}],localItProjectRoles:["$http",function(e){return e.get("odata/LocalItProjectRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}})}])}(e.Edit||(e.Edit={}))}(e.ItProject||(e.ItProject={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.stakeholders",{url:"/stakeholders",templateUrl:"app/components/it-project/tabs/it-project-tab-stakeholders.view.html",controller:"project.EditStakeholdersCtrl",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}]}})}]),t.controller("project.EditStakeholdersCtrl",["$rootScope","$scope","$http","notify","project","user",function(e,t,n,r,i,a){function o(e){e.show=!0,e.updateUrl="api/stakeholder/"+e.id,e.delete=function(){var t=r.addInfoMessage("Sletter...");n.delete(e.updateUrl+"?organizationId="+a.currentOrganizationId).success(function(){e.show=!1,t.toSuccessMessage("Rækken er slettet")}).error(function(){t.toErrorMessage("Kunne ikke slette!")})},t.stakeholders.push(e)}function s(){t.new={}}t.stakeholders=[],_.each(i.stakeholders,o),s(),t.saveNewStakeholder=function(){if(t.$broadcast("show-errors-check-validity"),null!=t.new.name&&null!=t.new.role&&null!=t.new.downsides&&null!=t.new.benefits&&null!=t.new.significance&&null!=t.new.howToHandle){var e=t.new,a={itProjectId:i.id,name:e.name,role:e.role,downsides:e.downsides,benefits:e.benefits,significance:e.significance,howToHandle:e.howToHandle},l=r.addInfoMessage("Gemmer... ");n.post("api/stakeholder",a).success(function(e){l.toSuccessMessage("Rækken er tilføjet."),o(e.response),s()}).error(function(){l.toErrorMessage("Fejl! Kunne ikke gemme!")})}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.status-goal.modal",{url:"/modal/:goalId",onEnter:["$state","$stateParams","$uibModal","goalTypes","project","user",function(e,t,n,r,i,a){n.open({size:"lg",templateUrl:"app/components/it-project/tabs/it-project-tab-status-goal-modal.view.html",windowClass:"modal fade in",resolve:{goalId:function(){return t.goalId},user:function(){return a},goalTypes:function(){return r},project:function(){return i},goal:["$http",function(e){var n=t.goalId;return n?e.get("api/goal/"+n).then(function(e){return e.data.response}):null}]},controller:"project.statusGoalModalCtrl"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("project.statusGoalModalCtrl",["$scope","$http","autofocus","goal","notify","goalId","goalTypes","project","user","moment",function(e,t,n,r,i,a,o,s,l,c){var d=null==r;r&&(r.subGoalDate1&&(r.subGoalDate1=c(r.subGoalDate1,"YYYY-MM-DD").format("DD-MM-YYYY")),r.subGoalDate2&&(r.subGoalDate2=c(r.subGoalDate2,"YYYY-MM-DD").format("DD-MM-YYYY")),r.subGoalDate3&&(r.subGoalDate3=c(r.subGoalDate3,"YYYY-MM-DD").format("DD-MM-YYYY"))),e.goal=r||{},e.goalTypes=o,e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},n(),e.dismiss=function(){e.$dismiss()},e.checkDate=function(t,n){var r=c(n,"DD-MM-YYYY");if(!r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099)switch(i.addErrorMessage("Den indtastede dato er ugyldig."),t){case"subGoalDate1":e.subGoalDate1=!0;break;case"subGoalDate2":e.subGoalDate2=!0;break;case"subGoalDate3":e.subGoalDate3=!0}else switch(t){case"subGoalDate1":e.subGoalDate1=!1;break;case"subGoalDate2":e.subGoalDate2=!1;break;case"subGoalDate3":e.subGoalDate3=!1}e.dateFail=e.subGoalDate1||e.subGoalDate2||e.subGoalDate3},e.save=function(){var n=e.goal;n.goalStatusId=s.goalStatus.id;var r=c(n.subGoalDate1,"DD-MM-YYYY");r.isValid()?n.subGoalDate1=r.format("YYYY-MM-DD"):n.subGoalDate1=null;var o=c(n.subGoalDate2,"DD-MM-YYYY");o.isValid()?n.subGoalDate2=o.format("YYYY-MM-DD"):n.subGoalDate2=null;var u=c(n.subGoalDate3,"DD-MM-YYYY");u.isValid()?n.subGoalDate3=u.format("YYYY-MM-DD"):n.subGoalDate3=null,delete n.id,delete n.objectOwnerId,delete n.objectOwner;var p=i.addInfoMessage("Gemmer ændringer...",!1);t({method:d?"POST":"PATCH",url:"api/goal/"+a+"?organizationId="+l.currentOrganizationId,data:n}).success(function(){p.toSuccessMessage("Ændringerne er gemt!"),e.$close(!0)}).error(function(){p.toErrorMessage("Ændringerne kunne ikke gemmes!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.status-goal",{url:"/status-goal",templateUrl:"app/components/it-project/tabs/it-project-tab-status-goal.view.html",controller:"project.EditStatusGoalCtrl",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}],goalTypes:["$http",function(e){return e.get("odata/LocalGoalTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}]}})}]),t.controller("project.EditStatusGoalCtrl",["$scope","$http","notify","$uibModal","$state","project","goalTypes","user",function(e,t,n,r,i,a,o,s){function l(e,r){var i=n.addInfoMessage("Gemmer...",!1);t({method:"PATCH",url:r,data:e}).success(function(){i.toSuccessMessage("Feltet er opdateret.")}).error(function(){i.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}function c(r){r.show=!0;var a=_.find(e.goals,{id:r.id});if(a)return void(a=r);r.edit=function(){i.go(".modal",{goalId:r.id})},r.delete=function(){var e=n.addInfoMessage("Sletter... ");t.delete(r.updateUrl+"?organizationId="+s.currentOrganizationId).success(function(){r.show=!1,e.toSuccessMessage("Slettet!")}).error(function(){e.toErrorMessage("Fejl! Kunne ikke slette!")})},r.updateUrl="api/goal/"+r.id,e.goals.push(r)}e.goalStatus=a.goalStatus,e.goalStatus.updateUrl="api/goalStatus/"+a.goalStatus.id,e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},e.getGoalTypeName=function(e){var t=_.find(o,{Id:e});return t&&t.Name},e.goals=[],e.patchDate=function(t,r){var i=moment(r,"DD-MM-YYYY");if(!i.isValid()||isNaN(i.valueOf())||i.year()<1e3||i.year()>2099)n.addErrorMessage("Den indtastede dato er ugyldig.");else{var a=i.format("YYYY-MM-DD"),o={};o[t]=a,l(o,e.goalStatus.updateUrl+"?organizationId="+s.currentOrganizationId)}},_.each(e.goalStatus.goals,c)}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.status-project.modal",{url:"/modal/:type/:activityId",onEnter:["$state","$stateParams","$uibModal","project","usersWithRoles","user",function(e,t,n,r,i,a){n.open({templateUrl:"app/components/it-project/tabs/it-project-tab-status-modal.view.html",windowClass:"modal fade in",resolve:{activityId:function(){return t.activityId},user:function(){return a},activityType:function(){return t.type},project:function(){return r},usersWithRoles:function(){return i},activity:["$http",function(e){var n=t.activityId;if(n){if("assignment"==t.type)return e.get("api/assignment/"+n).then(function(e){return e.data.response});if("milestone"==t.type)return e.get("api/milestone/"+n).then(function(e){return e.data.response})}return null}],hasWriteAccess:["$http",function(e){if(t.activityId){if("assignment"==t.type)return e.get("api/assignment/"+t.activityId+"?hasWriteAccess=true&organizationId="+a.currentOrganizationId).then(function(e){return e.data.response});if("milestone"==t.type)return e.get("api/milestone/"+t.activityId+"?hasWriteAccess=true&organizationId="+a.currentOrganizationId).then(function(e){return e.data.response})}return!1}]},controller:"project.statusModalCtrl"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("project.statusModalCtrl",["$scope","$http","autofocus","project","usersWithRoles","activity","notify","activityId","activityType","hasWriteAccess","user",function(e,t,n,r,i,a,o,s,l,c,d){var u=null==a;e.hasWriteAccess=!!u||c,e.isAssignment="assignment"==l,e.isMilestone="milestone"==l,a&&(a.startDate&&(a.startDate=moment(a.startDate,"YYYY-MM-DD").format("DD-MM-YYYY")),a.endDate&&(a.endDate=moment(a.endDate,"YYYY-MM-DD").format("DD-MM-YYYY")),a.date&&(a.date=moment(a.date,"YYYY-MM-DD").format("DD-MM-YYYY"))),e.activity=a||{},e.phases=r.phases,e.usersWithRoles=_.values(i),e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},n(),e.dismiss=function(){e.$dismiss()},e.save=function(){var n=e.activity;n.associatedItProjectId=r.id;var i=moment(n.startDate,"DD-MM-YYYY");i.isValid()?n.startDate=i.format("YYYY-MM-DD"):n.startDate=null;var a=moment(n.endDate,"DD-MM-YYYY");a.isValid()?n.endDate=a.format("YYYY-MM-DD"):n.endDate=null;var c=moment(n.date,"DD-MM-YYYY");c.isValid()?n.date=c.format("YYYY-MM-DD"):n.date=null,delete n.id,delete n.objectOwnerId,delete n.objectOwner,delete n.associatedUser;var p=o.addInfoMessage("Gemmer ændringer...",!1);t({method:u?"POST":"PATCH",url:"api/"+l+"/"+s+"?organizationId="+d.currentOrganizationId,data:n}).success(function(){p.toSuccessMessage("Ændringerne er gemt!"),e.$close(!0)}).error(function(){p.toErrorMessage("Ændringerne kunne ikke gemmes!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.status-project.status-edit-modal",{url:"/edit",onEnter:["$state","$stateParams","$uibModal","project","user","statusUpdates",function(e,t,n,r,i,a){n.open({templateUrl:"app/components/it-project/tabs/it-project-tab-status-project-edit-modal.view.html",windowClass:"modal fade in",resolve:{user:function(){return i},project:function(){return r},statusUpdates:function(){return a}},controller:"project.statusEditModalCtrl",size:"lg"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("project.statusEditModalCtrl",["$scope","$http","project","notify","user","statusUpdates","moment",function(e,t,n,r,i,a,o){e.statusUpdates=a,e.project=n,e.moment=o,e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},e.dismiss=function(){e.$dismiss()},e.save=function(n){var i={Created:n.Created,LastChanged:o()},a=o(i.Created,"DD-MM-YYYY");if(!a.isValid()||isNaN(a.valueOf())||a.year()<1e3||a.year()>2099)r.addErrorMessage("Den indtastede dato er ugyldig.");else{a.isValid()?i.Created=a.format("YYYY-MM-DD"):i.Created=null;var s=r.addInfoMessage("Gemmer ændringer...",!1);t({method:"PATCH",url:"odata/ItProjectStatusUpdates("+n.Id+")",data:i}).success(function(){s.toSuccessMessage("Ændringerne er gemt!"),e.$close(!0)}).error(function(){s.toErrorMessage("Ændringerne kunne ikke gemmes!")})}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.status-project.status-history-modal",{url:"/history",onEnter:["$state","$stateParams","$uibModal","project","user","statusUpdates",function(e,t,n,r,i,a){n.open({templateUrl:"app/components/it-project/tabs/it-project-tab-status-project-history-modal.view.html",windowClass:"modal fade in",resolve:{user:function(){return i},project:function(){return r},statusUpdates:function(){return a}},controller:"project.statusHistoryModalCtrl",size:"lg"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("project.statusHistoryModalCtrl",["$scope","$http","project","notify","user","statusUpdates","moment",function(e,t,n,r,i,a,o){e.statusUpdates=a,
e.project=n,e.moment=o,e.dismiss=function(){e.$dismiss()}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.status-project.status-update-modal",{url:"/update",onEnter:["$state","$stateParams","$uibModal","project","user","statusUpdates",function(e,t,n,r,i,a){n.open({templateUrl:"app/components/it-project/tabs/it-project-tab-status-project-update-modal.view.html",windowClass:"modal fade in",resolve:{user:function(){return i},project:function(){return r},statusUpdates:function(){return a}},controller:"project.statusUpdateModalCtrl"}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("project.statusUpdateModalCtrl",["$scope","$http","autofocus","project","notify","user","statusUpdates",function(e,t,n,r,i,a,o){e.update={},e.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},n(),e.dismiss=function(){e.$dismiss()},e.checkDate=function(e){var t=moment(e,"DD-MM-YYYY");(!t.isValid()||isNaN(t.valueOf())||t.year()<1e3||t.year()>2099)&&i.addErrorMessage("Den indtastede dato er ugyldig.")},e.save=function(){var n=e.update;n.AssociatedItProjectId=r.id;var a=moment(n.Created,"DD-MM-YYYY");a.isValid()?n.Created=a.format("YYYY-MM-DD"):n.Created=null,n.CombinedStatus=n.CombinedStatus+"",n.QualityStatus=n.QualityStatus+"",n.TimeStatus=n.TimeStatus+"",n.ResourcesStatus=n.ResourcesStatus+"","true"==n.IsCombined?(delete n.QualityStatus,delete n.TimeStatus,delete n.ResourcesStatus):delete n.CombinedStatus;var o=i.addInfoMessage("Gemmer ændringer...",!1);t({method:"POST",url:"odata/ItProjectStatusUpdates",data:n}).success(function(){o.toSuccessMessage("Ændringerne er gemt!"),e.$close(!0)}).error(function(){o.toErrorMessage("Ændringerne kunne ikke gemmes!")})}}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l){var c=this;this.$scope=e,this.$http=t,this.$state=n,this.notify=r,this.project=i,this.usersWithRoles=a,this.user=o,this.statusUpdates=s,this.moment=l,this.getPhaseName=function(e){return e?c.project.phases[e-1].name:""},this.loadStatues=function(){var e="api/itProjectStatus/"+c.project.id+"?project=true";e+="&skip="+c.pagination.skip,e+="&take="+c.pagination.take,c.pagination.orderBy&&(e+="&orderBy="+c.pagination.orderBy,c.pagination.descending&&(e+="&descending="+c.pagination.descending)),c.pagination.search?e+="&q="+c.pagination.search:e+="&q=",c.milestonesActivities=[],c.$http.get(e).success(function(e,t,n){var r=JSON.parse(n("X-Pagination"));c.totalCount=r.TotalCount,_.each(e.response,function(e){c.addStatus(e,null)})}).error(function(e,t){404!=t&&c.notify.addErrorMessage("Kunne ikke hente projekter!")})},this.addStatus=function(e,t){return e.show=!0,e.$type.indexOf("Assignment")>-1?(e.isTask=!0,e.updateUrl="api/Assignment/"+e.id):e.$type.indexOf("Milestone")>-1&&(e.isMilestone=!0,e.updateUrl="api/Milestone/"+e.id),e.updatePhase=function(){e.phase=_.find(c.project.phases,{id:e.associatedPhaseId})},e.updatePhase(),e.updateUser=function(){e.associatedUserId&&(e.associatedUser=_.find(c.usersWithRoles,{id:e.associatedUserId}))},e.updateUser(),e.edit=function(){e.isTask?c.$state.go(".modal",{type:"assignment",activityId:e.id}):e.isMilestone&&c.$state.go(".modal",{type:"milestone",activityId:e.id})},e.delete=function(){var t=c.notify.addInfoMessage("Sletter...");c.$http.delete(e.updateUrl+"?organizationId="+c.user.currentOrganizationId).success(function(){e.show=!1,t.toSuccessMessage("Slettet!")}).error(function(){t.toErrorMessage("Fejl! Kunne ikke slette!")})},t||c.milestonesActivities.push(e),e},this.project.updateUrl="api/itproject/"+i.id,this.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},this.project.phases=[i.phase1,i.phase2,i.phase3,i.phase4,i.phase5];var d=null;_.each(this.project.phases,function(e){e.updateUrl="api/itProjectPhase/"+e.id,e.prevPhase=d,d=e}),this.milestonesActivities=[],_.each(i.itProjectStatuses,function(e){c.addStatus(e,null)}),this.pagination={search:"",skip:0,take:50},this.$scope.$watchCollection(function(){return c.pagination},this.loadStatues),this.methodOptions=[{label:"Samlet",val:!0},{label:"Tid, kvalitet og ressourcer",val:!1}],this.allStatusUpdates=s,this.allStatusUpdates.length>0&&(this.currentStatusUpdate=this.allStatusUpdates[0],this.showCombinedChart=this.currentStatusUpdate.IsCombined?this.methodOptions[0]:this.methodOptions[1]),this.combinedStatusUpdates=_.filter(this.allStatusUpdates,function(e){return e.IsCombined}),this.splittedStatusUpdates=_.filter(this.allStatusUpdates,function(e){return!e.IsCombined})}return e.prototype.onSelectStatusMethod=function(e){this.currentStatusUpdate=e?this.combinedStatusUpdates.length>0?this.combinedStatusUpdates[0]:null:this.splittedStatusUpdates.length>0?this.splittedStatusUpdates[0]:null},e.$inject=["$scope","$http","$state","notify","project","usersWithRoles","user","statusUpdates","moment"],e}();angular.module("app").controller("project.EditStatusProjectCtrl",t).config(["$stateProvider",function(e){e.state("it-project.edit.status-project",{url:"/status-project",templateUrl:"app/components/it-project/tabs/it-project-tab-status-project.view.html",controller:t,controllerAs:"projectStatusVm",resolve:{usersWithRoles:["$http","$stateParams",function(e,t){return e.get("api/itprojectright/"+t.id).then(function(t){var n=t.data.response;return e.get("odata/LocalItProjectRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){var t=(e.data.value,{});return _.each(n,function(e){var n=t[e.userId]||e.user,r=n.roleNames||[];r.push(e.roleName),n.roleNames=r,t[e.userId]=n}),t})})}],statusUpdates:["$http","$stateParams",function(e,t){return e.get("odata/ItProjects("+t.id+")?$expand=ItProjectStatusUpdates($orderby=Created desc;$expand=ObjectOwner($select=Name,LastName))").then(function(e){return e.data.ItProjectStatusUpdates})}]}})}])}(e.Edit||(e.Edit={}))}(e.ItProject||(e.ItProject={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-project.edit.strategy",{url:"/strategy",templateUrl:"app/components/it-project/tabs/it-project-tab-strategy.view.html",controller:"project.EditStrategyCtrl",resolve:{project:["$http","$stateParams",function(e,t){return e.get("api/itproject/"+t.id).then(function(e){return e.data.response})}],jointMunicipalProjects:["$http","project","projectTypes",function(e,t,n){var r=_.find(n,function(e){return"Fælleskommunal"==e.Name}),i=r.Id,a=t.organizationId;return e.get("api/itproject/?orgId="+a+"&typeId="+i).then(function(e){return e.data.response})}],commonPublicProjects:["$http","project","projectTypes",function(e,t,n){var r=_.find(n,function(e){return"Fællesoffentlig"==e.Name}),i=r.Id,a=t.organizationId;return e.get("api/itproject/?orgId="+a+"&typeId="+i).then(function(e){return e.data.response})}]}})}]),t.controller("project.EditStrategyCtrl",["$scope","$http","notify","project","jointMunicipalProjects","commonPublicProjects",function(e,t,n,r,i,a){e.isStrategy=r.isStrategy,e.jointMunicipalProjectId=r.jointMunicipalProjectId,e.jointMunicipalProjects=i,e.commonPublicProjectId=r.commonPublicProjectId,e.commonPublicProjects=a,e.Options={allowClear:!0,initSelection:function(e,t){t({id:1,text:"Text"})}},e.savejoint=function(){var i;if(""===e.jointMunicipalProjectId)i={JointMunicipalProjectId:null};else{i={JointMunicipalProjectId:e.jointMunicipalProjectId}}t.patch("/odata/ItProjects("+r.id+")",i).then(function(){n.addSuccessMessage("Feltet er opdateret!")},function(){return n.addErrorMessage("Fejl! Feltet kunne ikke opdateres!")})},e.savecommon=function(){var i;if(""===e.commonPublicProjectId)i={CommonPublicProjectId:null};else{i={CommonPublicProjectId:e.commonPublicProjectId}}t.patch("/odata/ItProjects("+r.id+")",i).then(function(){n.addSuccessMessage("Feltet er opdateret!")},function(){return n.addErrorMessage("Fejl! Feltet kunne ikke opdateres!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage",{url:"/usage/{id:[0-9]+}",templateUrl:"app/components/it-system/usage/it-system-usage.view.html",controller:"system.UsageCtrl",resolve:{user:["userService",function(e){return e.getUser()}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/itSystemUsage/"+t.id+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}],itSystemUsage:["$http","$stateParams",function(e,t){return e.get("api/itSystemUsage/"+t.id).then(function(e){return e.data.response})}]}})}]),t.controller("system.UsageCtrl",["$rootScope","$scope","itSystemUsage","user","hasWriteAccess",function(e,t,n,r,i){t.hasWriteAccess=i,t.usage=n,t.allowClearOption={allowClear:!0},t.hasWriteAccess||_.remove(e.page.subnav.buttons,function(e){return"Fjern anvendelse"===e.text})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("local-config.import.contracts",{url:"/contracts",templateUrl:"app/components/local-config/import/local-config-import-template.view.html",controller:"local-config.import.ImportContractCtrl"})}]),t.controller("local-config.import.ImportContractCtrl",["$rootScope","$scope","$http","notify","user",function(e,t,n,r,i){t.url="api/excel?organizationId="+i.currentOrganizationId+"&exportContracts",t.title="IT Kontrakter",t.submit=function(){var e=r.addInfoMessage("Læser excel ark...",!1),a=new FormData;t.file&&a.append("file",t.file,t.file.name),n.post("/api/excel?organizationId="+i.currentOrganizationId+"&importContracts",a,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(n,r){e.toSuccessMessage("Excel arket er blevet læst og værdier er blevet sat ind i systemet."),t.errorData={}}).error(function(n,r){e.toErrorMessage("Fejl! Der er en fejl i excel arket."),t.errorData={},409==r?(t.errorData.showExcelErrors=!0,t.errorData.errors=n):t.errorData.showGenericError=!0})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("local-config.import.organization",{url:"/organization",templateUrl:"app/components/local-config/import/local-config-import-template.view.html",controller:"local-config.import.ImportOrgCtrl"})}]),t.controller("local-config.import.ImportOrgCtrl",["$rootScope","$scope","$http","notify","user",function(e,t,n,r,i){t.url="api/excel?organizationId="+i.currentOrganizationId+"&exportOrgUnits",t.title="organisationsenheder",t.submit=function(){var e=r.addInfoMessage("Læser excel ark...",!1),a=new FormData;t.file&&a.append("file",t.file,t.file.name),n.post("/api/excel?organizationId="+i.currentOrganizationId+"&importOrgUnits",a,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(n,r){e.toSuccessMessage("Excel arket er blevet læst og værdier er blevet sat ind i systemet."),t.errorData={}}).error(function(n,r){e.toErrorMessage("Fejl! Der er en fejl i excel arket."),t.errorData={},409==r?(t.errorData.showExcelErrors=!0,t.errorData.errors=n):t.errorData.showGenericError=!0})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("local-config.import.users",{url:"/users",templateUrl:"app/components/local-config/import/local-config-import-template.view.html",controller:"local-config.import.ImportUserCtrl"})}]),t.controller("local-config.import.ImportUserCtrl",["$rootScope","$scope","$http","notify","user",function(e,t,n,r,i){t.url="api/excel?organizationId="+i.currentOrganizationId+"&exportUsers",t.title="brugere",t.submit=function(){var e=r.addInfoMessage("Læser excel ark...",!1),a=new FormData;t.file&&a.append("file",t.file,t.file.name),n.post("/api/excel?organizationId="+i.currentOrganizationId+"&importUsers",a,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(n,r){e.toSuccessMessage("Excel arket er blevet læst og værdier er blevet sat ind i systemet."),t.errorData={}}).error(function(n,r){e.toErrorMessage("Fejl! Der er en fejl i excel arket."),t.errorData={},409==r?(t.errorData.showExcelErrors=!0,t.errorData.errors=n):t.errorData.showGenericError=!0})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("local-config.import",{url:"/import",abstract:!0,templateUrl:"app/components/local-config/import/local-config-import.view.html",resolve:{user:["userService",function(e){return e.getUser()}]},controller:["$rootScope",function(e){e.page.importsubnav=[{state:"local-config.import.organization",text:"Organisation"},{state:"local-config.import.users",text:"Brugere"},{state:"local-config.import.contracts",text:"IT Kontrakter"}]}]})}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";function t(){return{scope:{editState:"@state",dirId:"@",optionType:"@"},controller:n,controllerAs:"ctrl",bindToController:{optionsUrl:"@",title:"@"},template:'<h2>{{ ctrl.title }}</h2><div id="{{ ctrl.dirId }}" data-kendo-grid="{{ ctrl.mainGrid }}" data-k-options="{{ ctrl.mainGridOptions }}"></div>'}}var n=function(){function e(e,t,n,r,i,a,o){function s(e){e.element.kendoAutoComplete({noDataTemplate:""})}var l=this;this.$http=e,this.$timeout=t,this._=n,this.$=r,this.$state=i,this.notify=a,this.$scope=o,this.editOption=function(e){e.preventDefault();var t=l.$("#"+l.dirId).data("kendoGrid"),n=t.dataItem(l.$(e.currentTarget).closest("tr"));l.optionId=n.get("id"),l.$scope.$state.go(l.editState,{id:l.optionId,optionsUrl:l.optionsUrl,optionType:l.optionType})},this.$scope.$state=i,this.editState=o.editState,this.dirId=o.dirId,this.optionType=o.optionType,this.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:this.optionsUrl,dataType:"json"}},sort:{field:"priority",dir:"desc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{id:"Id"}}},pageable:{refresh:!0,pageSizes:[10,25,50,100,200],buttonCount:5},sortable:{mode:"single"},editable:!0,reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:{filterable:!1},columns:[{field:"IsLocallyAvailable",title:"Aktiv",width:112,persistId:"isLocallyAvailable",attributes:{class:"text-center"},template:'# if(IsObligatory) { # <span class="glyphicon glyphicon-check text-grey" aria-hidden="true"></span> # } else { # <input type="checkbox" data-ng-model="dataItem.IsLocallyAvailable" data-global-option-id="{{ dataItem.Id }}" data-autosave="'+this.optionsUrl+'" data-field="OptionId"> # } #',hidden:!1,filterable:!1,sortable:!1},{field:"Name",title:"Navn",width:230,persistId:"name",template:function(e){return e.Name},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Description",title:"Beskrivelse",width:230,persistId:"description",template:function(e){return e.Description},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{name:"editOption",text:"Redigér",template:"<button type='button' class='btn btn-link' title='Redigér type' ng-click='ctrl.editOption($event)'><i class='fa fa-pencil' aria-hidden='true'></i></button>",title:" ",width:176}]}}return e.$inject=["$http","$timeout","_","$","$state","notify","$scope"],e}();angular.module("app").directive("localOptionList",t)}(e.Directives||(e.Directives={}))}(e.LocalAdmin||(e.LocalAdmin={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";function t(){return{scope:{editState:"@state",dirId:"@",optionType:"@"},controller:n,controllerAs:"ctrl",bindToController:{optionsUrl:"@",title:"@"},template:'<h2>{{ ctrl.title }}</h2><div id="{{ ctrl.dirId }}" data-kendo-grid="{{ ctrl.mainGrid }}" data-k-options="{{ ctrl.mainGridOptions }}"></div>'}}var n=function(){function e(e,t,n,r,i,a,o){function s(e){e.element.kendoAutoComplete({noDataTemplate:""})}var l=this;this.$http=e,this.$timeout=t,this._=n,this.$=r,this.$state=i,this.notify=a,this.$scope=o,this.editOption=function(e){e.preventDefault();var t=l.$("#"+l.dirId).data("kendoGrid"),n=t.dataItem(l.$(e.currentTarget).closest("tr"));l.optionId=n.get("id"),l.$scope.$state.go(l.editState,{id:l.optionId,optionsUrl:l.optionsUrl,optionType:l.optionType})},this.$scope.$state=i,this.editState=o.editState,this.dirId=o.dirId,this.optionType=o.optionType,this.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:this.optionsUrl,dataType:"json"}},sort:{field:"priority",dir:"desc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{id:"Id"}}},pageable:{refresh:!0,pageSizes:[10,25,50,100,200],buttonCount:5},sortable:{mode:"single"},editable:!0,reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:{filterable:!1},columns:[{field:"IsLocallyAvailable",title:"Aktiv",width:112,persistId:"isLocallyAvailable",attributes:{class:"text-center"},template:'# if(IsObligatory) { # <span class="glyphicon glyphicon-check text-grey" aria-hidden="true"></span> # } else { # <input type="checkbox" data-ng-model="dataItem.IsLocallyAvailable" data-global-option-id="{{ dataItem.Id }}" data-autosave="'+this.optionsUrl+'" data-field="OptionId"> # } #',hidden:!1,filterable:!1,sortable:!1},{field:"Name",title:"Navn",width:230,persistId:"name",template:function(e){return e.Name},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"HasWriteAccess",title:"Skriv",width:112,persistId:"hasWriteAccess",attributes:{class:"text-center"},template:'# if(HasWriteAccess) { # <span class="glyphicon glyphicon-check text-grey" aria-hidden="true"></span> # } else { # <span class="glyphicon glyphicon-unchecked text-grey" aria-hidden="true"></span> # } #',hidden:!1,filterable:!1,sortable:!1},{field:"Description",title:"Beskrivelse",width:230,persistId:"description",template:function(e){return e.Description},hidden:!1,filterable:{cell:{template:s,dataSource:[],showOperators:!1,operator:"contains"}}},{name:"editOption",text:"Redigér",template:"<button type='button' class='btn btn-link' title='Redigér rolle' ng-click='ctrl.editOption($event)'><i class='fa fa-pencil' aria-hidden='true'></i></button>",title:" ",width:176}]}}return e.$inject=["$http","$timeout","_","$","$state","notify","$scope"],e}();angular.module("app").directive("localOptionRoleList",t)}(e.Directives||(e.Directives={}))}(e.LocalAdmin||(e.LocalAdmin={}))}(Kitos||(Kitos={})),function(e,t){"use strict";t.directive("suggestNew",["$http","notify",function(e,t){return{scope:{url:"@"},templateUrl:"app/components/local-config/suggestNew/suggestNew.view.html",link:function(n,r,i){n.suggest=function(){var r={isSuggestion:!0,name:n.suggestion};e.post(n.url,r).success(function(e){t.addSuccessMessage("Foreslag sendt!"),n.suggestion=""}).error(function(e){t.addErrorMessage("Kunne ikke sende foreslag!")})}}}}])}(angular,app),function(e,t){"use strict";t.directive("suggestNewRole",["$http","notify",function(e,t){return{scope:{url:"@"},templateUrl:"app/components/local-config/suggestNewRole/suggestNewRole.view.html",link:function(n,r,i){n.suggest=function(){var r={isSuggestion:!0,name:n.suggestion,hasReadAccess:!0,hasWriteAccess:n.writeAccess};e.post(n.url,r).success(function(e){t.addSuccessMessage("Foreslag sendt!"),n.suggestion=""}).error(function(e){t.addErrorMessage("Kunne ikke sende foreslag!")})}}}}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";var t=function(){function e(e,t,n,r,i,a,o,s,l,c,d,u,p,f){var g=this;this.$http=e,this.$timeout=t,this._=n,this.$=r,this.$state=i,this.$scope=a,this.notify=o,this.user=s,this.hasWriteAccess=l,this.organization=c,this.dataResponsible=d,this.dataProtectionAdvisor=u,this.contactPerson=p,this.emailExists=f,this.hasWriteAccess=l,this.organization=c,this._$scope=a,this.updateOrgUrl="api/Organization/"+this.organization.id,this.updatedataProtectionAdvisorUrl="api/dataProtectionAdvisor/"+this.dataProtectionAdvisor.id,this.updatedataResponsibleUrl="api/dataResponsible/"+this.dataResponsible.id,this.updateContactPersonUrl="api/contactPerson/"+this.contactPerson.id,this._$scope._emailExists=f,this._contactPerson=p,this._user=s,this._$scope.$watch("_emailExists",function(e,t){e&&g.$http.get("odata/GetUserByEmail(email='"+g.contactPerson.email+"')").then(function(e){g._contactPerson.name=e.data.Name,g._contactPerson.lastName=e.data.LastName,g._contactPerson.phoneNumber=e.data.PhoneNumber,g.$http.patch("api/contactPerson/"+g._contactPerson.id+"?organizationId= "+g._user.currentOrganizationId,g._contactPerson).catch(function(e){console.log(e)})})})}return e.$inject=["$http","$timeout","_","$","$state","$scope","notify","user","hasWriteAccess","organization","dataResponsible","dataProtectionAdvisor","contactPerson","emailExists"],e}();angular.module("app").config(["$stateProvider",function(e){e.state("organization.gdpr",{url:"/basicInfo",templateUrl:"app/components/org/basicInformation/org-GDPR.view.html",controller:t,controllerAs:"ctrl",resolve:{user:["userService",function(e){return e.getUser()}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/Organization/"+n.currentOrganizationId+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}],organization:["$http","$stateParams","user",function(e,t,n){return e.get("api/Organization/"+n.currentOrganizationId).then(function(e){return e.data.response})}],dataResponsible:["$http","$stateParams","organization",function(e,t,n){return e.get("api/dataResponsible/"+n.id).then(function(e){return e.data.response})}],dataProtectionAdvisor:["$http","$stateParams","organization",function(e,t,n){return e.get("api/dataProtectionAdvisor/"+n.id).then(function(e){return e.data.response})}],contactPerson:["$http","$stateParams","organization",function(e,t,n){return e.get("api/contactPerson/"+n.id).then(function(e){return e.data.response})}],emailExists:["$http","$stateParams","organization","contactPerson",function(e,t,n,r){return null!=r&&e.get("/odata/Users/IsEmailAvailable(email='"+r.email+"')").then(function(e){return!e.data.value})}]}})}])}(e.GDPR||(e.GDPR={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={})),function(e,t){function n(e){for(var t="",n=0;n<e;n++)t+=".....";return t}t.config(["$stateProvider",function(e){e.state("organization.overview",{url:"/overview",templateUrl:"app/components/org/overview/org-overview.view.html",controller:"org.OverviewCtrl",resolve:{}})}]),t.controller("org.OverviewCtrl",["$rootScope","$scope","$http","notify","$uibModal","user",function(e,t,r,i,a,o){function s(){if(t.orgUnitId){var e="api/taskusage/?orgUnitId="+t.orgUnitId+"&onlyStarred=true&organizationId="+o.currentOrganizationId;e+="&skip="+t.pagination.skip,e+="&take="+t.pagination.take,t.pagination.orderBy&&(e+="&orderBy="+t.pagination.orderBy,t.pagination.descending&&(e+="&descending="+t.pagination.descending)),r.get(e).success(function(e,n,r){function i(e,n,r){e.updateUrl="api/taskUsage/"+e.id,e.parent=n,e.level=r,n&&(e.hasWriteAccess=n.hasWriteAccess),e.hasDelegations||(t.$watch(function(){return e.technologyStatus},function(t,n){l(e)}),t.$watch(function(){return e.usageStatus},function(t,n){c(e)})),_.each(e.children,function(t){i(t,e,r+1)})}var a=JSON.parse(r("X-Pagination"));t.totalCount=a.TotalCount,t.taskUsages=e.response,_.each(t.taskUsages,function(e){e.isRoot=!0,i(e,null,0),l(e),c(e)})})}}function l(e){e.parent?l(e.parent):p(e)}function c(e){e.parent?c(e.parent):f(e)}function d(e,t){return 3==e?t.green++:2==e?t.yellow++:1==e?t.red++:t.white++,t.max++,t}function u(e,t){return{max:e.max+t.max,white:e.white+t.white,red:e.red+t.red,yellow:e.yellow+t.yellow,green:e.green+t.green}}function p(e){var t={max:0,white:0,red:0,yellow:0,green:0};return e.hasDelegations?_.each(e.children,function(e){var n=p(e);t=u(t,n)}):t=d(e.technologyStatus,t),e.calculatedTechStatus=t,t}function f(e){var t={max:0,white:0,red:0,yellow:0,green:0};return e.hasDelegations?(_.each(e.children,function(e){var n=f(e);t=u(t,n)}),e.calculatedUsageStatus=t,t):d(e.usageStatus,t)}e.page.title="Organisation - Overblik",console.log(o),function(){o.currentOrganizationUnitId&&(t.orgUnitId=o.currentOrganizationUnitId)}(),t.pagination={skip:0,take:10,orderBy:"taskRef.taskKey"},t.csvUrl="api/taskusage/?csv&orgUnitId="+t.orgUnitId+"&onlyStarred=true&orgUnitId="+o.currentOrganizationId,t.$watchCollection("pagination",function(){s()}),t.loadUsages=s,t.indent=n,t.openComment=function(e){a.open({templateUrl:"app/components/org/overview/org-overview-modal-comment.view.html",controller:["$scope","$uibModalInstance","autofocus",function(t,n,r){r(),t.usage=e,t.hasWriteAccess=e.hasWriteAccess}]})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("organization.structure",{url:"/structure",templateUrl:"app/components/org/structure/org-structure.view.html",controller:"org.StructureCtrl",resolve:{orgUnits:["$http","user",function(e,t){return e.get("api/organizationunit?organization="+t.currentOrganizationId).then(function(e){return e.data.response})}],localOrgUnitRoles:["$http",function(e){return e.get("odata/LocalOrganizationUnitRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],orgUnitRoles:["$http",function(e){return e.get("odata/OrganizationUnitRoles").then(function(e){return e.data.value})}],user:["userService",function(e){return e.getUser()}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/Organization/"+n.currentOrganizationId+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}]}})}]),t.controller("org.StructureCtrl",["$scope","$http","$q","$filter","$uibModal","$state","notify","orgUnits","localOrgUnitRoles","orgUnitRoles","user","hasWriteAccess",function(e,t,n,r,i,a,o,s,l,c,d,u){function p(n,r,i){if(n.parent=i,e.orgUnits[n.id]){var a=e.orgUnits[n.id];n.isOpen=a.isOpen}f(n),e.orgUnits[n.id]=n,r?(n.hasWriteAccess=!0,_.each(n.children,function(e){return p(e,!0,n)})):t.get("api/organizationUnit/"+n.id+"?hasWriteAccess&organizationId="+d.currentOrganizationId).then(function(e){n.hasWriteAccess=e.data.response,_.each(n.children,function(t){p(t,e.data.response,n)})})}function f(t){function n(e){e.isOpen=!0,e.parent&&n(e.parent)}d.currentOrganizationUnitId&&t&&t.id===d.currentOrganizationUnitId&&(n(t),e.chooseOrgUnit(t))}function g(){var t=s;e.nodes=[t],p(t,!1,null)}function m(n){t.get("api/organizationUnitRight/"+n.id+"?paged&take="+e.rightsPagination.take+"&skip="+e.rightsPagination.skip).then(function(t){var r=JSON.parse(t.headers("X-Pagination"));e.totalRightsCountCopy=r.TotalCount,n.orgRights=t.data.response;var i=0;_.each(n.orgRights,function(t){t.userForSelect={id:t.user.id,text:t.user.fullName},t.roleForSelect=t.roleId,t.show=e.showChildren||h(n,t),t.show&&i++}),e.totalRightsCount=e.showChildren?e.totalRightsCountCopy:i}),e.chosenOrgUnit=n}function h(e,t){return e.id===t.objectId}function v(){if(e.chosenOrgUnit){var n="api/organizationUnit/"+e.chosenOrgUnit.id;e.showAllTasks?n+="?tasks":n+="?usages",n+="&taskGroup="+e.selectedTaskGroup,n+="&skip="+e.pagination.skip+"&take="+e.pagination.take,e.pagination.orderBy&&(n+="&orderBy="+e.pagination.orderBy,e.pagination.descending&&(n+="&descending="+e.pagination.descending)),t.get(n).then(function(t){e.taskRefUsageList=t.data.response;var n=JSON.parse(t.headers("X-Pagination"));e.totalCount=n.TotalCount,b()},function(e){o.addErrorMessage("Kunne ikke hente opgaver!")})}}function y(n,r){if(r)var i=o.addInfoMessage("Opretter tilknytning...",!1);var a={taskRefId:n.taskRef.id,orgUnitId:e.chosenOrgUnit.id};t.post("api/taskUsage/",a).then(function(e){n.usage=e.data.response,r&&i.toSuccessMessage("Tilknytningen er oprettet")},function(e){r&&i.toErrorMessage("Fejl! Kunne ikke oprette tilknytningen!")})}function I(e,n){if(n)var r=o.addInfoMessage("Fjerner tilknytning...",!1);var i="api/taskUsage/"+e.usage.id+"?organizationId="+d.currentOrganizationId;t.delete(i).then(function(t){e.usage=null,n&&r.toSuccessMessage("Tilknytningen er fjernet")},function(e){n&&r.toErrorMessage("Fejl! Kunne ikke fjerne tilknytningen!")})}function b(){_.each(e.taskRefUsageList,function(e){e.toggleUsage=function(){e.usage?I(e,!0):y(e,!0)},e.toggleStar=function(){if(e.usage){var n={starred:!e.usage.starred},r="api/taskUsage/"+e.usage.id,i=o.addInfoMessage("Opdaterer...",!1);t({method:"PATCH",url:r+"?organizationId="+d.currentOrganizationId,data:n}).then(function(){e.usage.starred=!e.usage.starred,i.toSuccessMessage("Feltet er opdateret")},function(e){i.toErrorMessage("Fejl!")})}}})}function S(){a.go(".",null,{reload:!0})}e.orgId=d.currentOrganizationId,e.pagination={skip:0,take:50},e.rightsPagination={skip:0,take:15};var k=[];e.orgUnits={},e.hasWriteAccess=u,e.orgUnitRoles=c,e.activeOrgRoles=l,e.orgRoles={},_.each(l,function(t){e.orgRoles[t.Id]=t}),e.showChildren=!1,e.chosenOrgUnit=null,e.chooseOrgUnit=function(n,r){if(r){if(!("DIV"===angular.element(r.target)[0].tagName))return}e.chosenOrgUnit!==n&&(e.showChildren=!1,e.chosenOrgUnit!==n&&(n.organization||(k[n.organizationId]?n.organization=k[n.organizationId]:t.get("api/organization/"+n.organizationId).then(function(e){n.organization=e.data.response,k[n.organizationId]=e.data.response})),e.rightsPagination={skip:0,take:15},m(n),v()))},e.toggleChildren=function(){var t=e.chosenOrgUnit,n=0;_.each(t.orgRights,function(r){r.show=e.showChildren||h(t,r),r.show&&n++}),e.totalRightsCount=e.showChildren?e.totalRightsCountCopy:n,!e.showChildren&&0===e.totalRightsCount&&e.rightsPagination.skip>0&&(e.rightsPagination.skip=0,m(e.chosenOrgUnit))},e.$watch("selectedUser",function(){e.submitRight()}),e.newRole=3,e.submitRight=function(){if(e.selectedUser&&e.newRole){var n=e.chosenOrgUnit.id,r=parseInt(e.newRole),i=e.selectedUser.id;if(n&&r&&i){var a={roleId:r,userId:i};t.post("api/organizationUnitRight/"+n+"?organizationId="+d.currentOrganizationId,a).then(function(t){o.addSuccessMessage(t.data.response.user.fullName+" er knyttet i rollen"),e.chosenOrgUnit.orgRights.push({objectId:t.data.response.objectId,roleId:t.data.response.roleId,userId:t.data.response.userId,user:t.data.response.user,userForSelect:{id:t.data.response.userId,text:t.data.response.user.fullName},roleForSelect:t.data.response.roleId,show:!0}),e.newRole=3,e.selectedUser=""},function(e){o.addErrorMessage("Fejl!")})}}},e.deleteRight=function(e){var n=e.objectId,r=e.roleId,i=e.userId;t.delete("api/organizationUnitRight/"+n+"?rId="+r+"&uId="+i+"&organizationId="+d.currentOrganizationId).then(function(t){e.show=!1,o.addSuccessMessage("Rollen er slettet!")},function(e){o.addErrorMessage("Kunne ikke slette rollen!")})},e.updateRight=function(n){if(n.roleForSelect&&n.userForSelect){if(!e.checkIfRoleIsAvailable(n.roleForSelect))return void(n.edit=!1);var r=n.objectId,i=n.roleId,a=n.userId,s=n.objectId,l=n.roleForSelect,c=n.userForSelect.id;r===s&&i===l&&a===c&&(n.edit=!1),t.delete("api/organizationUnitRight/"+r+"?rId="+i+"&uId="+a+"&organizationId="+d.currentOrganizationId).then(function(e){var r={roleId:l,userId:c};t.post("api/organizationUnitRight/"+s+"?organizationId="+d.currentOrganizationId,r).then(function(e){n.roleId=e.data.response.roleId,n.user=e.data.response.user,n.userId=e.data.response.userId,n.edit=!1,o.addSuccessMessage(n.user.fullName+" er knyttet i rollen")},function(e){n.show=!1,o.addErrorMessage("Fejl!")})},function(e){n.userForSelect={id:n.user.id,text:n.user.fullName},n.roleForSelect=n.roleId,o.addErrorMessage("Fejl!")})}},e.rightSortBy="orgUnitName",e.rightSortReverse=!1,e.rightSort=function(t){switch(e.rightSortBy){case"orgUnitName":return e.orgUnits[t.objectId].name;case"roleName":return e.orgRoles[t.roleId].Priority;case"userName":return t.user.name;case"userEmail":return t.user.email;default:return e.orgUnits[t.objectId].name}},e.rightSortChange=function(t){e.rightSortBy===t?e.rightSortReverse=!e.rightSortReverse:e.rightSortReverse=!1,e.rightSortBy=t},e.editUnit=function(n){i.open({templateUrl:"app/components/org/structure/org-structure-modal-edit.view.html",
controller:["$scope","$uibModalInstance","autofocus",function(r,i,a){function s(e){e.organizationId===n.organizationId&&e.id!==n.id&&(r.orgUnits.push(e),_.each(e.children,s))}a(),r.isNew=!1,r.orgUnits=[],_.each(e.nodes,s),r.orgUnit={id:n.id,oldName:n.name,newName:n.name,newEan:n.ean,localId:n.localId,newParent:n.parentId,orgId:n.organizationId,isRoot:void 0==n.parentId},r.isAdmin=d.isGlobalAdmin||d.isLocalAdmin,r.canChangeParent=r.isAdmin&&!r.orgUnit.isRoot,r.patch=function(){if(!r.submitting){var e=r.orgUnit.newName,a=r.orgUnit.newParent,s=r.orgUnit.newEan,l=r.orgUnit.localId;if(e){var c={name:e,ean:s,localId:l};r.canChangeParent&&a&&(c.parentId=a),r.submitting=!0;var u=n.id;t({method:"PATCH",url:"api/organizationUnit/"+u+"?organizationId="+d.currentOrganizationId,data:c}).then(function(t){o.addSuccessMessage(e+" er ændret."),i.close(t.data.response)},function(t){r.submitting=!1,t.data.msg.indexOf("Duplicate entry")>-1?o.addErrorMessage("Fejl! Enhed ID er allerede brugt!"):o.addErrorMessage("Fejl! "+e+" kunne ikke ændres!")})}}},r.post=function(){if(!r.submitting){var e=r.newOrgUnit.name;if(e){var n=r.newOrgUnit.parent,a=r.newOrgUnit.orgId,s=r.newOrgUnit.ean,l=r.newOrgUnit.localId,c={name:e,parentId:n,organizationId:a,ean:s,localId:l};r.submitting=!0,t({method:"POST",url:"api/organizationUnit/",data:c}).then(function(t){o.addSuccessMessage(e+" er gemt."),i.close(t.data.response)},function(t){r.submitting=!1,t.data.msg.indexOf("Duplicate entry")>-1?o.addErrorMessage("Fejl! Enhed ID er allerede brugt!"):o.addErrorMessage("Fejl! "+e+" kunne ikke oprettes!")})}}},r.new=function(){a(),r.createNew=!0,r.newOrgUnit={name:"",parent:r.orgUnit.id,orgId:r.orgUnit.orgId}},r.delete=function(){r.submitting||(r.submitting=!0,t.delete("api/organizationUnit/"+n.id+"?organizationId="+d.currentOrganizationId).then(function(e){i.close(),o.addSuccessMessage(n.name+" er slettet!")},function(e){r.submitting=!1,o.addErrorMessage("Fejl! "+n.name+" kunne ikke slettes!<br /><br />\n                                                            Organisationsenheden bliver brugt som reference i en eller flere IT Projekter, IT Systemer og/eller IT Kontrakter.<br /><br />\n                                                            Fjern referencen for at kunne slette denne enhed.")}))},r.cancel=function(){i.dismiss("cancel")}}]}).result.then(function(e){a.go(a.current,{},{reload:!0}),g()})},e.$watch("selectedTaskGroup",function(t,n){e.pagination.skip=0,v()}),e.$watchCollection("pagination",v),e.$watchCollection("rightsPagination",function(){m(e.chosenOrgUnit)}),e.showAllTasks=!0,e.pagination.orderBy="taskKey",e.changeTaskView=function(){e.showAllTasks=!e.showAllTasks,e.pagination.orderBy=e.showAllTasks?"taskKey":"taskRef.taskKey",e.pagination.skip=0,v()},e.selectAllTasks=function(){_.each(e.taskRefUsageList,function(e){e.usage||y(e,!1)})},e.removeAllTasks=function(){_.each(e.taskRefUsageList,function(e){e.usage&&I(e,!1)})},e.selectTaskGroup=function(){var n="api/taskusage?orgUnitId="+e.chosenOrgUnit.id+"&taskId="+e.selectedTaskGroup,r=o.addInfoMessage("Opretter tilknytning...",!1);t.post(n,null).then(function(e){r.toSuccessMessage("Tilknytningen er oprettet"),S()},function(e){r.toErrorMessage("Fejl! Kunne ikke oprette tilknytningen!")})},e.removeTaskGroup=function(){var n="api/taskusage?orgUnitId="+e.chosenOrgUnit.id+"&taskId="+e.selectedTaskGroup,r=o.addInfoMessage("Fjerner tilknytning...",!1);t.delete(n).then(function(){r.toSuccessMessage("Tilknytningen er fjernet"),S()},function(e){r.toErrorMessage("Fejl! Kunne ikke fjerne tilknytningen!")})},e.dragEnabled=!1,e.toggleDrag=function(){e.dragEnabled=!e.dragEnabled},e.treeOptions={accept:function(e,t,n){return!angular.isUndefined(t.$parentNodesScope)},dropped:function(n){var r=n.dest.nodesScope.$nodeScope,i=n.source.nodeScope.$modelValue.id,a=n.source.nodeScope.$parentNodeScope.$modelValue.id;if(r&&a!=r.$modelValue.id){var l=r.$modelValue.id,i=n.source.nodeScope.$modelValue.id,c={parentId:l},u="api/organizationunit/"+i,p=o.addInfoMessage("Opdaterer...",!1);t({method:"PATCH",url:u+"?organizationId="+d.currentOrganizationId,data:c}).then(function(){p.toSuccessMessage("Enheden er opdateret"),e.chooseOrgUnit(s)},function(e){p.toErrorMessage("Fejl!")})}}},e.checkIfRoleIsAvailable=function(t){return _.find(e.activeOrgRoles,function(e){return e.Id===parseInt(t,10)})},e.getRoleName=function(t){return _.find(e.orgUnitRoles,function(e){return e.Id===parseInt(t,10)}).Name},g()}])}(angular,app);var Kitos;!function(e){!function(e){!function(e){"use strict";function t(){return{scope:{},controller:n,controllerAs:"ctrl",bindToController:{user:"=",currentOrganizationId:"@",ngDisabled:"="},template:'<button type="button" data-ng-if="ctrl.user.LastAdvisDate === null" class="btn btn-success btn-xs" style="width: 90%" data-ng-click="ctrl.sendAdvis(ctrl.user, false)" data-ng-disabled="ctrl.ngDisabled">\n                    Send Advis\n                </button>\n                <button type="button" data-ng-if="ctrl.user.LastAdvisDate !== null" class="btn btn-warning btn-xs" style="width: 90%" data-ng-click="ctrl.sendAdvis(ctrl.user, true)" data-ng-disabled="ctrl.ngDisabled">\n                    {{ ctrl.user.LastAdvisDate | date:\'dd-MM-yy\' }}\n                </button>'}}var n=function(){function e(e,t){this.$http=e,this.notify=t}return e.prototype.sendAdvis=function(e,t){var n,r={sendReminder:null,sendAdvis:null,organizationId:null};t?(r.sendReminder=!0,n="påmindelse"):(r.sendAdvis=!0,n="advis"),r.organizationId=this.currentOrganizationId;var i=this.notify.addInfoMessage("Sender "+n+" til "+e.email,!1);this.$http.post("api/user",e,{handleBusy:!0,params:r}).then(function(t){e.LastAdvisDate=t.data.response.lastAdvisDate,i.toSuccessMessage("Advis sendt til "+e.Email)},function(e){i.toErrorMessage("Kunne ikke sende "+n+"!")})},e.$inject=["$http","notify"],e}();angular.module("app").directive("advisButton",t)}(e.Users||(e.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function t(e,t,n,r,i,a,o){if(this.$uibModalInstance=e,this.$http=t,this.$q=n,this.notify=r,this.autofocus=i,this.user=a,this._=o,this.isUserGlobalAdmin=!1,this.isUserLocalAdmin=!1,this.isUserOrgAdmin=!1,this.isUserProjectAdmin=!1,this.isUserSystemAdmin=!1,this.isUserContractAdmin=!1,this.isUserReportAdmin=!1,this.isReadOnly=!1,!a.currentOrganizationId)return void r.addErrorMessage("Fejl! Kunne ikke oprette bruger.",!0);this.isUserGlobalAdmin=a.isGlobalAdmin,this.isUserLocalAdmin=a.isLocalAdmin,this.isUserOrgAdmin=a.isOrgAdmin,this.isUserProjectAdmin=a.isProjectAdmin,this.isUserSystemAdmin=a.isSystemAdmin,this.isUserContractAdmin=a.isContractAdmin,this.isUserReportAdmin=a.isReportAdmin,this.isReadOnly=a.isReadOnly,i(),this.busy=!1}return t.prototype.cancel=function(){this.$uibModalInstance.close()},t.prototype.create=function(t){var n=this;this.busy=!0;var r={user:{Name:this.vm.name,LastName:this.vm.lastName,Email:this.vm.email,PhoneNumber:this.vm.phoneNumber},organizationId:this.user.currentOrganizationId,sendMailOnCreation:t},i=this.notify.addInfoMessage("Opretter bruger",!1);this.$http.post("odata/Users/Create",r,{handleBusy:!0}).then(function(t){var r=t.data,a=[];a.push(n.addRole(n.user.currentOrganizationId,r.Id,e.Models.OrganizationRole.User)),n.vm.isLocalAdmin&&a.push(n.addRole(n.user.currentOrganizationId,r.Id,e.Models.OrganizationRole.LocalAdmin)),n.vm.isOrgAdmin&&a.push(n.addRole(n.user.currentOrganizationId,r.Id,e.Models.OrganizationRole.OrganizationModuleAdmin)),n.vm.isProjectAdmin&&a.push(n.addRole(n.user.currentOrganizationId,r.Id,e.Models.OrganizationRole.ProjectModuleAdmin)),n.vm.isSystemAdmin&&a.push(n.addRole(n.user.currentOrganizationId,r.Id,e.Models.OrganizationRole.SystemModuleAdmin)),n.vm.isContractAdmin&&a.push(n.addRole(n.user.currentOrganizationId,r.Id,e.Models.OrganizationRole.ContractModuleAdmin)),n.vm.isReportAdmin&&a.push(n.addRole(n.user.currentOrganizationId,r.Id,e.Models.OrganizationRole.ReportModuleAdmin)),n.vm.isReadOnly&&a.push(n.addRole(n.user.currentOrganizationId,r.Id,e.Models.OrganizationRole.ReadOnly)),n.$q.all(a).then(function(){i.toSuccessMessage(n.vm.name+" "+n.vm.lastName+" er oprettet i KITOS"),n.cancel()},function(){return i.toErrorMessage("Kunne ikke tilknytte "+n.vm.name+" "+n.vm.lastName+" til organisationen!")})},function(){i.toErrorMessage("Fejl! Noget gik galt ved oprettelsen af "+n.vm.name+" "+n.vm.lastName+"!"),n.cancel()})},t.prototype.addRole=function(e,t,n){var r={UserId:t,Role:n};return this.$http.post("odata/Organizations("+e+")/Rights",r)},t.prototype.attachUser=function(){var t=this,n=this.notify.addInfoMessage("Tilknytter bruger",!1);this.$http.get("odata/Users?$filter=Email eq '"+this.vm.email+"'").then(function(r){var i=t._.first(r.data.value),a=[];a.push(t.addRole(t.user.currentOrganizationId,i.Id,e.Models.OrganizationRole.User)),t.vm.isLocalAdmin&&a.push(t.addRole(t.user.currentOrganizationId,i.Id,e.Models.OrganizationRole.LocalAdmin)),t.vm.isOrgAdmin&&a.push(t.addRole(t.user.currentOrganizationId,i.Id,e.Models.OrganizationRole.OrganizationModuleAdmin)),t.vm.isProjectAdmin&&a.push(t.addRole(t.user.currentOrganizationId,i.Id,e.Models.OrganizationRole.ProjectModuleAdmin)),t.vm.isSystemAdmin&&a.push(t.addRole(t.user.currentOrganizationId,i.Id,e.Models.OrganizationRole.SystemModuleAdmin)),t.vm.isContractAdmin&&a.push(t.addRole(t.user.currentOrganizationId,i.Id,e.Models.OrganizationRole.ContractModuleAdmin)),t.vm.isReportAdmin&&a.push(t.addRole(t.user.currentOrganizationId,i.Id,e.Models.OrganizationRole.ReportModuleAdmin)),t.vm.isReadOnly&&a.push(t.addRole(t.user.currentOrganizationId,i.Id,e.Models.OrganizationRole.ReadOnly)),t.$q.all(a).then(function(){n.toSuccessMessage(i.Name+" "+i.LastName+" er tilknyttet til organisationen"),t.cancel()},function(e){return n.toErrorMessage("Kunne ikke tilknytte "+i.Name+" "+i.LastName+" til organisationen!")})})},t.$inject=["$uibModalInstance","$http","$q","notify","autofocus","user","_"],t}();angular.module("app").config(["$stateProvider",function(e){e.state("organization.user.create",{url:"/create",onEnter:["$state","$stateParams","$uibModal",function(e,t,r){r.open({templateUrl:"app/components/org/user/org-user-create.modal.view.html",windowClass:"modal fade in",controller:n,controllerAs:"ctrl",resolve:{user:["userService",function(e){return e.getUser()}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(t.Users||(t.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){!function(e){"use strict";var t=(function(){function e(){}}(),function(){function e(){this.items={}}return e.prototype.add=function(e,t){this.items[e]=t},e.prototype.has=function(e){return e in this.items},e.prototype.get=function(e){return this.items[e]},e.prototype.del=function(e){delete this.items[e]},e}()),n=function(){function e(e,n,r,i,a,o,s,l,c,d,u,p,f,g,m,h){var v=this;this.$uibModalInstance=e,this.$http=n,this.$q=r,this.$state=i,this.$scope=a,this.notify=o,this.user=s,this.currentUser=l,this.usersInOrganization=c,this.projects=d,this.system=u,this.itContracts=p,this.orgUnits=f,this.orgAdmin=g,this._=m,this.text=h,this.orgRoles=new t,this.projectRoles=new t,this.systemRoles=new t,this.contractRoles=new t,this.adminRoles=new t,this.vmOrgRoles=new t,this.vmProjectRoles=new t,this.vmSystemRoles=new t,this.vmContractRoles=new t,this.vmAdminRoles=new t,this.initCollections=function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];t.add(i.Id,i)}},this.collectionUpdate=function(e,t,n){if(v.disableBtns(v.isUserSelected),n){v.dirty=!1;var r={modul:e,rightId:t.Id,objectId:t.ObjectId};"OrganizationUnitRights"===e&&v.orgRoles.add(t.Id,r),"ItProjectRights"===e&&v.projectRoles.add(t.Id,r),"ItSystemRights"===e&&v.systemRoles.add(t.Id,r),"ItContractRights"===e&&v.contractRoles.add(t.Id,r),"OrganizationRights"===e&&v.adminRoles.add(t.Id,r)}n||("OrganizationUnitRights"===e&&v.orgRoles.del(t.Id),"ItProjectRights"===e&&v.projectRoles.del(t.Id),"ItSystemRights"===e&&v.systemRoles.del(t.Id),"ItContractRights"===e&&v.contractRoles.del(t.Id),"OrganizationRights"===e&&v.adminRoles.del(t.Id))},this.setSelectedUser=function(){null==v.selectedUser?v.isUserSelected=!0:(v.isUserSelected=!1,v.disableBtns(v.isUserSelected))},this.userId=s.Id,this.firstName=s.Name,this.lastName=s.LastName,this.email=s.Email,this.initCollections(f,this.vmOrgRoles),this.initCollections(d,this.vmProjectRoles),this.initCollections(u,this.vmSystemRoles),this.initCollections(p,this.vmContractRoles),this.initCollections(g,this.vmAdminRoles),this.vmUsersInOrganization=c.filter(function(e){return e.Id!==s.Id}),this.vmProject=d,this.vmSystem=u,this.vmItContracts=p,this.vmOrgUnits=f,this.vmOrgAdmin=g.filter(function(e){return"User"!==e.Role}).filter(function(e){return"ReadOnly"!==e.Role}),this.itemSelected=!1,this.isUserSelected=!0,this.curOrganization=s.currentOrganizationName,this.disabled=!0,this.vmText=h}return e.prototype.disableBtns=function(e){this.disabled=e},e.prototype.patchData=function(){var e=this,t=this.orgRoles,n=this.projectRoles,r=this.systemRoles,i=this.contractRoles,a=this.adminRoles;null!=t&&_.each(t.items,function(t,n){var r={UserId:e.selectedUser.Id};e.$http.patch("/odata/OrganizationUnitRights("+t.rightId+")",r).then(function(){return e.orgRoles.del(t.rightId)}),e.vmOrgUnits=e.vmOrgUnits.filter(function(e){return e.Id!==t.rightId})}),null!=n&&_.each(n.items,function(t,n){var r={UserId:e.selectedUser.Id};e.$http.patch("/odata/ItProjectRights("+t.rightId+")",r).then(function(){return e.projectRoles.del(t.rightId)}),e.vmProject=e.vmProject.filter(function(e){return e.Id!==t.rightId})}),null!=r&&_.each(r.items,function(t,n){var r={UserId:e.selectedUser.Id};e.$http.patch("/odata/ItSystemRights("+t.rightId+")",r).then(function(){return e.systemRoles.del(t.rightId)}),e.vmSystem=e.vmSystem.filter(function(e){return e.Id!==t.rightId})}),null!=i&&_.each(i.items,function(t,n){var r={UserId:e.selectedUser.Id};e.$http.patch("/odata/ItContractRights("+t.rightId+")",r).then(function(){return e.contractRoles.del(t.rightId)}),e.vmItContracts=e.vmItContracts.filter(function(e){return e.Id!==t.rightId})}),null!=a&&_.each(a.items,function(t,n){var r={UserId:e.selectedUser.Id};e.$http.patch("/odata/OrganizationRights("+t.rightId+")",r).then(function(){return e.adminRoles.del(t.rightId)}),e.vmOrgAdmin=e.vmOrgAdmin.filter(function(e){return e.Id!==t.rightId}),e.orgAdmin=e.orgAdmin.filter(function(e){return e.Id!==t.rightId})})},e.prototype.delete=function(e,t){var n=this,r=t.Id;this.$http.delete("/odata/"+e+"("+r+")").then(function(){"OrganizationUnitRights"===e&&(n.orgRoles.del(r),n.vmOrgUnits=n.vmOrgUnits.filter(function(e){return e.Id!==r})),"ItProjectRights"===e&&(n.projectRoles.del(r),n.vmProject=n.vmProject.filter(function(e){return e.Id!==r})),"ItSystemRights"===e&&(n.systemRoles.del(r),n.vmSystem=n.vmSystem.filter(function(e){return e.Id!==r})),"ItContractRights"===e&&(n.contractRoles.del(r),n.vmItContracts=n.vmItContracts.filter(function(e){return e.Id!==r})),"OrganizationRights"===e&&(n.adminRoles.del(r),n.vmOrgAdmin=n.vmOrgAdmin.filter(function(e){return e.Id!==r}))})},e.prototype.ok=function(){this.patchData(),this.$uibModalInstance.close(),this.notify.addSuccessMessage("Brugerens roller er ændret")},e.prototype.assign=function(){this.patchData(),this.notify.addSuccessMessage("Brugerens roller er ændret"),this.disableBtns(!0)},e.prototype.cancel=function(){this.$uibModalInstance.dismiss()},e.prototype.deleteUser=function(){this.deleteAllUserRoles(this.vmOrgUnits,"OrganizationUnitRights"),this.deleteAllUserRoles(this.vmProject,"ItProjectRights"),this.deleteAllUserRoles(this.vmSystem,"ItSystemRights"),this.deleteAllUserRoles(this.vmItContracts,"ItContractRights"),this.deleteAllUserRoles(this.orgAdmin,"OrganizationRights"),this.$uibModalInstance.close()},e.prototype.deleteSelectedRoles=function(){var e=this;if(confirm("Er du sikker på du vil slette de valgte roller?")){var t=this.orgRoles,n=this.projectRoles,r=this.systemRoles,i=this.contractRoles,a=this.adminRoles;null!=t&&_.each(t.items,function(t,n){e.$http.delete("/odata/OrganizationUnitRights("+t.rightId+")").then(function(){return e.orgRoles.del(t.rightId)}),e.vmOrgUnits=e.vmOrgUnits.filter(function(e){return e.Id!==t.rightId})}),null!=n&&_.each(n.items,function(t,n){e.$http.delete("/odata/ItProjectRights("+t.rightId+")").then(function(){return e.projectRoles.del(t.rightId)}),e.vmProject=e.vmProject.filter(function(e){return e.Id!==t.rightId})}),null!=r&&_.each(r.items,function(t,n){e.$http.delete("/odata/ItSystemRights("+t.rightId+")").then(function(){return e.systemRoles.del(t.rightId)}),e.vmSystem=e.vmSystem.filter(function(e){return e.Id!==t.rightId})}),null!=i&&_.each(i.items,function(t,n){e.$http.delete("/odata/ItContractRights("+t.rightId+")").then(function(){return e.contractRoles.del(t.rightId)}),e.vmItContracts=e.vmItContracts.filter(function(e){return e.Id!==t.rightId})}),null!=a&&_.each(a.items,function(t,n){e.$http.delete("/odata/OrganizationRights("+t.rightId+")").then(function(){return e.adminRoles.del(t.rightId)}),e.vmOrgAdmin=e.vmOrgAdmin.filter(function(e){return e.Id!==t.rightId})}),this.notify.addSuccessMessage("Rollerne er slettede."),this.disableBtns(!0)}},e.prototype.deleteAllUserRoles=function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n],a=i.Id;this.$http.delete("/odata/"+t+"("+a+")").then(this.notify.addSuccessMessage("Brugeren og dennes roller er slettet fra organisationen"))}},e.$inject=["$uibModalInstance","$http","$q","$state","$scope","notify","user","currentUser","usersInOrganization","projects","system","itContracts","orgUnits","orgAdmin","_","text"],e}();angular.module("app").config(["$stateProvider",function(e){e.state("organization.user.delete",{url:"/:id/delete",onEnter:["$state","$stateParams","$uibModal",function(e,t,r){r.open({templateUrl:"app/components/org/user/org-user-delete.modal.view.html",windowClass:"modal fade in",controller:n,controllerAs:"ctrl",resolve:{currentUser:["userService",function(e){return e.getUser()}],user:["$http","userService",function(e,n){return n.getUser().then(function(n){return e.get("/odata/Users("+t.id+")?$expand=OrganizationRights($filter=OrganizationId eq "+n.currentOrganizationId+")").then(function(e){return e.data})})}],usersInOrganization:["$http","userService","UserGetService",function(e,t,n){return t.getUser().then(function(e){return n.GetAllUsersFromOrganizationById(""+e.currentOrganizationId).then(function(e){return e.data.value})})}],projects:["$http","ItProjectService","userService",function(e,n,r){return r.getUser().then(function(e){return n.GetProjectDataById(t.id,""+e.currentOrganizationId).then(function(e){return e.data.value})})}],system:["$http","ItSystemService","userService",function(e,n,r){return r.getUser().then(function(e){return n.GetSystemDataByIdFiltered(t.id,""+e.currentOrganizationId).then(function(e){return e.data.value})})}],itContracts:["$http","ItContractsService","userService",function(e,n,r){return r.getUser().then(function(e){return n.GetContractDataById(t.id,""+e.currentOrganizationId).then(function(e){return e.data.value})})}],orgUnits:["$http","organizationService","userService",function(e,n,r){return r.getUser().then(function(e){return n.GetOrganizationUnitDataById(t.id,""+e.currentOrganizationId).then(function(e){return e.data.value})})}],orgAdmin:["$http","userService","organizationService",function(e,n,r){return n.getUser().then(function(e){return r.GetOrganizationData(t.id,""+e.currentOrganizationId).then(function(e){return e.data.value})})}],text:["$http","$sce",function(e,t){return e.get("odata/HelpTexts?$filter=Key eq 'user_deletion_modal_text'").then(function(e){return e.data.value.length?t.trustAsHtml(e.data.value[0].Description):"Ingen hjælpetekst defineret."})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^",null,{reload:!0})})}]})}])}(e.Users||(e.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function t(t,n,r,i,a,o,s){this.$uibModalInstance=t,this.$http=n,this.$q=r,this.notify=i,this.user=a,this.currentUser=o,this._=s,this.isUserGlobalAdmin=!1,this.isUserLocalAdmin=!1,this.isUserOrgAdmin=!1,this.isUserProjectAdmin=!1,this.isUserSystemAdmin=!1,this.isUserContractAdmin=!1,this.isUserReportAdmin=!1,this.isUserReadOnly=!1,this.userId=a.Id;var l={email:a.Email,name:a.Name,lastName:a.LastName,phoneNumber:a.PhoneNumber,isLocalAdmin:void 0!==s.find(a.OrganizationRights,{Role:e.Models.OrganizationRole.LocalAdmin}),isOrgAdmin:void 0!==s.find(a.OrganizationRights,{Role:e.Models.OrganizationRole.OrganizationModuleAdmin}),isProjectAdmin:void 0!==s.find(a.OrganizationRights,{Role:e.Models.OrganizationRole.ProjectModuleAdmin}),isSystemAdmin:void 0!==s.find(a.OrganizationRights,{Role:e.Models.OrganizationRole.SystemModuleAdmin}),isContractAdmin:void 0!==s.find(a.OrganizationRights,{Role:e.Models.OrganizationRole.ContractModuleAdmin}),isReportAdmin:void 0!==s.find(a.OrganizationRights,{Role:e.Models.OrganizationRole.ReportModuleAdmin}),isReadOnly:void 0!==s.find(a.OrganizationRights,{Role:e.Models.OrganizationRole.ReadOnly})};this.originalVm=s.clone(l),this.vm=l,this.isUserGlobalAdmin=o.isGlobalAdmin,this.isUserLocalAdmin=o.isLocalAdmin,this.isUserOrgAdmin=o.isOrgAdmin,this.isUserProjectAdmin=o.isProjectAdmin,this.isUserSystemAdmin=o.isSystemAdmin,this.isUserContractAdmin=o.isContractAdmin,this.isUserReportAdmin=o.isReportAdmin,this.isUserReadOnly=o.isReadOnly}return t.prototype.changeRight=function(e,t,n){if(-1!==Object.keys(e).indexOf(t)){if(e[t]){var r={UserId:this.userId,Role:n,OrganizationId:this.currentUser.currentOrganizationId};return this.$http.post("/odata/Organizations("+this.currentUser.currentOrganizationId+")/Rights",r)}var i=this._.find(this.user.OrganizationRights,{Role:n});return this.$http.delete("/odata/Organizations("+this.currentUser.currentOrganizationId+")/Rights("+i.Id+")")}},t.prototype.ok=function(){var t=this,n=this._.omitBy(this.vm,function(e,n){return t.originalVm[n]===e}),r=[];r.push(this.changeRight(n,"isLocalAdmin",e.Models.OrganizationRole.LocalAdmin)),r.push(this.changeRight(n,"isOrgAdmin",e.Models.OrganizationRole.OrganizationModuleAdmin)),r.push(this.changeRight(n,"isProjectAdmin",e.Models.OrganizationRole.ProjectModuleAdmin)),r.push(this.changeRight(n,"isSystemAdmin",e.Models.OrganizationRole.SystemModuleAdmin)),r.push(this.changeRight(n,"isContractAdmin",e.Models.OrganizationRole.ContractModuleAdmin)),r.push(this.changeRight(n,"isReportAdmin",e.Models.OrganizationRole.ReportModuleAdmin)),r.push(this.changeRight(n,"isReadOnly",e.Models.OrganizationRole.ReadOnly));var i={Name:this.vm.name,LastName:this.vm.lastName,PhoneNumber:this.vm.phoneNumber,Email:this.vm.email};this.$http.patch("/odata/Users("+this.userId+")",i),this.$q.all(r).then(function(){return t.$uibModalInstance.close()},function(){return t.notify.addErrorMessage("Fejl. Noget gik galt!")})},t.prototype.cancel=function(){this.$uibModalInstance.dismiss()},t.$inject=["$uibModalInstance","$http","$q","notify","user","currentUser","_"],t}();angular.module("app").config(["$stateProvider",function(e){e.state("organization.user.edit",{url:"/:id/edit",onEnter:["$state","$stateParams","$uibModal",function(e,t,r){r.open({templateUrl:"app/components/org/user/org-user-edit.modal.view.html",windowClass:"modal fade in",controller:n,controllerAs:"ctrl",resolve:{currentUser:["userService",function(e){return e.getUser()}],user:["$http","userService",function(e,n){return n.getUser().then(function(n){return e.get("/odata/Users("+t.id+")?$expand=OrganizationRights($filter=OrganizationId eq "+n.currentOrganizationId+")").then(function(e){return e.data})})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}])}(t.Users||(t.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function t(t,n,r,i,a,o,s,l,c){function d(e){e.element.kendoAutoComplete({noDataTemplate:""})}var u=this;this.$http=t,this.$timeout=n,this._=r,this.$=i,this.$state=a,this.$scope=o,this.notify=s,this.user=l,this.hasWriteAccess=c,this.roleTemplate=function(t){var n=u._.map(t.OrganizationRights,"Role");return u._.forEach(n,function(t,r){switch(t){case e.Models.OrganizationRole.LocalAdmin:n[r]="Lokal Admin";break;case e.Models.OrganizationRole.OrganizationModuleAdmin:n[r]="Organisations Admin";break;case e.Models.OrganizationRole.ProjectModuleAdmin:n[r]="Projekt Admin";break;case e.Models.OrganizationRole.SystemModuleAdmin:n[r]="System Admin";break;case e.Models.OrganizationRole.ContractModuleAdmin:n[r]="Kontrakt Admin";break;case e.Models.OrganizationRole.ReportModuleAdmin:n[r]="Rapport Admin"}}),n.join(",")},this.exportFlag=!1,this.exportToExcel=function(e){var t=e.sender.columns;if(u.exportFlag){u.exportFlag=!1,u._.forEach(t,function(t){t.tempVisual&&(delete t.tempVisual,e.sender.hideColumn(t))});for(var n=e.workbook.sheets[0],r=1;r<n.rows.length;r++)for(var i=n.rows[r],a=e.data[r-1],o=0;o<i.cells.length;o++)if(""!==t[o].field){var s=i.cells[o],l=u.getTemplateMethod(t[o]);s.value=l(a)}kendo.ui.progress(u.mainGrid.element,!1)}else e.preventDefault(),u._.forEach(t,function(t){t.hidden&&(t.tempVisual=!0,e.sender.showColumn(t))}),u.$timeout(function(){u.exportFlag=!0,e.sender.saveAsExcel()})},this.hasWriteAccess=c,this.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:"/odata/Organizations("+this.user.currentOrganizationId+")/Users",dataType:"json",data:{$expand:"ObjectOwner,OrganizationUnitRights($expand=Role($select=Name)),OrganizationRights($filter=OrganizationId eq "+this.user.currentOrganizationId+")"}},destroy:{url:function(e){return"/odata/Organizations("+u.user.currentOrganizationId+")/RemoveUser()"},dataType:"json",contentType:"application/json"},parameterMap:function(e,t){if("read"===t){var n=kendo.data.transports["odata-v4"].parameterMap(e,t);return n.$filter&&(n.$filter=u.fixNameFilter(n.$filter,"Name"),n.$filter=u.fixNameFilter(n.$filter,"ObjectOwner.Name")),n}if("destroy"===t){var r={userId:e.Id};return kendo.stringify(r)}return kendo.stringify(e)}},sort:{field:"Name",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{model:{id:"Id",fields:{LastAdvisDate:{type:"date"}}},parse:function(t){return u._.forEach(t.value,function(t){u.user.isGlobalAdmin||(u.user.isLocalAdmin||u.user.isOrgAdmin)&&!u.user.isReadOnly?t.canEdit=!0:u.user.id!==t.Id||u.user.isReadOnly?t.canEdit=!1:t.canEdit=!0,u._.remove(t.OrganizationRights,function(t){return t.Role===e.Models.OrganizationRole.User}),t.isLocalAdmin=void 0!==u._.find(t.OrganizationRights,function(t){return t.Role===e.Models.OrganizationRole.LocalAdmin}),t.isOrgAdmin=void 0!==u._.find(t.OrganizationRights,function(t){return t.Role===e.Models.OrganizationRole.OrganizationModuleAdmin}),t.isProjectAdmin=void 0!==u._.find(t.OrganizationRights,function(t){return t.Role===e.Models.OrganizationRole.ProjectModuleAdmin}),t.isSystemAdmin=void 0!==u._.find(t.OrganizationRights,function(t){return t.Role===e.Models.OrganizationRole.SystemModuleAdmin}),t.isContractAdmin=void 0!==u._.find(t.OrganizationRights,function(t){return t.Role===e.Models.OrganizationRole.ContractModuleAdmin}),t.isReportAdmin=void 0!==u._.find(t.OrganizationRights,function(t){return t.Role===e.Models.OrganizationRole.ReportModuleAdmin}),t.isReadOnly=void 0!==u._.find(t.OrganizationRights,function(t){return t.Role===e.Models.OrganizationRole.ReadOnly})}),t}}},excel:{fileName:"Brugere.xlsx",filterable:!0,allPages:!0},pageable:{refresh:!0,pageSizes:[10,25,50,100,200,"all"],buttonCount:5},sortable:{mode:"single"},editable:!0,reorderable:!0,resizable:!0,filterable:{mode:"row"},groupable:!1,columnMenu:!0,height:window.innerHeight-200,detailTemplate:function(e){return'<uib-tabset active="0">\n                    <uib-tab index="0" heading="Organisation roller"><user-organization-unit-roles user-id="'+e.Id+'" current-organization-id="'+u.user.currentOrganizationId+'"></user-organization-unit-roles></uib-tab>\n                    <uib-tab index="1" heading="Projekt roller"><user-project-roles user-id="'+e.Id+'" current-organization-id="'+u.user.currentOrganizationId+'"></user-project-roles></uib-tab>\n                    <uib-tab index="2" heading="System roller"><user-system-roles user-id="'+e.Id+'" current-organization-id="'+u.user.currentOrganizationId+'"></user-system-roles></uib-tab>\n                    <uib-tab index="3" heading="Kontrakt roller"><user-contract-roles user-id="'+e.Id+'" current-organization-id="'+u.user.currentOrganizationId+'"></user-contract-roles></uib-tab>\n                </uib-tabset>'},excelExport:this.exportToExcel,columns:[{field:"Name",title:"Navn",width:230,persistId:"fullname",template:function(e){return e.Name+" "+e.LastName},excelTemplate:function(e){return e.Name+" "+e.LastName},hidden:!1,filterable:{cell:{template:d,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Email",title:"Email",width:230,persistId:"email",template:function(e){return""+e.Email},excelTemplate:function(e){return e.Email},hidden:!1,filterable:{cell:{template:d,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"LastAdvisDate",title:"Advis",width:110,persistId:"advisdate",template:function(e){return'<advis-button data-user="dataItem" data-current-organization-id="'+u.user.currentOrganizationId+'" data-ng-disabled="'+!e.canEdit+'"></advis>'},excelTemplate:function(e){return e.LastAdvisDate?e.LastAdvisDate.toDateString():""},hidden:!1,filterable:!1},{field:"ObjectOwner.Name",title:"Oprettet af",width:150,persistId:"createdby",template:function(e){return e.ObjectOwner?e.ObjectOwner.Name+" "+e.ObjectOwner.LastName:""},excelTemplate:function(e){return e.ObjectOwner?e.ObjectOwner.Name+" "+e.ObjectOwner.LastName:""},hidden:!1,filterable:{cell:{template:d,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"OrganizationUnitRights.Role",title:"Roller",width:150,persistId:"role",attributes:{class:"might-overflow"},template:function(e){return u.curOrgCheck=e.OrganizationUnitRights.ObjectId==u.user.currentOrganizationId,'<span data-ng-model="dataItem.OrganizationUnitRights" value="rights.Role.Name" ng-repeat="rights in dataItem.OrganizationUnitRights | filter: { ObjectId: \''+u.user.currentOrganizationId+"' }\"> {{rights.Role.Name}}<span data-ng-if=\"projectOverviewVm.checkIfRoleIsAvailable(rights.Role.Id)\">(udgået)</span>{{$last ? '' : ', '}}</span>"},hidden:!0,filterable:{cell:{template:d,dataSource:[],showOperators:!1,operator:"contains"}}},{field:"isLocalAdmin",title:"Lokal Admin",width:96,persistId:"localadminrole",attributes:{class:"text-center"},template:function(e){return e.isLocalAdmin?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:!1,sortable:!1},{field:"isOrgAdmin",title:"Organisations Admin",width:104,persistId:"orgadminrole",attributes:{class:"text-center"},template:function(e){return e.isOrgAdmin?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:!1,sortable:!1},{field:"isProjectAdmin",title:"Projekt Admin",width:109,persistId:"projectadminrole",attributes:{class:"text-center"},template:function(e){return e.isProjectAdmin?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:!1,sortable:!1},{field:"isSystemAdmin",title:"System Admin",width:104,persistId:"systemadminrole",attributes:{class:"text-center"},template:function(e){
return e.isSystemAdmin?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:!1,sortable:!1},{field:"isContractAdmin",title:"Kontrakt Admin",width:112,persistId:"contractadminrole",attributes:{class:"text-center"},template:function(e){return e.isContractAdmin?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:!1,sortable:!1},{field:"isReportAdmin",title:"Rapport Admin",width:112,persistId:"reportadminrole",attributes:{class:"text-center"},template:function(e){return e.isReportAdmin?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:!1,sortable:!1},{field:"isReadOnly",title:"Bruger med læserettigheder",width:112,persistId:"readonlyRole",attributes:{class:"text-center"},template:function(e){return e.isReadOnly?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:!1,sortable:!1},{template:function(e){return e.canEdit?'<a data-ng-click="ctrl.onEdit('+e.Id+')" class="k-button k-button-icontext"><span class="k-icon k-edit"></span>Redigér</a><a data-ng-click="ctrl.onDelete('+e.Id+')" class="k-button k-button-icontext" data-user="dataItem"><span class="k-icon k-delete"></span>Slet</a>':'<a class="k-button k-button-icontext" data-ng-disabled="'+!e.canEdit+'"><span class="k-icon k-edit"></span>Redigér</a><a class="k-button k-button-icontext" data-user="dataItem" data-ng-disabled="'+!e.canEdit+'"><span class="k-icon k-delete"></span>Slet</a>'},title:" ",width:176,persistId:"command"}]}}return t.prototype.onEdit=function(e){this.$state.go("organization.user.edit",{id:e})},t.prototype.fixNameFilter=function(e,t){var n=new RegExp("(\\w+\\()"+t+"(.*?\\))","i");return"ObjectOwner.Name"==t?e.replace(n,"$1concat(concat(ObjectOwner/Name, ' '), ObjectOwner/LastName)$2"):e.replace(n,"$1concat(concat(Name, ' '), LastName)$2")},t.prototype.onDelete=function(e){1==this.hasWriteAccess?this.$state.go("organization.user.delete",{id:e}):this.notify.addErrorMessage("Brugeren har ikke rettigheder til at ændre i organisationen")},t.prototype.getTemplateMethod=function(e){return e.excelTemplate?e.excelTemplate:"function"==typeof e.template?e.template:"string"==typeof e.template?kendo.template(e.template):function(e){return e}},t.$inject=["$http","$timeout","_","$","$state","$scope","notify","user","hasWriteAccess"],t}();angular.module("app").config(["$stateProvider",function(e){e.state("organization.user",{url:"/user",templateUrl:"app/components/org/user/org-user.view.html",controller:n,controllerAs:"ctrl",resolve:{user:["userService",function(e){return e.getUser()}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/Organization/"+n.currentOrganizationId+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}]}})}])}(t.Users||(t.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={})),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.edit.access-control",{url:"/access-control",templateUrl:"app/components/it-system/edit/tabs/it-system-edit-tab-access-control.view.html",controller:"system.SystemAccessControlCtrl",resolve:{accessTypes:["$http","itSystem",function(e,t){return e.get("odata/ItSystems("+t.id+")?$select=Id&$expand=AccessTypes").then(function(e){return e.data.AccessTypes})}]}})}]),t.controller("system.SystemAccessControlCtrl",["$scope","$http","$state","notify","itSystem","user","hasWriteAccess","accessTypes",function(e,t,n,r,i,a,o,s){var l=i.id;e.system=i,e.accessTypes=s,e.hasWriteAccess=o,e.add=function(){if(e.accessTypeName){var n={};n.Name=e.accessTypeName,n.ItSystemId=l;var i=r.addInfoMessage("Opdaterer ...",!1);return t.post("odata/AccessTypes",n).success(function(t){i.toSuccessMessage("Feltet er oprettet!"),e.accessTypes.push(t),e.accessTypeName=""}).error(function(){i.toErrorMessage("Fejl!")})}},e.remove=function(n){var i=r.addInfoMessage("Opdaterer ...",!1);return t.delete("odata/AccessTypes("+n+")").success(function(t){i.toSuccessMessage("Feltet er slettet!"),_.remove(e.accessTypes,function(e){return e.Id===n})}).error(function(e,t){500===t?i.toErrorMessage("Fejl! Kan ikke slettes, da den er i brug."):i.toErrorMessage("Fejl! Kunne ikke slette!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.edit.kle",{url:"/kle",templateUrl:"app/components/it-system/edit/tabs/it-system-edit-tab-kle.view.html",controller:"system.SystemKleCtrl",resolve:{}})}]),t.controller("system.SystemKleCtrl",["$scope","$http","$state","notify","itSystem","user","hasWriteAccess",function(e,t,n,r,i,a,o){function s(){var n=p+"?tasks=true";n+="&onlySelected="+!e.showAllTasks,n+="&taskGroup="+e.selectedTaskGroup,n+="&skip="+e.pagination.skip+"&take="+e.pagination.take,e.pagination.orderBy&&(n+="&orderBy="+e.pagination.orderBy,e.pagination.descending&&(n+="&descending="+e.pagination.descending)),t.get(n).success(function(t,n,r){e.tasklist=t.response;var i=JSON.parse(r("X-Pagination"));e.totalCount=i.TotalCount}).error(function(){r.addErrorMessage("Kunne ikke hente opgaver!")})}function l(e){return t.post(p+"?taskId="+e.taskRef.id+"&organizationId="+a.currentOrganizationId).success(function(t){e.isSelected=!0})}function c(e){return t.delete(p+"?taskId="+e.taskRef.id+"&organizationId="+a.currentOrganizationId).success(function(t){e.isSelected=!1})}function d(){n.go(".",null,{reload:!0})}var u=i.id;e.system=i;var p="api/itSystem/"+u;e.pagination={skip:0,take:50},e.hasWriteAccess=o,e.showAllTasks=!0,e.$watch("selectedTaskGroup",function(t,n){e.pagination.skip=0,s()}),e.$watchCollection("pagination",s),e.changeTaskView=function(){e.showAllTasks=!e.showAllTasks,e.pagination.skip=0,s()},e.save=function(e){var t=r.addInfoMessage("Opdaterer ...",!1);e.isSelected?c(e).success(function(){t.toSuccessMessage("Feltet er opdateret!")}).error(function(){t.toErrorMessage("Fejl!")}):l(e).success(function(){t.toSuccessMessage("Feltet er opdateret!")}).error(function(){t.toErrorMessage("Fejl!")})},e.selectAllTasks=function(){_.each(e.tasklist,function(e){e.isSelected||l(e)})},e.removeAllTasks=function(){_.each(e.tasklist,function(e){e.isSelected&&c(e)})},e.selectTaskGroup=function(){var n=p+"?taskId="+(e.selectedTaskGroup||"")+"&organizationId="+a.currentOrganizationId,i=r.addInfoMessage("Opretter tilknytning...",!1);t.post(n).success(function(){i.toSuccessMessage("Tilknytningen er oprettet"),d()}).error(function(){i.toErrorMessage("Fejl! Kunne ikke oprette tilknytningen!")})},e.removeTaskGroup=function(){var n=p+"?taskId="+(e.selectedTaskGroupc||"")+"&organizationId="+a.currentOrganizationId,i=r.addInfoMessage("Fjerner tilknytning...",!1);t.delete(n).success(function(){i.toSuccessMessage("Tilknytningen er fjernet"),d()}).error(function(){i.toErrorMessage("Fejl! Kunne ikke fjerne tilknytningen!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.edit.main",{url:"/main",templateUrl:"app/components/it-system/edit/tabs/it-system-edit-tab-main.view.html",controller:"system.SystemMainCtrl",resolve:{businessTypes:["$http",function(e){return e.get("odata/LocalBusinessTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc")}],appTypeOptions:["$http",function(e){return e.get("odata/LocalItSystemTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],itSystem:["$http","$stateParams",function(e,t){return e.get("api/itsystem/"+t.id).then(function(e){return e.data.response})}]}})}]),t.controller("system.SystemMainCtrl",["$rootScope","$scope","$http","$state","notify","itSystem","businessTypes","user","autofocus","appTypeOptions","hasWriteAccess",function(e,t,n,r,i,a,o,s,l,c,d){function u(e,t,r){return{minimumInputLength:1,initSelection:function(e,t){},allowClear:t,ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(t){var i=r?"&"+r.join("&"):"",a=n.get(e+"?q="+t.data.query+i).then(t.success);return a.abort=function(){return null},a},results:function(t,n){var r=[];return"api/itsystem"===e?_.each(t.data.response,function(e){!1===e.disabled&&r.push({id:e.id,text:e.name})}):_.each(t.data.response,function(e){r.push({id:e.id,text:e.name})}),{results:r}}}}}e.page.title="IT System - Rediger system",l(),a.updateUrl="api/itsystem/"+a.id,a.belongsTo=a.belongsToId?{id:a.belongsToId,text:a.belongsToName}:null,a.parent=a.parentId?{id:a.parentId,text:a.parentName}:null,t.select2AllowClearOpt={allowClear:!0},t.appTypeOptions=c,t.system=a,t.businessTypes=o.data.value,t.itSystemsSelectOptions=u("api/itsystem",!0,["excludeId="+a.id,"orgId="+s.currentOrganizationId]),t.organizationSelectOptions=u("api/organization",!0,["orgId="+s.currentOrganizationId]),t.hasWriteAccess=d,t.submitDataLevel=function(){var e={DataLevel:t.system.dataLevel};n.patch("api/itsystem/"+a.id+"?organizationId="+a.organizationId,e).success(function(e){i.addSuccessMessage("Feltet er opdateret.")}).error(function(e){i.addErrorMessage("Fejl!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.edit.gdpr",{url:"/gdpr",templateUrl:"app/components/it-system/edit/tabs/it-system-tab-gdpr.view.html",controller:"system.EditGdpr",resolve:{theSystem:["$http","$stateParams",function(e,t){return e.get("api/itsystem/"+t.id).then(function(e){return e.data.response})}],regularSensitiveData:["$http","$stateParams","theSystem",function(e,t,n){return e.get("odata/GetRegularPersonalDataByObjectID(id="+t.id+", entitytype='ITSYSTEM')").then(function(e){return e.data.value})}],sensitivePersonalData:["$http","$stateParams",function(e,t){return e.get("odata/GetSensitivePersonalDataByObjectID(id="+t.id+", entitytype='ITSYSTEM')").then(function(e){return e.data.value})}]}})}]),t.controller("system.EditGdpr",["$scope","$http","$uibModal","$timeout","$state","$stateParams","$confirm","notify","hasWriteAccess","user","theSystem","regularSensitiveData","sensitivePersonalData",function(e,t,n,r,i,a,o,s,l,c,d,u,p){function f(){return i.transitionTo(i.current,a,{reload:!0}).then(function(){return e.hideContent=!0,r(function(){return e.hideContent=!1},1)})}e.hasWriteAccess=l,e.system=d,e.updateUrl="api/itsystem/"+d.id,e.regularSensitiveData=u,e.sensitivePersonalData=p,e.dataWorkers=d.associatedDataWorkers,e.dataWorkerSelectOptions=function(e,n,r){return{minimumInputLength:1,allowClear:!0,placeholder:" ",initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(n){var i=r?"&"+r.join("&"):"",a=t.get(e+"?q="+n.data.query+i).then(n.success);return a.abort=function(){return null},a},results:function(e,t){var r=[];return _.each(e.data.response,function(e){n&&e.id==d.id||r.push({id:e.id,text:e.name?e.name:"Unavngiven",cvr:e.cvr})}),{results:r}}}}}("api/organization",!1,["public=true","orgId="+c.currentOrganizationId]),e.updateDataLevel=function(e,n,r){var i=s.addInfoMessage("Arbejder ...",!1);if(1==n){var a={ObjectId:d.id,OptionId:e,OptionType:r,ObjectType:"ITSYSTEM"};t.post("Odata/AttachedOptions/",a,{handleBusy:!0}).success(function(e){i.toSuccessMessage("Feltet er Opdateret.")}).error(function(){i.toErrorMessage("Fejl!")})}else t.delete("Odata/RemoveOption(id="+e+", objectId="+d.id+",type='"+r+"', entitytype='ITSYSTEM')").success(function(){i.toSuccessMessage("Feltet er Opdateret.")}).error(function(){i.toErrorMessage("Fejl!")})},e.changeDataField=function(n){var r;switch(n){case"containsLegalInfo":r={ContainsLegalInfo:e.system.containsLegalInfo};break;case"isDataTransferedToThirdCountries":r={IsDataTransferedToThirdCountries:e.system.isDataTransferedToThirdCountries}}t.patch("api/itsystem/"+d.id+"?organizationId="+d.organizationId,r).success(function(e){s.addSuccessMessage("Feltet er Opdateret.")}).error(function(e){s.addErrorMessage("Fejl!")})},e.delete=function(n){t.delete("api/DataWorker/"+n+"?organizationid="+e.system.organizationId).success(function(){s.addSuccessMessage("Databehandlerens tilknytning er fjernet."),f()}).error(function(){s.addErrorMessage("Fejl! Kunne ikke fjerne databehandlerens tilknyttning!")})},e.editLink=function(){n.open({templateUrl:"app/components/it-system/usage/tabs/it-systemusage-tab-gdpr-editlink-modal.view.html",controller:["$scope","$state","$uibModalInstance","usage",function(e,n,r,i){e.usage=i,e.linkName=e.usage.linkToDirectoryAdminUrlName,e.Url=e.usage.linkToDirectoryAdminUrl,e.ok=function(){var i={Id:e.usage.Id,LinkToDirectoryAdminUrlName:e.usage.linkToDirectoryAdminUrlName,LinkToDirectoryAdminUrl:e.usage.linkToDirectoryAdminUrl};i.LinkToDirectoryAdminUrlName=e.linkName,i.LinkToDirectoryAdminUrl=e.Url;var a=s.addInfoMessage("Gemmer...",!1);t({method:"PATCH",url:"api/itsystem/"+e.usage.id+"?organizationId="+c.currentOrganizationId,data:i}).success(function(){a.toSuccessMessage("Feltet er opdateret."),n.reload()}).error(function(){a.toErrorMessage("Fejl! Feltet kunne ikke ændres!")}),r.close()},e.cancel=function(){r.dismiss("cancel")}}],resolve:{usage:[function(){return e.system}]}})},e.save=function(){var n={ItSystemId:e.system.id,DataWorkerId:e.selectedDataWorker.id};t.post("api/Dataworker/",n).success(function(){s.addSuccessMessage("Databehandleren er tilknyttet."),f()}).error(function(){s.addErrorMessage("Fejl! Kunne ikke tilknytte databehandleren!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.edit.references.create",{url:"/createReference/:id",onEnter:["$state","$stateParams","$uibModal","user",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"system.referenceCreateModalCtrl",resolve:{itSystem:["$http","$stateParams",function(e,t){return e.get("api/itsystem/"+t.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("system.referenceCreateModalCtrl",["$scope","$http","itSystem","notify","user",function(e,t,n,r,i){e.dismiss=function(){e.$dismiss()},e.save=function(){var i=new Date,a={ItSystem_Id:n.id,Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display,Created:i},o=r.addInfoMessage("Gemmer række",!1);t.post("api/Reference",a).success(function(t){o.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){o.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.edit.references.edit",{url:"/editReference/:refId/:orgId",onEnter:["$state","$stateParams","$uibModal","$http",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"system.referenceEditModalCtrl",resolve:{reference:["$http",function(e){return e.get("api/Reference/"+t.refId).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("system.referenceEditModalCtrl",["$scope","$http","reference","$stateParams","notify",function(e,t,n,r,i){e.reference=n,e.dismiss=function(){e.$dismiss()},e.save=function(){var n={Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display},a=i.addInfoMessage("Gemmer række",!1);t.patch("api/Reference/"+r.refId+"?organizationId="+r.orgId,n).success(function(t){a.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){a.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.edit.references",{url:"/reference",templateUrl:"app/components/it-reference/it-reference.view.html",controller:"system.EditReference",resolve:{theSystem:["$http","itSystem",function(e,t){return e.get("odata/ItSystems("+t.id+")?$expand=ExternalReferences($expand=ObjectOwner)").then(function(e){return e.data})}]}})}]),t.controller("system.EditReference",["$scope","$http","$timeout","$state","$stateParams","$confirm","notify","hasWriteAccess","theSystem",function(e,t,n,r,i,a,o,s,l){function c(){r.go(".",null,{reload:!0})}e.hasWriteAccess=s,e.referenceName=l.Name,e.setChosenReference=function(e){var n=e===l.ReferenceId?null:e,r={ReferenceId:n},i=o.addInfoMessage("Opdaterer felt...",!1);t.patch("api/itSystem/"+l.Id+"?organizationId="+l.OrganizationId,r).success(function(e){i.toSuccessMessage("Feltet er opdateret!"),c()}).error(function(){i.toErrorMessage("Fejl! Prøv igen.")})},e.deleteReference=function(e){var n=o.addInfoMessage("Sletter...");t.delete("api/Reference/"+e+"?organizationId="+l.OrganizationId).success(function(){n.toSuccessMessage("Slettet!")}).error(function(){n.toErrorMessage("Fejl! Kunne ikke slette!")}),c()},e.edit=function(e){r.go(".edit",{refId:e,orgId:l.OrganizationId})},e.isValidUrl=function(e){if(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())}return!1},e.mainGridOptions={dataSource:{data:l.ExternalReferences,pageSize:10},sortable:!0,pageable:{refresh:!1,pageSizes:!0,buttonCount:5},columns:[{field:"Title",title:"Dokumenttitel",template:function(e){return e.URL?'<a target="_blank" href="'+e.Url+'">'+e.Title+"</a>":e.Title},width:240},{field:"ExternalReferenceId",title:"Evt. dokumentID/Sagsnr./anden referenceContact"},{field:"Created",title:"Oprettet",template:"#= kendo.toString(kendo.parseDate(Created, 'yyyy-MM-dd'), 'dd. MMMM yyyy') #"},{field:"ObjectOwner.Name",title:"Oprettet af",template:function(e){return e.ObjectOwner?e.ObjectOwner.Name+" "+e.ObjectOwner.LastName:""},width:150},{title:"Rediger",template:function(t){var n="<button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' title='Redigér reference' data-ng-click=\"edit("+t.Id+")\"><i class='fa fa-pencil' aria-hidden='true'></i></button>";return t.Id!=l.ReferenceId&&(n+=" <button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' data-confirm-click=\"Er du sikker på at du vil slette?\" class='btn btn-link' title='Slet reference' data-confirmed-click='deleteReference("+t.Id+")'><i class='fa fa-trash-o' aria-hidden='true'></i></button>"),t.URL&&(n=t.Id===l.ReferenceId?n+"<button data-uib-tooltip=\"Vises i overblik\" tooltip-placement='right' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' data-ng-click='setChosenReference("+t.Id+")'><img class='referenceIcon chosen' src=\"/Content/img/VisIOverblik.svg\"/></button>":n+"<button data-uib-tooltip=\"Vis objekt i overblik\"  tooltip-placement='right' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' data-ng-click='setChosenReference("+t.Id+")'><img class='referenceIcon' src=\"/Content/img/VisIOverblik.svg\"></img></button>"),n}}],toolbar:[{name:"addReference",text:"Tilføj reference",template:function(){return s?'<a id="addReferenceItSystem" class="btn btn-success btn-sm" href="\\#/system/edit/'+l.Id+"/reference/createReference/"+l.Id+"\"'>Tilføj reference</a>":""}}]}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.access-control",{url:"/access-control",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-access-control.view.html",controller:"system.UsageAccessControl",resolve:{accessTypes:["$http","itSystemUsage",function(e,t){return e.get("odata/ItSystems("+t.itSystemId+")?$select=Id&$expand=AccessTypes").then(function(e){return e.data.AccessTypes})}],activeAccessTypes:["$http","itSystemUsage",function(e,t){return e.get("odata/ItSystemUsages("+t.id+")?$select=Id&$expand=AccessTypes").then(function(e){return e.data.AccessTypes})}]}})}]),t.controller("system.UsageAccessControl",["$scope","$http","$state","$stateParams","itSystemUsage","notify","accessTypes","activeAccessTypes","hasWriteAccess",function(e,t,n,r,i,a,o,s,l){i.id;e.usage=i,e.hasWriteAccess=l,e.accessTypes=o,e.isActive=function(e){return _.find(s,{Id:e})},e.toggle=function(e,n){if(n.currentTarget.checked){var r={};r["@odata.id"]=window.location.origin+"/odata/AccessTypes("+e.Id+")";var o=a.addInfoMessage("Opdaterer ...",!1);return t.post("odata/ItSystemUsages("+i.id+")/AccessTypes/$ref",r).success(function(e){o.toSuccessMessage("Feltet er opdateret!")}).error(function(){o.toErrorMessage("Fejl!")})}var o=a.addInfoMessage("Opdaterer ...",!1);return t.delete("odata/ItSystemUsages("+i.id+")/AccessTypes/$ref?$id="+window.location.origin+"/odata/AccessTypes("+e.Id+")").success(function(e){o.toSuccessMessage("Feltet er opdateret!")}).error(function(){o.toErrorMessage("Fejl!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.advice",{url:"/advice",templateUrl:"app/components/it-advice/it-advice.view.html",controller:"object.EditAdviceCtrl",controllerAs:"Vm",resolve:{Roles:["$http",function(e){return e.get("odata/LocalItSystemRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],advices:["$http","$stateParams",function(e,t){return e.get("api/itSystemUsage/"+t.id).then(function(e){return e.data.response.advices})}],object:["itSystemUsage",function(e){return e}],type:[function(){return"itSystemUsage"}],hasWriteAccess:["$http","$stateParams","user",function(e,t,n){return e.get("api/itSystemUsage/"+t.id+"?hasWriteAccess=true&organizationId="+n.currentOrganizationId).then(function(e){return e.data.response})}],advicename:["$http","$stateParams",function(e,t){return e.get("api/itSystemUsage/"+t.id).then(function(e){return e.data.response.itSystem})}]}})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.archiving",{url:"/archiving",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-archiving.view.html",controller:"system.EditArchiving",resolve:{archiveTypes:["$http",function(e){return e.get("odata/LocalArchiveTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],archiveLocations:["$http",function(e){return e.get("odata/LocalArchivelocations?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],archiveTestLocations:["$http",function(e){return e.get("odata/LocalArchiveTestlocations?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],systemUsage:["$http","$stateParams",function(e,t){return e.get("odata/itSystemUsages("+t.id+")").then(function(e){return e.data})}],archivePeriod:["$http","$stateParams",function(e,t){return e.get("odata/ArchivePeriods?$filter=ItSystemUsageId eq "+t.id+"&$orderby=StartDate").then(function(e){return e.data.value})}]}})}]),t.controller("system.EditArchiving",["$scope","_","$http","$state","$stateParams","$timeout","user","itSystemUsage","itSystemUsageService","archiveTypes","archiveLocations","archiveTestLocations","systemUsage","archivePeriod","moment","notify",function(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g,m){function h(){var n=[],r=[];t.each(e.archivePeriods,function(e){g().isBetween(g(e.StartDate,["DD-MM-YYYY","YYYY-MM-DD"]).startOf("day"),g(e.EndDate,["DD-MM-YYYY","YYYY-MM-DD"]).endOf("day"),null,"[]")?n.push(e):r.push(e)}),t.each(r,function(e){n.push(e)}),e.archivePeriods=n}function v(){t.each(e.archivePeriods,function(e){n.delete("odata/ArchivePeriods("+e.Id+")").then(function(){m.addSuccessMessage("Dataen for arkiveringen er slettet!"),I()})})}function y(){var t={},r="api/itSystemUsage/"+i.id+"?organizationId="+o.currentOrganizationId;t.Archived=!1,t.ArchiveDuty=null,t.ReportedToDPA=null,t.DocketNo="",t.ArchiveNotes="",t.ArchiveFreq=0,t.Registertype=null,t.ArchiveFromSystem=null,t.archiveTypeId=null,t.archiveLocationId=null,t.SupplierId=null,t.archiveTestLocationId=null,n.patch(r,t).then(function(){e.Archived=!1,e.ArchiveDuty=null,e.systemUsage.ReportedToDPA=null,e.systemUsage.DocketNo="",e.systemUsage.ArchiveNotes="",e.systemUsage.ArchiveFreq=0,e.systemUsage.Registertype=null,e.systemUsage.ArchiveFromSystem=null,e.usage.archiveTypeId=null,e.usage.archiveLocationId=null,e.usage.SupplierId=null,e.usage.archiveTestLocationId=null,e.archivePeriods.length<1?(m.addSuccessMessage("Dataen for arkiveringen er slettet!"),I()):v()},function(){})}function I(){return r.transitionTo(r.current,i,{reload:!0}).then(function(){return e.hideContent=!0,a(function(){return e.hideContent=!1},1)})}function b(e){var t="<div>"+e.text+"</div>";return e.cvr&&(t+='<div class="small">'+e.cvr+"</div>"),t}e.usage=s,e.archiveTypes=c,e.archiveLocations=d,e.archiveTestLocations=u,e.usageId=i.id,e.systemUsage=p,e.ArchivedDate=p.ArchivedDate,e.archivePeriods=f,e.hasWriteAccessAndArchived=p.Archived,e.ArchiveDuty=p.ArchiveDuty,p.Archived||(e.systemUsage.Archived=!1),p.ArchiveDuty||(e.ArchiveDuty=s.itSystem.archiveDuty),e.archivePeriods&&h(),e.$watch("usage.archiveTypeId",function(t,n){t!==n&&null!==t&&(e.dirty=!0)}),e.$watch("usage.archiveLocationId",function(t,n){t!==n&&null!==t&&(e.dirty=!0)}),e.$watch("usage.archiveTestLocationId",function(t,n){t!==n&&null!==t&&(e.dirty=!0)}),e.patchArchivedNo=function(){confirm("Bekræft at alle de indtastede data i Arkivering vil blive slettet hvis der fortsættes")?y():(m.addInfoMessage("Feltet blev ikke opdateret!"),e.systemUsage.Archived=!0)},e.patch=function(t,r){var i={};i[t]=r,"Archived"===t?n.patch("/odata/ItSystemUsages("+e.usageId+")",i).then(function(){m.addSuccessMessage("Feltet er opdateret!"),I()},function(){return m.addErrorMessage("Fejl! Feltet kunne ikke opdateres!")}):"ArchiveFreq"===t&&(r<0||0===r.length)?m.addErrorMessage("Fejl! Feltet kunne ikke opdateres!"):l.patchSystem(e.usageId,i)},e.patchSupplier=function(t,n){var r={};r[t]=n.id,r.ArchiveSupplier=n.text,l.patchSystem(e.usageId,r)},p.SupplierId&&(e.systemUsage.supplier={id:p.SupplierId,text:p.ArchiveSupplier}),e.save=function(){e.$broadcast("show-errors-check-validity");var t=g(e.archivePeriod.startDate,"DD-MM-YYYY"),r=g(e.archivePeriod.endDate,"DD-MM-YYYY"),a=!t.isValid()||isNaN(t.valueOf())||t.year()<1e3||t.year()>2099,o=!r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099,s=t.startOf("day")>=r.endOf("day");if(a||o)return void m.addErrorMessage("Den indtastede dato er ugyldig.");if(s)return void m.addErrorMessage("Den indtastede slutdato er før startdatoen.");t=t.format("YYYY-MM-DD"),r=r.format("YYYY-MM-DD");var l={};l.StartDate=t,l.EndDate=r,l.UniqueArchiveId=e.archivePeriod.uniqueArchiveId,l.ItSystemUsageId=i.id,l.Approved=e.archivePeriod.approved,n.post("odata/ArchivePeriods",l).finally(I)},e.delete=function(e){n.delete("odata/ArchivePeriods("+e+")").finally(I),m.addSuccessMessage("Slettet!")},e.suppliersSelectOptions=function(e,r,i,a){return{minimumInputLength:1,allowClear:!0,placeholder:" ",formatResult:i,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(t){var r=a?"&"+a.join("&"):"",i=n.get(e+"?q="+t.data.query+r).then(t.success);return i.abort=function(){return null},i},results:function(e,n){var r=[];return t.each(e.data.response,function(e){r.push({id:e.id,text:e.name?e.name:"Unavngiven",cvr:e.cvr})}),{results:r}}}}}("api/organization",!1,b,["public=true","orgId="+o.currentOrganizationId]),e.patchDatePeriode=function(t,r,i){var a=g(r,"DD-MM-YYYY"),o=e.archivePeriods.filter(function(e){return e.Id===i}),s=g(o[0].StartDate,["DD-MM-YYYY","YYYY-MM-DD"]).startOf("day"),l=g(o[0].EndDate,["DD-MM-YYYY","YYYY-MM-DD"]).endOf("day");if(!a.isValid()||isNaN(a.valueOf())||a.year()<1e3||a.year()>2099)m.addErrorMessage("Den indtastede dato er ugyldig.");else if(s>=l)e.archivePeriods=f,m.addErrorMessage("Den indtastede slutdato er før startdatoen.");else{a=a.format("YYYY-MM-DD");var c={};c[t]=a,h(),n.patch("odata/ArchivePeriods("+i+")",c).finally(I),m.addSuccessMessage("Datoen er opdateret!")}},e.patchPeriode=function(e,t,r){var i={};i[e]=t,n.patch("odata/ArchivePeriods("+r+")",i),m.addSuccessMessage("Feltet er opdateret!")},e.datepickerOptions={format:"dd-MM-yyyy"}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.contracts",{url:"/contracts",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-contracts.view.html",controller:"system.EditContracts",resolve:{}})}]),t.controller("system.EditContracts",["$scope","$http","$state","$stateParams","$timeout","itSystemUsage","notify",function(e,t,n,r,i,a,o){function s(){n.go(".",null,{reload:!0})}var l=a.id;e.usage=a,e.contracts=a.contracts,e.mainContractId=a.mainContractId,e.saveMainContract=function(){var n=o.addInfoMessage("Gemmer... ");e.mainContractId?t.post("api/ItContractItSystemUsage/?contractId="+e.mainContractId+"&usageId="+l).success(function(){n.toSuccessMessage("Gemt!"),s()}).error(function(){n.toErrorMessage("Fejl! Kunne ikke gemmes!")}):t.delete("api/ItContractItSystemUsage/?usageId="+l).success(function(){n.toSuccessMessage("Gemt!"),s()}).error(function(){n.toErrorMessage("Fejl! Kunne ikke gemmes!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.GDPR",{url:"/GDPR",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-GDPR.view.html",controller:"system.GDPR",resolve:{systemUsage:["$http","$stateParams",function(e,t){return e.get("odata/itSystemUsages("+t.id+")").then(function(e){return e.data})}],regularSensitiveData:["$http","$stateParams",function(e,t){return e.get("odata/GetRegularPersonalDataByObjectID(id="+t.id+", entitytype='ITSYSTEMUSAGE')").then(function(e){return e.data.value})}],sensitivePersonalData:["$http","$stateParams",function(e,t){return e.get("odata/GetSensitivePersonalDataByObjectID(id="+t.id+", entitytype='ITSYSTEMUSAGE')").then(function(e){return e.data.value})}],registerTypes:["$http","$stateParams",function(e,t){return e.get("odata/GetRegisterTypesByObjectID(id="+t.id+")").then(function(e){return e.data.value})}],dataResponsible:["$http","$stateParams","user",function(e,t,n){return e.get("api/dataResponsible/"+n.currentOrganizationId).then(function(e){return e.data.response})}]}})}]),t.controller("system.GDPR",["$scope","$http","$state","$uibModal","$stateParams","$timeout","itSystemUsage","itSystemUsageService","systemUsage","moment","notify","registerTypes","regularSensitiveData","sensitivePersonalData","user","dataResponsible",function(e,t,n,r,i,a,o,s,l,c,d,u,p,f,g,m){function h(){return n.transitionTo(n.current,i,{reload:!0}).then(function(){return e.hideContent=!0,a(function(){return e.hideContent=!1},1)})}e.usage=o,e.registerTypes=u,e.usageId=i.id,e.systemUsage=l,e.regularSensitiveData=_.orderBy(p,"Priority","desc"),e.sensitivePersonalData=f,e.contracts=o.contracts.filter(function(e){return"Databehandleraftale"===e.contractTypeName||e.agreementElements.some(function(e){return"Databehandleraftale"===e.name})}),e.filterDataProcessor=e.contracts.length>0,e.generalPurpose=o.generalPurpose,e.generalPurpose||(e.generalPurpose=o.itSystem.generalPurpose),e.systemUsage.LinkToDirectoryUrl=o.linkToDirectoryUrl,e.systemUsage.LinkToDirectoryUrl||(e.systemUsage.LinkToDirectoryUrl=o.itSystem.linkToDirectoryAdminUrl),e.systemUsage.LinkToDirectoryUrlName=o.linkToDirectoryUrlName,e.systemUsage.LinkToDirectoryUrlName||(e.systemUsage.LinkToDirectoryUrlName=o.itSystem.linkToDirectoryAdminUrlName),l.dataProcessor||(e.systemUsage.dataProcessor=m.name),e.updateUrl="/api/itsystemusage/"+e.usage.id,e.dataWorkerSelectOptions=function(e,n,r){return{minimumInputLength:1,
allowClear:!0,placeholder:" ",initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(n){var i=r?"&"+r.join("&"):"",a=t.get(e+"?q="+n.data.query+i).then(n.success);return a.abort=function(){return null},a},results:function(e,t){var r=[];return _.each(e.data.response,function(e){n&&e.id==o.id||r.push({id:e.id,text:e.name?e.name:"Unavngiven",cvr:e.cvr})}),{results:r}}}}}("api/organization",!1,["public=true","orgId="+g.currentOrganizationId]),e.systemUsage.LinkToDirectoryUrl=encodeURI(l.LinkToDirectoryUrl),e.updateDataLevel=function(e,n,r,i){var a=d.addInfoMessage("Arbejder ...",!1);if(1==n){var s={ObjectId:o.id,OptionId:e,OptionType:r,ObjectType:"ITSYSTEMUSAGE"};t.post("Odata/AttachedOptions/",s,{handleBusy:!0}).success(function(e){a.toSuccessMessage("Feltet er Opdateret.")}).error(function(){a.toErrorMessage("Fejl!")})}else t.delete("Odata/RemoveOption(id="+e+", objectId="+o.id+",type='"+r+"', entityType='ITSYSTEMUSAGE')").success(function(){a.toSuccessMessage("Feltet er Opdateret.")}).error(function(){a.toErrorMessage("Fejl!")})},e.patch=function(t,n){var r={};r[t]=n,s.patchSystem(e.usageId,r)},e.patchDate=function(t,n){var r=c(c(n,"DD-MM-YYYY",!0).format());if(!r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099)d.addErrorMessage("Den indtastede dato er ugyldig."),e.ArchivedDate=l.ArchivedDate;else{r=r.format("YYYY-MM-DD");var i={};i[t]=r,s.patchSystem(e.usageId,i),e.ArchivedDate=r}},e.editLink=function(n){r.open({templateUrl:"app/components/it-system/usage/tabs/it-systemusage-tab-gdpr-editlink-modal.view.html",controller:["$scope","$state","$uibModalInstance","usage",function(e,r,i,a){switch(e.usage=a,n){case"datahandlerSupervisionDocumentationUrl":e.linkName=e.usage.datahandlerSupervisionDocumentationUrlName,e.Url=e.usage.datahandlerSupervisionDocumentationUrl;break;case"technicalSupervisionDocumentationUrl":e.linkName=e.usage.TechnicalSupervisionDocumentationUrlName,e.Url=e.usage.TechnicalSupervisionDocumentationUrl;break;case"UserSupervisionDocumentationUrl":e.linkName=e.usage.UserSupervisionDocumentationUrlName,e.Url=e.usage.UserSupervisionDocumentationUrl;break;case"RiskSupervisionDocumentationUrl":e.linkName=e.usage.RiskSupervisionDocumentationUrlName,e.Url=e.usage.RiskSupervisionDocumentationUrl;break;case"DataHearingSupervisionDocumentationUrl":e.linkName=e.usage.DataHearingSupervisionDocumentationUrlName,e.Url=e.usage.DataHearingSupervisionDocumentationUrl;break;case"DPIASupervisionDocumentationUrl":e.linkName=e.usage.DPIASupervisionDocumentationUrlName,e.Url=e.usage.DPIASupervisionDocumentationUrl;break;case"LinkToDirectoryUrl":e.linkName=e.usage.LinkToDirectoryUrlName,e.Url=e.usage.LinkToDirectoryUrl}e.ok=function(){var a={Id:e.usage.Id,datahandlerSupervisionDocumentationUrlName:e.usage.DatahandlerSupervisionDocumentationUrlName,datahandlerSupervisionDocumentationUrl:e.usage.DatahandlerSupervisionDocumentationUrl,technicalSupervisionDocumentationUrlName:e.usage.TechnicalSupervisionDocumentationUrlName,technicalSupervisionDocumentationUrl:e.usage.TechnicalSupervisionDocumentationUrl,userSupervisionDocumentationUrlName:e.usage.UserSupervisionDocumentationUrlName,userSupervisionDocumentationUrl:e.usage.UserSupervisionDocumentationUrl,riskSupervisionDocumentationUrlName:e.usage.RiskSupervisionDocumentationUrlName,riskSupervisionDocumentationUrl:e.usage.RiskSupervisionDocumentationUrl,dataHearingSupervisionDocumentationUrlName:e.usage.DataHearingSupervisionDocumentationUrlName,dataHearingSupervisionDocumentationUrl:e.usage.DataHearingSupervisionDocumentationUrl,DPIASupervisionDocumentationUrlName:e.usage.DPIASupervisionDocumentationUrlName,DPIASupervisionDocumentationUrl:e.usage.DPIASupervisionDocumentationUrl,LinkToDirectoryUrlName:e.usage.LinkToDirectoryUrlName,LinkToDirectoryUrl:e.usage.LinkToDirectoryUrl};switch(n){case"datahandlerSupervisionDocumentationUrl":a.datahandlerSupervisionDocumentationUrlName=e.linkName,a.datahandlerSupervisionDocumentationUrl=e.Url;break;case"technicalSupervisionDocumentationUrl":a.technicalSupervisionDocumentationUrlName=e.linkName,a.technicalSupervisionDocumentationUrl=e.Url;break;case"UserSupervisionDocumentationUrl":a.userSupervisionDocumentationUrlName=e.linkName,a.userSupervisionDocumentationUrl=e.Url;break;case"RiskSupervisionDocumentationUrl":a.riskSupervisionDocumentationUrlName=e.linkName,a.riskSupervisionDocumentationUrl=e.Url;break;case"DataHearingSupervisionDocumentationUrl":a.dataHearingSupervisionDocumentationUrlName=e.linkName,a.dataHearingSupervisionDocumentationUrl=e.Url;break;case"DPIASupervisionDocumentationUrl":a.DPIASupervisionDocumentationUrlName=e.linkName,a.DPIASupervisionDocumentationUrl=e.Url;break;case"LinkToDirectoryUrl":a.LinkToDirectoryUrlName=e.linkName,a.LinkToDirectoryUrl=e.Url}var o=d.addInfoMessage("Gemmer...",!1);t({method:"PATCH",url:"api/itsystemusage/"+e.usage.Id+"?organizationId="+g.currentOrganizationId,data:a}).success(function(){o.toSuccessMessage("Feltet er opdateret."),r.reload()}).error(function(){o.toErrorMessage("Fejl! Feltet kunne ikke ændres!")}),i.close()},e.cancel=function(){i.dismiss("cancel")}}],resolve:{usage:[function(){return e.systemUsage}]}})},e.toggleSelection=function(t){var n=e.selection.indexOf(t);n>-1?e.selection.splice(n,1):e.selection.push(t)},e.delete=function(n){t.delete("api/UsageDataWorker/"+n+"?organizationid="+e.usage.organizationId).success(function(){d.addSuccessMessage("Databehandlerens tilknyttning er fjernet."),h()}).error(function(){d.addErrorMessage("Fejl! Kunne ikke fjerne databehandlerens tilknyttning!")})},e.save=function(){var n={ItSystemUsageId:e.usage.id,DataWorkerId:e.selectedDataWorker.id};t.post("api/UsageDataworker/",n).success(function(){d.addSuccessMessage("Databehandleren er tilknyttet."),h()}).error(function(){d.addErrorMessage("Fejl! Kunne ikke tilknytte databehandleren!")})},e.datepickerOptions={format:"dd-MM-yyyy"}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.hierarchy",{url:"/hierarchy",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-hierarchy.view.html",controller:"system.EditHierarchy",resolve:{hierarchyFlat:["$http","itSystemUsage",function(e,t){return e.get("api/itsystem/"+t.itSystemId+"?hierarchy=true").then(function(e){return e.data.response})}]}})}]),t.controller("system.EditHierarchy",["$scope","_","hierarchyFlat","itSystemUsage",function(e,t,n,r){e.systems=t.toHierarchy(n,"id","parentId","children"),e.usage=r}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.interfaces",{url:"/interfaces",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-interfaces.view.html",controller:"system.EditInterfaces",resolve:{tsas:["$http",function(e){return e.get("odata/LocalTsaTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],interfaces:["$http",function(e){return e.get("odata/LocalInterfaceTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],interfaceTypes:["$http",function(e){return e.get("odata/LocalItInterfaceTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],methods:["$http",function(e){return e.get("odata/LocalMethodTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],dataTypes:["$http",function(e){return e.get("odata/LocalDataTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],frequencies:["$http",function(e){return e.get("odata/LocalFrequencyTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],exhibits:["$http","itSystemUsage","user",function(e,t,n){return e.get("api/exhibit/?interfaces=true&sysId="+t.itSystem.id+"&orgId="+n.currentOrganizationId).then(function(n){var r=n.data.response;return _.each(r,function(n){e.get("api/itInterfaceExhibitUsage/?usageId="+t.id+"&exhibitId="+n.exhibitedById).success(function(e){n.usage=e.response})}),r})}],user:["userService",function(e){return e.getUser()}]}})}]),t.controller("system.EditInterfaces",["$rootScope","$scope","$http","notify","tsas","interfaces","interfaceTypes","methods","dataTypes","frequencies","itSystemUsage","exhibits",function(e,t,n,r,i,a,o,s,l,c,d,u){function p(e){e.interfaceType=_.find(o,{Id:e.interfaceTypeId}),e.interface=_.find(a,{Id:e.interfaceId}),e.method=_.find(s,{Id:e.methodId}),e.tsa=_.find(i,{Id:e.tsaId}),_.each(e.dataRows,function(e){e.dataType=_.find(l,{Id:e.dataTypeId})}),e.numRows=e.dataRows.length}t.frequencies=c,t.filterInterfaces=function(e){return e.canBeUsed||e.usage||t.showAllInterfaces},_.each(u,function(e){e.updateUrl="api/itInterfaceExhibitUsage/",e.urlParams="&usageId="+d.id+"&exhibitId="+e.id,p(e)}),t.interfaceExposures=u,t.itSystemUsageSelectOptions=function(e,t){return{allowClear:!0,minimumInputLength:1,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(r){var i=t?"&"+t.join("&"):"",a=n.get(e+"?q="+r.data.query+i).then(r.success);return a.abort=function(){return null},a},results:function(e,t){var n=[];return _.each(e.data.response,function(e){n.push({id:e.id,text:e.itSystem.name})}),{results:n}}}}}("api/itSystemUsage",["organizationId="+d.organizationId])}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.kle",{url:"/kle",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-kle.view.html",controller:"system.EditKle",resolve:{}})}]),t.controller("system.EditKle",["$scope","$http","$state","$stateParams","notify","user","hasWriteAccess",function(e,t,n,r,i,a,o){function s(){var n=p+"?tasks=true";n+="&onlySelected="+!e.showAllTasks,n+="&taskGroup="+e.selectedTaskGroup,n+="&skip="+e.pagination.skip+"&take="+e.pagination.take,e.pagination.orderBy&&(n+="&orderBy="+e.pagination.orderBy,e.pagination.descending&&(n+="&descending="+e.pagination.descending)),t.get(n).success(function(t,n,r){e.tasklist=t.response;var i=JSON.parse(r("X-Pagination"));e.totalCount=i.TotalCount}).error(function(){i.addErrorMessage("Kunne ikke hente opgaver!")})}function l(e){return t.post(p+"?taskId="+e.taskRef.id+"&organizationId="+a.currentOrganizationId).success(function(t){e.isSelected=!0})}function c(e){return t.delete(p+"?taskId="+e.taskRef.id+"&organizationId="+a.currentOrganizationId).success(function(t){e.isSelected=!1})}function d(){n.go(".",null,{reload:!0})}var u=r.id,p="api/itSystemUsage/"+u;e.pagination={skip:0,take:50},e.hasWriteAccess=o,e.showAllTasks=!0,e.$watch("selectedTaskGroup",function(t,n){e.pagination.skip=0,s()}),e.$watchCollection("pagination",s),e.changeTaskView=function(){e.showAllTasks=!e.showAllTasks,e.pagination.skip=0,s()},e.save=function(e){var t=i.addInfoMessage("Opdaterer ...",!1);e.isSelected?c(e).success(function(){t.toSuccessMessage("Feltet er opdateret!")}).error(function(){t.toErrorMessage("Fejl!")}):l(e).success(function(){t.toSuccessMessage("Feltet er opdateret!")}).error(function(){t.toErrorMessage("Fejl!")})},e.selectAllTasks=function(){_.each(e.tasklist,function(e){e.isSelected||e.isLocked||l(e)})},e.removeAllTasks=function(){_.each(e.tasklist,function(e){e.isSelected&&!e.isLocked&&c(e)})},e.selectTaskGroup=function(){var n=p+"?taskId="+e.selectedTaskGroup+"&organizationId="+a.currentOrganizationId,r=i.addInfoMessage("Opretter tilknytning...",!1);t.post(n).success(function(){r.toSuccessMessage("Tilknytningen er oprettet"),d()}).error(function(){r.toErrorMessage("Fejl! Kunne ikke oprette tilknytningen!")})},e.removeTaskGroup=function(){var n=p+"?taskId="+e.selectedTaskGroup+"&organizationId="+a.currentOrganizationId,r=i.addInfoMessage("Fjerner tilknytning...",!1);t.delete(n).success(function(){r.toSuccessMessage("Tilknytningen er fjernet"),d()}).error(function(){r.toErrorMessage("Fejl! Kunne ikke fjerne tilknytningen!")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.main",{url:"/main",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-main.view.html",controller:"system.EditMain",resolve:{businessTypes:["$http",function(e){return e.get("odata/LocalBusinessTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],archiveTypes:["$http",function(e){return e.get("odata/LocalArchiveTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],sensitiveDataTypes:["$http",function(e){return e.get("odata/LocalSensitiveDataTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],appTypeOptions:["$http",function(e){return e.get("odata/LocalItSystemTypes?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],systemCategories:["$http",function(e){return e.get("odata/LocalItSystemCategories?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}]}})}]),t.controller("system.EditMain",["$rootScope","$scope","$http","$stateParams","notify","itSystemUsage","user","systemCategories","businessTypes","archiveTypes","sensitiveDataTypes","autofocus","hasWriteAccess","appTypeOptions",function(e,t,n,r,i,a,o,s,l,c,d,u,p,f){function g(e,t){var r=i.addInfoMessage("Gemmer...",!1);n({method:"PATCH",url:t,data:e}).success(function(){r.toSuccessMessage("Feltet er opdateret.")}).error(function(){r.toErrorMessage("Fejl! Feltet kunne ikke ændres!")})}e.page.title="IT System - Anvendelse",t.autoSaveUrl="api/itsystemusage/"+r.id,t.autosaveUrl2="api/itsystemusage/"+t.usage.id,t.usage=a,t.usageId=r.id,t.hasWriteAccess=p,t.businessTypes=l,t.archiveTypes=c,t.sensitiveDataTypes=d,t.appTypeOptions=f,t.hasViewAccess=o.currentOrganizationId==a.organizationId,t.systemCategories=s,u();var m=new Date;console.log(a),a.active?t.displayActive=!1:a.concluded<m&&m<a.expirationDate?t.displayActive=!0:t.displayActive=!1,a.overviewId&&(t.usage.overview={id:a.overviewId,text:a.overviewItSystemName}),t.datepickerOptions={format:"dd-MM-yyyy",parseFormats:["yyyy-MM-dd"]},t.orgUnits=a.usedBy,t.itSytemUsagesSelectOptions=function(e,r,i){return{minimumInputLength:1,allowClear:!0,placeholder:" ",initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(t){var r=i?"&"+i.join("&"):"",a=n.get(e+"?q="+t.data.query+r).then(t.success);return a.abort=function(){return null},a},results:function(e,n){var i=[];return _.each(e.data.response,function(e){r&&e.id==t.usageId||i.push({id:e.id,text:e.itSystem.name,cvr:e.cvr})}),{results:i}}}}}("api/itSystemUsage",!1,["organizationId="+a.organizationId]),t.patchDate=function(e,n){var r=moment(n,"DD-MM-YYYY"),a=moment();if(!r.isValid()||isNaN(r.valueOf())||r.year()<1e3||r.year()>2099)i.addErrorMessage("Den indtastede dato er ugyldig.");else{a.isBetween(moment(t.usage.concluded,"DD-MM-YYYY").startOf("day"),moment(t.usage.expirationDate,"DD-MM-YYYY").endOf("day"),null,"[]")||a.isSameOrAfter(moment(t.usage.concluded,"DD-MM-YYYY").startOf("day"))&&null==t.usage.expirationDate||a.isSameOrBefore(moment(t.usage.expirationDate,"DD-MM-YYYY").endOf("day"))&&null==t.usage.concluded||null==t.usage.expirationDate&&null==t.usage.concluded?t.usage.isActive=!0:t.usage.active?t.usage.isActive=!0:t.usage.isActive=!1;var s=r.format("YYYY-MM-DD"),l={};l[e]=s,g(l,t.autosaveUrl2+"?organizationId="+o.currentOrganizationId)}},t.checkSystemValidity=function(){var e=moment();e.isBetween(moment(t.usage.concluded,"DD-MM-YYYY").startOf("day"),moment(t.usage.expirationDate,"DD-MM-YYYY").endOf("day"),null,"[]")||e>moment(t.usage.concluded,"DD-MM-YYYY").startOf("day")&&null==t.usage.expirationDate||e<moment(t.usage.expirationDate,"DD-MM-YYYY").endOf("day")&&null==t.usage.concluded||null==t.usage.expirationDate&&null==t.usage.concluded?t.usage.isActive=!0:t.usage.active?t.usage.isActive=!0:t.usage.isActive=!1}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.org",{url:"/org",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-org.view.html",controller:"system.EditOrg",resolve:{selectedOrgUnits:["$http","$stateParams",function(e,t){var n=t.id;return e.get("api/itSystemUsageOrgUnitUsage/"+n).then(function(e){return e.data.response})}],responsibleOrgUnitId:["$http","$stateParams",function(e,t){var n=t.id;return e.get("api/itSystemUsageOrgUnitUsage/"+n+"?responsible=true").then(function(e){return e.data.response?e.data.response.id:null})}],orgUnitsTree:["$http","itSystemUsage",function(e,t){return e.get("api/organizationunit/?organization="+t.organizationId).then(function(e){return[e.data.response]})}]}})}]),t.controller("system.EditOrg",["$scope","$http","$stateParams","selectedOrgUnits","responsibleOrgUnitId","orgUnitsTree","notify","user",function(e,t,n,r,i,a,o,s){function l(e,t){if(e.id==t)return e;if(null!=e.children){for(var n=null,r=0;null==n&&r<e.children.length;r++)n=l(e.children[r],t);return n}return null}e.orgUnitsTree=a,e.selectedOrgUnits=r,e.responsibleOrgUnitId=i;var c=n.id;e.saveResponsible=function(){var n=e.responsibleOrgUnitId,r=o.addInfoMessage("Gemmer... ");e.responsibleOrgUnitId?t.post("api/itSystemUsageOrgUnitUsage/?usageId="+c+"&orgUnitId="+n+"&responsible=true").success(function(){r.toSuccessMessage("Gemt!")}).error(function(){r.toErrorMessage("Fejl! Kunne ikke gemmes!")}):t.delete("api/itSystemUsageOrgUnitUsage/?usageId="+c+"&responsible=true").success(function(){r.toSuccessMessage("Gemt!")}).error(function(){r.toErrorMessage("Fejl! Kunne ikke gemmes!")})},e.save=function(n){var r=o.addInfoMessage("Gemmer... ");n.selected?t.post("api/itSystemUsage/"+c+"?organizationunit="+n.id+"&organizationId="+s.currentOrganizationId).success(function(){r.toSuccessMessage("Gemt!"),e.selectedOrgUnits.push(n)}).error(function(){r.toErrorMessage("Fejl! Kunne ikke gemmes!")}):t.delete("api/itSystemUsage/"+c+"?organizationunit="+n.id+"&organizationId="+s.currentOrganizationId).success(function(){r.toSuccessMessage("Gemt!");var t;_.filter(e.selectedOrgUnits,function(e,r){var i=e.id==n.id;return i&&(t=r),i})&&e.selectedOrgUnits.splice(t,1),n.id==e.responsibleOrgUnitId&&(e.responsibleOrgUnitId="")}).error(function(){r.toErrorMessage("Fejl! Kunne ikke gemmes!")})};var d=_.map(r,"id");_.each(d,function(e){var t=l(a[0],e);t&&(t.selected=!0)})}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.proj",{url:"/proj",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-proj.view.html",controller:"system.EditProjCtrl",resolve:{user:["userService",function(e){return e.getUser()}]}})}]),t.controller("system.EditProjCtrl",["$scope","$http","$timeout","$state","$stateParams","notify","itSystemUsage","user",function(e,t,n,r,i,a,o,s){function l(){return r.transitionTo(r.current,i,{reload:!0}).then(function(){return e.hideContent=!0,n(function(){return e.hideContent=!1},1)})}e.itProjects=o.itProjects;var c=i.id;e.save=function(){t.post("api/itproject/"+e.selectedProject.id+"?usageId="+c+"&organizationId="+s.currentOrganizationId).success(function(){a.addSuccessMessage("Projektet er tilknyttet."),l()}).error(function(){a.addErrorMessage("Fejl! Kunne ikke tilknytte projektet!")})},e.delete=function(e){t.delete("api/itproject/"+e+"?usageId="+c+"&organizationId="+s.currentOrganizationId).success(function(){a.addSuccessMessage("Projektets tilknyttning er fjernet."),l()}).error(function(){a.addErrorMessage("Fejl! Kunne ikke fjerne projektets tilknyttning!")})},e.itProjectsSelectOptions={minimumInputLength:1,initSelection:function(e,t){},ajax:{data:function(e,t){return{query:e}},quietMillis:500,transport:function(e){var n=t.get("api/itProject?orgId="+s.currentOrganizationId+"&q="+e.data.query).then(e.success);return n.abort=function(){return null},n},results:function(e,t){var n=[];return _.each(e.data.response,function(e){n.push({id:e.id,text:e.name})}),{results:n}}}}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.references.create",{url:"/createReference/:id",onEnter:["$state","$stateParams","$uibModal","user",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"it-system-usage.referenceCreateModalCtrl",resolve:{itSystemUsage:["$http","$stateParams",function(e,t){return e.get("api/itSystemUsage/"+t.id).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("it-system-usage.referenceCreateModalCtrl",["$scope","$http","itSystemUsage","notify","user",function(e,t,n,r,i){e.dismiss=function(){e.$dismiss()},e.save=function(){var i=new Date,a={ItSystemUsage_Id:n.id,Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display,Created:i},o=r.addInfoMessage("Gemmer række",!1);t.post("api/Reference",a).success(function(t){o.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){o.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.references.edit",{url:"/editReference/:refId/:orgId",onEnter:["$state","$stateParams","$uibModal","$http",function(e,t,n,r){n.open({templateUrl:"app/components/it-reference/it-reference-modal.view.html",windowClass:"modal fade in",controller:"it-system-usage.referenceEditModalCtrl",resolve:{reference:["$http",function(e){return e.get("api/Reference/"+t.refId).then(function(e){return e.data.response})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}}).result.then(function(){e.go("^",null,{reload:!0})},function(){e.go("^")})}]})}]),t.controller("it-system-usage.referenceEditModalCtrl",["$scope","$http","reference","$stateParams","notify",function(e,t,n,r,i){e.reference=n,e.dismiss=function(){e.$dismiss()},e.save=function(){var n={Title:e.reference.title,ExternalReferenceId:e.reference.externalReferenceId,URL:e.reference.url,Display:e.reference.display},a=i.addInfoMessage("Gemmer række",!1);t.patch("api/Reference/"+r.refId+"?organizationId="+r.orgId,n).success(function(t){a.toSuccessMessage("Referencen er gemt"),e.$close(!0)}).error(function(){a.toErrorMessage("Fejl! Prøv igen")})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.references",{url:"/reference",templateUrl:"app/components/it-reference/it-reference.view.html",controller:"it-system-usage.EditReference"})}]),t.controller("it-system-usage.EditReference",["$scope","$http","$timeout","$state","$stateParams","itSystemUsage","$confirm","notify","hasWriteAccess",function(e,t,n,r,i,a,o,s,l){function c(){r.go(".",null,{reload:!0})}e.objectId=a.id,e.hasWriteAccess=l,e.referenceName=a.itSystem.name,e.setChosenReference=function(e){var n=e===a.referenceId?null:e,r={referenceId:n},i=s.addInfoMessage("Opdaterer felt...",!1);t.patch("api/itSystemUsage/"+a.id+"?organizationId="+a.organizationId,r).success(function(e){i.toSuccessMessage("Feltet er opdateret!"),c()}).error(function(){i.toErrorMessage("Fejl! Prøv igen.")})},e.deleteReference=function(e){var n=s.addInfoMessage("Sletter...");t.delete("api/Reference/"+e+"?organizationId="+a.organizationId).success(function(){n.toSuccessMessage("Slettet!")}).error(function(){n.toErrorMessage("Fejl! Kunne ikke slette!")}),c()},e.isValidUrl=function(e){if(e){return/(http || https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.toLowerCase())}return!1},e.edit=function(e){r.go(".edit",{refId:e,orgId:a.organizationId})},e.mainGridOptions={dataSource:{data:a.externalReferences,pageSize:10},sortable:!0,pageable:{refresh:!1,pageSizes:!0,buttonCount:5},columns:[{field:"title",title:"Dokumenttitel",template:function(e){return e.url?'<a target="_blank" href="'+e.url+'">'+e.title+"</a>":e.title},width:240},{field:"externalReferenceId",title:"Evt. dokumentID/Sagsnr./anden referenceContact"},{field:"created",title:"Oprettet",template:"#= kendo.toString(kendo.parseDate(created, 'yyyy-MM-dd'), 'dd. MMMM yyyy') #"},{field:"objectOwner.fullName",title:"Oprettet af",width:150},{title:"Rediger",template:function(t){var n="<button type='button' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' title='Redigér reference' data-ng-click=\"edit("+t.id+")\"><i class='fa fa-pencil' aria-hidden='true'></i></button>";return t.id!=a.referenceId&&(n+=" <button type='button' data-confirm-click=\"Er du sikker på at du vil slette?\" class='btn btn-link' title='Slet reference' data-confirmed-click='deleteReference("+t.id+")'><i class='fa fa-trash-o' aria-hidden='true'></i></button>"),t.url&&(n=t.id===a.referenceId?n+"<button data-uib-tooltip=\"Vises i overblik\" tooltip-placement='right' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' data-ng-click='setChosenReference("+t.id+")'><img class='referenceIcon chosen' src=\"/Content/img/VisIOverblik.svg\"/></button>":n+"<button data-uib-tooltip=\"Vis objekt i overblik\"  tooltip-placement='right' data-ng-disabled='"+!e.hasWriteAccess+"' class='btn btn-link' data-ng-click='setChosenReference("+t.id+")'><img class='referenceIcon' src=\"/Content/img/VisIOverblik.svg\"></img></button>"),n}}],toolbar:[{name:"addReference",text:"Tilføj reference",template:function(){return l?'<a id="addReferenceItSystemUsaged" class="btn btn-success btn-sm" href="\\#/system/usage/'+a.id+"/reference/createReference/"+a.id+"\"'>Tilføj reference</a>":""}}]}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.roles",{url:"/roles",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-roles.view.html",controller:"system.EditRoles",resolve:{itSystemRoles:["$http",function(e){return e.get("odata/ItSystemRoles").then(function(e){return e.data.value})}],localItSystemRoles:["$http",function(e){return e.get("odata/LocalItSystemRoles?$filter=IsLocallyAvailable eq true or IsObligatory&$orderby=Priority desc").then(function(e){return e.data.value})}],user:["userService",function(e){return e.getUser().then(function(e){return e})}]}})}]),t.controller("system.EditRoles",["$scope","$http","notify","itSystemUsage","itSystemRoles","localItSystemRoles","user",function(e,t,n,r,i,a,o){var s=r.id;e.activeItSystemRoles=a,e.itSystemRoles=i,e.newRole=1,e.orgId=o.currentOrganizationId,e.rights=[],_.each(r.rights,function(t){t.role=_.find(i,{Id:t.roleId}),t.show=!0;var n=_.find(e.activeItSystemRoles,{Id:t.roleId});!angular.isUndefined(n)&&n.Description&&(t.role.Description=n.Description),t.userForSelect={id:t.user.id,text:t.user.fullName},t.roleForSelect=t.roleId,e.rights.push(t)}),e.$watch("selectedUser",function(){e.submitRight()}),e.submitRight=function(){if(e.selectedUser&&e.newRole){var r=parseInt(e.newRole),i=e.selectedUser.id;if(r&&i){var l={roleId:r,userId:i};t.post("api/itSystemUsageRights/"+s+"?organizationId="+o.currentOrganizationId,l).success(function(t){n.addSuccessMessage(t.response.user.fullName+" er knyttet i rollen"),e.rights.push({objectId:t.response.objectId,roleId:t.response.roleId,userId:t.response.userId,user:t.response.user,userForSelect:{id:t.response.userId,text:t.response.user.fullName},roleForSelect:t.response.roleId,role:_.find(a,{Id:t.response.roleId}),show:!0}),e.newRole=1,e.selectedUser=""}).error(function(e){n.addErrorMessage("Fejl!")})}}},e.deleteRight=function(e){var r=e.roleId,i=e.userId;t.delete("api/itSystemUsageRights/"+s+"?rId="+r+"&uId="+i+"&organizationId="+o.currentOrganizationId).success(function(t){e.show=!1,n.addSuccessMessage("Rollen er slettet!")}).error(function(e){n.addErrorMessage("Kunne ikke slette rollen!")})},e.updateRight=function(r){if(r.roleForSelect&&r.userForSelect){if(!e.checkIfRoleIsAvailable(r.roleForSelect))return void(r.edit=!1);var i=r.roleId,l=r.userId,c=r.roleForSelect,d=r.userForSelect.id;i==c&&l==d&&(r.edit=!1),t.delete("api/itSystemUsageRights/"+s+"?rId="+i+"&uId="+l+"&organizationId="+o.currentOrganizationId).success(function(e){var i={roleId:c,userId:d};t.post("api/itSystemUsageRights/"+s+"?organizationId="+o.currentOrganizationId,i).success(function(e){r.roleId=e.response.roleId,r.user=e.response.user,r.userId=e.response.userId,r.role=_.find(a,{Id:r.roleId}),r.edit=!1,n.addSuccessMessage(r.user.fullName+" er knyttet i rollen")}).error(function(e){r.show=!1,n.addErrorMessage("Fejl!")})}).error(function(e){r.userForSelect={id:r.user.id,text:r.user.fullName},r.roleForSelect=r.roleId,n.addErrorMessage("Fejl!")})}},e.rightSortBy="roleName",e.rightSortReverse=!1,e.rightSort=function(t){switch(e.rightSortBy){case"roleName":return t.role.Priority;case"userName":return t.user.name;case"userEmail":return t.user.email;default:return t.role.Priority}},e.rightSortChange=function(t){e.rightSortBy==t?e.rightSortReverse=!e.rightSortReverse:e.rightSortReverse=!1,e.rightSortBy=t},e.checkIfRoleIsAvailable=function(t){return _.find(e.activeItSystemRoles,function(e){return e.Id===parseInt(t,10)})}}])}(angular,app),function(e,t){t.config(["$stateProvider",function(e){e.state("it-system.usage.wishes",{url:"/wishes",templateUrl:"app/components/it-system/usage/tabs/it-system-usage-tab-wishes.view.html",controller:"system.EditWishes",resolve:{user:["userService",function(e){return e.getUser()}],wishes:["$http","$stateParams","userService",function(e,t,n){return n.getUser().then(function(n){return e.get("api/wish/?userId="+n.id+"&usageId="+t.id).then(function(e){return e.data.response})})}]}})}]),t.controller("system.EditWishes",["$rootScope","$scope","$http","$state","$stateParams","notify","wishes","user",function(e,t,n,r,i,a,o,s){t.user=s,t.wishes=o,t.save=function(){var e={text:t.text,isPublic:t.isPublic,userId:s.id,itSystemUsageId:i.id},o=a.addInfoMessage("Gemmer... ");n.post("api/wish",e).success(function(){o.toSuccessMessage("Ønsket er gemt!"),r.go(".",null,{reload:!0})}).error(function(){o.toErrorMessage("Fejl! Ønsket kunne ikke gemmes!")})},t.delete=function(e){var t=a.addInfoMessage("Gemmer... ");n.delete("api/wish/"+e+"?organizationId="+s.currentOrganizationId).success(function(){t.toSuccessMessage("Ønsket er slettet!"),r.go(".",null,{reload:!0})}).error(function(){t.toErrorMessage("Fejl! Ønsket kunne ikke slettes!")})}}])}(angular,app);var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function e(){this.templateUrl="app/components/org/user/user-rights-details/user-rights.view.html",this.scope={userId:"@",currentOrganizationId:"@"}}return e.prototype.link=function(e,t,n){e.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:function(){return"/odata/Users("+e.userId+")/ItContractRights?$filter=Object/OrganizationId eq "+e.currentOrganizationId+"&$expand=Object($select=Name),Role($select=Name,HasWriteAccess)"},dataType:"json"}},sort:{field:"ObjectId",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0},noRecords:!0,messages:{noRecords:"Ingen kontrakt roller tilknyttet"},columns:[{field:"Object.Name",title:"IT Kontrakt",width:150,persistId:"contractname",template:function(e){return e.Object.Name},excelTemplate:function(e){return e.Object.Name},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Role.Name",title:"Rolle",width:150,persistId:"contractrole",template:function(e){return e.Role.Name},excelTemplate:function(e){return e.Role.Name},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Role.HasWriteAccess",title:"Skrive",width:150,persistId:"contractroleaccess",template:function(e){
return e.Role.HasWriteAccess?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}}]}},e.directiveName="userContractRoles",e}();angular.module("app").directive(n.directiveName,e.DirectiveFactory.getFactoryFor(n))}(t.Users||(t.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function e(){this.templateUrl="app/components/org/user/user-rights-details/user-rights.view.html",this.scope={userId:"@",currentOrganizationId:"@"}}return e.prototype.link=function(e,t,n){e.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:function(){return"/odata/Users("+e.userId+")/OrganizationUnitRights?$filter=Object/OrganizationId eq "+e.currentOrganizationId+"&$expand=Object($select=Name),Role($select=Name,HasWriteAccess)"},dataType:"json"}},sort:{field:"ObjectId",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0},noRecords:!0,messages:{noRecords:"Ingen organisationenheds roller tilknyttet"},columns:[{field:"Object.Name",title:"Organisationsenhed",width:150,persistId:"orgunitname",template:function(e){return e.Object.Name},excelTemplate:function(e){return e.Object.Name},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Role.Name",title:"Rolle",width:150,persistId:"orgunitrole",template:function(e){return e.Role.Name},excelTemplate:function(e){return e.Role.Name},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Role.HasWriteAccess",title:"Skrive",width:150,persistId:"orgunitroleaccess",template:function(e){return e.Role.HasWriteAccess?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}}]}},e.directiveName="userOrganizationUnitRoles",e}();angular.module("app").directive(n.directiveName,e.DirectiveFactory.getFactoryFor(n))}(t.Users||(t.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function e(){this.templateUrl="app/components/org/user/user-rights-details/user-rights.view.html",this.scope={userId:"@",currentOrganizationId:"@"}}return e.prototype.link=function(e,t,n){e.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:function(){return"/odata/Users("+e.userId+")/ItProjectRights?$filter=Object/OrganizationId eq "+e.currentOrganizationId+"&$expand=Object($select=Name),Role($select=Name,HasWriteAccess)"},dataType:"json"}},sort:{field:"ObjectId",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0},noRecords:!0,messages:{noRecords:"Ingen projekter roller tilknyttet"},columns:[{field:"Object.Name",title:"IT Projekt",width:150,persistId:"projectname",template:function(e){return e.Object.Name},excelTemplate:function(e){return e.Object.Name},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Role.Name",title:"Rolle",width:150,persistId:"projectrole",template:function(e){return e.Role.Name},excelTemplate:function(e){return e.Role.Name},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Role.HasWriteAccess",title:"Skrive",width:150,persistId:"projectroleaccess",template:function(e){return e.Role.HasWriteAccess?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}}]}},e.directiveName="userProjectRoles",e}();angular.module("app").directive(n.directiveName,e.DirectiveFactory.getFactoryFor(n))}(t.Users||(t.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){!function(t){"use strict";var n=function(){function e(){this.templateUrl="app/components/org/user/user-rights-details/user-rights.view.html",this.scope={userId:"@",currentOrganizationId:"@"}}return e.prototype.link=function(e,t,n){e.mainGridOptions={dataSource:{type:"odata-v4",transport:{read:{url:function(){return"/odata/Users("+e.userId+")/ItSystemRights?$filter=Object/OrganizationId eq "+e.currentOrganizationId+"&$expand=Object($expand=ItSystem($select=Name)),Role($select=Name,HasWriteAccess)"},dataType:"json"}},sort:{field:"ObjectId",dir:"asc"},pageSize:100,serverPaging:!0,serverSorting:!0,serverFiltering:!0},noRecords:!0,messages:{noRecords:"Ingen system roller tilknyttet"},columns:[{field:"Object.ItSystem.Name",title:"IT System",width:150,persistId:"systemname",template:function(e){return e.Object.ItSystem.Name},excelTemplate:function(e){return e.Object.ItSystem.Name},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Role.Name",title:"Rolle",width:150,persistId:"systemrole",template:function(e){return e.Role.Name},excelTemplate:function(e){return e.Role.Name},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}},{field:"Role.HasWriteAccess",title:"Skrive",width:150,persistId:"systemroleaccess",template:function(e){return e.Role.HasWriteAccess?'<span class="glyphicon glyphicon-check text-success" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>'},hidden:!1,filterable:{cell:{dataSource:[],showOperators:!1,operator:"contains"}}}]}},e.directiveName="userSystemRoles",e}();angular.module("app").directive(n.directiveName,e.DirectiveFactory.getFactoryFor(n))}(t.Users||(t.Users={}))}(e.Organization||(e.Organization={}))}(Kitos||(Kitos={}));
//# sourceMappingURL=maps/app-bundle.min.js.map
