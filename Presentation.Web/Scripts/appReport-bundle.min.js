function NotifyProvider(){"use strict";var e=5e3,t=!0,r=!0;return this.globalTimeToLive=function(t){e=t},this.onlyUniqueMessages=function(e){r=e},this.$get=["$rootScope","$filter","$timeout","$sce",function(i,n,o,a){function s(e){i.$broadcast("notifyDeleteMessage",e)}function u(t){t.autoclose&&(t.timeout&&(o.cancel(t.timeout),delete t.timeout),t.timeout=o(function(){s(t)},e))}function d(e){m&&(e.text=m(e.text)),i.$broadcast("notifyNewMessage",e),u(e)}function l(e,r,i){void 0===i&&(i=t);var n={text:a.trustAsHtml(e),severity:r,autoclose:i,update:function(e,r,i){void 0===i&&(i=t),this.text=a.trustAsHtml(e),this.severity=r,this.autoclose=i,n.closed?d(n):u(n)},toWarnMessage:function(e,t){this.update(e,"warn",t)},toErrorMessage:function(e,t){this.update(e,"error",t)},toInfoMessage:function(e,t){this.update(e,"info",t)},toSuccessMessage:function(e,t){this.update(e,"success",t)},close:function(){s(this)}};return d(n),n}function c(e,t){return l(e,"warn",t)}function g(e,t){return l(e,"error",t)}function p(e,t){return l(e,"info",t)}function f(e,t){return l(e,"success",t)}function h(){return r}var m;try{m=n("translate")}catch(e){}return{addWarnMessage:c,addErrorMessage:g,addInfoMessage:p,addSuccessMessage:f,onlyUnique:h}}],this}var Kitos;!function(e){!function(e){!function(e){!function(e){e[e.User=0]="User",e[e.LocalAdmin=1]="LocalAdmin",e[e.OrganizationModuleAdmin=2]="OrganizationModuleAdmin",e[e.ProjectModuleAdmin=3]="ProjectModuleAdmin",e[e.SystemModuleAdmin=4]="SystemModuleAdmin",e[e.ContractModuleAdmin=5]="ContractModuleAdmin",e[e.ReportModuleAdmin=6]="ReportModuleAdmin",e[e.ReadOnly=7]="ReadOnly"}(e.OrganizationRole||(e.OrganizationRole={}))}(e.Models||(e.Models={}))}(e.API||(e.API={}))}(Kitos||(Kitos={}));var app=angular.module("reportApp",["ui.router","ui.bootstrap","ngAnimate","ngSanitize","notify"]);app.constant("$",$).constant("_",_),angular.module("notify",[]),angular.module("notify").directive("notify",["$rootScope",function(e){"use strict";return{restrict:"A",template:'<div class="notify">\t<div class="notify-item alert" ng-repeat="message in messages" ng-class="computeClasses(message)">\t\t<button type="button" class="close" ng-click="deleteMessage(message)">&times;</button>       <div ng-bind-html="message.text"></div>\t</div></div>',replace:!1,scope:!0,controller:["$scope","$sce","$timeout","notify",function(t,r,i,n){function o(e){e.closed=!1,t.messages.push(e)}var a=n.onlyUnique();t.messages=[],e.$on("notifyNewMessage",function(e,r){var i;a?(angular.forEach(t.messages,function(e){r.text===e.text&&r.severity===e.severity&&(i=!0)}),i||o(r)):o(r)}),e.$on("notifyDeleteMessage",function(e,r){t.deleteMessage(r)}),t.deleteMessage=function(e){var r=t.messages.indexOf(e);r>-1&&(e.closed=!0,t.messages.splice(r,1))},t.computeClasses=function(e){return{"alert-success":"success"===e.severity,"alert-error":"error"===e.severity,"alert-danger":"error"===e.severity,"alert-info":"info"===e.severity,"alert-warning":"warn"===e.severity}}}]}}]),angular.module("notify").provider("notify",NotifyProvider);var Kitos;!function(e){!function(t){var r=function(){function e(e){this.$window=e}return e.prototype.getViewerOptions=function(){return new this.$window.Stimulsoft.Viewer.StiViewerOptions},e.prototype.getViewer=function(e,t){return new this.$window.Stimulsoft.Viewer.StiViewer(e,t,!1)},e.prototype.getReport=function(){return new this.$window.Stimulsoft.Report.StiReport},e.prototype.getVariable=function(){return new this.$window.Stimulsoft.Report.Dictionary.StiVariable},e.prototype.getODataDatabase=function(){return new this.$window.Stimulsoft.Report.Dictionary.StiODataDatabase},e.prototype.getDesignerOptions=function(){return new this.$window.Stimulsoft.Designer.StiDesignerOptions},e.prototype.getDesigner=function(e,t){return new this.$window.Stimulsoft.Designer.StiDesigner(e,t,!1)},e.prototype.setLocalizationFile=function(e){this.$window.Stimulsoft.Base.Localization.StiLocalization.setLocalizationFile(e)},e.$inject=["$window"],e}();t.StimulsoftService=r,angular.module("reportApp").service("stimulsoftService",e.Services.StimulsoftService)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(e){var t=function(){function e(e){var t=this;this.$http=e,this.baseUrl="/odata/reports",this.GetById=function(e){return t.$http.get(t.baseUrl+"("+e+")")},this.GetAll=function(e){return t.$http.get(t.baseUrl+"?$expand=CategoryType")},this.GetEmptyReport=function(){return t.$http.get("/appReport/empty-report.json")},this.saveReport=function(e){t.$http.patch(t.baseUrl+"("+e.Id+")",e)},this.getReportCategories=function(){return t.$http.get("/odata/ReportCategoryTypes")}}return e.$inject=["$http"],e}();e.ReportService=t,app.service("reportService",t)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){var r=function(){function t(t,r,i,n,o,a){var s=this;this.$http=t,this.$window=r,this.$q=i,this.$rootScope=n,this.$uibModal=o,this._=a,this._user=null,this._loadUserDeferred=null,this.saveUser=function(t,r){var i,n,o,a=r.organization,u=r.defaultOrgUnit,d=null==u?null:u.id,l=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.LocalAdmin&&t.organizationId==a.id}),c=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.OrganizationModuleAdmin&&t.organizationId==a.id}),g=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.ProjectModuleAdmin&&t.organizationId==a.id}),p=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.SystemModuleAdmin&&t.organizationId==a.id}),f=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.ContractModuleAdmin&&t.organizationId==a.id}),h=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.ReportModuleAdmin&&t.organizationId==a.id}),m=s._.some(t.organizationRights,function(t){return t.role==e.API.Models.OrganizationRole.ReadOnly&&t.organizationId==a.id});return null==d?(i=a.root.id,n=a.root.name,o=!1):(i=d,n=u.name,o=!0),s._user={isAuth:!0,id:t.id,name:t.name,lastName:t.lastName,fullName:t.fullName,email:t.email,phoneNumber:t.phoneNumber,uuid:t.uuid,defaultUserStartPreference:t.defaultUserStartPreference||"index",isGlobalAdmin:t.isGlobalAdmin,isLocalAdmin:l,isOrgAdmin:c,isProjectAdmin:g,isSystemAdmin:p,isContractAdmin:f,isReportAdmin:h,isReadOnly:m,orgAndDefaultUnit:r,currentOrganizationUnitId:i,currentOrganizationUnitName:n,isUsingDefaultOrgUnit:o,defaultOrganizationUnitId:d,currentOrganization:a,currentOrganizationId:a.id,currentOrganizationName:a.name,currentConfig:a.config},s.$rootScope.user=s._user,s._user},this.patchUser=function(e){var t=s.$q.defer();return null==s._user?t.reject("Not authenticated."):s.$http({method:"PATCH",url:"api/user/"+s._user.id+"?organizationId="+s._user.currentOrganizationId,data:e}).success(function(e){var r=e.response;s.saveUser(r,s._user.orgAndDefaultUnit),s._loadUserDeferred=null,t.resolve(s._user)}).error(function(){t.reject("Couldn't patch the user!")}),t.promise},this.getUser=function(){return s.reAuthorize()},this.reAuthorize=function(){var e=s.$q.defer();return e.resolve(s.loadUser(null)),e.promise},this.getOrganizations=function(){return s.$http.get("api/authorize/GetOrganizations")},this.getOrganizationWithDefault=function(e){return s.$http.get("api/authorize/GetOrganization("+e+")").then(function(e){return e.data.response})},this.getCurrentUserIfAuthorized=function(){return s.$http.get("api/authorize")},this.authorizeUser=function(e){return s.$http.post("api/authorize",e)},this.saveUserInfo=function(e,t){s.saveUser(e,t),s.setDefaultOrganizationInBackend(t.organization.id)},this.auth=function(t){return s.getUser().then(function(r){if(t){if(!s._.some(t,function(t){return"GlobalAdmin"===t&&r.isGlobalAdmin||t===e.Models.OrganizationRole.LocalAdmin&&r.isLocalAdmin}))return s.$q.reject("User doesn't have the required permissions")}return!0})},this.getSavedOrgId=function(){var e=localStorage.getItem("currentOrgId");return null!=e&&JSON.parse(e)},this.setSavedOrgId=function(e){localStorage.setItem("currentOrgId",JSON.stringify(e))},this.clearSavedOrgId=function(){localStorage.setItem("currentOrgId",null)},this.setDefaultOrganizationInBackend=function(e){s.$http.post("api/user?updateDefaultOrganization=true&organizationId="+e,void 0)},this.login=function(e,t,r){var i=s.$q.defer();if(e&&t){var n={email:e,password:t,rememberMe:r};s.loadUser(n).then(function(e){i.resolve(e)},function(e){i.reject(e)})}else i.reject("Email or password cannot be empty");return i.promise},this.loginSSO=function(e){var t=s.$q.defer(),r={token:e};return t.resolve(s.loadUser(r)),t.promise},this.logout=function(){return s.clearSavedOrgId(),s._loadUserDeferred=null,s._user=null,s.$rootScope.user=null,s.$http.post("api/authorize?logout",void 0)},this.loadUser=function(e){if(!s._loadUserDeferred){s._loadUserDeferred=s.$q.defer();(e?s.authorizeUser(e):s.getCurrentUserIfAuthorized()).then(function(e){var t=e.data.response;s.$rootScope.userHasOrgChoices=s._.uniqBy(t.organizationRights,"organizationId").length>1,s.determineLoginProcedure().then(function(e){s.saveUserInfo(t,e),s._loadUserDeferred.resolve(s._user),s._loadUserDeferred=null},function(){s._loadUserDeferred.reject("No organization selected"),s._loadUserDeferred=null})},function(e){s._loadUserDeferred.reject(e.data),s._loadUserDeferred=null,s.clearSavedOrgId()})}return s._loadUserDeferred.promise},this.determineLoginProcedure=function(){var e=s.$q.defer();if(s.currentlyLoggedIn()){var t=s.getSavedOrgId();t&&e.resolve(s.getOrganizationWithDefault(t))}else e.resolve(s.chooseOrganization());return e.promise},this.selectAvailableOrganization=function(e){var t=e.$values[0];return s.setSavedOrgId(t.organization.id),t},this.lastChosenOrganization=function(e,t){var r=s._.find(e.$values,function(e){return e.organization.id==t});if(null!=r)return r;s.clearSavedOrgId()},this.chooseOrganization=function(){var e=s.$q.defer();return s.getOrganizations().then(function(t){var r=t.data.response;if(!s.$rootScope.userHasOrgChoices){var i=s.getOrganizationWithDefault(r[0].id);return e.resolve(i),e.promise}s.showOrganizationsModal(r).result.then(function(t){t.userCancelled&&e.resolve(!0),s.setSavedOrgId(t.id);var r=s.getOrganizationWithDefault(t.id);e.resolve(r)},function(){e.reject("Modal dismissed")})}),e.promise},this.showOrganizationsModal=function(e){return s.$uibModal.open({backdrop:"static",templateUrl:"app/components/home/choose-organization.html",controller:["$scope","$uibModalInstance","autofocus",function(t,r,i){i(),t.organizations=e,t.orgChooser={selectedId:null},t.ok=function(){var e=s._.find(t.organizations,function(e){return e.id===t.orgChooser.selectedId});r.close(e)}}]})},this.changeOrganization=function(){var e=s.getSavedOrgId();s.clearSavedOrgId();var t=null,r=s.$q.defer();return s.getCurrentUserIfAuthorized().then(function(i){t=i.data.response,s.chooseOrganization().then(function(e){s.saveUserInfo(t,e),r.resolve(s._user)},function(t){s.setSavedOrgId(e),r.reject("Could not select an organization.")})},function(e){r.reject("Could not retrieve organizational context.")}),r.promise},this.updateDefaultOrgUnit=function(e){var t={orgId:s._user.currentOrganizationId,orgUnitId:e};return s.$http.post("api/user?updateDefaultOrgUnit",t)}}return t.prototype.currentlyLoggedIn=function(){return this.getSavedOrgId()},t.$inject=["$http","$window","$q","$rootScope","$uibModal","_"],t}();t.UserService=r,app.service("userService",r)}(e.Services||(e.Services={}))}(Kitos||(Kitos={}));var Kitos;!function(e){!function(t){"use strict";var r=function(){function e(e,t,r,i,n,o,a){var s=this;this.stimulsoftService=e,this.reportService=t,this.$window=r,this.notify=i,this.userService=n,this.$http=o,this._=a,this.emptyreport={ReportVersion:"2016.1.28",ReportGuid:"9ad83767ecc3b68cb62c086805556fce",ReportName:"Report",ReportAlias:"Report",ReportAuthor:"",ReportDescription:"",ReportCreated:"/Date(1472651877000+0200)/",ReportChanged:"/Date(1472651877000+0200)/",EngineVersion:"EngineV2",CalculationMode:"Interpretation",Dictionary:{Variables:{0:{Name:"CurrentOrganizationName",DialogInfo:{DateTimeType:"DateAndTime"},Alias:"CurrentOrganizationName",Type:"System.String",ReadOnly:!0}}},Pages:{0:{Ident:"StiPage",Name:"Page1",Guid:"a4875a4e-cd43-da99-360b-a7560ca0b913",Interaction:{Ident:"StiInteraction"},Border:";;2;;;;;solid:Black",Brush:"solid:Transparent",Components:{0:{Ident:"StiText",Name:"Text1",MinSize:"0,0",MaxSize:"0,0",ClientRectangle:"0.6,4.8,17.4,4.2",Interaction:{Ident:"StiInteraction"},Text:{Value:"Rapporten er tom og venter på at blive designet."},HorAlignment:"Center",Font:"Verdana;28;;",Border:";;;;;;;solid:Black",Brush:"solid:Transparent",TextBrush:"solid:Black",TextOptions:{WordWrap:!0},Type:"Expression"}},PageWidth:21.01,PageHeight:29.69,Watermark:{TextBrush:"solid:50,0,0,0"},Margins:{Left:1,Right:1,Top:1,Bottom:1}}}},this.getReportId=function(){var e=s.$window.location.search,t=/([0-9]+)/g,r=e.match(t),i=r[0];if(1===r.length)return parseInt(i)},this.buildViewerOptions=function(){var e=s.stimulsoftService.getViewerOptions();return e.appearance.scrollbarsMode=!0,e.toolbar.showDesignButton=s.canDesignReport,e.appearance.fullScreenMode=!0,e},this.buildDesignerOptions=function(){var e=s.stimulsoftService.getDesignerOptions();return e.appearance.fullScreenMode=!0,e.appearance.showSaveDialog=!1,e},this.loadReport=function(e,t){s.reportService.GetById(e).then(function(e){s.report=e.data,s.stiReport=s.stimulsoftService.getReport();var r=s.emptyreport;s.report.Definition&&s.report.Definition.length>0&&(r=JSON.parse(s.report.Definition)),r.ReportName=s.report.Name,r.ReportAlias=s.report.Name,r.ReportAuthor=t.fullName,r.ReportDescription=s.report.Description,r.ReportCreated=(new Date).toString(),s.stiReport.load(r);var i,n=!0;for(i=0;i<s.stiReport.dictionary.databases.count;i++)"Kitos"===s.stiReport.dictionary.databases.getByIndex(i).name&&(n=!1,s.stiReport.dictionary.databases.getByIndex(i).connectionString=window.location.origin+"/odata");if(n){var o=s.stimulsoftService.getODataDatabase();o.name="Kitos",o.alias="Kitos",o.connectionString=window.location.origin+"/odata",s.stiReport.dictionary.databases.add(o),s.stiReport.dictionary.synchronize()}var a=s.stimulsoftService.getVariable();a.name="CurrentOrganizationName",a.alias="CurrentOrganizationName",a.value=t.currentOrganizationName,a.description="Auto generated and injected variable",a.readOnly=!0,a.requestFromUser=!1,a.allowUseAsSqlParameter=!1,a.typeT=typeof String,a.category="",s.stiReport.dictionary.variables.add(a);var u=s.stimulsoftService.getVariable();u.name="CurrentOrganizationId",u.alias="CurrentOrganizationId",u.value=t.currentOrganizationId.toString(),u.description="Auto generated and injected variable",u.readOnly=!0,u.requestFromUser=!1,u.allowUseAsSqlParameter=!1,u.typeT=typeof String,u.category="",s.stiReport.dictionary.variables.add(u);var d=s.stimulsoftService.getVariable();d.name="CurrentUserName",d.alias="CurrentUserName",d.value=t.fullName,d.description="Auto generated and injected variable",d.readOnly=!0,d.requestFromUser=!1,d.allowUseAsSqlParameter=!1,d.typeT=typeof String,d.category="",s.stiReport.dictionary.variables.add(d);var l=s.stimulsoftService.getVariable();l.name="CurrentUserId",l.alias="CurrentUserId",l.value=t.id.toString(),l.description="Auto generated and injected variable",l.readOnly=!0,l.requestFromUser=!1,l.allowUseAsSqlParameter=!1,l.typeT=typeof String,l.category="",s.stiReport.dictionary.variables.add(l),s.viewer.report=s.stiReport}).catch(function(e){alert("Ingen adgang til rapporten!")})},this.designerSaveReport=function(e){s.report.Definition=e.report.saveToJsonString(),s.reportService.saveReport(s.report),s.viewer.report=e.report,s.notify.addSuccessMessage("Rapporten er gemt",!0)},this.designerOnExit=function(e){s.designer.visible=!1,s.viewer.report=e.report,s.viewer.visible=!0};var u=this;this.userService.getUser().then(function(t){s.$http.get("odata/GlobalConfigs").then(function(r){var i=r.data.value,n=a.find(i,function(e){return"CanGlobalAdminOnlyEditReports"===e.key});u.canDesignReport="true"===n.value?t.isGlobalAdmin:t.isGlobalAdmin||t.isLocalAdmin||t.isReportAdmin,s.viewer=e.getViewer(s.buildViewerOptions(),"Viewer"),s.viewer.onDesignReport=function(t){this.visible=!1,this.designer=e.getDesigner(u.buildDesignerOptions(),"designer"),this.designer.onExit=u.designerOnExit,this.designer.onSaveReport=u.designerSaveReport,this.designer.renderHtml("reportDesigner"),this.designer.visible=u.canDesignReport,this.designer.report=t.report},s.viewer.showProcessIndicator(),s.viewer.renderHtml("reportViewer"),s.loadReport(s.getReportId(),t)})})}return e.$inject=["stimulsoftService","reportService","$window","notify","userService","$http","_"],e}();t.ReportViewerController=r,angular.module("reportApp").controller("reportViewerController",e.Reports.ReportViewerController)}(e.Reports||(e.Reports={}))}(Kitos||(Kitos={}));
//# sourceMappingURL=maps/appReport-bundle.min.js.map
