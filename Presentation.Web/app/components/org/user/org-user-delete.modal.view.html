<div class="modal-header">
    <button type="button" class="close" data-ng-click="ctrl.cancel()" data-dismiss="modal">
        &times;
    </button>
    <h3 align="center">Slet bruger fra organisation</h3>
    <h5> Roller for {{ctrl.firstName}} {{ctrl.lastName}}, {{ctrl.email}}
    </h5></div>
<div class="modal-body">
    <h5 ng-show="ctrl.vmProject.length || ctrl.vmSystem.length || ctrl.vmItContracts.length || ctrl.vmOrgUnits.length || ctrl.vmOrgAdmin.length">
        Der ønskes at fjerne <b>{{ctrl.firstName}} {{ctrl.lastName}}</b> fra organisationen <b>{{ctrl.curOrganization}}</b>, der er fundet roller for vedkommende.
        Her ses brugerens tildelte roller.<br>
        Disse roller kan tildeles andre brugere eller slettes helt fra organisationen.
    </h5>
    <h5 ng-hide="ctrl.vmProject.length || ctrl.vmSystem.length || ctrl.vmItContracts.length || ctrl.vmOrgUnits.length || ctrl.vmOrgAdmin.length">Brugeren har ikke nogen tildelte roller i denne organisation</h5>
    
    <div ng-show="ctrl.vmProject.length || ctrl.vmSystem.length || ctrl.vmItContracts.length || ctrl.vmOrgUnits.length || ctrl.vmOrgAdmin.length">
        <label for="selectedUserId">Alloker roller til: &nbsp;</label>
        <select id="selectedUserId" ng-model="selectedUser" ng-click="ctrl.setSelectedUser(selectedUser)" style="-webkit-text-align-last: center; text-align-last: center;">
            <option selected disabled hidden style='display: none' value=''>Vælg bruger</option>
            <option ng-repeat="user in ctrl.vmUsersInOrganization | orderBy: user.LastName" value="{{user}}">
                {{user.Name}} {{user.LastName}}
            </option>
        </select>
    </div>

    <!-- Table containing organization data -->
    <table class="table table-hover" ng-show="{{ctrl.vmOrgUnits.length}}">
        <thead>
            <tr>
                <th>Vælg</th>
                <th>Organisation</th>
                <th>Rolle</th>
                <th>Allokere til</th>
                <th>Slet</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="orgUnit in ctrl.vmOrgUnits | orderBy: 'Rolle'">
            <!--<tr ng-repeat="orgUnit in ctrl.vmOrgRoles.items | orderBy: 'Role.Name'">-->  
                <!--ng-true-value doesn't accept dynamically allocated values-->
                <td><input type="checkbox" ng-disabled="ctrl.isUserSelected" ng-model="orgUnitModel" ng-change="ctrl.collectionUpdate('OrganizationUnitRights', orgUnit, orgUnitModel, selectedUser)" /></td>
                <td>{{orgUnit.Object.Name}}</td>
                <td>{{orgUnit.Role.Name}}</td>
                <td ng-show="orgUnitModel">{{ctrl.selecterUser.Name}} {{ctrl.selecterUser.LastName}}</td>
                <td ng-hide="orgUnitModel"> </td>
                <td><button class="glyphicon glyphicon-trash" ng-click="ctrl.delete('OrganizationUnitRights', orgUnit)"></button></td>
            </tr>
        </tbody>
    </table>
    <!-- Table containing project data -->
    <table class="table table-hover" ng-show="{{ctrl.vmProject.length}}">
        <thead>
            <tr>
                <th>Vælg</th>
                <th>Projektnavn</th>
                <th>Rolle</th>
                <th>Allokere til</th>
                <th>Slet</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="project in ctrl.vmProject | orderBy: 'project.Role.Name'">
                <td><input type="checkbox" ng-disabled="ctrl.isUserSelected" ng-model="projUnitModel" ng-change="ctrl.collectionUpdate('ItProjectRights', project, projUnitModel, selectedUser)"/></td>
                <td>{{project.Object.Name}}</td>
                <td>{{project.Role.Name}}</td>
                <td ng-show="projUnitModel">{{ctrl.selecterUser.Name}} {{ctrl.selecterUser.LastName}}</td>
                <td ng-hide="projUnitModel"> </td>
                <td><button class="glyphicon glyphicon-trash" ng-click="ctrl.delete('ItProjectRights', project)"></button></td>
            </tr>
        </tbody>
    </table>
    <!-- Table containing ItSystem data -->
    <table class="table table-hover" ng-show="{{ctrl.vmSystem.length}}">
        <thead>
            <tr>
                <th>Vælg</th>
                <th>Systemnavn</th>
                <th>Rolle</th>
                <th>Allokere til</th>
                <th>Slet</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="system in ctrl.vmSystem | orderBy: 'Rolle'">
                <td><input type="checkbox" ng-disabled="ctrl.isUserSelected" ng-model="systemUnitModel" ng-change="ctrl.collectionUpdate('ItSystemRights', system, systemUnitModel, selectedUser)" /></td>
                <td>{{system.Object.ItSystem.Name}}</td>
                <td>{{system.Role.Name}}</td>
                <td ng-show="systemUnitModel">{{ctrl.selecterUser.Name}} {{ctrl.selecterUser.LastName}}</td>
                <td ng-hide="systemUnitModel"> </td>
                <td><button class="glyphicon glyphicon-trash" ng-click="ctrl.delete('ItSystemRights', system)"></button></td>
            </tr>
        </tbody>
    </table>
    <!-- Table containing ItContract data -->
    <table class="table table-hover" ng-show="ctrl.vmItContracts.length">
        <thead>
            <tr>
                <th>Vælg</th>
                <th>Kontraktnavn</th>
                <th>Rolle</th>
                <th>Allokere til</th>
                <th>Slet</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="Contract in ctrl.vmItContracts | orderBy: 'Rolle'">
                <td><input type="checkbox" ng-disabled="ctrl.isUserSelected" ng-model="ContractUnitModel" ng-change="ctrl.collectionUpdate('ItContractRights', Contract, ContractUnitModel, selectedUser)" /></td>
                <td>{{Contract.Object.Name}}</td>
                <td>{{Contract.Role.Name}}</td>
                <td ng-show="ContractUnitModel">{{ctrl.selecterUser.Name}} {{ctrl.selecterUser.LastName}}</td>
                <td ng-hide="ContractUnitModel"> </td>
                <td><button class="glyphicon glyphicon-trash" ng-click="ctrl.delete('ItContractRights', Contract)"></button></td>
            </tr>
        </tbody>
    </table>
    <!-- Table containing administrative roller data -->
    <table class="table table-hover" ng-show="{{ctrl.vmOrgAdmin.length}}">
        <thead>
            <tr>
                <th>Vælg</th>
                <th>Adminstrative rettigheder</th>
                <th>Allokere til</th>
                <th>Slet</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="admin in ctrl.vmOrgAdmin">
                <td><input type="checkbox" ng-disabled="ctrl.isUserSelected" ng-model="adminModel" ng-change="ctrl.collectionUpdate('OrganizationRights', admin, adminModel, selectedUser)" /></td>
                <td>{{admin.Role}}</td>
                <td ng-show="adminModel">{{ctrl.selecterUser.Name}} {{ctrl.selecterUser.LastName}}</td>
                <td ng-hide="adminModel"> </td>
                <td><button class="glyphicon glyphicon-trash" ng-click="ctrl.delete('OrganizationRights', admin)"></button></td>
            </tr>
        </tbody>
    </table>
</div>

<div class="modal-footer">
    <button type="submit" class="btn btn-danger" data-ng-click="ctrl.deleteUser()" data-disabled-on-busy>Slet bruger</button>
    <button type="submit" ng-disabled="ctrl.isUserSelected" id="btnOk" class="btn btn-warning" data-ng-click="ctrl.ok()" data-disabled-on-busy>Tildel valgte og returner</button>
    <button type="submit" ng-disabled="ctrl.isUserSelected" id="btnAssign" class="btn btn-warning" data-ng-click="ctrl.assign()" data-disabled-on-busy>Tildel valgte</button>
    <button type="submit" class="btn btn-default" data-ng-click="ctrl.cancel()" data-disabled-on-busy>Annuller</button>
</div>